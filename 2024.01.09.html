<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2024-01-09 Tue 14:39 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OCaml Weekly News</title>
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<style type="text/css">#table-of-contents h2 { display: none } .title { display: none } .authorname { text-align: right }</style>
<style type="text/css">.outline-2 {border-top: 1px solid black;}</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">OCaml Weekly News</h1>
<p>
<a href="https://alan.petitepomme.net/cwn/2024.01.02.html">Previous Week</a> <a href="https://alan.petitepomme.net/cwn/index.html">Up</a> <a href="https://alan.petitepomme.net/cwn/2024.01.16.html">Next Week</a>
</p>

<p>
Hello
</p>

<p>
Here is the latest OCaml Weekly News, for the week of January 02 to 09, 2024.
</p>

<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#1">Odoc module index bookmarklet</a></li>
<li><a href="#2">create-melange-app 1.0.0 - A CLI for quickly becoming productive with Melange</a></li>
<li><a href="#3">What&rsquo;s possible with Melange</a></li>
<li><a href="#4">Ocaml-ts-mode - Emacs ocaml major mode using tree sitter</a></li>
<li><a href="#5">Using Menhir to parse into idiomatic JS (TypeScript) structures</a></li>
<li><a href="#6">Play with project-wide occurrences for OCaml!</a></li>
<li><a href="#7">New release of Menhir (20231231)</a></li>
<li><a href="#8">Ocsigen: summary of recent releases</a></li>
<li><a href="#9">sarif 0.1.0 - Static Analysis Results Interchange Format (SARIF) For OCaml</a></li>
<li><a href="#10">Other OCaml News</a></li>
<li><a href="#orga5993a1">Old CWN</a></li>
</ul>
</div>
</div>
<div id="outline-container-1" class="outline-2">
<h2 id="1">Odoc module index bookmarklet</h2>
<div class="outline-text-2" id="text-1">
<p>
Archive: <a href="https://discuss.ocaml.org/t/odoc-module-index-bookmarklet/13780/1">https://discuss.ocaml.org/t/odoc-module-index-bookmarklet/13780/1</a>
</p>
</div>
<div id="outline-container-org7dc3836" class="outline-3">
<h3 id="org7dc3836">Yawar Amin announced</h3>
<div class="outline-text-3" id="text-org7dc3836">
<p>
Hello, I made a <a href="https://yawaramin.github.io/bookmarklets/#h2-odoc-idx">bookmarklet</a>
that injects an index of a module&rsquo;s contents into the sidebar of an <span class="underline">odoc-generated
module documentation</span> page. For example, if you go to
<a href="https://aantron.github.io/dream/">https://aantron.github.io/dream/</a> , and run the bookmarklet, you will see:
</p>


<div id="org3d5253f" class="figure">
<p><img src="https://global.discourse-cdn.com/business7/uploads/ocaml/optimized/2X/b/b8ff2875a69e16df70772fe76e04f8bad334bc5d_2_1380x624.png" alt="b8ff2875a69e16df70772fe76e04f8bad334bc5d_2_1380x624.png" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-2" class="outline-2">
<h2 id="2">create-melange-app 1.0.0 - A CLI for quickly becoming productive with Melange</h2>
<div class="outline-text-2" id="text-2">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-create-melange-app-1-0-0-a-cli-for-quickly-becoming-productive-with-melange/13794/1">https://discuss.ocaml.org/t/ann-create-melange-app-1-0-0-a-cli-for-quickly-becoming-productive-with-melange/13794/1</a>
</p>
</div>
<div id="outline-container-org9e4cc2f" class="outline-3">
<h3 id="org9e4cc2f">Dillon Mulroy announced</h3>
<div class="outline-text-3" id="text-org9e4cc2f">
<p>
Hello y‚Äôall üëã
</p>

<p>
I have been working on creating a scaffolding tool aimed at enabling JavaScript and
TypeScript developers to quickly become familiar and productive with OCaml, ReasonML,
and Melange.  The developer experience, tooling, and project setup is opinionated and
meant to be familiar and friendly for folks coming from that ecosystem.
</p>

<p>
So, without further ado, I&rsquo;m excited to announce create-melange-app, 1.0.0!
</p>

<p>
Get started by simply running <code>npm create melange-app@latest</code> and completing the
questions that the CLI will guide you through.
</p>

<p>
Project setup:
</p>


<div id="org1cf6870" class="figure">
<p><img src="https://global.discourse-cdn.com/business7/uploads/ocaml/optimized/2X/f/f933ddbdd7f1a8471f82d58ded774eeeffc98800_2_900x932.jpeg" alt="f933ddbdd7f1a8471f82d58ded774eeeffc98800_2_900x932.jpeg" />
</p>
</div>

<p>
Scaffolding:
</p>


<div id="orga819d15" class="figure">
<p><img src="https://global.discourse-cdn.com/business7/uploads/ocaml/optimized/2X/c/c82f71d8455efb6d4e2de8275f7aecba72780294_2_900x564.jpeg" alt="c82f71d8455efb6d4e2de8275f7aecba72780294_2_900x564.jpeg" />
</p>
</div>


<div id="orgfc581fb" class="figure">
<p><img src="https://global.discourse-cdn.com/business7/uploads/ocaml/optimized/2X/9/929f373bee8384d50d017200f73c354e61ef916c_2_900x534.jpeg" alt="929f373bee8384d50d017200f73c354e61ef916c_2_900x534.jpeg" />
</p>
</div>

<p>
‚ú®Your new Melange app ‚ú®
</p>


<div id="org1d179e4" class="figure">
<p><img src="https://global.discourse-cdn.com/business7/uploads/ocaml/optimized/2X/e/eb0987302d99dfdb0ae87bf1bf371856fe27624d_2_900x576.jpeg" alt="eb0987302d99dfdb0ae87bf1bf371856fe27624d_2_900x576.jpeg" />
</p>
</div>


<div id="org70834cc" class="figure">
<p><img src="https://global.discourse-cdn.com/business7/uploads/ocaml/optimized/2X/6/6b3a945d63c3664a792894366e8ead786ef6b723_2_900x792.jpeg" alt="6b3a945d63c3664a792894366e8ead786ef6b723_2_900x792.jpeg" />
</p>
</div>

<p>
You can find the code/projected generated in this example here:
<a href="https://github.com/dmmulroy/create-melange-app-example">https://github.com/dmmulroy/create-melange-app-example</a>
</p>

<p>
I‚Äôve tried to take great care to provide as much helpful information for developers
unfamiliar with our ecosystem as possible. You‚Äôll find many of the scaffolded files
commented with explanations, examples, and additional resources aimed at quickly
becoming productive with OCaml, ReasonML, and Melange.
</p>

<p>
<b>Looking forward üëÄ</b>
</p>

<p>
I have a lot of ideas around making bindings easier and more pleasant to write for
manage, along with some delightful ways to integrate them into CMA.
</p>

<p>
But first&#x2026;
</p>

<p>
We&rsquo;re rewriting to native OCaml using <a href="https://github.com/leostera/minttea">MintTea</a>!
Currently <code>create-melange-app</code> is written using Melange and
<a href="https://github.com/vadimdemedes/ink">Ink</a>, a library for rendering React components
too the terminal.
</p>

<p>
When I started CMA, OCaml didn&rsquo;t have a great TUI story for easily making delightful
experiences (plus I wanted an excuse to go deeper with Melange, and doesn&rsquo;t a CLI
written with OCaml and React sound ridiculous? üòÇ)
</p>

<p>
I would love for CMA itself to be a great OSS project for beginners with OCaml to get
involved with and learn with and I&rsquo;m aiming to bring as many people along for that
ride as I can :)
</p>

<p>
You can follow my development of CMA on <a href="https://twitch.tv/dmmulroy">my twitch
channel</a> where I live stream OCaml content every M-F 7am - 10am ET
</p>

<p>
Thanks y&rsquo;all! üê´
</p>
</div>
</div>
</div>
<div id="outline-container-3" class="outline-2">
<h2 id="3">What&rsquo;s possible with Melange</h2>
<div class="outline-text-2" id="text-3">
<p>
Archive: <a href="https://discuss.ocaml.org/t/whats-possible-with-melange/13806/1">https://discuss.ocaml.org/t/whats-possible-with-melange/13806/1</a>
</p>
</div>
<div id="outline-container-org7789d55" class="outline-3">
<h3 id="org7789d55">David Sancho announced</h3>
<div class="outline-text-3" id="text-org7789d55">
<p>
Hi
</p>

<p>
Since dune got the integration with Melange (and Ahrefs migrated to Melange
<a href="https://discuss.ocaml.org/t/ahrefs-is-now-built-with-melange/12107">https://discuss.ocaml.org/t/ahrefs-is-now-built-with-melange/12107</a>) I wanted to write
about the benefits of using it.
</p>

<p>
I wrote a blog post comparing Melange with the previous compiler
(BuckleScript/ReScript) and what&rsquo;s possible. I tried to be objetive and focus only on
the technical parts of it.
</p>

<p>
The link to the post is: <a href="https://sancho.dev/blog/whats-possible-with-melange">https://sancho.dev/blog/whats-possible-with-melange</a>
</p>

<p>
Hope you like it, and feel free to ask anything!
</p>
</div>
</div>
</div>
<div id="outline-container-4" class="outline-2">
<h2 id="4">Ocaml-ts-mode - Emacs ocaml major mode using tree sitter</h2>
<div class="outline-text-2" id="text-4">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ocaml-ts-mode-emacs-ocaml-major-mode-using-tree-sitter/13807/1">https://discuss.ocaml.org/t/ocaml-ts-mode-emacs-ocaml-major-mode-using-tree-sitter/13807/1</a>
</p>
</div>
<div id="outline-container-org4c00d64" class="outline-3">
<h3 id="org4c00d64">Malcolm announced</h3>
<div class="outline-text-3" id="text-org4c00d64">
<p>
This weekend I got interested in emacs major modes based on treesitter, so I decided
to implement <code>ocaml-ts-mode</code>.  The code can be found here:
</p>

<p>
<a href="https://github.com/terrateamio/ocaml-ts-mode">https://github.com/terrateamio/ocaml-ts-mode</a>
</p>

<p>
It was actually very easy thanks to the hard work others have done in creating the
treesitter grammar.
</p>

<p>
It supports:
</p>

<ul class="org-ul">
<li>Syntax highlighting of <code>.ml</code> and <code>.mli</code> files.</li>
<li>Initial indentation support (this is probably currently broken in multiple places)</li>
<li><code>C-c C-a</code> - Switch between <code>.ml</code> and <code>.mli</code> files for a module.</li>
</ul>

<p>
This is less feature rich than Tuareg mode, so I don&rsquo;t know if it replaces it.  If
anything, maybe it could be integrated into tuareg mode.
</p>

<p>
I have no experience writing elisp so this probably has obvious mistakes.
Contributions welcome!
</p>

<p>
Enjoy!
</p>
</div>
</div>
<div id="outline-container-org73b02bc" class="outline-3">
<h3 id="org73b02bc">Malcolm then added</h3>
<div class="outline-text-3" id="text-org73b02bc">
<p>
Whoops, in my excitement learning about treesitter I didn&rsquo;t notice that there already
is an ocaml-ts-mode.  That one is probably the preferred one to use.  I&rsquo;ll probably
direct any of my development towards it.  But learning how to make a major mode was a
fun experience.
</p>
</div>
</div>
</div>
<div id="outline-container-5" class="outline-2">
<h2 id="5">Using Menhir to parse into idiomatic JS (TypeScript) structures</h2>
<div class="outline-text-2" id="text-5">
<p>
Archive: <a href="https://discuss.ocaml.org/t/using-menhir-to-parse-into-idiomatic-js-typescript-structures/13809/1">https://discuss.ocaml.org/t/using-menhir-to-parse-into-idiomatic-js-typescript-structures/13809/1</a>
</p>
</div>
<div id="outline-container-orgb15dc81" class="outline-3">
<h3 id="orgb15dc81">Shon announced</h3>
<div class="outline-text-3" id="text-orgb15dc81">
<p>
Hello and Happy New Year!
</p>

<p>
As we all know, despite being named an <a href="https://en.wikipedia.org/wiki/Caml">Objective Categorical Abstract Machine
Language</a>, OCaml is Obviously a Completely
Awesome [Meta Language](<a href="https://en.wikipedia.org/wiki/ML_(programming_language)">https://en.wikipedia.org/wiki/ML_(programming_language)</a>). The
awesomeness is founded on the wonderful language, but obviously completed by the
extraordinary ecosystem of tools and techniques that take life in that language.
:stuck_out_tongue_winking_eye:
</p>

<p>
This is a note to share a solution I hacked together using a handful of these awesome
tools in our lovely language, but also a request for any suggestions on a more
elegant solution to the problem posed.
</p>
</div>
<div id="outline-container-org580b8f9" class="outline-4">
<h4 id="org580b8f9">The Problem</h4>
<div class="outline-text-4" id="text-org580b8f9">
<p>
I wanted to use Menhir and Sedlex to write a fault-tolerant, incremental parser for a
preexisting project that has an intermediate representation (IR), and a bunch of
other tools, written in TypeScript.
</p>
</div>
</div>
<div id="outline-container-orgf3e8600" class="outline-4">
<h4 id="orgf3e8600">Non-solutions</h4>
<div class="outline-text-4" id="text-orgf3e8600">
<p>
Unfortunately, achieving this outcome was not quite as simple as adding a <code>(mode js)</code>
to dune to have the generated parser compiled by <a href="https://ocsigen.org/js_of_ocaml/latest/manual/overview">Js_os_ocaml (Jsoo)
</a>. Of course, that <b>does</b>
work like a charm, and if we could justify rewriting everything in OCaml, we&rsquo;d be
able to produce JS easy as pie. But for interop with the existing TypeScript code
this won&rsquo;t fly. We need to parse into JS objects that represent the IR in a
human-readable way, ideally matching our existing TypeScript types, but Jsoo gives
something like this.
</p>

<pre class="example" id="org6764052">
&gt; parser.parse('def foo(a,b) = 123')
[ 0, [ 0, [ 0, [Array], [Array] ], 0 ] ]
</pre>

<p>
My next thought was to use Melange: it seems to be a great project with a lot of
excellent work going in to it, and, iiuc, its purpose is precisely to compile OCaml
into idiomatic(ish) JS. But I hit a road block right away, which led me to ask
<a href="https://discuss.ocaml.org/t/what-are-the-limits-and-prerequisites-of-using-dependencies-with-melange/13688">https://discuss.ocaml.org/t/what-are-the-limits-and-prerequisites-of-using-dependencies-with-melange/13688</a>
and to try something else.
</p>
</div>
</div>
<div id="outline-container-orgad503d1" class="outline-4">
<h4 id="orgad503d1">A Solution</h4>
<div class="outline-text-4" id="text-orgad503d1">
<p>
Fortunately, the wealth of shining jewels-of-tools in the OCaml ecosystem made this
short work. The solution I ended up with is hacky as heck, but its doing what I
needed:
</p>

<ul class="org-ul">
<li>I define our types using the excellent <a href="https://github.com/ahrefs/atd">atd</a>.</li>
<li><p>
I generate OCaml and TypeScript representations of the types, along with JSON serializers, via a dune config like
</p>
<pre class="example" id="org8488523">
(library
 (public_name lang_ir)
 (libraries atdgen))

;; The OCaml ser/de-serializers
(rule
 (targets lang_ir_j.ml
          lang_ir_j.mli)
 (deps    lang_ir.atd)
 (action  (run atdgen -j -j-std %{deps})))

;; The OCaml types
(rule
 (targets lang_ir_t.ml
          lang_ir_t.mli)
 (deps    lang_ir.atd)
 (action  (run atdgen -t %{deps})))

;; The TypeScript types and ser/de
(rule
 (targets lang_ir.ts)
 (deps    lang_ir.atd)
 (action  (run atdts %{deps})))

;; Conversion of the TypeScript into vanilla JS so I can test it with node
(rule
 (targets lang_ir.js)
 (deps    lang_ir.ts)
 (action  (run npx tsc %{deps})))
</pre></li>
<li>I use menhir and sedlex to define a parser that produces inhabitants of the OCaml types generated in <code>lang_ir_t.ml</code>. (Working out the incremental, fault-tolerant parsing was its own exhilarating side quest, but I&rsquo;ll save a report on that for it&rsquo;s own post.)</li>
<li><p>
Then I use Jsoo to run the parser in JS and then serialize its optimized but inscritable representation into the JSON dictated by atd:
</p>
<div class="org-src-container">
<pre class="src src-ocaml">    <span style="color: #000000; font-weight: bold;">open </span><span style="color: #444fcf;">Lang_parser_lib</span>

    <span style="color: #000000; font-weight: bold;">open </span><span style="color: #444fcf;">Js_of_ocaml</span>

    <span style="color: #8f6f4a; font-style: italic;">(* </span><span style="color: #8f6f4a; font-style: italic;">Export functions</span><span style="color: #8f6f4a; font-style: italic;"> *)</span>
    <span style="color: #8f6f4a; font-style: italic;">(* </span><span style="color: #8f6f4a; font-style: italic;">See  https://ocsigen.org/js_of_ocaml/latest/manual/rev-bindings</span><span style="color: #8f6f4a; font-style: italic;"> *)</span>
    <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #007a9f;">_</span> =
    <span style="color: #444fcf;">Js.</span>export_all
        (<span style="color: #000000; font-weight: bold;">object</span><span style="color: #a2604f;">%js</span>
        <span style="color: #000000; font-weight: bold;">method</span> <span style="color: #a7601f;">parse</span> <span style="color: #007a9f;">s</span> =
            <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #007a9f;">lexbuf</span> = <span style="color: #444fcf;">Sedlexing.Utf8.</span>from_string s <span style="color: #000000; font-weight: bold;">in</span>
            <span style="color: #006f00; font-weight: bold;">match</span> parse lexbuf <span style="color: #006f00; font-weight: bold;">with</span> <span style="color: #8f6f4a; font-style: italic;">(* </span><span style="color: #8f6f4a; font-style: italic;">run the parser</span><span style="color: #8f6f4a; font-style: italic;"> *)</span>
            | <span style="color: #242521; background-color: #fcf7ef;">Some</span> t -&gt; <span style="color: #444fcf;">Lang_ir.Quint_ir_j.</span>string_of_t t <span style="color: #8f6f4a; font-style: italic;">(* </span><span style="color: #8f6f4a; font-style: italic;">produce a JSON string</span>
<span style="color: #8f6f4a; font-style: italic;">from the result</span><span style="color: #8f6f4a; font-style: italic;">*)</span>
            | <span style="color: #242521; background-color: #fcf7ef;">None</span> -&gt; <span style="color: #ca3400;">""</span>
        <span style="color: #000000; font-weight: bold;">end</span>)
</pre>
</div></li>
<li><p>
And, finally, I make a little <code>wrapper.js</code> that invokes the atd-generated deserializer to parse into the TypeScript representation:
</p>
<div class="org-src-container">
<pre class="src src-js"><span style="color: #006f00; font-weight: bold;">var</span> <span style="color: #007a9f;">ir</span> = require(<span style="color: #ca3400;">'./_build/default/ir/lang_ir.js'</span>)
<span style="color: #006f00; font-weight: bold;">var</span> <span style="color: #007a9f;">parser</span> = require(<span style="color: #ca3400;">'./_build/default/js/lang_parser.bc.js'</span>)

exports.parse = <span style="color: #006f00; font-weight: bold;">function</span> (<span style="color: #007a9f;">s</span>) {
  <span style="color: #006f00; font-weight: bold;">return</span> ir.readT(JSON.parse(parser.parse(s)))
}
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-orgac86fc1" class="outline-4">
<h4 id="orgac86fc1">The result</h4>
<div class="outline-text-4" id="text-orgac86fc1">
<p>
I now can use the wrapper script to parse into the nice TypeScript (compatible)
structures I need:
</p>

<pre class="example" id="org5573a6a">
[me@comp mparsing]$ node
&gt; var p = require('./wrapper.js')
undefined
&gt; p.parse("def foo(a,b) = 123")
[
{
    loc: { start_: [Object], end_: [Object] },
    v: { name: 'foo', params: [Array], body: [Object] }
}
]
</pre>

<p>
I have three hopes for this post:
</p>

<ol class="org-ol">
<li>I hope to contribute yet another note celebrating the virtues of our extraordinary programming language ecosystem.</li>
<li>I hope it might be useful for others who need to solve similar problems.</li>
<li>I hope there is a more elegant way to achieve this result (namely, without having to go through serialization) and that one of y&rsquo;all can point the way.</li>
</ol>

<p>
:heart: :camel:
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-6" class="outline-2">
<h2 id="6">Play with project-wide occurrences for OCaml!</h2>
<div class="outline-text-2" id="text-6">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-preview-play-with-project-wide-occurrences-for-ocaml/13814/1">https://discuss.ocaml.org/t/ann-preview-play-with-project-wide-occurrences-for-ocaml/13814/1</a>
</p>
</div>
<div id="outline-container-orgec490b0" class="outline-3">
<h3 id="orgec490b0">vds announced</h3>
<div class="outline-text-3" id="text-orgec490b0">
<p>
Hi fellow camelers üëã, I am very pleased to announce that every one can now try the
upcoming project-wide occurrences feature for Merlin and OCaml-LSP.
</p>

<p>
This feature involves changes to multiple packages such as <code>ocaml</code>, <code>merlin</code>,
<code>ocaml-lsp</code> and <code>dune</code> so we decided to prepare a custom opam repository to make it
easy for adventurous people to install the feature, play with it, and
most-importantly&#x2026; break it ! We hope you will have as much fun querying around your
codebases as we do :-)
</p>
</div>
<div id="outline-container-org161fd7d" class="outline-4">
<h4 id="org161fd7d">Requirements for this preview:</h4>
<div class="outline-text-4" id="text-org161fd7d">
<ul class="org-ul">
<li>Have projects compatible with <i>OCaml 4.14.2</i>.</li>
<li>These projects build with <i>Dune</i>. (The tools themselves are build-system agnostic, but this preview only include rules for Dune.)</li>
<li>You use an <i>LSP-based editor plugin</i>. (We do plan to bring basic support to the vanilla <code>emacs</code> and <code>vim</code> modes for Merlin.)</li>
</ul>
</div>
</div>
<div id="outline-container-org919f8c5" class="outline-4">
<h4 id="org919f8c5">What the feature does&#x2026;</h4>
<div class="outline-text-4" id="text-org919f8c5">
<ul class="org-ul">
<li>‚úÖ Returns every <b>usages</b> of types, values, constructors and labels in <code>ml</code> and <code>mli</code> files in the workspace</li>
<li>‚úÖ Returns direct usages of modules (like <code>M</code> in <code>include M</code>)</li>
<li>‚úÖ Can be called on any such usage of a value or on its <b>definition</b> itself</li>
</ul>
</div>
</div>
<div id="outline-container-orgf43af9e" class="outline-4">
<h4 id="orgf43af9e">&#x2026;what is does not do yet:</h4>
<div class="outline-text-4" id="text-orgf43af9e">
<ul class="org-ul">
<li>‚ùå Return <b>declarations</b> related to searched values in both <b>ml</b> and <b>mli</b> files. This will come in a second iteration.</li>
<li>‚ùå Occurrences of modules appearing in paths: like <code>M</code> and <code>N</code> in <code>M.N.P</code>. This will also arrive later.</li>
<li>‚ö†Ô∏è Renaming is experimental and not as smart as one would expect (with regard to punning and other syntactic tricks).</li>
</ul>
</div>
</div>
<div id="outline-container-org17ef413" class="outline-4">
<h4 id="org17ef413">&#x2026;and known caveats:</h4>
<div class="outline-text-4" id="text-org17ef413">
<ul class="org-ul">
<li>‚ö†Ô∏è Interaction with PPX might give unexpected results depending on the specifics of the PPX.</li>
<li>‚ö†Ô∏è Values whose definition cannot be determined statically (like items of a first-class module) won&rsquo;t be searched project-wide. For the same reason, walues coming from libraries that do not install their <code>cmt</code> files won&rsquo;t be searched project-wide.</li>
</ul>
</div>
</div>
<div id="outline-container-orgfd692cd" class="outline-4">
<h4 id="orgfd692cd">Demo</h4>
<div class="outline-text-4" id="text-orgfd692cd">
<p>
In the following demo, the feature is used to rename a symbol in Merlin. Since the
name appears in one <b>declaration</b>,  this last occurrence still needs to be replaced
by hand for the build to succeed:
</p>


<div id="org4811d7d" class="figure">
<p><img src="https://global.discourse-cdn.com/business7/uploads/ocaml/original/2X/5/5f9380fcc7e841c54e018a390946eaa801ff4241.gif" alt="5f9380fcc7e841c54e018a390946eaa801ff4241.gif" />
</p>
</div>
</div>
</div>
<div id="outline-container-orgdc19e4e" class="outline-4">
<h4 id="orgdc19e4e">Setup</h4>
<div class="outline-text-4" id="text-orgdc19e4e">
<p>
You can find detailed setup instruction in the <a href="https://github.com/voodoos/opam-repository-index">custom opam
repository</a>. In short:
</p>

<ol class="org-ol">
<li>Add the repository to your opam installation: <code>opam repo add index https://github.com/voodoos/opam-repository-index.git</code></li>
<li>Create a switch  (global or local) with the <code>+index</code> ocaml variant: <code>opam switch create --repositories=default,index 4.14.2+index</code></li>
<li>Install <code>merlin</code>, <code>ocaml-lsp</code> and the indexer: <code>opam install indexing-tools</code></li>
<li>Build the index with your project: <code>dune build @ocaml-index @your-usual-target-maybe-install-or-all --watch</code></li>
</ol>

<p>
References and renaming queries should return result on the entire workspace.
</p>
</div>
</div>
<div id="outline-container-orga834cbf" class="outline-4">
<h4 id="orga834cbf">Feedback</h4>
<div class="outline-text-4" id="text-orga834cbf">
<p>
Please do not hesitate to share any feedback on the feature here or by <a href="https://github.com/voodoos/opam-repository-index/issues">opening an
issue on the repository</a>
:slightly_smiling_face:
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-7" class="outline-2">
<h2 id="7">New release of Menhir (20231231)</h2>
<div class="outline-text-2" id="text-7">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-new-release-of-menhir-20231231/13816/1">https://discuss.ocaml.org/t/ann-new-release-of-menhir-20231231/13816/1</a>
</p>
</div>
<div id="outline-container-org45bbd71" class="outline-3">
<h3 id="org45bbd71">Fran√ßois Pottier announced</h3>
<div class="outline-text-3" id="text-org45bbd71">
<p>
It is my pleasure to announce a new version of Menhir, 20231231.
It should be available now:
</p>

<pre class="example" id="org89b9cd1">
opam update
opam install menhir.20231231
</pre>

<p>
The main new features are as follows:
</p>

<ul class="org-ul">
<li><p>
The new command line switch <code>--unparsing</code> (which must be used in conjunction
with <code>--table</code>) causes Menhir to generate an unparsing API. In short,
unparsing is the process of transforming abstract syntax trees back into
text. The unparsing API is intended to help users write correct unparsers,
but does not automate the whole process.
</p>

<p>
For more details, please see the paper <a href="http://cambium.inria.fr/~fpottier/publis/pottier-unparsing-2024.pdf">Correct, Fast LR(1)
Unparsing</a>.
</p>

<p>
The unparsing API requires linking with the library <code>MenhirCST</code>, and
requires OCaml 4.08.
</p></li>

<li><p>
Attributes can now be attached with a production. (In previous versions of
Menhir, attributes could be attached only with a symbol, with a specific
occurrence of a symbol in the right-hand side of a production, or with the
whole grammar.) This is achieved by letting one or more attributes appear
immediately after the semantic action.
</p>

<p>
During the two grammar transformation phases (expansion of parameterized
nonterminal symbols and elimination of <code>%inline</code> nonterminal symbols), the
<code>[@name]</code> attributes attached with productions receive special treatment,
so as to allow each production to receive a unique name.
</p></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-8" class="outline-2">
<h2 id="8">Ocsigen: summary of recent releases</h2>
<div class="outline-text-2" id="text-8">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ocsigen-summary-of-recent-releases/13817/1">https://discuss.ocaml.org/t/ocsigen-summary-of-recent-releases/13817/1</a>
</p>
</div>
<div id="outline-container-orgfc75040" class="outline-3">
<h3 id="orgfc75040">Vincent Balat announced</h3>
<div class="outline-text-3" id="text-orgfc75040">
<p>
We do not announce very often our releases on this forum. Here is a roundup of recent
releases to make amends.
</p>

<p>
Many releases of <a href="http://ocsigen.org/js_of_ocaml">Js_of_ocaml</a> last year, with
important features like the support of OCaml 5 effects, global dead-code elimination,
support for modern JavaScript and <a href="https://github.com/ocsigen/js_of_ocaml/blob/master/CHANGES.md">a huge list of improvements and
fixes</a>.
There is now also a new backend for js_of_ocaml,
<a href="https://github.com/ocaml-wasm/wasm_of_ocaml">Wasm_of_ocaml</a> written by @vouillon, to
compile to WebAssembly. It can be used as a replacement for js_of_ocaml with very few
changes.
</p>

<p>
<a href="http://ocsigen.org/eliom">Eliom</a>, the OCaml Web framework, has now reached version
10.2. Amongst the most recent changes:
</p>
<ul class="org-ul">
<li>The Dune-based build system is now the default one for client-server apps</li>
<li>compatibility with OCaml 5</li>
<li>Reactive programming: Update to recent versions of js_of_ocaml, which support weak pointers</li>
<li>Documentation improvements</li>
</ul>

<p>
An <a href="https://github.com/ocsigen/eliom/pull/767">experimental version</a> is also
available to build WASM applications with wasm_of_ocaml
</p>

<p>
<a href="http://ocsigen.org/ocsigen-start">Ocsigen-Start</a> version 6.1
</p>
<ul class="org-ul">
<li>removes a dependency on Ocamlnet to make it compatible with OCaml 5. No default email function is now provided. Warning: this might be a regression if you use the default email-sending function.</li>
<li>updates the dune-based build system</li>
</ul>

<p>
<a href="http://ocsigen.org/tyxml">Tyxml</a> 4.6 was released with
<a href="https://github.com/ocsigen/tyxml/releases">fixes</a> on some tags and options.
</p>

<p>
<a href="http://ocsigen.org/lwt">Lwt</a> reach version
<a href="https://github.com/ocsigen/lwt/releases/tag/5.7.0">5.7</a>
</p>

<p>
Several maintenance releases of <a href="http://ocsigen.org/ocsigen-toolkit">Ocsigen-Toolkit</a>
</p>

<p>
The Ocsigen team wishes you a happy new year!
</p>
</div>
</div>
</div>
<div id="outline-container-9" class="outline-2">
<h2 id="9">sarif 0.1.0 - Static Analysis Results Interchange Format (SARIF) For OCaml</h2>
<div class="outline-text-2" id="text-9">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-sarif-0-1-0-static-analysis-results-interchange-format-sarif-for-ocaml/13821/1">https://discuss.ocaml.org/t/ann-sarif-0-1-0-static-analysis-results-interchange-format-sarif-for-ocaml/13821/1</a>
</p>
</div>
<div id="outline-container-org47b322d" class="outline-3">
<h3 id="org47b322d">Geoffrey Borough announced</h3>
<div class="outline-text-3" id="text-org47b322d">
<p>
Hi folks, I announce the initial release of sarif version 0.1.0, a library for
processing and validating the SARIF format. If you are familiar with static analysis
and/or code scanner like Semgrep or Snyk etc, SARIF is one of the output format that
people generate and share after scanning, the specification itself is quite big and
convoluted.
</p>

<p>
My motivation for making this library is that there seems to be no definitive library
for SARIF in the OCaml ecosystem, and even companies like Semgrep relies on some
python glue code to generate the format. Given OCaml&rsquo;s importance in the static
analysis scene I thought it would be nice if this gets over the line :slight_smile:
</p>

<p>
Code: <a href="https://github.com/gborough/sarif">https://github.com/gborough/sarif</a>
</p>

<p>
Documentation: <a href="https://gborough.github.io/sarif/sarif/sarif/index.html">https://gborough.github.io/sarif/sarif/sarif/index.html</a> (Package
available very soon in opam-repository pending PR approval)
</p>

<p>
Have a nice day!
</p>
</div>
</div>
</div>
<div id="outline-container-10" class="outline-2">
<h2 id="10">Other OCaml News</h2>
<div class="outline-text-2" id="text-10">
</div>
<div id="outline-container-org1454471" class="outline-3">
<h3 id="org1454471">From the ocaml.org blog</h3>
<div class="outline-text-3" id="text-org1454471">
<p>
Here are links from many OCaml blogs aggregated at <a href="https://ocaml.org/blog/">the ocaml.org blog</a>.
</p>

<ul class="org-ul">
<li><a href="https://practicalocaml.com/parsing-with-binary-string-pattern-matching/">Parsing with Binary String Pattern Matching</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orga5993a1" class="outline-2">
<h2 id="orga5993a1">Old CWN</h2>
<div class="outline-text-2" id="text-orga5993a1">
<p>
If you happen to miss a CWN, you can <a href="mailto:alan.schmitt@polytechnique.org">send me a message</a> and I&rsquo;ll mail it to you, or go take a look at <a href="https://alan.petitepomme.net/cwn/">the archive</a> or the <a href="https://alan.petitepomme.net/cwn/cwn.rss">RSS feed of the archives</a>.
</p>

<p>
If you also wish to receive it every week by mail, you may subscribe to the <a href="https://sympa.inria.fr/sympa/info/caml-list">caml-list</a>.
</p>

<div class="authorname" id="org16579db">
<p>
<a href="https://alan.petitepomme.net/">Alan Schmitt</a>
</p>

</div>
</div>
</div>
</div>
</body>
</html>
