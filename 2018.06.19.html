<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2018-06-19 Tue 15:20 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OCaml Weekly News</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<style type="text/css">#table-of-contents h2 { display: none } .title { display: none } .authorname { text-align: right }</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">OCaml Weekly News</h1>
<p>
<a href="http://alan.petitepomme.net/cwn/2018.06.12.html">Previous Week</a> <a href="http://alan.petitepomme.net/cwn/index.html">Up</a> <a href="http://alan.petitepomme.net/cwn/2018.06.26.html">Next Week</a>
</p>

<p>
Hello
</p>

<p>
Here is the latest OCaml Weekly News, for the week of June 12 to 19, 2018.
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#1">New tool to generate the CWN</a></li>
<li><a href="#2">You like parmap? You like parany?</a></li>
<li><a href="#3">opam-check-all: Are your packages broken for the upcoming OCaml releases?</a></li>
<li><a href="#4">OCaml job opportunity at Citrix in Cambridge UK</a></li>
<li><a href="#5">Omod 0.0.1</a></li>
<li><a href="#6">Tools for logic programming in OCaml</a></li>
<li><a href="#7">opam-ci: first release of a tool to check the health of your packages</a></li>
<li><a href="#8">Does OCaml ecosystem have CSS preprocessors?</a></li>
<li><a href="#orgdf0779d">Old CWN</a></li>
</ul>
</div>
</div>


<hr />

<div id="outline-container-orgb259c60" class="outline-2">
<h2 id="1"><a id="orgb259c60"></a>New tool to generate the CWN</h2>
<div class="outline-text-2" id="text-1">
<p>
Archive: <a href="https://framagit.org/brab/cwn">https://framagit.org/brab/cwn</a>
</p>

<p>
<i>The editor announced:</i>
</p>


<p>
Thanks to the hard work of <a href="https://github.com/cloudyhug">Enzo Crance</a>, we now have an OCaml-based tool to generate the OCaml weekly news. We now use <a href="http://orgmode.org/">Org mode</a> for the conversion to html and text. Please don't hesitate to <a href="mailto:alan.schmitt@polytechnique.org">contact me</a> for any bug report or suggestion.
</p>




<hr />
</div>
</div>

<div id="outline-container-org46aedff" class="outline-2">
<h2 id="2"><a id="org46aedff"></a>You like parmap? You like parany?</h2>
<div class="outline-text-2" id="text-2">
<p>
Archive: <a href="https://discuss.ocaml.org/t/you-like-parmap-you-like-parany/2131/1">https://discuss.ocaml.org/t/you-like-parmap-you-like-parany/2131/1</a>
</p>

<p>
<i>UnixJunkie announced:</i>
</p>


<p>
So, here comes parpair:
<a href="https://github.com/UnixJunkie/parpair">https://github.com/UnixJunkie/parpair</a>
</p>

<p>
The ultimate step in minimalist parallel programming.
</p>

<p>
Of course, your function needs to be pretty heavy in order
for the computation to be accelerated.
</p>




<hr />
</div>
</div>

<div id="outline-container-org39e6145" class="outline-2">
<h2 id="3"><a id="org39e6145"></a>opam-check-all: Are your packages broken for the upcoming OCaml releases?</h2>
<div class="outline-text-2" id="text-3">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-opam-check-all-are-your-packages-broken-for-the-upcoming-ocaml-releases/1875/28">https://discuss.ocaml.org/t/ann-opam-check-all-are-your-packages-broken-for-the-upcoming-ocaml-releases/1875/28</a>
</p>

<p>
<i>Continuing this discussion, Kate announced:</i>
</p>


<p>
The service now has a proper domain name: <a href="http://check.ocamllabs.io/">http://check.ocamllabs.io/</a>
</p>




<hr />
</div>
</div>

<div id="outline-container-org66d0852" class="outline-2">
<h2 id="4"><a id="org66d0852"></a>OCaml job opportunity at Citrix in Cambridge UK</h2>
<div class="outline-text-2" id="text-4">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ocaml-job-opportunity-at-citrix-in-cambridge-uk/2132/1">https://discuss.ocaml.org/t/ocaml-job-opportunity-at-citrix-in-cambridge-uk/2132/1</a>
</p>

<p>
<i>Christian Lindig announced:</i>
</p>


<p>
The Citrix office in Cambridge develops the
<a href="https://www.citrix.co.uk/products/xenserver/">XenServer</a> hypervisor which is
open source and builds on <a href="https://www.xenproject.org">Xen</a>. The toolstack part
of the product, which orchestrates the VMs, is developed in OCaml (see
<a href="http://www.github.com/xapi-project">GitHub</a>) and the team is looking for an
engineer with strong affinity to functional programming in the Unix environment.
Feel free to send me an email at <a href="mailto:christian.lindig@citrix.com">christian.lindig@citrix.com</a> with any questions.
Below is the official job description.
</p>

<p>
<a href="https://jobs.citrix.com/job/CITRA005811517/Software-Engineer-Functional-Programming">https://jobs.citrix.com/job/CITRA005811517/Software-Engineer-Functional-Programming</a>
</p>




<hr />
</div>
</div>

<div id="outline-container-orgc2922a1" class="outline-2">
<h2 id="5"><a id="orgc2922a1"></a>Omod 0.0.1</h2>
<div class="outline-text-2" id="text-5">
<p>
Archive: <a href="https://sympa.inria.fr/sympa/arc/caml-list/2018-06/msg00020.html">https://sympa.inria.fr/sympa/arc/caml-list/2018-06/msg00020.html</a>
</p>

<p>
<i>Daniel Bünzli announced:</i>
</p>


<p>
I'd like to announce <code>omod</code> which provides data-driven module toplevel loaders.
</p>

<p>
Like <code>ocamlfind</code> it allows to load compilation objects and their dependencies in
the toplevel. However <code>omod</code> works without additional metadata files and with
top level (compilation unit) module names rather than ocamlfind package or
archive names.
</p>

<p>
This means you only need to know the name of the module you want to load rather
than having to remember in which <code>ocamlfind</code> package or archive it lives.
</p>

<p>
It should work well in <code>ocaml</code>, <code>ocamlnat</code>[0] and <code>utop</code>. To get started type:
</p>

<div class="org-src-container">
<pre class="src src-shell">opam install omod
</pre>
</div>

<p>
and follow the [tutorial][1]. More information on how <code>omod</code> came to be is given below [2].
</p>

<p>
omod is ISC licensed and can be found at <a href="http://erratique.ch/software/omod">http://erratique.ch/software/omod</a>
</p>

<p>
Best,
</p>

<p>
Daniel
</p>

<p>
P.S. Currently <code>omod</code> doesn't work with opam system compilers.
</p>

<p>
[0]
One issue with <code>ocamlnat</code> is that some libraries lack their <code>cmxs</code> files. E.g.
the lack of <code>threads.cmxs</code> prevents the <code>Core</code> module from loading. But other
ones like <code>Irmin</code>, <code>Containers</code> or <code>Base</code> do however load in <code>ocamlnat</code> via
<code>omod</code>.
</p>

<p>
[1]: <a href="http://erratique.ch/software/omod/doc/Omod.html#tutorial">http://erratique.ch/software/omod/doc/Omod.html#tutorial</a>
</p>

<p>
[2]
This is basically a dependency-less rewrite of <code>odig</code>'s toplevel loaders which
will be removed from <code>odig</code>. It solves the following problems they had:
</p>

<ol class="org-ol">
<li>Too many dependencies. They brought too many dependencies in the toplevel including <code>compiler-libs</code> which are problematic in <code>ocamlnat​</code>. <code>omod</code> has no dependency, so using it limits toplevel scope pollution to the <code>Omod</code> module only which loads fine in <code>ocamlnat</code>.</li>
<li>Resolution for multiple load sequences. <code>odig</code> had no support for choosing between multiple load solutions (e.g. for library variants). <code>omod</code> has both a variant specification syntax and an interactive mode to resolve them.</li>
<li>Slow. They were too slow on large libraries as resolution was done in the (bytecode) toplevel itself, <code>omod</code>'s performance (and API) should be improved for scripting however it is reasonably fast for your toplevel interactive usage.</li>
<li>Outdated information in long running toplevel sessions. They provided no mecanism to update the package information whenever the package install base changed.</li>
</ol>

<p>
To solve 1., 3. and 4. the <code>Omod</code> API invokes the <code>omod</code> binary with
the <code>load</code> sub-command (whose textual output you can check when you
suspect there's a problem) to find out the load sequences.
</p>




<hr />
</div>
</div>

<div id="outline-container-orge5a88a6" class="outline-2">
<h2 id="6"><a id="orge5a88a6"></a>Tools for logic programming in OCaml</h2>
<div class="outline-text-2" id="text-6">
<p>
Archive: <a href="https://discuss.ocaml.org/t/tools-for-logic-programming-in-ocaml/2126/4">https://discuss.ocaml.org/t/tools-for-logic-programming-in-ocaml/2126/4</a>
</p>

<p>
<i>Continuing this thread from last week, th3rac said:</i>
</p>


<p>
Also <a href="https://github.com/c-cube/datalog">https://github.com/c-cube/datalog</a>, a Datalog implementation
</p>




<hr />
</div>
</div>

<div id="outline-container-orge588254" class="outline-2">
<h2 id="7"><a id="orge588254"></a>opam-ci: first release of a tool to check the health of your packages</h2>
<div class="outline-text-2" id="text-7">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-opam-ci-first-release-of-a-tool-to-check-the-health-of-your-packages/2146/1">https://discuss.ocaml.org/t/ann-opam-ci-first-release-of-a-tool-to-check-the-health-of-your-packages/2146/1</a>
</p>

<p>
<i>Anil Madhavapeddy announced:</i>
</p>


<p>
<i>Cross posted from <a href="https://github.com/ocaml/infrastructure/wiki/Using-the-opam-ci-tool">https://github.com/ocaml/infrastructure/wiki/Using-the-opam-ci-tool</a></i>
</p>

<p>
Have you submitted a new opam package after testing it on your desktop, and then wondered if it builds on OpenSUSE or CentOS, or on an ARM or PowerPC architecture, or against a different version of the OCaml compiler, or if older version continues to work after a few years of being published?  But you don't have the resources to check all these interactions manually, especially as the opam package database now contains thousands of revisions of OCaml source code. The new <code>opam ci</code> plugin comes to the rescue!  The remainder of this post describes its uses, how to triage issues and then fix them.
</p>

<p align="center">
  <img width="600" src="https://cdn.rawgit.com/ocaml/obi/1a9ad12aa756771b0ea731f40995c7ca7b55c31f/opam-ci.svg">
</p>

<p>
<code>opam-ci</code> provides an interface to the opam2 continuous integration cluster, which regularly rebuilds the full package repository across a variety of OCaml compiler versions, operating system distributions and CPU architectures. These builds are done regularly in remote infrastructure and the results are pushed to a <a href="https://github.com/ocaml/obi-logs">metadata repository</a> where they are fetched by a CLI client to let you query the status of your packages.
</p>

<ul class="org-ul">
<li><code>opam ci status</code> shows a dashboard of the build results across this matrix. Packages can be filtered by maintainer substrings or tag names in the opam package description, so you see only those relevant to you.</li>

<li><code>opam ci logs</code> will show you the build errors so you can fix them. It also generates a Dockerfile of the precise build to reproduce the environment locally for you.</li>
</ul>

<p>
To get started, try these commands with the maintainer argument replaced with your own information or tags:
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;"># </span><span style="color: #b22222;">show all the failing MirageOS packages</span>
opam ci status -m org:mirage | less -R
<span style="color: #b22222;"># </span><span style="color: #b22222;">show all the packages maintained by anil@recoil.org</span>
opam ci status -m anil@recoil.org --filter=all | less -R
<span style="color: #b22222;"># </span><span style="color: #b22222;">show all the packages failing on the latest RC of the OCaml compiler</span>
opam ci status --filter=variants:rc | less -R
<span style="color: #b22222;"># </span><span style="color: #b22222;">display all failure logs for the mirage-xen package</span>
opam ci logs mirage-xen
</pre>
</div>

<p>
The status view shows a panel of icons that represent different combinations of ways to build opam packages. From left to right, these are:
</p>

<ul class="org-ul">
<li><i>Compiler:</i> The circled numbers represent OCaml compiler versions (a circled 6 is OCaml 4.06, a circled 7 is 4.07, and so on).</li>
<li><i>Distro</i>: The square letters indicate different OS distributions. D is Debian, F is Fedora, A is Alpine, U is Ubuntu and S is OpenSUSE.</li>
<li><i>CPU Architecture</i>: The small circled letters represent different CPU architectures. x represents x86_64, a is arm64 and p is PowerPC64LE.</li>
</ul>

<p>
Some compiler variants are also tested to track down specific problems, shown by the icons to the far right of the display. (see [below](#fix-specific-issues-around-ocaml-features) for more information on these).
</p>

<ul class="org-ul">
<li><i>safe-string</i>: The ss icon is for 'safe-string' failures, which would happen in OCaml 4.06 due to the switch to immutable strings.</li>
<li><i>flambda</i>: The fl icon is for packages that fail to compile with the flambda variant of the compiler.</li>
<li><i>release-candidate</i>: The flag icon is for packages that fail to compile with the latest release candidate of OCaml; this is useful to figure out how much of the ecosystem works with a soon-to-be-released compiler.</li>
</ul>

<p>
The colours indicate the result of the build: white indicates the package was not built due to constraints, green is a successful build, yellow indicates the build was skipped due to a dependency failure, red is a direct build failure of that package, and magenta and blue indicate package metadata errors such as a failure of the solver to find a solution or the package sources being unavailable. <i>(note: colors are currently mandatory but this <a href="https://github.com/ocaml/obi/issues/6">needs to be improved</a>)</i>
</p>
</div>

<div id="outline-container-org2e09069" class="outline-3">
<h3 id="org2e09069">Uses</h3>
<div class="outline-text-3" id="text-org2e09069">
</div>
<div id="outline-container-org837b505" class="outline-4">
<h4 id="org837b505">Check your own package builds</h4>
<div class="outline-text-4" id="text-org837b505">
<p>
See all failing builds by specifying the maintainer:
</p>

<div class="org-src-container">
<pre class="src src-shell">opam ci status -m anil@recoil.org | less -R
</pre>
</div>

<p>
See all builds, including successes:
</p>

<div class="org-src-container">
<pre class="src src-shell">opam ci status -m anil@recoil.org -f all | less -R
</pre>
</div>
</div>
</div>

<div id="outline-container-org146dc84" class="outline-4">
<h4 id="org146dc84">Check on a project's libraries</h4>
<div class="outline-text-4" id="text-org146dc84">
<p>
You can specify additional <code>-m</code> fields, which match based on the <code>maintainer:</code> or <code>tags:</code> field in the opam metadata.  For example, the <a href="https://mirage.io">MirageOS</a> uses <code>org:mirage</code> in its tags to group libraries:
</p>

<div class="org-src-container">
<pre class="src src-shell">opam ci status -m org:mirage | less -R
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc70f62e" class="outline-4">
<h4 id="orgc70f62e">Package you have forgotten about</h4>
<div class="outline-text-4" id="text-orgc70f62e">
<p>
Sometimes you constrain a package due to an incompatibility with a newer version of OCaml, but then forget to release a new version.
</p>

<p>
You can query for "lagging" packages whose latest version is incompatible with the latest release of OCaml due to constraints:
</p>

<div class="org-src-container">
<pre class="src src-shell">opam ci status -f lagging | less -R
</pre>
</div>
</div>
</div>

<div id="outline-container-org5c05262" class="outline-4">
<h4 id="org5c05262">Fix specific issues around OCaml features</h4>
<div class="outline-text-4" id="text-org5c05262">
<p>
Newer releases of OCaml come with some backwards incompatible changes.  You can find packages with some of those particular problems.
</p>
</div>

<ul class="org-ul">
<li><a id="org675c8bd"></a>Migration to safe-string<br />
<div class="outline-text-5" id="text-org675c8bd">
<p>
OCaml shifted from mutable to immutable strings by default in OCaml 4.06, but there is a variant of the compiler with the old behaviour.  You can list packages which break with the new immutable default, but that work with the older setting.
</p>

<div class="org-src-container">
<pre class="src src-shell">opam ci status -f variants:ss | less -R
</pre>
</div>
</div>
</li>

<li><a id="org471c04d"></a>Flambda inliner compilation<br />
<div class="outline-text-5" id="text-org471c04d">
<p>
There is an experimental inliner available with the <code>flambda</code> configure time variant of the compiler. A few packages fail to compile with the new option, so you can list those explicitly to determine what's wrong:
</p>

<div class="org-src-container">
<pre class="src src-shell">opam ci status -f variants:fl | less -R
</pre>
</div>
</div>
</li>

<li><a id="orgd57177c"></a>Testing on trunk / release candidate OCaml<br />
<div class="outline-text-5" id="text-orgd57177c">
<p>
When there are release candidates for OCaml, it is helpful to test packages on those pre-release versions. You can find packages that compile successfully on a stable release but fail on the bleeding edge compiler:
</p>

<div class="org-src-container">
<pre class="src src-shell">opam ci status -f variants:rc | less -R
</pre>
</div>

<p>
Note that this shows actual build failures.  You can use the "lagging" filter to find packages that have been constrained to prevent them from being compiled on the latest version entirely, which is useful to figure out what needs porting.
</p>

<div class="org-src-container">
<pre class="src src-shell">opam ci status -f lagging | less -R
</pre>
</div>
</div>
</li>
</ul>
</div>

<div id="outline-container-org3a2efcc" class="outline-4">
<h4 id="org3a2efcc">Community service</h4>
<div class="outline-text-4" id="text-org3a2efcc">
<p>
You can find all unmaintained packages that might seem some assistance since their maintainer fields are blank:
</p>

<div class="org-src-container">
<pre class="src src-shell">opam ci status -f orphaned | less -R
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgec37882" class="outline-3">
<h3 id="orgec37882">Identifying issues</h3>
<div class="outline-text-3" id="text-orgec37882">
<p>
Once you have identified a package that is failing, you can inspect the build logs to figure out how to fix the issue.
</p>

<p>
Firstly, use <code>opam ci logs</code> to find out what's wrong.  For example, I might run this on the <code>xen-gnt-unix</code> package.
</p>

<div class="org-src-container">
<pre class="src src-shell">$ opam ci logs xen-gnt-unix
xen-gnt-unix: multiple build failures found with different configuration parameters.
Please refine the command to select exactly one of the following:
  opam-ci logs xen-gnt-unix.3.0.0 --compiler=4.06 --arch=amd64 --distro=ubuntu-18.04
  opam-ci logs xen-gnt-unix.3.0.0 --compiler=4.06 --arch=amd64 --distro=fedora-28
  opam-ci logs xen-gnt-unix.3.0.0 --compiler=4.06 --arch=amd64 --distro=debian-9
  opam-ci logs xen-gnt-unix.3.0.0 --compiler=4.06+flambda --arch=amd64 --distro=debian-9
  opam-ci logs xen-gnt-unix.3.0.0 --compiler=4.06+default-unsafe-string --arch=amd64 --distro=debian-9
  opam-ci logs xen-gnt-unix.3.0.0 --compiler=4.05 --arch=amd64 --distro=debian-9
  opam-ci logs xen-gnt-unix.3.0.0 --compiler=4.04 --arch=amd64 --distro=debian-9
  opam-ci logs xen-gnt-unix.3.0.0 --compiler=4.06 --arch=amd64 --distro=alpine-3.7
  opam-ci logs xen-gnt-unix.3.0.0 --compiler=4.06 --arch=ppc64le --distro=debian-9
  opam-ci logs xen-gnt-unix.3.0.0 --compiler=4.06 --arch=arm64 --distro=debian-9
  opam-ci logs xen-gnt-unix.3.0.0 --compiler=4.06 --arch=amd64 --distro=opensuse-42.3
  opam-ci logs xen-gnt-unix.3.0.1 --compiler=4.06 --arch=ppc64le --distro=debian-9
  opam-ci logs xen-gnt-unix.3.0.1 --compiler=4.06 --arch=amd64 --distro=opensuse-42.3
</pre>
</div>

<p>
If just one failure is found, then the build logs are shown for that failure. If there is more than one failure, the output will give you a more precise command line to enter to select just one of the failures, as shown above.
</p>

<p>
Just pick the first one, and the output shows us the abbreviated failure log, and some metadata such as which git revision of the [opam-repository (<a href="https://github.com/ocaml/opam-repository">https://github.com/ocaml/opam-repository</a>) the package was built against.
</p>

<div class="org-src-container">
<pre class="src src-shell">opam-ci logs xen-gnt-unix.3.0.0 --compiler=4.06 --arch=amd64 --distro=ubuntu-18.04
====&gt; xen-gnt-unix.3.0.0 4.06 Ubuntu 18.04 amd64 (<span style="color: #a020f0;">exit</span> code 31) (opam-repository 8425e617):
&lt;snip&gt;
<span style="color: #b22222;">### </span><span style="color: #b22222;">output ###</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">File "/home/opam/.opam/4.06/lib/io-page/META", line 1, characters 0-0:</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Error: Library "io-page-unix" not found.</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">-&gt; required by library "io-page.unix" in /home/opam/.opam/4.06/lib/io-page</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Hint: try: jbuilder external-lib-deps --missing -p xen-gnt-unix @install</span>
</pre>
</div>

<p>
This then lets you hopefully see a path to fixing the issue.
</p>
</div>

<div id="outline-container-orgef7033b" class="outline-4">
<h4 id="orgef7033b">Fixing issues</h4>
<div class="outline-text-4" id="text-orgef7033b">
<p>
The problems you find can range from a few root causes. If you think of more, please add them here by updating the <a href="https://github.com/ocaml/infrastructure/wiki/Using-the-opam-ci-tool/_edit">wiki page</a> or posting to the discussion forum.
</p>
</div>

<ul class="org-ul">
<li><a id="orgfb78925"></a>Incorrect opam package constraints<br />
<div class="outline-text-5" id="text-orgfb78925">
<p>
If a package used to build but subsequently starts failing, it is probably because some dependencies have changed their interfaces. You can use opam package constraints to fix this by identifying which the offending dependency is from the build failure, and modifying your package to only select 
</p>

<p>
<i>Feature: <a href="https://github.com/ocaml/obi/issues/5">#5</a> tracks including dependency information into the opam-ci metadata directly.</i>
</p>

<p>
A package occasionally also becomes uninstallable due to dependency constraints resulting in an impossible situation.  This is normally caught by the opam repository maintainers, but mistakes slip through.  In this case, you'll need to figure out the constraints that let your package install.
</p>

<p>
<i>Feature: <a href="https://github.com/ocaml/obi/issues/7">#7</a> tracks including <code>opam lint</code> output in opam-ci status to make finding these problems easier.</i>
</p>
</div>
</li>

<li><a id="orgb1fc8b2"></a>OCaml compiler version<br />
<div class="outline-text-5" id="text-orgb1fc8b2">
<p>
OCaml now releases on a 6-8 month release schedule, and the march of progress occasionally breaks existing code.  In this case, maintainers can release a new version of their package that works, but older releases are still tracked in opam and should be constrained to prevent them being selected by the new compiler.
</p>

<p>
One example is the migration to safe-string, which broke a large number of packages out of the box in OCaml 4.06.0.  In this case, you might see an issue like this:
</p>

<div class="org-src-container">
<pre class="src src-shell">$ opam-ci logs syslog.1.4 --compiler=4.06 --arch=amd64 --distro=debian-9
<span style="color: #b22222;"># </span><span style="color: #b22222;">File "syslog.ml", line 196, characters 50-53:</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Error: This expression has type bytes but an expression was expected of type</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">string</span>
</pre>
</div>

<p>
In this case, you need to prevent this package from being installed on OCaml 4.06.0 or higher, and release a new version of the package with the functionality fixed. The opam1 constraint looks like:
</p>

<div class="org-src-container">
<pre class="src src-config">available: [ ocaml-version &lt; "4.06.0" ]
</pre>
</div>
</div>
</li>

<li><a id="orgfcab4ba"></a>Operating System portability<br />
<div class="outline-text-5" id="text-orgfcab4ba">
<p>
A very common situation is that you test your package on your local desktop, but cannot try it on the huge number of Linux distributions out there.  Thanks to the magic of Docker containers, the opam-ci shows build information on many distributions: Ubuntu, Debian, CentOS, Alpine, OpenSUSE and OracleLinux across several versions (the full list is <a href="https://github.com/avsm/ocaml-dockerfile/blob/master/src-opam/dockerfile_distro.mli#L25">here</a>).
</p>

<p>
To pick on an example of <code>zstd</code>, the <code>opam ci status zstd</code> shows that it builds on  Debian and Ubuntu, but fails on CentOS and Alpine.  Inspecting the opam file reveals why:
</p>

<div class="org-src-container">
<pre class="src src-shell">$ opam show zstd --raw
&lt;snip&gt;
depexts: [
  [<span style="color: #8b2252;">"libzstd-dev"</span>] {os-distribution = <span style="color: #8b2252;">"debian"</span>}
  [<span style="color: #8b2252;">"libzstd-dev"</span>] {os-distribution = <span style="color: #8b2252;">"ubuntu"</span>}
]
</pre>
</div>

<p>
The <code>depexts</code> field is driven by <a href="https://github.com/ocaml/opam-depext/tree/2.0">opam-depext</a> which understands a large number of operating systems.   You can fix this by including the packages for Alpine and CentOS and submitting the fixes.  The opam-repository CI will test your submitted fixes against the matrix of operating systems and verify if the fix worked or not, or you can use <a href="https://www.docker.com/docker-mac">Docker locally</a> via the [OCaml containers](Containers) before submitting the fix.
</p>
</div>
</li>

<li><a id="orge3bfc17"></a>CPU portability<br />
<div class="outline-text-5" id="text-orge3bfc17">
<p>
OCaml runs on a variety of CPU architectures, but most of us develop on x86. The bulk builds also run regularly on arm64 and ppc64le, which exposes portability bugs in C bindings quite often.
</p>

<p>
The AFL testing system fails on ARM for example:
</p>

<div class="org-src-container">
<pre class="src src-shell">opam-ci logs afl.2.52b --compiler=4.06 --arch=arm64 --distro=debian-9
 <span style="color: #b22222;">### </span><span style="color: #b22222;">output ###</span>
 <span style="color: #b22222;"># </span><span style="color: #b22222;">[*] Checking for the ability to compile x86 code...</span>
 <span style="color: #b22222;"># </span><span style="color: #b22222;">/tmp/cctyEiSt.s: Assembler messages:</span>
 <span style="color: #b22222;"># </span><span style="color: #b22222;">/tmp/cctyEiSt.s:10: Error: unknown mnemonic `xorb' -- `xorb %al,%al'</span>
 <span style="color: #b22222;">#</span>
 <span style="color: #b22222;"># </span><span style="color: #b22222;">Oops, looks like your compiler can't generate x86 code.</span>
 <span style="color: #b22222;">#</span>
 <span style="color: #b22222;"># </span><span style="color: #b22222;">Don't panic! You can use the LLVM or QEMU mode, but see docs/INSTALL first.</span>
 <span style="color: #b22222;"># </span><span style="color: #b22222;">(To ignore this error, set AFL_NO_X86=1 and try again.)</span>
</pre>
</div>

<p>
In this case, you can fix the portability issue in your package and release a new version.  To prevent the older (already released) packages from being selected by the opam solver on that architecture, you can add a <code>cpu</code> constraint in the <code>available:</code> field.  An example is the <code>yaml.0.2.0</code> package that was broken on PowerPC and fixed in <code>yaml.0.2.1</code>:
</p>

<div class="org-src-container">
<pre class="src src-shell">$ opam show yaml.0.2.0 --raw
&lt;snip&gt;
available: arch != <span style="color: #8b2252;">"ppc64"</span>
</pre>
</div>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgd041c68" class="outline-3">
<h3 id="orgd041c68">Contributions</h3>
<div class="outline-text-3" id="text-orgd041c68">
<p>
We would love to see more contributions to opam-ci and the associated infrastructure. The most obvious way you can get involved is by looking at the build failures and submitting fixes to the <a href="https://github.com/ocaml/opam-repository">opam-repository</a> to help us maintain the rapidly growing package database.
</p>

<p>
If you would like to work on the CLI tool itself, then feel free to  get started and look at the <a href="https://github.com/ocaml/obi/issues">issue list</a> and the <a href="https://github.com/ocaml/obi/blob/master/CONTRIBUTING.md">contributions guidelines</a> to get started, and/or post on the <a href="https://discuss.ocaml.org">OCaml discussion forum</a>. You can also add more triaging tips to this wiki to help other users.
</p>




<hr />
</div>
</div>
</div>

<div id="outline-container-org85e516e" class="outline-2">
<h2 id="8"><a id="org85e516e"></a>Does OCaml ecosystem have CSS preprocessors?</h2>
<div class="outline-text-2" id="text-8">
<p>
Archive: <a href="https://discuss.ocaml.org/t/does-ocaml-ecosystem-have-css-preprocessors/2139/3">https://discuss.ocaml.org/t/does-ocaml-ecosystem-have-css-preprocessors/2139/3</a>
</p>

<p>
<i>Volodymyr Melnyk asked and Nadeem Bitar replied:</i>
</p>


<blockquote>
<p>
Does OCaml's ecosystem have CSS preprocessors except CCSS (cause I want to write CSS in OCaml)?
</p>
</blockquote>

<p>
I've used <a href="https://github.com/SentiaAnalytics/bs-css">bs-css</a> to write CSS in OCaml. 
</p>

<p>
It allows you to write something like:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">open </span><span style="color: #228b22;">CSS</span>
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">card</span> <span style="color: #a52a2a;">=</span> style
<span style="color: #a52a2a;">[</span>
  display flexBox<span style="color: #a52a2a;">;</span>
  flexDirection column<span style="color: #a52a2a;">;</span>
  boxShadow <span style="color: #008b8b;">~y</span><span style="color: #a52a2a;">:(</span>px 3<span style="color: #a52a2a;">)</span> <span style="color: #008b8b;">~blur</span><span style="color: #a52a2a;">:(</span>px 5<span style="color: #a52a2a;">)</span> <span style="color: #a52a2a;">(</span>rgba 0 0 0 0 0.3<span style="color: #a52a2a;">);</span>
<span style="color: #a52a2a;">]</span>
</pre>
</div>




<hr />
</div>
</div>

<div id="outline-container-orgdf0779d" class="outline-2">
<h2 id="orgdf0779d">Old CWN</h2>
<div class="outline-text-2" id="text-orgdf0779d">
<p>
If you happen to miss a CWN, you can <a href="mailto:alan.schmitt@polytechnique.org">send me a message</a> and I'll mail it to you, or go take a look at <a href="http://alan.petitepomme.net/cwn/">the archive</a> or the <a href="http://alan.petitepomme.net/cwn/cwn.rss">RSS feed of the archives</a>.
</p>

<p>
If you also wish to receive it every week by mail, you may subscribe <a href="http://lists.idyll.org/listinfo/caml-news-weekly/">online</a>.
</p>
<hr />
<div class="authorname">
<p>
<a href="http://alan.petitepomme.net/">Alan Schmitt</a>
</p>

</div>
</div>
</div>
</div>
</body>
</html>
