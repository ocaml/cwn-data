<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-07-13 Tue 15:54 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OCaml Weekly News</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<style type="text/css">#table-of-contents h2 { display: none } .title { display: none } .authorname { text-align: right }</style>
<style type="text/css">.outline-2 {border-top: 1px solid black;}</style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">OCaml Weekly News</h1>
<p>
<a href="https://alan.petitepomme.net/cwn/2021.07.06.html">Previous Week</a> <a href="https://alan.petitepomme.net/cwn/index.html">Up</a> <a href="https://alan.petitepomme.net/cwn/2021.07.20.html">Next Week</a>
</p>

<p>
Hello
</p>

<p>
Here is the latest OCaml Weekly News, for the week of July 06 to 13, 2021.
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#1">slug 1.0.0 - URL-safe slug generator</a></li>
<li><a href="#2">Developer Experience Engineer at Jane Street</a></li>
<li><a href="#3">Hardcaml MIPS CPU Learning Project and Blog</a></li>
<li><a href="#4">OCaml for Windows installation confusion</a></li>
<li><a href="#5">OCamlFormat config file auto-completion support in VSCode</a></li>
<li><a href="#6">Multicore OCaml: June 2021</a></li>
<li><a href="#7">memprof-limits (first official release): Memory limits, allocation limits, and thread cancellation, with interrupt-safe resources</a></li>
<li><a href="#8">Bitwuzla 1.0.0 (SMT solver for AUFBVFP)</a></li>
<li><a href="#org0390044">Old CWN</a></li>
</ul>
</div>
</div>


<div id="outline-container-1" class="outline-2">
<h2 id="1">slug 1.0.0 - URL-safe slug generator</h2>
<div class="outline-text-2" id="text-1">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-slug-1-0-0-url-safe-slug-generator/8107/1">https://discuss.ocaml.org/t/ann-slug-1-0-0-url-safe-slug-generator/8107/1</a>
</p>
</div>

<div id="outline-container-orgf1ace51" class="outline-3">
<h3 id="orgf1ace51">Khoa Nguyen announced</h3>
<div class="outline-text-3" id="text-orgf1ace51">
<p>
I want to introduce my first library ever released on opam.
Link to Github repository: <a href="https://github.com/thangngoc89/ocaml-slug">https://github.com/thangngoc89/ocaml-slug</a>
</p>
</div>

<div id="outline-container-orgdf40d11" class="outline-4">
<h4 id="orgdf40d11">ocaml-slug</h4>
<div class="outline-text-4" id="text-orgdf40d11">
<p>
Url safe slug generator for OCaml
</p>

<blockquote>
<p>
A URL slug is the part of a URL or link that comes after the domain extension.
In websites the keyword used for your URL slug can be used to SEO optimize the URL by showing Google
the structure of your site and the contents of the page in question.
</p>
</blockquote>

<p>
This library turns title into URL-safe slug with support for non-latin characters.
</p>

<p>
This library uses algorithm and data from <a href="https://github.com/simov/slugify">node-slugify</a>
</p>
</div>

<div id="outline-container-org3ff5887" class="outline-5">
<h5 id="org3ff5887">Installation</h5>
<div class="outline-text-5" id="text-org3ff5887">
<pre class="example" id="org95fc75b">
opam install slug
</pre>

<p>
If you use <a href="https://esy.sh">esy</a>
</p>

<pre class="example" id="orgfa9ee76">
esy add @opam/slug
</pre>
</div>
</div>

<div id="outline-container-orged631aa" class="outline-5">
<h5 id="orged631aa">Usage</h5>
<div class="outline-text-5" id="text-orged631aa">
<ul class="org-ul">
<li><p>
OCaml syntax:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #228b22;">Slug.</span>slugify <span style="color: #8b2252;">"my string"</span><span style="color: #ff4500;">;;</span>
- : string = <span style="color: #8b2252;">"my-string"</span>

<span style="color: #b22222;">(* </span><span style="color: #b22222;">Custom separator </span><span style="color: #b22222;">*)</span>
<span style="color: #228b22;">Slug.</span>slugify <span style="color: #008b8b;">?sep</span>: <span style="color: #8b2252;">"_"</span> <span style="color: #8b2252;">"my string"</span><span style="color: #ff4500;">;;</span>
- : string = <span style="color: #8b2252;">"my_string"</span>

<span style="color: #b22222;">(* </span><span style="color: #b22222;">Retain uppercase </span><span style="color: #b22222;">*)</span>
<span style="color: #228b22;">Slug.</span>slugify <span style="color: #008b8b;">?lowercase</span>: <span style="color: #008b8b;">false</span> <span style="color: #8b2252;">"My String"</span><span style="color: #ff4500;">;;</span>
- : string = <span style="color: #8b2252;">"My-String"</span>

<span style="color: #b22222;">(* </span><span style="color: #b22222;">Use locale </span><span style="color: #b22222;">*)</span>
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">with_vi</span> = <span style="color: #228b22;">Slug.</span>(<span style="color: #228b22;">Charmap.</span>mk_charmap [<span style="color: #228b22;">Slug_data.</span>base; <span style="color: #228b22;">Slug_data.</span>vi])<span style="color: #ff4500;">;;</span>
- : <span style="color: #228b22;">Charmap.</span>t = &lt;abstr&gt;
<span style="color: #228b22;">Slug.</span>slugify <span style="color: #008b8b;">?charmap</span>: with_vi <span style="color: #8b2252;">"&#272;"</span><span style="color: #ff4500;">;;</span>
- : string = <span style="color: #8b2252;">"d"</span>
<span style="color: #228b22;">Slug.</span>slugify <span style="color: #8b2252;">"&#272;"</span><span style="color: #ff4500;">;;</span>
- : string = <span style="color: #8b2252;">"dj"</span>

<span style="color: #b22222;">(* </span><span style="color: #b22222;">Custom characters map </span><span style="color: #b22222;">*)</span>
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">custom_map</span> = <span style="color: #228b22;">Slug.</span>(<span style="color: #228b22;">Charmap.</span>mk_charmap [<span style="color: #228b22;">Slug_data.</span>base; [ (<span style="color: #8b2252;">"M"</span>, <span style="color: #8b2252;">"z"</span>); (<span style="color: #8b2252;">"m"</span>, <span style="color: #8b2252;">"z"</span>) ]])<span style="color: #ff4500;">;;</span>
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">custom_map</span> : <span style="color: #228b22;">Charmap.</span>t = &lt;abstr&gt;

<span style="color: #228b22;">Slug.</span>slugify <span style="color: #008b8b;">?charmap</span>: custom_map <span style="color: #8b2252;">"Mm"</span><span style="color: #ff4500;">;;</span>
- : string = <span style="color: #8b2252;">"zz"</span>
</pre>
</div></li>

<li><p>
ReasonML syntax
</p>

<div class="org-src-container">
<pre class="src src-reason">Slug.slugify("my string");
- : string = "my-string"

/* Custom separator */
Slug.slugify(~sep = "_", "my string");
- : string = "my_string"

/* Retain uppercase */
Slug.slugify(~lowercase = false, "My String");
- : string = "My-String"

/* Use locale */
let with_vi = Slug.(Charmap.mk_charmap([Slug_data.base, Slug_data.vi]));
let with_vi : Charmap.t = &lt;abstr&gt;
Slug.slugify(~charmap = with_vi, "Đ");
- : string = "d"
Slug.slugify("Đ");
- : string = "dj"

/* Custom characters map */
let custom_map = Slug.(Charmap.mk_charmap([Slug_data.base, [ ("M", "z"), ("m", "z") ]]));;
let custom_map : Charmap.t = &lt;abstr&gt;

Slug.slugify(~charmap = custom_map, "Mm");
- : string = "zz"
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org33fcebc" class="outline-5">
<h5 id="org33fcebc">Notice</h5>
<div class="outline-text-5" id="text-org33fcebc">
<p>
Please don't send PR to update <code>data/*</code>. They are auto-generated from <a href="https://github.com/simov/slugify">upstream
library</a>.
</p>

<p>
Please send PRs about new locales to node-slugify.
</p>

<p>
If you really need it, you can use a <code>custom_map</code> instead.
</p>
</div>
</div>

<div id="outline-container-org94b0320" class="outline-5">
<h5 id="org94b0320">License</h5>
<div class="outline-text-5" id="text-org94b0320">
<p>
MIT. Data are downloaded from <a href="https://github.com/simov/slugify">node-slugify</a>
</p>
</div>
</div>
</div>
</div>
</div>




<div id="outline-container-2" class="outline-2">
<h2 id="2">Developer Experience Engineer at Jane Street</h2>
<div class="outline-text-2" id="text-2">
<p>
Archive: <a href="https://discuss.ocaml.org/t/job-developer-experience-engineer-at-jane-street/8113/1">https://discuss.ocaml.org/t/job-developer-experience-engineer-at-jane-street/8113/1</a>
</p>
</div>

<div id="outline-container-orgd4b8d10" class="outline-3">
<h3 id="orgd4b8d10">Yaron Minsky announced</h3>
<div class="outline-text-3" id="text-orgd4b8d10">
<p>
You can read more about the job here:
</p>

<p>
<a href="https://blog.janestreet.com/looking-for-a-developer-experience-engineer-index/">https://blog.janestreet.com/looking-for-a-developer-experience-engineer-index/</a>
</p>

<p>
The role is for someone to act as an advocate for our internal developers, helping move information in
both directions: teaching people how to make most use of the tools, and figuring out what our
developers need, and helping set priorities for our dev-tools and compiler teams.
</p>

<p>
Please share this with anyone you think might be a good fit for the role!
</p>
</div>
</div>
</div>




<div id="outline-container-3" class="outline-2">
<h2 id="3">Hardcaml MIPS CPU Learning Project and Blog</h2>
<div class="outline-text-2" id="text-3">
<p>
Archive: <a href="https://discuss.ocaml.org/t/hardcaml-mips-cpu-learning-project-and-blog/8088/9">https://discuss.ocaml.org/t/hardcaml-mips-cpu-learning-project-and-blog/8088/9</a>
</p>
</div>

<div id="outline-container-orgb05cdcb" class="outline-3">
<h3 id="orgb05cdcb">Clément asked and Alexander (Sasha) Skvortsov announced</h3>
<div class="outline-text-3" id="text-orgb05cdcb">
<blockquote>
<p>
👍 Does your website have an RSS feed?
</p>
</blockquote>

<p>
It does now! <code>https://ceramichacker.com/rss</code>.
Also <code>https://ceramichacker.com/atom</code> for Atom users.
</p>

<p>
On a side note, we've published two more posts:
</p>

<ol class="org-ol">
<li><a href="https://ceramichacker.com/blog/12-6x-memory-in-hardcaml">Memory in Hardcaml</a></li>
<li><a href="https://ceramichacker.com/blog/13-7x-registers-and-stateful-design">Registers and Stateful Design</a></li>
</ol>

<p>
More coming soon!
</p>
</div>
</div>
</div>




<div id="outline-container-4" class="outline-2">
<h2 id="4">OCaml for Windows installation confusion</h2>
<div class="outline-text-2" id="text-4">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ocaml-for-windows-installation-confusion/8105/17">https://discuss.ocaml.org/t/ocaml-for-windows-installation-confusion/8105/17</a>
</p>
</div>

<div id="outline-container-org2b1fba4" class="outline-3">
<h3 id="org2b1fba4">Deep in this thread, Nicolás Ojeda Bär said</h3>
<div class="outline-text-3" id="text-org2b1fba4">
<p>
At LexiFi we have been writing OCaml under Windows for a long time and are quite experienced with it. I
know of at least one other large industrial player that uses OCaml on Windows as their main environment
cc @keleshev.
</p>

<p>
If I had to summarize the situation of OCaml on Windows I would say that once you get past the
installation of the dev environment (C toolchain + Cygwin), the experience is quite similar to Linux.
The compiler, standard library, <code>dune</code> and <code>merlin</code>, all work flawlessly on Windows. OPAM is not 100%
ready yet on Windows (we don't use it) but it has never been easier to work "monorepo" style using
<code>dune</code>.
</p>

<p>
For beginners the main stumbling block is setting up the dev environment (C toolchain + Cygwin). On
Linux installing a C toolchain is not needed because the compiler is installed by default, but this is
not the case on Windows. As for Cygwin, it is strictly speaking only necessary when building the
compiler itself. Once the compiler is installed you are free to never use Cygwin again&#x2026;
</p>

<p>
So if you want a Rust-style exeperience for beginners you need to figure out how to provide a
point-and-click installer that does the following things:
</p>

<ol class="org-ol">
<li>installs the C toolchain,</li>
<li>installs Cygwin and builds &amp; installs the OCaml compiler using it</li>
<li>installs merlin and dune</li>
</ol>

<p>
At this point you will be left with a very capable environment for writing OCaml programs using common
editors such as VS Code.
</p>

<p>
Regarding 1. above (the C toolchain), there are two main options. If you want a completely freestanding
C toolchain you <b>must</b> use the native MSVC compiler command-line tools, which you can get from
<a href="https://docs.microsoft.com/en-us/cpp/build/building-on-the-command-line">https://docs.microsoft.com/en-us/cpp/build/building-on-the-command-line</a> (link appears down at the
moment).
</p>

<p>
If you are willing to use Cygwin for your day-to-day developing (as opposed to only using it when
building the compiler), then you have a second option which is to use the <code>mingw64</code> compiler. This is a
compiler that produces native Windows binaries, but the advantage is that it is essentially <code>gcc</code> so
you get an user experience which you may be used to from Linux. As it runs under Cygwin, this option
may appeal to those that prefer to insulate themselves as much as possible from Windows specificities.
</p>

<blockquote>
<p>
My guess is that the recommanded windows way is WSL2.
</p>
</blockquote>

<p>
It depends what you mean by "on Windows". If all you want is to develop "on" a Windows machine, yes by
all means WSL is a good option. But the binaries you produce are Linux binaries, so they won't run on
Windows outside of the WSL environment.
</p>

<blockquote>
<p>
Thank you. However if the repository won’t get any more updates from next month, that seems like a
showstopper for OCaml usage on Windows to me.
</p>
</blockquote>

<p>
Only if you insist on using OPAM for your development. It is perfectly feasible to develop on Windows
"monorepo" style without using OPAM. The experience may not be as pleasent as it would be on Unix and
depending on how much you rely on external libraries it may be more or less convenient, but it works
quite well in general.
</p>
</div>
</div>
</div>




<div id="outline-container-5" class="outline-2">
<h2 id="5">OCamlFormat config file auto-completion support in VSCode</h2>
<div class="outline-text-2" id="text-5">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ocamlformat-config-file-auto-completion-support-in-vscode/8118/1">https://discuss.ocaml.org/t/ocamlformat-config-file-auto-completion-support-in-vscode/8118/1</a>
</p>
</div>

<div id="outline-container-org6b00818" class="outline-3">
<h3 id="org6b00818">тars announced</h3>
<div class="outline-text-3" id="text-org6b00818">
<p>
Hi, I made a tiny vscode extension which provides auto-completion for <code>.ocamlformat</code> file. (I posted
this on discord but let me post it here too.)
</p>

<p>
&#x2026;BTW I'm <b>a complete beginner</b> so this is written in TS. If I become comfortable with OCaml and its
ecosystems, I'd like to re-write this in OCaml. But as of now, I have no clue. :upside_down_face:
</p>

<p>
Cheers.
</p>

<p>
<a href="https://github.com/tars0x9752/ocamlformat-auto-completion-vscode">https://github.com/tars0x9752/ocamlformat-auto-completion-vscode</a>
</p>
</div>
</div>


<div id="outline-container-org24caa89" class="outline-3">
<h3 id="org24caa89">тars then added</h3>
<div class="outline-text-3" id="text-org24caa89">
<p>
Here's how it works.
</p>


<div id="orgf905b2c" class="figure">
<p><img src="https://user-images.githubusercontent.com/46079709/124963946-666d0a80-e05b-11eb-9747-75002e458818.gif" alt="124963946-666d0a80-e05b-11eb-9747-75002e458818.gif" />
</p>
</div>
</div>
</div>


<div id="outline-container-orge3c6c77" class="outline-3">
<h3 id="orge3c6c77">Max Lantas replied</h3>
<div class="outline-text-3" id="text-orge3c6c77">
<p>
Wow, this is great! Nice job!
</p>

<blockquote>
<p>
I’d like to re-write this in OCaml.
</p>
</blockquote>

<p>
If you decide to try this, you can look <a href="https://github.com/ocamllabs/vscode-ocaml-platform">VSCode OCaml Platform source
code</a> to see how we wrote the OCaml extension in
OCaml code. The basic idea is that it uses the <a href="https://github.com/ocsigen/js_of_ocaml">Js_of_ocaml
compiler</a> to compile OCaml code to Javascript with bindings to
the VSCode API.
</p>

<p>
I glanced over your source code and it looks like it would translate very well to OCaml code. Feel free
to reach out if you'd like help.
</p>
</div>
</div>
</div>




<div id="outline-container-6" class="outline-2">
<h2 id="6">Multicore OCaml: June 2021</h2>
<div class="outline-text-2" id="text-6">
<p>
Archive: <a href="https://discuss.ocaml.org/t/multicore-ocaml-june-2021/8134/1">https://discuss.ocaml.org/t/multicore-ocaml-june-2021/8134/1</a>
</p>
</div>

<div id="outline-container-org24d2063" class="outline-3">
<h3 id="org24d2063">Anil Madhavapeddy announced</h3>
<div class="outline-text-3" id="text-org24d2063">
<p>
Welcome to the June 2021 <a href="https://github.com/ocaml-multicore/ocaml-multicore">Multicore OCaml</a> monthly
report! This month's update along with the <a href="https://discuss.ocaml.org/tag/multicore-monthly">previous
update's</a> have been compiled by @avsm, @ctk21,
@kayceesrk and @shakthimaan.
</p>

<p>
Our overall goal remains on track for generating a preview tree for OCaml 5.0 multicore domains-only
parallelism over the summer.
</p>
</div>

<div id="outline-container-orga6ca45b" class="outline-4">
<h4 id="orga6ca45b">Ecosystem compatibility for 4.12.0+domains</h4>
<div class="outline-text-4" id="text-orga6ca45b">
<p>
In <a href="https://discuss.ocaml.org/t/multicore-ocaml-may-2021/7990#ecosystem-changes-to-prepare-for-500-domains-only-2">May's
update</a>,
I noted that our focus was now on adapting the ecosystem to work well with multicore, and I'm pleased
to report that this is progressing very well.
</p>

<ul class="org-ul">
<li>The 4.12.0+domains multicore compiler variant has been <a href="https://github.com/ocaml/opam-repository/pull/18960">merged into mainline opam-repo</a>, so you can now <code>opam switch 4.12.0+domains</code> directly. The <code>base-domains</code> package is also available to mark your opam project as <span class="underline">requiring</span> the <code>Domains</code> module, so you can even publish your early multicore-capable libraries to the mainline opam repository now.</li>

<li>The OCaml standard library was made safe for parallel use by multiple domains (<a href="https://github.com/ocaml-multicore/ocaml-multicore/wiki/Safety-of-Stdlib-under-Multicore-OCaml">wiki</a>, <a href="https://github.com/ocaml/ocaml/issues/10453">issue</a>, <a href="https://github.com/ocaml-multicore/ocaml-multicore/issues?q=is%3Aissue+label%3A%22stdlib+safety%22+is%3Aclosed">fixes</a>); and in particularly the <code>Format</code> and <code>Random</code> modules. These modules were the main sources of incompatibilities we found when running existing OCaml code with multiple domains.</li>

<li>The <code>Domain</code> module has had its interface slimmed with the removal of <code>critical_section</code>, <code>wait</code>, <code>notify</code> which has allowed significant runtime simplification. The GC C-API interface is now implemented and this means that Jane Street's <code>Base</code>, <code>Core</code>, and <code>Async</code> now compile on <code>4.12+domains</code> without modifications; for example <code>opam install patdiff</code> works out of the box on a <code>4.12+domains</code> switch!</li>

<li><a href="https://github.com/ocaml-multicore/domainslib/releases/tag/0.3.0">Domainslib 0.3.0</a> has been released which incorporates multiple improvements including the work-stealing deques for task distribution. The performance of reading domain local variables has also been improved with a primitive and a O(1) lookup.  The chapter on <a href="https://github.com/ocaml-multicore/parallel-programming-in-multicore-ocaml"><code>Parallel Programming in Multicore OCaml</code></a> has been updated to reflect the latest developments with Domainslib.</li>
</ul>

<p>
This means that big application stacks should now compile pretty well with 4.12.0+domains (applications
like the Tezos node and patdiff exercise a lot of the dependency trees in opam). If you do find
incompatibilities, please do report them on the
<a href="https://github.com/ocaml-multicore/ocaml-multicore/issues">repository</a>.
</p>
</div>
</div>

<div id="outline-container-orgcf143ea" class="outline-4">
<h4 id="orgcf143ea">4.12.0+domains+effects</h4>
<div class="outline-text-4" id="text-orgcf143ea">
<p>
Most of our focus has been on getting the domains-only trees (for OCaml 5.0) up to speed, but we have
been progressing the direct-style effects-based IO stack as well.
</p>

<ul class="org-ul">
<li>The <code>uring</code> bindings to Linux Io_uring are now available on opam-repository, so you can try it out on sequential OCaml too. A good mini-project would be to add a uring backend to the existing Async or Lwt engines, if anyone wants to try a substantial contribution.</li>
<li>The <a href="https://github.com/ocaml-multicore/eio"><code>eio</code> library</a> is fairly usable now, for both filesystem and networking. We've submitted a talk to the OCaml workshop to dive into the innards of it in more detail, so stay tuned for that in the coming months if accepted.  The main changes here have been performance improvements, and the HTTP stack is fairy competitive with (e.g.) <code>rust-hyper</code>.</li>
</ul>

<p>
We will soon also have a variant of this tree that removes the custom effect syntax and implements the fibres (the runtime piece) as <code>Obj</code> functions.  This will further improve ecosystem compatibility and allow us to build direct-style OCaml libraries that use fibres internally to provide concurrency, but without exposing any use of effects in their interfaces.
</p>
</div>
</div>

<div id="outline-container-org478e252" class="outline-4">
<h4 id="org478e252">Benchmarking and performance</h4>
<div class="outline-text-4" id="text-org478e252">
<p>
We are always keen to get more benchmarks that exercise multicore features; if you want to try
multicore out and help write benchmarks there are some suggestions on the
<a href="https://github.com/ocaml-multicore/ocaml-multicore/wiki/Multicore-benchmarking-projects">wiki</a>. We've
got a private server which runs a Sandmark nightly benchmark pipeline with Jupyter notebooks, which we
can give access to anyone who submits benchmarks. We continue to test integration of Sandmark with
<a href="https://github.com/ocurrent/current-bench">current-bench</a> for better integration with GitHub PRs.
</p>

<p>
As always, the Multicore OCaml ongoing and completed tasks are listed first, which are then followed by
updates from the ecosystem and their associated libraries. The Sandmark benchmarking and nightly build
efforts are then mentioned. Finally, the status of the upstream OCaml Safepoints PR is provided for
your reference.
</p>
</div>
</div>

<div id="outline-container-orge7f0fd0" class="outline-4">
<h4 id="orge7f0fd0">Multicore OCaml</h4>
<div class="outline-text-4" id="text-orge7f0fd0">
</div>
<div id="outline-container-org23b468f" class="outline-5">
<h5 id="org23b468f">Ongoing</h5>
<div class="outline-text-5" id="text-org23b468f">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/573">ocaml-multicore/ocaml-multicore#573</a>
Backport trunk safepoints PR to multicore
</p>

<p>
A work-in-progress to backport the Safepoints PR from ocaml/ocaml to
Multicore OCaml.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/584">ocaml-multicore/ocaml-multicore#584</a>
Modernise signal handling
</p>

<p>
A patch to bring the Multicore OCaml signals implementation closer
to upstream OCaml.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/598">ocaml-multicore/ocaml-multicore#598</a>
Do not deliver signals to threads that have blocked them
</p>

<p>
A draft PR to not deliver signals to threads that are in a blocked
state. The without-systhreads case needs to be handled.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/600">ocaml-multicore/ocaml-multicore#600</a>
Expose a few more GC variables in headers
</p>

<p>
The <code>caml_young_start</code>, <code>caml_young_limit</code> and <code>caml_minor_heap_wsz</code>
variables have been defined in the runtime.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/601">ocaml-multicore/ocaml-multicore#601</a>
Domain better participants
</p>

<p>
The iterations <code>0(Max_domains)</code> from STW signalling and
<code>0(n_running_domains)</code> from domain creation have now been removed.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/603">ocaml-multicore/ocaml-multicore#603</a>
Systhreads tick thread
</p>

<p>
An initial draft PR for porting the tick thread to Multicore OCaml.
</p></li>
</ul>
</div>
</div>

<div id="outline-container-org53fe78a" class="outline-5">
<h5 id="org53fe78a">Completed</h5>
<div class="outline-text-5" id="text-org53fe78a">
</div>
<div id="outline-container-orgba45cce" class="outline-6">
<h6 id="orgba45cce">Enhancements</h6>
<div class="outline-text-6" id="text-orgba45cce">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/552">ocaml-multicore/ocaml-multicore#552</a>
Add a <code>force_instrumented_runtime</code> option to configure
</p>

<p>
The <code>configure</code> script now accepts a new
<code>--enable-force-instrumented-runtime</code> option to facilitate use of
the instrumented runtime on linker invocations to obtain event logs.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/558">ocaml-multicore/ocaml-multicore#558</a>
Refactor <code>Domain.{spawn/join}</code> to use no critical sections
</p>

<p>
The critical sections in <code>Domain.{spawn/join}</code> and the use of
<code>Domain.wait</code> have been removed.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/561">ocaml-multicore/ocaml-multicore#561</a>
Slim down <code>Domain.Sync</code>: remove <code>wait</code>, <code>notify</code>, <code>critical_section</code>
</p>

<p>
A breaking change in <code>Domain.Sync</code> that removes <code>critical_section</code>,
<code>notify</code>, <code>wait</code>, <code>wait_for</code>, and <code>wait_until</code>. This is to remove
the need for domain-to-domain messaging in the runtime.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/576">ocaml-multicore/ocaml-multicore#576</a>
Including Git hash in runtime
</p>

<p>
A Git hash is now printed in the runtime as shown below:
</p>

<pre class="example" id="orgf1ce76e">
$ ./boot/ocamlrun -version
The OCaml runtime, version 4.12.0+multicore
Built with git hash 'ae3fb4bb6' on branch 'runtime_version' with tag '&lt;tag unavailable&gt;'
</pre></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/579">ocaml-multicore/ocaml-multicore#579</a>
Primitive for fetching DLS root
</p>

<p>
A new primitive has been implemented for fetching DLS, and is now a
single <code>mov</code> instruction on <code>amd64</code>.
</p></li>
</ul>
</div>
</div>

<div id="outline-container-org57b0c1d" class="outline-6">
<h6 id="org57b0c1d">Upstream</h6>
<div class="outline-text-6" id="text-org57b0c1d">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/555">ocaml-multicore/ocaml-multicore#555</a>
runtime: <code>CAML_TRACE_VERSION</code> is now set to a Multicore specific value
</p>

<p>
A <code>CAML_TRACE_VERSION</code> is defined to distinguish between Multicore
OCaml and trunk for the runtime.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/581">ocaml-multicore/ocaml-multicore#581</a>
Move our usage of inline to <code>Caml_inline</code>
</p>

<p>
We now use <code>Caml_inline</code> for all the C inlining in the runtime to
align with upstream OCaml.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/589">ocaml-multicore/ocaml-multicore#589</a>
Reintroduce <code>adjust_gc_speed</code>
</p>

<p>
The <code>caml_adjust_gc_speed</code> function from trunk has been reintroduced
to the Multicore OCaml runtime.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/590">ocaml-multicore/ocaml-multicore#590</a>
runtime: stub <code>caml_stat_*</code> interfaces in gc_ctrl
</p>

<p>
The creation of <code>caml_stat_*</code> stub functions in gc_ctrl.h to
introduce a compatibility layer for GC stat utilities that are
available in trunk.
</p></li>
</ul>
</div>
</div>

<div id="outline-container-orga7709e8" class="outline-6">
<h6 id="orga7709e8">Fixes</h6>
<div class="outline-text-6" id="text-orga7709e8">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/562">ocaml-multicore/ocaml-multicore#562</a>
Import fixes to the minor heap allocation code from DLABs
</p>

<p>
The multiplication factor of two used for minor heap allocation has
been removed, and the <code>Minor_heap_max</code> limit from config.h is no
longer converted to a byte size for Multicore OCaml.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/593">ocaml-multicore/ocaml-multicore#593</a>
Fix two issues with ephemerons
</p>

<p>
A patch to simplify ephemeron handover during termination.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/594">ocaml-multicore/ocaml-multicore#594</a>
Fix finaliser handover issue
</p>

<p>
The <code>caml_finish_major_cycle</code> is used leading to the major GC phase
<code>Phase_sweep_and_mark_main</code> for the correct handoff of finalisers.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/596">ocaml-multicore/ocaml-multicore#596</a>
systhreads: do <code>st_thread_id</code> after initializing the thread descriptor
</p>

<p>
The thread ID was set even before initializing the thread
descriptor, and this PR fixes the order.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/604">ocaml-multicore/ocaml-multicore#604</a>
Fix unguarded <code>caml_skiplist_empty</code> in <code>caml_scan_global_young_roots</code>
</p>

<p>
The PR introduces a <code>caml_iterate_global_roots</code> function and fixes a
locking bug with global roots.
</p></li>
</ul>
</div>
</div>

<div id="outline-container-orgdd5b1bc" class="outline-6">
<h6 id="orgdd5b1bc">Cleanups</h6>
<div class="outline-text-6" id="text-orgdd5b1bc">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/567">ocaml-multicore/ocaml-multicore#567</a>
Simplify some of the minor_gc code
</p>

<p>
The <code>not_alone</code> variable has been cleaned up with a simplification
to the minor_gc.c code.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/580">ocaml-multicore/ocaml-multicore#580</a>
Remove struct domain
</p>

<p>
The <code>caml_domain_state</code> is now the single source of domain
information with the removal of <code>struct domain</code>. <code>struct
  dom_internal</code> is no longer leaking across the runtime.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/583">ocaml-multicore/ocaml-multicore#583</a>
Removing interrupt queues
</p>

<p>
The locking of <code>struct_interruptor</code> when receiving interrupts and
the use of <code>struct interrupt</code> have been removed, simplifying the
implementation of domains.
</p></li>
</ul>
</div>
</div>

<div id="outline-container-org7655879" class="outline-6">
<h6 id="org7655879">Sundries</h6>
<div class="outline-text-6" id="text-org7655879">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/582">ocaml-multicore/ocaml-multicore#582</a>
Make global state domain-local in Random, Hashtbl and Filename
</p>

<p>
The Domain-Local is now set as the default state in <code>Random</code>,
<code>Hashtbl</code> and <code>Filename</code>.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/586">ocaml-multicore/ocaml-multicore#586</a>
Make the state in Format domain-local
</p>

<p>
The default state in <code>Format</code> is now set to Domain-Local.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/595">ocaml-multicore/ocaml-multicore#595</a>
Implement <code>caml_alloc_dependent_memory</code> and <code>caml_free_dependent_memory</code>
</p>

<p>
Dependent memory are the blocks of heap memory that depend on the GC
(and finalizers) for deallocation. The <code>caml_alloc_dependent_memory</code>
and <code>caml_free_dependent_memory</code> have been added to
runtime/memory.c.
</p></li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-orga9919e9" class="outline-4">
<h4 id="orga9919e9">Ecosystem</h4>
<div class="outline-text-4" id="text-orga9919e9">
</div>
<div id="outline-container-orgd8deffe" class="outline-5">
<h5 id="orgd8deffe">Ongoing</h5>
<div class="outline-text-5" id="text-orgd8deffe">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/eventlog-tools/pull/3">ocaml-multicore/eventlog-tools#3</a>
Use ocaml/setup-ocaml@v2
</p>

<p>
An update to <code>.github/workflows/main.yml</code> to build for
ocaml/setup-ocaml@v2.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/parallel-programming-in-multicore-ocaml/pull/7">ocaml-multicore/parallel-programming-in-multicore-ocaml#7</a>
Add a section on Domain-Local Storage
</p>

<p>
The README.md file now includes a section on Domain-Local Storage.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/26">ocaml-multicore/eio#26</a>
Grand Central Dispatch Backend
</p>

<p>
The implemention of the Grand Central Dispatch (GCD) backend for Eio
is a work-in-progress.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/domainslib/pull/34">ocaml-multicore/domainslib#34</a>
Fix initial value accounting in <code>parallel_for_reduce</code>
</p>

<p>
A patch to fix the initial value in <code>parallel_for_reduce</code> as it was
being accounted for multiple times.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/domainslib/pull/36">ocaml-multicore/domainslib#36</a>
Switch to default <code>Random</code> module
</p>

<p>
The library has been updated to use the default <code>Random</code> module as
it stores its state in Domain-Local Storage which can be called from
multiple domains. The Sandmark results are given below:
</p>


<div id="org7fa958d" class="figure">
<p><img src="https://aws1.discourse-cdn.com/standard11/uploads/ocaml/original/2X/9/9a68704f282ac07167fb7d909334befa437593f0.png" alt="9a68704f282ac07167fb7d909334befa437593f0.png" />
</p>
</div></li>

<li><p>
<a href="https://github.com/ocaml-multicore/multicore-opam/issues/56">ocaml-multicore/multicore-opam#56</a>
Base-effects depends strictly on 4.12
</p>

<p>
A query on the use of strict 4.12.0 lower bound for OCaml in
<code>base-effects.base/opam</code>.
</p></li>

<li><p>
<a href="https://github.com/ocsigen/lwt/pull/860">ocsigen/lwt#860</a>
Lwt_domain: An interfacet to Multicore parallelism
</p>

<p>
The <code>Lwt_domain</code> module has been ported to domainslib Task pool for
performing computations to CPU cores using Multicore OCaml's
Domains. A few benchmark results obtained on an Intel Xeon Gold 5120
processor with 24 isolated cores is shown below:
</p>


<div id="orge8dc082" class="figure">
<p><img src="https://aws1.discourse-cdn.com/standard11/uploads/ocaml/original/2X/1/1e2d018635857f3603a1b7f9573176840efabede.png" alt="1e2d018635857f3603a1b7f9573176840efabede.png" />
</p>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org5f93e3c" class="outline-5">
<h5 id="org5f93e3c">Completed</h5>
<div class="outline-text-5" id="text-org5f93e3c">
</div>
<div id="outline-container-org9438cd4" class="outline-6">
<h6 id="org9438cd4">Ocaml-Uring</h6>
<div class="outline-text-6" id="text-org9438cd4">
<p>
The <code>ocaml-uring</code> repository contains bindings to <code>io_uring</code> for
OCaml.
</p>

<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-uring/pull/21">ocaml-multicore/ocaml-uring#21</a>
Add accept call
</p>

<p>
The <code>accept</code> call has been added to uring along with the inclusion
of the <code>unix</code> library as a dependency.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-uring/pull/22">ocaml-multicore/ocaml-uring#22</a>
Add support for cancellation
</p>

<p>
A <code>cancel</code> method is added to request jobs for cancellation. The
queuing operations and tests have also been updated.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-uring/pull/24">ocaml-multicore/ocaml-uring#24</a>
Sort out cast
</p>

<p>
The <code>Int_val</code> has been changed to <code>Long_val</code> to remove the need for
sign extension instruction on 64-bit platforms.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-uring/pull/25">ocaml-multicore/ocaml-uring#25</a>
Fix test_cancel
</p>

<p>
A <code>with_uring</code> function is added with a <code>queue_depth</code> argument to
handle tests for cancellation.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-uring/pull/26">ocaml-multicore/ocaml-uring#26</a>
Add <code>openat2</code>
</p>

<p>
The <code>openat2</code> method has been added giving access to all the Linux
open and resolve flags.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-uring/pull/27">ocaml-multicore/ocaml-uring#27</a>
Fine-tune C flags for better performance
</p>

<p>
The CFLAGS have been updated for performance improvements. The
following results are observed for the noop benchmark:
</p>

<pre class="example" id="orgaa4e2d0">
Before: noop   10000  │        1174227.1170 ns/run│
After:  noop   10000  │         920622.5802 ns/run│
</pre></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-uring/pull/28">ocaml-multicore/ocaml-uring#28</a>
Don't allow freeing the ring while it is in use
</p>

<p>
The ring is added to a global set on creation and is cleaned up on
exit. Also, invalid cancellation requests are checked before
allocating a slot.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-uring/pull/29">ocaml-multicore/ocaml-uring#29</a>
Replace iovec with cstruct and clean up the C stubs
</p>

<p>
The <code>readv</code> and <code>writev</code> now accept a list of Cstructs which allow
access to sub-ranges of bigarrays, and to work with multiple
buffers. The handling of OOM errors has also been improved.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-uring/pull/30">ocaml-multicore/ocaml-uring#30</a>
Fix remaining TODOs in API
</p>

<p>
The <code>read</code> and <code>write</code> methods have been renamed to <code>read_fixed</code> and
<code>write_fixed</code> respectively. The <code>Region.to_cstruct</code> has been added
as an alternative to creating a sub-bigarray. An exception is now
raised if the user requests for a larger size chunk.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-uring/pull/31">ocaml-multicore/ocaml-uring#31</a>
Use <code>caml_enter_blocking_section</code> when waiting
</p>

<p>
The <code>caml_enter_blocking_section</code> and <code>caml_leave_blocking_section</code>
are used when waiting, which allows other threads to execute and the
GC can run in the case of Multicore OCaml.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-uring/pull/32">ocaml-multicore/ocaml-uring#32</a>
Compile <code>uring</code> using the C flags from OCaml
</p>

<p>
Use the OCaml C flags when building uring, and remove the unused
dune file.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-uring/pull/33">ocaml-multicore/ocaml-uring#33</a>
Prepare release
</p>

<p>
The CHANGES.md, README.md, dune-project and uring.opam files have
been updated to prepare for a release.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-uring/pull/34">ocaml-multicore/ocaml-uring#34</a>
Convert <code>liburing</code> to subtree
</p>

<p>
We now use a subtree instead of a submodule so that the ocaml-uring
can be submitted to the opam-repository.
</p></li>
</ul>
</div>
</div>

<div id="outline-container-orgd24fa90" class="outline-6">
<h6 id="orgd24fa90">Parallel Programming in Multicore OCaml</h6>
<div class="outline-text-6" id="text-orgd24fa90">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/parallel-programming-in-multicore-ocaml/pull/5">ocaml-multicore/parallel-programming-in-multicore-ocaml#5</a>
<code>num_domains</code> to <code>num_additional_domains</code>
</p>

<p>
The documentation and code examples have been updated to now use
<code>num_additional_domains</code> instead of <code>num_domains</code>.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/parallel-programming-in-multicore-ocaml/pull/6">ocaml-multicore/parallel-programming-in-multicore-ocaml#6</a>
Update latest information about compiler versions
</p>

<p>
The compiler versions in the README.md have been updated to use 4.12
and its variants.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/parallel-programming-in-multicore-ocaml/pull/8">ocaml-multicore/parallel-programming-in-multicore-ocaml#8</a>
Nudge people to the default chunk_size setting
</p>

<p>
The recommendation is to use the default <code>chunk_size</code> when using
<code>parallel_for</code>, especially when the number of domains gets larger.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/parallel-programming-in-multicore-ocaml/pull/9">ocaml-multicore/parallel-programming-in-multicore-ocaml#9</a>
Eventlog section updates
</p>

<p>
The <code>eventlog-tools</code> library can now be used for parsing trace files
since Multicore OCaml includes CTF tracing support from trunk. The
relevant information has been updated in the README.md file.
</p></li>
</ul>
</div>
</div>

<div id="outline-container-orgba1fa2b" class="outline-6">
<h6 id="orgba1fa2b">Eio</h6>
<div class="outline-text-6" id="text-orgba1fa2b">
<p>
The <code>eio</code> library provides an effects-based parallel IO stack for
Multicore OCaml.
</p>
</div>

<ul class="org-ul">
<li><a id="org7814625"></a>Additions<br />
<div class="outline-text-7" id="text-org7814625">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/41">ocaml-multicore/eio#41</a>
Add eio.mli file
</p>

<p>
A <code>lib_eio/eio.mli</code> file containing modules for <code>Generic</code>, <code>Flow</code>,
<code>Network</code>, and <code>Stdenv</code> have been added to the repository.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/45">ocaml-multicore/eio#45</a>
Add basic domain manager
</p>

<p>
The PR allows you to run a CPU-intensive task on another domain, and
adds a mutex to <code>traceln</code> to avoid overlapping output.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/46">ocaml-multicore/eio#46</a>
Add Eio.Time and allow cancelling sleeps
</p>

<p>
Use <code>psq</code> instead of <code>bheap</code> library to allow cancellations. The
<code>Eio.Time</code> module has been added to <code>lib_eio/eio.ml</code>.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/53">ocaml-multicore/eio#53</a>
Add <code>Switch.sub_opt</code>
</p>

<p>
A new <code>Switch.sub_opt</code> implementation has been added to allow
running a function with a new switch. Also, <code>Switch.sub</code> has been
modified so that it is not a named argument.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/54">ocaml-multicore/eio#54</a>
Initial FS abstraction
</p>

<p>
A module <code>Dir</code> has been added to allow file system abstraction along
with the ability to create files and directories. On Linux, it uses
<code>openat2</code> and <code>RESOLVE_BENEATH</code>.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/56">ocaml-multicore/eio#56</a>
Add <code>with_open_in</code>, <code>with_open_out</code> and <code>with_open_dir</code> helpers
</p>

<p>
The <code>Eio.Dir</code> module now contains a <code>with_open_in</code>, <code>with_open_out</code>
and <code>with_open_dir</code> helper functions.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/58">ocaml-multicore/eio#58</a>
Add <code>Eio_linux.{readv, writev}</code>
</p>

<p>
The <code>Eio_linux.{readv, writev}</code> functions have been added to
<code>lib_eio_linux/eio_linux.ml</code> which uses the new OCaml-Uring API.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/59">ocaml-multicore/eio#59</a>
Add <code>Eio_linux.noop</code> and a simple benchmark
</p>

<p>
A <code>Eio_linux.noop</code> implementation has been added for benchmarking
Uring dispatch.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/61">ocaml-multicore/eio#61</a>
Add generic Enter effect to simplify scheduler
</p>

<p>
A <code>Enter</code> effect has been introduced to simplify the scheduler
operations, and this does not have much effect on the noop
benchmark as illustrated below:
</p>


<div id="org76522b7" class="figure">
<p><img src="https://aws1.discourse-cdn.com/standard11/uploads/ocaml/original/2X/3/3c1b2df002e1f57be2850d8b81d5eb08afb097dd.png" alt="3c1b2df002e1f57be2850d8b81d5eb08afb097dd.png" />
</p>
</div></li>
</ul>
</div>
</li>

<li><a id="org06056c6"></a>Improvements<br />
<div class="outline-text-7" id="text-org06056c6">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/38">ocaml-multicore/eio#38</a>
Rename Flow.write to Flow.copy
</p>

<p>
The code and documentation have been updated to rename <code>Flow.write</code>
to <code>Flow.copy</code> for better clarity.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/36">ocaml-multicore/eio#36</a>
Use uring for accept
</p>

<p>
The <code>enqueue_accept</code> function now uses <code>Uring.accept</code> along with the
<code>effect Accept</code>.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/37">ocaml-multicore/eio#37</a>
Performance improvements
</p>

<p>
Optimisation for <code>Eunix.free</code> and process completed events with
<code>Uring.peek</code> for better performance results.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/48">ocaml-multicore/eio#48</a>
Simplify <code>Suspend</code> operation
</p>

<p>
The <code>Suspend</code> effect has been simplified by replacing the older
<code>Await</code> and <code>Yield</code> effects with the code from Eio.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/52">ocaml-multicore/eio#52</a>
Split Linux support out to <code>eio_linux</code> library
</p>

<p>
<code>eunix</code> now has common code that is shared by different backends,
and <code>eio_linux</code> provides a Linux io-uring backend. The tests and the
documentation have been updated to reflect the change.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/57">ocaml-multicore/eio#57</a>
Reraise exceptions with backtraces
</p>

<p>
Added support to store a reference to a backtrace when a switch
catches an exception. This is useful when you want to reraise the
exception later.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/60">ocaml-multicore/eio#60</a>
Simplify handling of completions
</p>

<p>
The PR adds <code>Job</code> and <code>Job_no_cancel</code> in <code>type io_job</code> along with
additional <code>Log.debug</code> messages.
</p></li>
</ul>
</div>
</li>

<li><a id="org966670b"></a>Cleanups<br />
<div class="outline-text-7" id="text-org966670b">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/42">ocaml-multicore/eio#42</a>
Merge fibreslib into eio
</p>

<p>
The <code>Fibreslib</code> code is now merged with <code>eio</code>. You will now need to
open <code>Eio.Std</code> instead of opening <code>Fibreslib</code>.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/47">ocaml-multicore/eio#47</a>
Clean up the network API
</p>

<p>
The network APIs have been updated with few changes such as renaming
<code>bind</code> to <code>listen</code>, replacing <code>Unix.shutdown_command</code> with our own
type in Eio API, and replacing <code>Unix.sockaddr</code> with a custom type.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/49">ocaml-multicore/eio#49</a>
Remove <code>Eio.Private.Waiters</code> and <code>Eio.Private.Switch</code>
</p>

<p>
The <code>Eio.Private.Waiters</code> and <code>Eio.Private.Switch</code> modules have been
removed, and waiting is now handled using the Eio library.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/55">ocaml-multicore/eio#55</a>
Some API and README cleanups
</p>

<p>
The PR has multiple cleanups and documentation changes. The
README.md has been modified to use <code>Eio.Flow.shutdown</code> instead of
<code>Eio.Flow.close</code>, and a Time section has been added. The
<code>Eio.Network</code> module has been changed to <code>Eio.Net</code>. The <code>Time.now</code>
and <code>Time.sleep_until</code> methods have been added to <code>lib_eio/eio.ml</code>.
</p></li>
</ul>
</div>
</li>

<li><a id="org55353fa"></a>Documentation<br />
<div class="outline-text-7" id="text-org55353fa">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/43">ocaml-multicore/eio#43</a>
Add design note about determinism
</p>

<p>
The README.md documentation has been updated with few design notes
on Determinism.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/50">ocaml-multicore/eio#50</a>
README improvements
</p>

<p>
Updated README.md and added <code>doc/prelude.ml</code> for use with MDX.
</p></li>
</ul>
</div>
</li>
</ul>
</div>

<div id="outline-container-orga9596dd" class="outline-6">
<h6 id="orga9596dd">Handling Cancellation</h6>
<div class="outline-text-6" id="text-orga9596dd">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/39">ocaml-multicore/eio#39</a>
Allow cancelling accept operations
</p>

<p>
The PR now supports cancelling the server accept and read
operations.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/40">ocaml-multicore/eio#40</a>
Support cancelling the remaining Uring operations
</p>

<p>
The cancellation request of <code>connect</code>, <code>wait_readable</code> and
<code>await_writable</code> Uring operations is now supported.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/44">ocaml-multicore/eio#44</a>
Fix read-cancel test
</p>

<p>
The <code>ENOENT</code> value has been correctly fixed to use -2, and the
documentation for cancelling the read request has been updated.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/eio/pull/51">ocaml-multicore/eio#51</a>
Getting <code>EALREADY</code> from cancel is not an error
</p>

<p>
Handle <code>EALREADY</code> case in <code>lib_eunix/eunix.ml</code> where an operation
got cancelled while in progress.
</p></li>
</ul>
</div>
</div>

<div id="outline-container-org23dc913" class="outline-6">
<h6 id="org23dc913">Sundries</h6>
<div class="outline-text-6" id="text-org23dc913">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/eventlog-tools/pull/2">ocaml-multicore/eventlog-tools#2</a>
Add a pausetimes tool
</p>

<p>
A <code>eventlog_pausetimes</code> tool has been added to <code>eventlog-tools</code> that
takes a directory of eventlog files and computes the mean, max pause
times, as well as the distribution up to the 99.9th percentiles. For
example:
</p>

<pre class="example" id="orgd73f0d3">
ocaml-eventlog-pausetimes /home/engil/dev/ocaml-multicore/trace3/caml-426094-* name
{
  "name": "name",
  "mean_latency": 718617,
  "max_latency": 33839379,
  "distr_latency": [191,250,707,16886,55829,105386,249272,552640,1325621,13312993,26227671]
}
</pre></li>

<li><p>
<a href="https://github.com/ocaml-multicore/kcas/pull/9">ocaml-multicore/kcas#9</a>
Backoff with <code>cpu_relax</code>
</p>

<p>
The <code>Domain.Sync.{critical_section, wait_for}</code> have now been
replaced with <code>Domain.Sync.cpu_relax</code>, which matches the
implementation with lockfree.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/retro-httpaf-bench/pull/10">ocaml-multicore/retro-httpaf-bench#10</a>
Add Eio benchmark
</p>

<p>
The Eio benchmark has now been added to the retro-httpaf-bench
GitHub repository.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/retro-httpaf-bench/pull/11">ocaml-multicore/retro-httpaf-bench#11</a>
Do a recursive checkout in the CI build
</p>

<p>
The <code>build_image.yml</code> workflow has been updated to perform a
recursive checkout of the submodules for the CI build.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/domainslib/pull/29">domainslib#29</a>
Task stealing with Chase Lev deques
</p>

<p>
The task-stealing Chase Lev deques for scheduling tasks across
domains is now merged, and shows promising results on machines with
128 CPU cores.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/multicore-opam/pull/55">ocaml-multicore/multicore-opam#55</a>
Add 0.3.0 release of domainslib
</p>

<p>
The opam file for <code>domainslib.0.3.0</code> has been added to the
multicore-opam repository.
</p></li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-orgef033aa" class="outline-4">
<h4 id="orgef033aa">Benchmarking</h4>
<div class="outline-text-4" id="text-orgef033aa">
</div>
<div id="outline-container-org1eed9ac" class="outline-5">
<h5 id="org1eed9ac">Ongoing</h5>
<div class="outline-text-5" id="text-org1eed9ac">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-bench/sandmark-nightly/issues/1">ocaml-bench/sandmark-nightly#1</a>
Cannot alter comparison input values
</p>

<p>
The <code>Timestamp</code> and <code>Variant</code> fields in the dropdown option in the
<code>parallel_nightly.ipynb</code> notebook get reset when recomputing the
whole workbook.
</p>


<div id="org3f60e6e" class="figure">
<p><img src="https://aws1.discourse-cdn.com/standard11/uploads/ocaml/optimized/2X/e/e029e7d420487a4f3f63893dd4412322c1933787_2_1380x278.png" alt="e029e7d420487a4f3f63893dd4412322c1933787_2_1380x278.png" />
</p>
</div></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/230">ocaml-bench/sandmark#230</a>
Build for 4.13.0+trunk with dune.2.8.1
</p>

<p>
The <code>ocaml-migrate-parsetree.2.2.0</code> and <code>ppxlib.0.22.2</code> packages are
now available for 4.13.0+trunk, and we are currently porting the
Irmin Layers benchmark in Sandmark from using Irmin 2.4 to 2.6.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/issues/231">ocaml-bench/sandmark#231</a>
View results for a set of benchmarks in the nightly notebooks
</p>

<p>
A feature request to filter the list of benchmarks when using the
Sandmark Jupyter notebooks.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/233">ocaml-bench/sandmark#233</a>
Update pausetimes_multicore to fit with the latest Multicore changes
</p>

<p>
The pausetimes are now updated for both the 4.12.0 upstream and
4.12.0 Multicore branches to use the new Common Trace Format
(CTF). The generated graphs for both the sequential and parallel
pausetime results are illustrated below:
</p>


<div id="org992df03" class="figure">
<p><img src="https://aws1.discourse-cdn.com/standard11/uploads/ocaml/optimized/2X/9/9aa420116b999df5b89cd106b211673b3d2afb1d_2_1380x458.png" alt="9aa420116b999df5b89cd106b211673b3d2afb1d_2_1380x458.png" />
</p>
</div>


<div id="org8465267" class="figure">
<p><img src="https://aws1.discourse-cdn.com/standard11/uploads/ocaml/optimized/2X/c/cc380d59494290056577f76f977b0ffcb4199e55_2_1380x710.png" alt="cc380d59494290056577f76f977b0ffcb4199e55_2_1380x710.png" />
</p>
</div></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/issues/235">ocaml-bench/sandmark#235</a>
Update selected benchmarks as a set for baseline benchmark
</p>

<p>
The baseline benchmark for comparison should only be one from the
user selected benchmarks in the Jupyter notebooks.
</p>


<div id="org04b00f3" class="figure">
<p><img src="https://aws1.discourse-cdn.com/standard11/uploads/ocaml/original/2X/f/fba96b8d43ee766bff262ec5ca0c48e356e8d9cb.png" alt="fba96b8d43ee766bff262ec5ca0c48e356e8d9cb.png" />
</p>
</div></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/issues/236">ocaml-bench/sandmark#236</a>
Implement pausetimes support in sandmark_nightly
</p>

<p>
The sequential and parallel pausetimes graph results need to be
implemented in the Sandmark nightly Jupyter notebooks. The results
are similar to the Figures 10 and 12 produced in the <a href="https://arxiv.org/pdf/2004.11663.pdf">Retrofitting
Parallelism ont OCaml, ICFP 2020
paper</a>.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/issues/237">ocaml-bench/sandmark#237</a>
Run sandmark_nightly on a larger machine
</p>

<p>
The testing of Sandmark nightly sequential and parallel benchmark
runs have been done on a 24-core machine, and we would like to
deploy the same on a 64+ core machine to benefit from the recent
improvements to Domainslib.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/241">ocaml-bench/sandmark#241</a>
Switch to default Random module
</p>

<p>
An on-going discussion on whether to switch to using <code>Random.State</code>
for the sequential Minilight, global roots micro-benchmarks and
Evolutionary Algorithm.
</p></li>
</ul>
</div>
</div>

<div id="outline-container-org974db00" class="outline-5">
<h5 id="org974db00">Completed</h5>
<div class="outline-text-5" id="text-org974db00">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/232">ocaml-bench/sandmark#232</a>
<code>num_domains</code> -&gt; <code>num_additional_domains</code>
</p>

<p>
The benchmarks have been updated to now use
<code>num_additional_domains</code>, to be consistent with the naming in
Domainslib.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/239">ocaml-bench/sandmark#239</a>
Port grammatrix to Task pool
</p>

<p>
The Multicore Grammatrix benchmark has now been ported to use
Domainslib Task pool. The time and speedup graphs are given below:
</p>


<div id="org18499cc" class="figure">
<p><img src="https://aws1.discourse-cdn.com/standard11/uploads/ocaml/original/2X/d/d1e2d18707d543bc73cfa967c7dbfc2dd4783416.png" alt="d1e2d18707d543bc73cfa967c7dbfc2dd4783416.png" />
</p>
</div>


<div id="org228b73c" class="figure">
<p><img src="https://aws1.discourse-cdn.com/standard11/uploads/ocaml/original/2X/4/4b920039c0ebf9b1fbac4597b08ecf40f6e0f14f.png" alt="4b920039c0ebf9b1fbac4597b08ecf40f6e0f14f.png" />
</p>
</div></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orge742482" class="outline-4">
<h4 id="orge742482">OCaml</h4>
<div class="outline-text-4" id="text-orge742482">
</div>
<div id="outline-container-org54c2046" class="outline-5">
<h5 id="org54c2046">Ongoing</h5>
<div class="outline-text-5" id="text-org54c2046">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml/ocaml/pull/10039">ocaml/ocaml#10039</a>
Safepoints
</p>

<p>
The PR is currently being testing and evaluated for both ARM64 and
PowerPC architectures, in particular, the branch relaxations applied
to <code>Ipoll</code> instructions.
</p></li>
</ul>

<p>
Our thanks to all the OCaml users, developers and contributors in the community for their continued
support to the project. Stay safe!
</p>
</div>
</div>
</div>
</div>
</div>




<div id="outline-container-7" class="outline-2">
<h2 id="7">memprof-limits (first official release): Memory limits, allocation limits, and thread cancellation, with interrupt-safe resources</h2>
<div class="outline-text-2" id="text-7">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-memprof-limits-first-official-release-memory-limits-allocation-limits-and-thread-cancellation-with-interrupt-safe-resources/8135/1">https://discuss.ocaml.org/t/ann-memprof-limits-first-official-release-memory-limits-allocation-limits-and-thread-cancellation-with-interrupt-safe-resources/8135/1</a>
</p>
</div>

<div id="outline-container-org1511936" class="outline-3">
<h3 id="org1511936">Guillaume Munch-Maccagnoni announced</h3>
<div class="outline-text-3" id="text-org1511936">
<p>
Dear OCamlers, I am satisfied to announce the first official release of the package <code>memprof-limits</code>
(v0.2.0).
</p>

<p>
From the <a href="https://guillaume.munch.name/software/ocaml/memprof-limits/">user guide</a> (which has detailed
examples and use-cases):
</p>

<blockquote>
<p>
This package lets you interrupt <b>tasks</b> in a thread-safe and resource-safe way, when a resource limit
is reached or a cancellation token is set. A task is an isolated piece of computation running within
a thread.
</p>

<p>
<b>Global memory limits</b> interrupt a task when the major heap exceeds a certain size. <b>Allocation
limits</b> interrupt a task when a certain number of words have been allocated, a portable mesure of
time elapsed and quantity of work done. <b>Token limits</b> interrupt an allocating task when an
arbitrary token is set.
</p>
</blockquote>

<p>
It is available on opam for OCaml ≥ 4.12.
</p>

<p>
The name comes from the fact that it uses OCaml's <code>Memprof</code> statistical profiler engine (to perform
limit checks frequently-enough, related to the allocation rate of the program, and at the same time
rarely-enough to not affect performance).
</p>

<p>
It comes with an implementation of <b>masking</b> that lets you define interrupt-safe resources that are
guaranteed to be cleaned-up, and with them <a href="https://guillaume.munch.name/software/ocaml/memprof-limits/recovering.html">ensure that your program remains in a valid state after
being interrupted</a>.
</p>

<p>
To learn more about it, I recommend again the <a href="https://guillaume.munch.name/software/ocaml/memprof-limits/">user guide</a>.
</p>
</div>

<div id="outline-container-org5642046" class="outline-4">
<h4 id="org5642046">Example</h4>
<div class="outline-text-4" id="text-org5642046">
<p>
You can try it with OCaml 4.12 on the following example (<code>opam install memprof-limits</code> -&gt; <code>utop</code> -&gt;
<code>#require "memprof-limits";;</code>):
</p>

<p>
A worker task allocates 300M words, only 3k of which live simultaneously. This comes close to an
allocation limit of 330M words set by the monitor. The probability that the worker is interrupted is
less than 10^-50, and thus the computation successfully completes, in about a second.
</p>
<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #b22222;">(* </span><span style="color: #b22222;">worker </span><span style="color: #b22222;">*)</span>
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">f</span> () =
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #000000; font-weight: bold;">rec</span> <span style="color: #0000ff;">alloc</span> <span style="color: #a0522d;">n</span> <span style="color: #a0522d;">x</span> =
    <span style="color: #a020f0;">if</span> n = 0 <span style="color: #a020f0;">then</span> x <span style="color: #a020f0;">else</span> alloc (n-1) (()<span style="color: #000000; background-color: #ffffff;">::</span>x)
  <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #b22222;">(* </span><span style="color: #b22222;">allocate 300'000 kw </span><span style="color: #b22222;">*)</span>
  <span style="color: #a020f0;">for</span> i = 0 <span style="color: #a020f0;">to</span> 100_000 <span style="color: #a020f0;">do</span> <span style="color: #483d8b;">ignore</span> (alloc 1_000 <span style="color: #000000; background-color: #ffffff;">[]</span>) <span style="color: #a020f0;">done</span>

<span style="color: #b22222;">(* </span><span style="color: #b22222;">monitor </span><span style="color: #b22222;">*)</span>
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">g</span> () =
  <span style="color: #a020f0;">match</span> <span style="color: #228b22;">Memprof_limits.</span>limit_allocations <span style="color: #008b8b;">~limit</span>:330_000L f <span style="color: #a020f0;">with</span>
  | <span style="color: #000000; background-color: #ffffff;">Ok</span> ((), n) -&gt; <span style="color: #228b22;">Printf.</span>printf <span style="color: #8b2252;">"success (est. alloc. %#Lu kw)\n"</span> n
  | <span style="color: #000000; background-color: #ffffff;">Error</span> _ -&gt; print_endline <span style="color: #8b2252;">"out of fuel"</span>

<span style="color: #b22222;">(* </span><span style="color: #b22222;">main </span><span style="color: #b22222;">*)</span>
<span style="color: #000000; font-weight: bold;">let</span> () =
  <span style="color: #228b22;">Memprof_limits.</span>start_memprof_limits () ;
  g ()
</pre>
</div>
</div>
</div>

<div id="outline-container-org2f2cd51" class="outline-4">
<h4 id="org2f2cd51">Changes</h4>
<div class="outline-text-4" id="text-org2f2cd51">
<p>
Major changes to last year's experimental release:
</p>
<ul class="org-ul">
<li>The internal state is now protected against asynchronous exceptions arising from memprof callbacks (especially the own interrupt of memprof-limits), so it is no longer buggy (“experimental”).</li>
<li>And now it works under bytecode too.</li>
<li>Added token limits: interrupts that can be triggered at a distance.</li>
<li>Detailed guide and reference manuals, now generated by <code>odoc</code>.</li>
<li><a href="https://guillaume.munch.name/software/ocaml/memprof-limits/index.html#isolation">Features to program with interrupt- and resource-safety in mind</a>.</li>
<li>API revamp.</li>
</ul>
</div>
</div>

<div id="outline-container-org312289c" class="outline-4">
<h4 id="org312289c">Links</h4>
<div class="outline-text-4" id="text-org312289c">
<ul class="org-ul">
<li><a href="https://gitlab.com/gadmm/memprof-limits/">Gitlab repository</a>.</li>
<li><a href="https://guillaume.munch.name/software/ocaml/memprof-limits/">Guide with use cases and examples</a>.</li>
<li><a href="https://guillaume.munch.name/software/ocaml/memprof-limits/Memprof_limits/">Reference manual</a>.</li>
<li>A <a href="https://gitlab.com/gadmm/memprof-limits/-/blob/master/doc/statistical.md">statistical analysis of the different limits</a>.</li>
<li>A <a href="https://guillaume.munch.name/software/ocaml/memprof-limits/recovering.html">guide to recover from interrupts</a>.</li>
<li><a href="https://gitlab.com/gadmm/memprof-limits/-/blob/master/FAQ.md">FAQ</a>.</li>
</ul>
</div>
</div>
</div>
</div>




<div id="outline-container-8" class="outline-2">
<h2 id="8">Bitwuzla 1.0.0 (SMT solver for AUFBVFP)</h2>
<div class="outline-text-2" id="text-8">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-bitwuzla-1-0-0-smt-solver-for-aufbvfp/8138/1">https://discuss.ocaml.org/t/ann-bitwuzla-1-0-0-smt-solver-for-aufbvfp/8138/1</a>
</p>
</div>

<div id="outline-container-orgfe58dbf" class="outline-3">
<h3 id="orgfe58dbf">Frédéric Recoules announced</h3>
<div class="outline-text-3" id="text-orgfe58dbf">
<p>
On behalf of the bitwuzla team I am pleased to announce the release of bitwuzla ocaml binding
(<a href="https://github.com/bitwuzla/ocaml-bitwuzla">https://github.com/bitwuzla/ocaml-bitwuzla</a>).
</p>

<p>
Bitwuzla (<a href="https://bitwuzla.github.io/">https://bitwuzla.github.io/</a>) is a Satisfiability Modulo Theories (SMT) solver for the
theories of fixed-size bit-vectors, floating-point arithmetic, arrays and uninterpreted functions and
their combinations.
</p>

<p>
This ocaml binding comes in two flavors:
</p>
<ul class="org-ul">
<li>a straight low-level C binding <code>Bitwuzla_c</code> (for the brave and the unaware) &#x2013; <code>opam depext -i bitwuzla-c</code>;</li>
<li>a type-safier OCaml API <code>Bitwuzla</code> &#x2013; <code>opam depext -i bitwuzla</code>.</li>
</ul>

<p>
(Additionally, you can build bitwuzla standalone executable with <code>opam depext -i bitwuzla-bin</code>.)
</p>

<p>
Documentation and examples are available online (<a href="https://bitwuzla.github.io/docs/ocaml/">https://bitwuzla.github.io/docs/ocaml/</a>).
</p>

<p>
Feel free to give it a try,
</p>
</div>
</div>
</div>




<div id="outline-container-org0390044" class="outline-2">
<h2 id="org0390044">Old CWN</h2>
<div class="outline-text-2" id="text-org0390044">
<p>
If you happen to miss a CWN, you can <a href="mailto:alan.schmitt@polytechnique.org">send me a message</a> and I'll mail it to you, or go take a look at <a href="https://alan.petitepomme.net/cwn/">the archive</a> or the <a href="https://alan.petitepomme.net/cwn/cwn.rss">RSS feed of the archives</a>.
</p>

<p>
If you also wish to receive it every week by mail, you may subscribe <a href="http://lists.idyll.org/listinfo/caml-news-weekly/">online</a>.
</p>

<div class="authorname" id="orgc32b686">
<p>
<a href="https://alan.petitepomme.net/">Alan Schmitt</a>
</p>

</div>
</div>
</div>
</div>
</body>
</html>
