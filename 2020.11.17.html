<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-11-17 Tue 10:20 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OCaml Weekly News</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<style type="text/css">#table-of-contents h2 { display: none } .title { display: none } .authorname { text-align: right }</style>
<style type="text/css">.outline-2 {border-top: 1px solid black;}</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">OCaml Weekly News</h1>
<p>
<a href="http://alan.petitepomme.net/cwn/2020.11.10.html">Previous Week</a> <a href="http://alan.petitepomme.net/cwn/index.html">Up</a> <a href="http://alan.petitepomme.net/cwn/2020.11.24.html">Next Week</a>
</p>

<p>
Hello
</p>

<p>
Here is the latest OCaml Weekly News, for the week of November 10 to 17, 2020.
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#1">latest batteries release: v3.2.0</a></li>
<li><a href="#2">OCaml User Survey 2020</a></li>
<li><a href="#3">VSCode OCaml Platform v1.4.0</a></li>
<li><a href="#4">Directories, an ocaml library</a></li>
<li><a href="#5">Lwt vs System threads</a></li>
<li><a href="#6">OCaml for ARM MacOS</a></li>
<li><a href="#7">Introduction to the module system</a></li>
<li><a href="#8">Getting resulting sig and struct of a complex modular program</a></li>
<li><a href="#9">New release of ocaml-r</a></li>
<li><a href="#10">Reflections on my first completed application in OCaml</a></li>
<li><a href="#11">Help needed testing decimal package</a></li>
<li><a href="#12">OCaml 4.12.0, first alpha release</a></li>
<li><a href="#13">Experimental new layout for the ocaml-variants packages in opam-repository</a></li>
<li><a href="#14">Messages, a library for type safe encoding and decoding</a></li>
<li><a href="#orgbdc6060">Old CWN</a></li>
</ul>
</div>
</div>


<div id="outline-container-orgf122be1" class="outline-2">
<h2 id="1">latest batteries release: v3.2.0</h2>
<div class="outline-text-2" id="text-1">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-latest-batteries-release-v3-2-0/6738/1">https://discuss.ocaml.org/t/ann-latest-batteries-release-v3-2-0/6738/1</a>
</p>
</div>

<div id="outline-container-org1cf2e74" class="outline-3">
<h3 id="org1cf2e74">UnixJunkie announced</h3>
<div class="outline-text-3" id="text-org1cf2e74">
<p>
The batteries maintainers are pleased to announce the latest minor release of OCaml batteries-included:
v3.2.0.
Batteries is an open-source, community-maintained, extended standard library for OCaml.
The latest version is available in opam.
</p>

<p>
Thanks to all the contributors for this release!
</p>

<p>
The change log follows:
</p>
</div>
<div id="outline-container-org96de042" class="outline-4">
<h4 id="org96de042">v3.2.0 (minor release)</h4>
<div class="outline-text-4" id="text-org96de042">
<ul class="org-ul">
<li>BatArray.fold_while: ('acc -&gt; 'a -&gt; bool) -&gt; ('acc -&gt; 'a -&gt; 'acc) -&gt; 'acc -&gt; 'a array -&gt; 'acc * int <a href="https://github.com/ocaml-batteries-team/batteries-included/pull/974">#974</a> (Francois Berenger, review by Cedric Cellier)</li>
<li>Support for OCaml 4.12 <a href="https://github.com/ocaml-batteries-team/batteries-included/pull/980">#980</a> (kit-ty-kate)</li>
<li>BatArray.fold is an alias for fold_left <a href="https://github.com/ocaml-batteries-team/batteries-included/pull/976">#976</a> (Francois Berenger)</li>
<li>BatList.fold is an alias for fold_left <a href="https://github.com/ocaml-batteries-team/batteries-included/pull/975">#975</a> (Francois Berenger)</li>
<li>BatArray.count_matching: ('a -&gt; bool) -&gt; 'a array -&gt; int <a href="https://github.com/ocaml-batteries-team/batteries-included/pull/972">#972</a> (Francois Berenger)</li>
<li>BatList.count_matching: ('a -&gt; bool) -&gt; 'a list -&gt; int <a href="https://github.com/ocaml-batteries-team/batteries-included/pull/816">#816</a> (Francois Berenger)</li>
<li>Provide an explicitly unthreaded package For Dune, provide an alternative batteries.unthreaded package <a href="https://github.com/ocaml-batteries-team/batteries-included/pull/970">#970</a> (Jerome Vouillon)</li>
<li>BatList.findi: correct documentation <a href="https://github.com/ocaml-batteries-team/batteries-included/pull/967">#967</a> (Francois Berenger)</li>
<li>BatOptParse.unprogify: bug fix (issue <a href="https://github.com/ocaml-batteries-team/batteries-included/issues/965">#965</a>) '%prog' was replaced only once, now it is always replaced (in accordance with the documentation) <a href="https://github.com/ocaml-batteries-team/batteries-included/pull/966">#966</a> (Francois Berenger, report by OnkV)</li>
<li>Expose Map.remove_exn and Set.remove_exn: 'a -&gt; 'a t -&gt; 'a t <a href="https://github.com/ocaml-batteries-team/batteries-included/issues/954">#954</a> (Cedric Cellier)</li>
</ul>
</div>
</div>
</div>
</div>




<div id="outline-container-org788d012" class="outline-2">
<h2 id="2">OCaml User Survey 2020</h2>
<div class="outline-text-2" id="text-2">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-ocaml-user-survey-2020/6624/16">https://discuss.ocaml.org/t/ann-ocaml-user-survey-2020/6624/16</a>
</p>
</div>

<div id="outline-container-org520c4ba" class="outline-3">
<h3 id="org520c4ba">Xavier Leroy announced</h3>
<div class="outline-text-3" id="text-org520c4ba">
<p>
The OCaml survey 2020 is now closed.  It attracted 745 replies.  Everyone should be able to see <a href="https://docs.google.com/forms/d/1OZV7WCprDnouU-rIEuw-1lDTeXrH_naVlJ77ziXQJfg/viewanalytics">the
summary of
results</a>
and to download <a href="http://cambium.inria.fr/~xleroy/tmp/OCaml-user-survey.csv.zip">the raw data</a>.
</p>

<p>
I and a few others will try to write a summary of the replies, especially of the many free-form
replies.  Everyone is welcome to help sifting through the results!  Short comments can be posted in
this discussion thread, and longer analyses can be  put somewhere else and mentioned here.
</p>
</div>
</div>
</div>




<div id="outline-container-org6c377b3" class="outline-2">
<h2 id="3">VSCode OCaml Platform v1.4.0</h2>
<div class="outline-text-2" id="text-3">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-vscode-ocaml-platform-v1-4-0/6748/1">https://discuss.ocaml.org/t/ann-vscode-ocaml-platform-v1-4-0/6748/1</a>
</p>
</div>

<div id="outline-container-org19bc05f" class="outline-3">
<h3 id="org19bc05f">Max LANTAS announced</h3>
<div class="outline-text-3" id="text-org19bc05f">
<p>
We are happy to announce the v1.4.0 release of <a href="https://github.com/ocamllabs/vscode-ocaml-platform">VSCode OCaml
Platform</a>, a Visual Studio Code extension for
OCaml. It will be available shortly on the <a href="https://marketplace.visualstudio.com/items?itemName=ocamllabs.ocaml-platform">VSCode
Marketplace</a>.
</p>

<p>
This release has the following changes:
</p>
<ul class="org-ul">
<li>Stop highlighting ocaml unit/array/list literals with bold
(<a href="https://github.com/ocamllabs/vscode-ocaml-platform/pull/416">#416</a>)</li>
<li>Add a snippet <code>struct end</code> with prefix <code>struct</code>
(<a href="https://github.com/ocamllabs/vscode-ocaml-platform/pull/420">#420</a>)</li>
<li>Only restart the language server for the <code>ocaml.server.restart</code> command
(<a href="https://github.com/ocamllabs/vscode-ocaml-platform/pull/426">#426</a>)</li>
<li>Use highlighting for character literals which is consistent with other
languages in VS Code (<a href="https://github.com/ocamllabs/vscode-ocaml-platform/pull/428">#428</a>)</li>
<li>Allow using <code>${workspaceFolder:folder_name}</code> placeholder variables in sandbox
configurations for portable settings.json files (<a href="https://github.com/ocamllabs/vscode-ocaml-platform/pull/424">#424</a>)</li>
<li>Fix OCaml problem matcher for warning codes and error messages without
characters (<a href="https://github.com/ocamllabs/vscode-ocaml-platform/pull/429">#429</a>)</li>
</ul>

<p>
The workspace folder variables in sandbox configurations should make configurations portable, a common
request we've had. The extension will now use portable settings by default for local opam switches and
esy configurations.
</p>

<p>
Please feel free to share feedback.
</p>
</div>
</div>
</div>




<div id="outline-container-org78bba0a" class="outline-2">
<h2 id="4">Directories, an ocaml library</h2>
<div class="outline-text-2" id="text-4">
<p>
Archive: <a href="https://discuss.ocaml.org/t/directories-an-ocaml-library/6753/1">https://discuss.ocaml.org/t/directories-an-ocaml-library/6753/1</a>
</p>
</div>

<div id="outline-container-org6f1138a" class="outline-3">
<h3 id="org6f1138a">OCamlPro announced</h3>
<div class="outline-text-3" id="text-org6f1138a">
<p>
We are pleased to present  <a href="https://github.com/OCamlPro/directories">directories</a>, which is an <a href="https://en.wikipedia.org/wiki/OCaml">OCaml</a> library that provides configuration, cache and data paths
(and more!) following the suitable conventions on <a href="https://en.wikipedia.org/wiki/Linux">Linux</a>, <a href="https://en.wikipedia.org/wiki/MacOS">macOS</a> and <a href="https://en.wikipedia.org/wiki/Microsoft_Windows">Windows</a>. It is inspired by similar libraries for
other languages such as <a href="https://github.com/dirs-dev/directories-jvm">directories-jvm</a>.
</p>

<p>
The following conventions are used:
</p>

<ul class="org-ul">
<li><a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a> and<a href="https://www.freedesktop.org/wiki/Software/xdg-user-dirs/">xdg-user-dirs</a> on Linux</li>
<li><a href="https://docs.microsoft.com/fr-fr/windows/win32/shell/known-folders">Known Folders</a> on Windows</li>
<li><a href="https://developer.apple.com/library/archive/documentation/FileManagement/Conceptual/FileSystemProgrammingGuide/FileSystemOverview/FileSystemOverview.html#//apple_ref/doc/uid/TP40010672-CH2-SW6">Standard Directories</a> on macOS</li>
</ul>

<p>
On Linux and macOS it has no dependency. On Windows, it depends only on <a href="https://github.com/ocamllabs/ocaml-ctypes">ctypes</a>.
</p>

<p>
You will find more information here:
<a href="https://github.com/OCamlPro/directories">https:</a><a href="https://github.com/OCamlPro/directories">//github.com/OCamlPro/directories</a>
</p>
</div>
</div>
</div>




<div id="outline-container-org72a89fe" class="outline-2">
<h2 id="5">Lwt vs System threads</h2>
<div class="outline-text-2" id="text-5">
<p>
Archive: <a href="https://discuss.ocaml.org/t/lwt-vs-system-threads/5007/28">https://discuss.ocaml.org/t/lwt-vs-system-threads/5007/28</a>
</p>
</div>

<div id="outline-container-org1fcc6bb" class="outline-3">
<h3 id="org1fcc6bb">Continuing this thread, Robin Bj√∂rklin said</h3>
<div class="outline-text-3" id="text-org1fcc6bb">
<p>
The article you linked is an interesting read. This <a href="https://www.youtube.com/watch?v=kdzL3r-yJZY">talk on
youtube</a> also explains the difference in an easily
digestible way.
</p>

<p>
Looking at <a href="https://github.com/ocaml-community/awesome-ocaml#web-development">awesome-ocaml</a> there
doesn't seem to be a web framework that relies on threading. Is there one out there somewhere?
</p>
</div>
</div>


<div id="outline-container-orge7b3b2b" class="outline-3">
<h3 id="orge7b3b2b">Simon Cruanes replied</h3>
<div class="outline-text-3" id="text-orge7b3b2b">
<p>
It's a very far cry from a framework, but my <a href="https://github.com/c-cube/tiny_httpd">tiny
httpd</a> relies on threads and works
pretty well for http 1.1.
</p>
</div>
</div>
</div>




<div id="outline-container-orgeea59ad" class="outline-2">
<h2 id="6">OCaml for ARM MacOS</h2>
<div class="outline-text-2" id="text-6">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ocaml-for-arm-macos/6019/15">https://discuss.ocaml.org/t/ocaml-for-arm-macos/6019/15</a>
</p>
</div>

<div id="outline-container-org851249c" class="outline-3">
<h3 id="org851249c">Paolo G. Giarrusso asked</h3>
<div class="outline-text-3" id="text-org851249c">
<p>
News, now that M1 is out?
</p>
</div>
</div>


<div id="outline-container-org8a044ac" class="outline-3">
<h3 id="org8a044ac">Anil Madhavapeddy replied</h3>
<div class="outline-text-3" id="text-org8a044ac">
<p>
OCaml 4.12 will have full native code macOS/ARM support. The first alpha is due out any day now, and
the ecosystem tools will be ready on the day of its release as well, thanks to the <a href="https://github.com/ocaml/opam-repository/issues/17530">OCaml readiness
team's efforts</a>
</p>
</div>
</div>


<div id="outline-container-org6b4bfe6" class="outline-3">
<h3 id="org6b4bfe6">EduardoRFS also replied</h3>
<div class="outline-text-3" id="text-org6b4bfe6">
<p>
@Blaisorblade currently with my backport to OCaml 4.10 everything is working, a couple of months ago I
did bootstrap opam using it.
</p>

<p>
This one,
</p>

<p>
<a href="https://github.com/EduardoRFS/ocaml/tree/4.10+ios+esy">https://github.com/EduardoRFS/ocaml/tree/4.10+ios+esy</a>
</p>
</div>
</div>
</div>




<div id="outline-container-org8be2e11" class="outline-2">
<h2 id="7">Introduction to the module system</h2>
<div class="outline-text-2" id="text-7">
<p>
Archive: <a href="https://discuss.ocaml.org/t/introduction-to-the-module-system/6760/1">https://discuss.ocaml.org/t/introduction-to-the-module-system/6760/1</a>
</p>
</div>

<div id="outline-container-orga694439" class="outline-3">
<h3 id="orga694439">Christian Lindig announced</h3>
<div class="outline-text-3" id="text-orga694439">
<p>
Stephen Diehl has started a series of blog posts about <a href="https://www.stephendiehl.com/posts/exotic01.html">module
systems</a> using OCaml as an example. This provides a
nice introduction to the finer points.
</p>
</div>
</div>
</div>




<div id="outline-container-org7989156" class="outline-2">
<h2 id="8">Getting resulting sig and struct of a complex modular program</h2>
<div class="outline-text-2" id="text-8">
<p>
Archive: <a href="https://discuss.ocaml.org/t/getting-resulting-sig-and-struct-of-a-complex-modular-program/6762/1">https://discuss.ocaml.org/t/getting-resulting-sig-and-struct-of-a-complex-modular-program/6762/1</a>
</p>
</div>

<div id="outline-container-org7e2fc2d" class="outline-3">
<h3 id="org7e2fc2d">Luc_ML asked</h3>
<div class="outline-text-3" id="text-org7e2fc2d">
<p>
The OCaml module system let create a very modular program with quite unlimited complexly nested sig and
struct, while avoiding redundancy.
But the resulting documentation reflects exactly that, which makes it hard to read, resulting in
jumping from one sig (or struct) to another. It may give headache and especially provoke mistakes when
writing an expression with illegal type.
</p>

<p>
What is the straightest manner to get the <b>resulting</b> signature and structure of an OCaml program:
</p>
<ul class="org-ul">
<li>in its generated documentation</li>
<li>from the toplevel (it seems roughly to work with <code>#show_module module-path</code> but it sometimes has weird behavior/result)</li>
</ul>

<p>
The error messages are also more complex, revealing the modular structure. It can even be harder to
understand when polymorphic variants are used!
Is there a way to limit that burden?
One <b>simplistic</b> idea would be to program in a modular way, then to "flatten" the whole program in
order to let him expose the resulting sig/struct.
Is that idea sensible, and how to simply do that?
</p>
</div>
</div>


<div id="outline-container-orgd1781e4" class="outline-3">
<h3 id="orgd1781e4">Christian Lindig replied</h3>
<div class="outline-text-3" id="text-orgd1781e4">
<p>
If you are interested in generating the documentation of such a structure - this is not an easy problem
and was the topic of a talk at this year's OCaml Workshop: <a href="https://www.youtube.com/watch?v=wVyZ-KveN-w">The final pieces of the OCaml documentation
puzzle</a>
</p>

<blockquote>
<p>
Rendering OCaml document is widely known as a very difficult task: The ever-evolving OCaml module
system is extremely rich and can include complex set of inter-dependencies that are both difficult to
compute and to render in a concise document. Its tasks are even harder than the typechecker as it
also needs to keep track of documentation comments precisely and efficiently. As an example,
signatures such as include F(X).T and destructive substitutions were never handled properly by any
documentation generator.
</p>
</blockquote>
</div>
</div>
</div>




<div id="outline-container-org879d538" class="outline-2">
<h2 id="9">New release of ocaml-r</h2>
<div class="outline-text-2" id="text-9">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-new-release-of-ocaml-r/6765/1">https://discuss.ocaml.org/t/ann-new-release-of-ocaml-r/6765/1</a>
</p>
</div>

<div id="outline-container-orgccaa75d" class="outline-3">
<h3 id="orgccaa75d">Philippe announced</h3>
<div class="outline-text-3" id="text-orgccaa75d">
<p>
It is my pleasure to announce the 0.4 release of <code>ocaml-r</code>, a library providing bindings to the <a href="https://www.r-project.org/">R
statistical environment</a> interpreter and a few of its standard libraries.
</p>

<p>
Documentation: <a href="http://pveber.github.io/ocaml-r/index.html">http://pveber.github.io/ocaml-r/index.html</a> <br />
Repository: <a href="https://github.com/pveber/ocaml-r">https://github.com/pveber/ocaml-r</a>
</p>

<p>
This new release brings a big API change, where the bindings are exposed through modules and abstract
types instead of types parameterized by object types. The new style is similar in spirit to what's
offered in Lexify's <a href="https://github.com/lexifi/gen_js_api">gen_js_api</a> or Daniel B√ºnzli's
<a href="https://erratique.ch/software/brr">Brr</a>. The result is hopefully a lot easier to read and use, and
incidentally provides a condensed (although incomplete) specification of R's type system.
</p>

<p>
Finally the documentation, while it's far from being exhaustive, has improved a bit. On this topic, I'd
like to address a warm and loud thank you to all the good people involved in
<a href="https://github.com/ocaml/odoc">odoc</a>: you're changing people's life for the better ;)
</p>
</div>
</div>
</div>




<div id="outline-container-org84c2c3a" class="outline-2">
<h2 id="10">Reflections on my first completed application in OCaml</h2>
<div class="outline-text-2" id="text-10">
<p>
Archive: <a href="https://discuss.ocaml.org/t/reflections-on-my-first-completed-application-in-ocaml/6768/1">https://discuss.ocaml.org/t/reflections-on-my-first-completed-application-in-ocaml/6768/1</a>
</p>
</div>

<div id="outline-container-org962a9ce" class="outline-3">
<h3 id="org962a9ce">Christopher Dieringer told</h3>
<div class="outline-text-3" id="text-org962a9ce">
<p>
Greetings! I'm a new OCaml user. The intent of this post is simply to share my experience thus far in
OCaml and hopefully generate some casual conversation about how other community users think about &amp; use
OCaml. What do I hope to get from this post? Critiques, affirmation, tips, whatever. I learned OCaml
alone, in a bubble, during pandemic lockdown. Was my experience the classic OCaml learning experience,
or was it unique in some way? I'm hoping to garner feedback from other community members. Talk at me!
:)
</p>
</div>

<div id="outline-container-org2669632" class="outline-4">
<h4 id="org2669632">What's my project?</h4>
<div class="outline-text-4" id="text-org2669632">
<ul class="org-ul">
<li><a href="https://github.com/cdaringe/freshawair">https://github.com/cdaringe/freshawair</a></li>
</ul>

<p>
tl;dr, freshawair is a system that collects and presents air quality datas from my in-home air quality
monitor.
</p>

<p>
Awair ships a mobile app to observe your air quality stats, but the app doesn't let you observe data
more than a week old. Further, the app does not let you bin the timeseries data. I wanted to be able to
see macro, seasonal trends on various air quality metrics in my home. Lucky for me, the sensor unit
exposes a HTTP API, allowing me to capture data easily and get busy. Sounds like a fun COVID "time to
learn OCaml project!"
</p>


<div class="figure">
<p><img src="https://aws1.discourse-cdn.com/standard11/uploads/ocaml/original/2X/e/eb73c493f5d7c731664c457e269d17217ac9f46f.gif" alt="eb73c493f5d7c731664c457e269d17217ac9f46f.gif" />
</p>
</div>
</div>
</div>

<div id="outline-container-org9209295" class="outline-4">
<h4 id="org9209295">Why OCaml?</h4>
<div class="outline-text-4" id="text-org9209295">
<p>
My key interests in selecting OCaml for this project were:
</p>

<ul class="org-ul">
<li>Binaries. code that runs artifacts on the metal. no VM required! having a thin runtime was not inhibiting.
<ul class="org-ul">
<li>I was originally targeting ARM on a low powered device, so this was essential.</li>
</ul></li>

<li>functional language. I'm tired of the same old problems from <span class="underline">other-langs</span>. I've been on a kick, learning languages that seem to support or tend towards correctness.</li>

<li>Effects. I recently worked on <a href="https://effects.js.org">https://effects.js.org</a>, and I wanted to experience effects, first-class, in a language.</li>
</ul>
</div>

<ul class="org-ul">
<li><a id="orgb3c345d"></a>How does the project work?<br />
<div class="outline-text-5" id="text-orgb3c345d">
<p>
There are four parts:
</p>

<ul class="org-ul">
<li>agent - ocaml - collects data from the awair http api, forwards data to the freshawair server</li>
<li>server - ocaml - hosts api, hosts ui static assets</li>
<li>database - timescaledb - omitted from discussion</li>
<li>ui - react/typescript - omitted from discussion</li>
</ul>

<p>
The agent and the server could have been combined into one binary. However, the original designed
called for the server and DB to live in the cloud, while the agent would exist in my local network
only. The design still supports this, even though I now just deploy all of the things side-by-side on
my NAS.
</p>
</div>
</li>
</ul>
</div>

<div id="outline-container-org26b029b" class="outline-4">
<h4 id="org26b029b">How'd it go?</h4>
<div class="outline-text-4" id="text-org26b029b">
<p>
Overall, pretty good. I've grown quite affectionate towards ML. Having done a bit of Elm before, and
just a nibble of recreational Haskell, OCaml <span class="underline">fundamentals</span> were not hard to pick up. The module
system, figuring out where common functionality lives (or if common functionality even existed in the
core lib), &amp; perhaps configuring builds all cumulatively took a little more time than I would have
liked, but hey&#x2013;that's learning. Regardless of the the hype around multicore, which I am certainly
excited about, pragmatically <code>effects</code> don't exist in ocaml yet. No ARM support, ppx_tools incompat,
etc in the multicore compiler. Effects was one of my primary decision drivers in selecting OCaml, so I
felt a bit bamboozled as I slowly uncovered that this lack of compatibility with mainline compilers was
the status-quo. Even so, I have no remorse.
</p>
</div>

<ul class="org-ul">
<li><a id="org792dcff"></a>What was great?<br />
<div class="outline-text-5" id="text-org792dcff">
<ul class="org-ul">
<li>discord community. thanks everyone for helping me with so many questions</li>
<li>docker images/infrastructure. just top tier work right there.</li>
<li>ocaml platform editor support for vscode
<ul class="org-ul">
<li>it has its quirks, but it's also new. having a clear "this is the tooling to use" directive, and having it actually work (most of the time) was quite nice.</li>
</ul></li>
<li>responsive community
<ul class="org-ul">
<li>during the course of the project, i added comments in maybe 6-12 community GitHub projects. i got feedback in <span class="underline">every single one</span>. OCaml may be a small community, but it's real people committed to the cause ;). what a delight this was. seriously! you are nerds helping helping nerds. be proud.</li>
</ul></li>
<li>Core as a std lib was easy to explore, and was a great start to hack away at an empty file.</li>
<li>Opium. I originally wrote my server in plain-jane cohttp, and recently refactored it to opium. Love it!</li>
</ul>
</div>
</li>

<li><a id="org22b3c25"></a>What was just OK<br />
<div class="outline-text-5" id="text-org22b3c25">
<p>
It's easier to remember recent suffering for me, so forgive the fact that the below lists are a bit
longer than the "great!" list.
</p>

<ul class="org-ul">
<li>Real World OCaml is a good book&#x2013;truly. Even so, I personally do not think that it is the right book to bootstrap newbies, nor get people excited about OCaml. It's more of a handbook, versus a guided tutorial on how to start doing productive <span class="underline">things‚Ñ¢</span> common to software development. It certainly beats the manual, and certainly beats nothing&#x2013;100%.
<ul class="org-ul">
<li>Richard Feldman has words to say on the matter (<a href="https://corecursive.com/teaching-fp-with-richard-feldman/">https://corecursive.com/teaching-fp-with-richard-feldman/</a>), where you can replace any mention of haskell with ocaml. To poorly distill his thoughts, FP pedagogy seems to focus first on underlying concepts then secondarily on application, versus focusing first on incremental, practical applications, then secondarily exploring required concepts during the ride. Having "learned" haskell and eventually ejecting from it, this interview resonated. OCaml is much more approachable than Haskell (better docs, tools, etc), but I'm still looking for "OCaml In Action". RWO didn't scratch my itch. It feels foolish to critique something that the community offered to me for free, so maybe I should just hush up :).</li>
</ul></li>
<li>ReasonML. ReasonML is what exposed me to OCaml, but once I started using OCaml, my interest in ReasonML dwindled rather quickly. That is a bummer because I love building UIs and I'm a react power user. I'm sure there's an interesting history in this space (I'm totally oblivious), but I just can't help but wonder what would have happened if all of that OCaml-ish UI work was reinvested in the OCaml community vs this UI-specific fork-ish project. I prefer the ML syntax, even though reason is supposedly catering to me, a TypeScript power user. When I finally ejected reason out of my OCaml project, I lost npm as a package source, and that caused some headache as I had to move fully into opam deps, vs getting deps from both places. It was pretty cool that I could co-locate <code>.ml</code> and <code>.re</code> files together, though! Maybe I'll take some time to look at the history here (links welcomed). Anyway, I ended up doing my UI via create-react-app + typescript, to avoid the growing pains of figuring out ReScript or jsoo, while simulatenously learning OCaml :).</li>
<li><code>json</code> operations. It took me much too long to just <span class="underline">figure out</span> how to do the basics w/ JSON. I eventually landed on <code>yojson</code> &amp; <code>ppx_deriving_yojson.runtime</code>, but was distracted by <code>atdgen</code>. I understand there are cost-benefit analyses required when choosing tools, but I was hoping to have landed on a solution within minutes of research. I won't tell you how long it actually took me just to get my JSON serialization and deserialization code in place. Hint: too darn long!</li>
<li>regex. <a href="https://pl-rants.net/posts/regexes-and-combinators-2/">https://pl-rants.net/posts/regexes-and-combinators-2/</a> was quite helpful</li>
<li><code>dune</code> &amp; <code>opam</code>. both are seemingly polished tools. I wish they were married, into a single OCaml project management tool. I get that they have different roles, but #opinons.
<ul class="org-ul">
<li>Additionally, a <code>.nvmrc</code> pattern would be nice. For instance, I alias <code>cd</code> on my system to execute <code>nvm/fnm use</code> on every cd <span class="underline">iff</span> a .nvmrc is found, s.t. when getting to work for the day, I'm always have the right switch loaded.</li>
</ul></li>
</ul>
</div>
</li>

<li><a id="orgd44a892"></a>What wasn't great<br />
<div class="outline-text-5" id="text-orgd44a892">
<ul class="org-ul">
<li>resolving compiler errors. no surprise.
<ul class="org-ul">
<li>commonly, in order to try and help narrow the problem space, i'd try and add explicit types, but even figuring out what types (let alone how to access to them) was often a bit tedious</li>
<li>FWIW, the reasonml error message formatter was <span class="underline">awesome</span> in improving OCaml compiler error messages. we should seriously consider baking that thing straight in.</li>
</ul></li>
<li>no integrated debugger. ü§∑üèª‚Äç‚ôÄÔ∏è. MS is doing really great work with <a href="https://microsoft.github.io/debug-adapter-protocol/">https://microsoft.github.io/debug-adapter-protocol/</a>. maybe some motivated soul will  be my hero someday.</li>
<li>lwt promises vs core deferreds. whatever the async primitives will be in the future, we should probably dedupe this as a community. further, we should probably also bake them right into the stdlib if we are going to continue to have colored functions. i spent time studying deferreds only to later discover that most of the things I wanted to do and use were lwt-centric. RWO puts you down the deferreds path, but <span class="underline">actual, for real ocaml</span> seems more aligned on Lwt. Disagree? Then now we know we have a problem :laughing:.  I ended up refactoring a moderate amount of early code for this reason. It was a tad bit obnoxious, especially that it felt out-of-band with the learning trajectory set forth in RWO. Perhaps that's on me :).</li>
<li>Producing statically linked binaries proved unproductive. I can't recall all of the errors I ran into, I was just hoping to flip a switch and get statically linked everything. Nope! Terrible assumption. Surely portable software can exist again one day. :crossed_fingers:</li>
<li><code>esy</code>. It sounded like <code>esy</code> it's was going to be great for bootstrapping a project, but ultimately understanding <code>dune</code> and <code>opam</code> was more productive, even as someone deeply familiar with <code>package.json</code>-isms. I used it for a while, and am glad to have removed it.</li>
<li>string interpolation. i want automatic toplevel sprintf-like functionality in string literals. <code>let str = "wah wah boo hoo I want ${featureName} yesterday!" ...</code>  would be pretttty cool :ok_hand:</li>
</ul>
</div>
</li>

<li><a id="orgad56846"></a>What's next?<br />
<div class="outline-text-5" id="text-orgad56846">
<ul class="org-ul">
<li>I'd eventually like to try <code>jsoo</code>. I saw that some react-bindings are in work. <span class="underline">Sweet</span>. Even if there was an Elm-like UI lib, I'd be keen on that as well.</li>
<li>Performance.
<ul class="org-ul">
<li>I'm pretty sure my postgresql cursor usage is blocking my single thread on the server. Async-ifying my postgres cursor for piping datas into my <code>Lwt_stream</code> seems worthwhile, if possible.</li>
<li>Request less data in the UI. Specifically, request only data that is expected to be painted. Currently I request a boat-load of data that the user may not be interested in.</li>
</ul></li>
<li>Tests. :grimacing: Don't look!</li>
<li>De-cruft-ify some malarkey. There's some values hardcoded in there that really don't belong. There's perhaps some not-very OCamly patterns that need tidying up that suffer from beginner-isms.</li>
</ul>

<p>
Anyway. <span class="underline">OCaml</span>. Great language. Will I keep using it? <span class="underline">Definitely!</span> I'm glad to be here. Thx all!
</p>
</div>
</li>
</ul>
</div>
</div>


<div id="outline-container-org3626304" class="outline-3">
<h3 id="org3626304">Yawar Amin then said</h3>
<div class="outline-text-3" id="text-org3626304">
<p>
Hi, thanks for this write-up, very interesting and super valuable to hear what new users are going
through. FWIW, I think you made the right call going with TypeScript; when learning something new, it's
better to focus on one thing at a time. Btw, opam does support the <code>.nvmrc</code> style, see
<a href="http://opam.ocaml.org/blog/opam-local-switches/">http://opam.ocaml.org/blog/opam-local-switches/</a>
</p>
</div>
</div>


<div id="outline-container-org7385d45" class="outline-3">
<h3 id="org7385d45">Emile Trotignon also replied</h3>
<div class="outline-text-3" id="text-org7385d45">
<p>
Nice thoughts. I think I will do a library for string interpolation - it should just be a simple ppx.
You can already check out this project : <a href="https://github.com/EmileTrotignon/embedded_ocaml_templates">https://github.com/EmileTrotignon/embedded_ocaml_templates</a>,
that attempts to be EJS for OCaml (not every feature is here though), and provide the following syntax:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">name</span> = <span style="color: #8b2252;">"John"</span>
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">john</span> = <span style="color: #483d8b; background-color: #ebebeb;">[%eml</span> <span style="color: #8b2252;">"Name : &lt;%-name%&gt;"</span><span style="color: #483d8b; background-color: #ebebeb;">]</span>
</pre>
</div>

<p>
However I the <code>${...}</code> syntax in a package that would not allow control structures, just interpolation,
would definitely be useful. Maybe it even already exists, I will check before I try and implement it ^^
</p>

<p>
Edit : it does exists : <a href="https://github.com/bloomberg/ppx_string_interpolation">https://github.com/bloomberg/ppx_string_interpolation</a>
</p>
</div>
</div>


<div id="outline-container-org4671822" class="outline-3">
<h3 id="org4671822">Patrick Ferris also replied</h3>
<div class="outline-text-3" id="text-org4671822">
<p>
Thanks for the incredibly well written and useful write up, especially describing the things you like,
think are okay and weren't so great.
</p>

<p>
I can't speak about how to resolve all of your pain-points (e.g. no integrated debugger) but what I can
say is that:
</p>

<blockquote>
<p>
guided tutorial on how to start doing productive <b>things‚Ñ¢</b>
</p>
</blockquote>

<p>
is actively being worked on, which includes more information (amongst other things) about
</p>

<blockquote>
<p>
dune &amp; opam
</p>
</blockquote>

<p>
The (very WIP) set of "workflows" for getting productive things done in OCaml can be found
<a href="https://github.com/ocaml-explore/explore">here</a> and are live
<a href="https://ocaml-explore.netlify.app/">here</a> (easier to digest full list
<a href="https://github.com/ocaml-explore/explore/tree/trunk/content/workflows">here</a>). The goal is to fill
these out more but also maintain the continuous integration which helps ensure they are <b>working</b>
examples of how to be productive with the OCaml Platform (and friends). As I said, it's early days but
I think it is already in a position that at least one user might find something useful in there.
</p>

<p>
Good luck with the rest of your very cool project!
</p>
</div>
</div>


<div id="outline-container-org3268d76" class="outline-3">
<h3 id="org3268d76">Aaron L. Zeng said</h3>
<div class="outline-text-3" id="text-org3268d76">
<p>
In case you needed more options, <a href="https://github.com/janestreet/ppx_string">https://github.com/janestreet/ppx_string</a> is another string
interpolation ppx.  It's part of ppx_jane, so if you're already using that, <code>[%string]</code> is available
without any further work.
</p>
</div>
</div>
</div>




<div id="outline-container-org847c82a" class="outline-2">
<h2 id="11">Help needed testing decimal package</h2>
<div class="outline-text-2" id="text-11">
<p>
Archive: <a href="https://discuss.ocaml.org/t/help-needed-testing-decimal-package/6772/1">https://discuss.ocaml.org/t/help-needed-testing-decimal-package/6772/1</a>
</p>
</div>

<div id="outline-container-orgcfd681c" class="outline-3">
<h3 id="orgcfd681c">Yawar Amin announced</h3>
<div class="outline-text-3" id="text-orgcfd681c">
<p>
Hi, I've been working on a <code>decimal</code> package: <a href="https://github.com/yawaramin/ocaml-decimal">https://github.com/yawaramin/ocaml-decimal</a>
(arbitrary-precision floating-point decimals).
</p>

<p>
I've published a <span class="underline">very early preview</span> on opam: <a href="http://opam.ocaml.org/packages/decimal/">http://opam.ocaml.org/packages/decimal/</a>
</p>

<p>
You can try it out:
</p>

<pre class="example">
$ opam install decimal
$ utop
#
  module D = Decimal
  let i = D.of_int
  let s = D.of_string;;
#
  #install_printer D.pp;;
#
  D.(s "0.1" + s "0.2");;
- : D.t = 0.3
# (* default precision is 32 *)
  D.(i 1 / i 3);;
- : D.t = 0.33333333333333333333333333333333
</pre>

<p>
The module is basically a port of the <a href="https://docs.python.org/3/library/decimal.html">Python decimal</a>
module, with some simplifications like, I'm ignoring different types of NaN like negative NaN, quiet
NaN, signalling NaN, and just treating them all as NaN. Otherwise I aim to have the same functionality.
</p>

<p>
What I need help with mainly is porting the Python <code>decimal</code> unit tests:
<a href="https://github.com/python/cpython/tree/23831a7a90956e38b7d70304bb6afe30d37936de/Lib/test/decimaltestdata">https://github.com/python/cpython/tree/23831a7a90956e38b7d70304bb6afe30d37936de/Lib/test/decimaltestdata</a>
. They are written in a plain-text DSL consisting of test cases like:
</p>

<pre class="example">
addx6324 add  0.12  0.01    -&gt;  0.13
</pre>

<p>
And I assume they have an interpreter somewhere that parses and runs these tests as standard Python
unit tests.
</p>

<p>
What I would like to do is to port these tests into plain OCaml. The above test case could look like
(e.g. Alcotest):
</p>

<pre class="example">
check string "addx6324" "0.13" D.(to_string (s "0.12" + s "0.01"))
</pre>

<p>
The test DSL has a few more features, like comments and setting and checking flags, but not too much
more complex. So I would really appreciate some help with porting them. I was thinking good old regular
expressions to do the conversions, but I'm open to suggestions.
</p>
</div>
</div>
</div>




<div id="outline-container-org61f2506" class="outline-2">
<h2 id="12">OCaml 4.12.0, first alpha release</h2>
<div class="outline-text-2" id="text-12">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ocaml-4-12-0-first-alpha-release/6777/1">https://discuss.ocaml.org/t/ocaml-4-12-0-first-alpha-release/6777/1</a>
</p>
</div>

<div id="outline-container-orgdd13081" class="outline-3">
<h3 id="orgdd13081">octachron announced</h3>
<div class="outline-text-3" id="text-orgdd13081">
<p>
The set of new features for the future version 4.12.0 of OCaml has been frozen,
maybe a little earlier than expected.
</p>

<p>
In this new version of OCaml, the gap between the mainline and multicore runtime
has been considerably narrowed.
Moreover, this new version comes with a port to the newly launched macOs/ARM architecture.
We are thus planning to have a shorter release cycle this time around to get
this new version out the door as soon as sensible ‚Äî which probably translates
to the beginning of January.
</p>

<p>
I am thus happy to announce the first alpha release for OCaml 4.12.0 .
</p>

<p>
This alpha version is here to help fellow hackers join us early in our bug
hunting and opam ecosystem fixing fun. You can see the progress on this front at:
</p>

<p>
<a href="https://github.com/ocaml/opam-repository/issues/17530">https://github.com/ocaml/opam-repository/issues/17530</a>
</p>

<p>
Once the major tools are supported, we will switch to beta releases.
</p>

<p>
And since changes are more fun when they come in pair, we are also testing
a new layout for the opam compiler packages.
</p>

<p>
The base compiler can now be installed as an opam switch with the following commands
</p>
<div class="org-src-container">
<pre class="src src-shell">opam update
opam switch create 4.12.0~alpha1
--repositories=default,<span style="color: #a0522d;">beta</span>=git+https://github.com/ocaml/ocaml-beta-repository.git
</pre>
</div>
<p>
If you want to tweak the configuration of the compiler, the new layout offers
much finer-grained options. The new command looks like this:
</p>
<div class="org-src-container">
<pre class="src src-shell">opam update
opam switch create &lt;switch_name&gt; --packages=ocaml-variants.4.12.0~alpha1+options,&lt;option_list&gt;
--repositories=default,<span style="color: #a0522d;">beta</span>=git+https://github.com/ocaml/ocaml-beta-repository.git
</pre>
</div>
<p>
where &lt;option_list&gt; is a comma separated list of ocaml-option-* packages. For instance, for a flambda
and no-flat-float-array switch:
</p>
<div class="org-src-container">
<pre class="src src-shell">opam switch create 4.12.0~alpha1+flambda+nffa
--packages=ocaml-variants.4.12.0~alpha1+options,ocaml-option-flambda,ocaml-option-no-flat-float-array
--repositories=default,<span style="color: #a0522d;">beta</span>=git+https://github.com/ocaml/ocaml-beta-repository.git
</pre>
</div>
<p>
All available options can be listed with <code>opam search ocaml-option</code>.
</p>

<p>
If you want to test this version, it is advised to install the alpha opam repository
</p>

<p>
<a href="https://github.com/kit-ty-kate/opam-alpha-repository">https://github.com/kit-ty-kate/opam-alpha-repository</a>
</p>

<p>
with
</p>
<div class="org-src-container">
<pre class="src src-shell">opam repo add alpha git://github.com/kit-ty-kate/opam-alpha-repository.git
</pre>
</div>
<p>
This alpha repository contains various fixes in the process of being upstreamed.
</p>

<p>
The source code for the alpha is also available at these addresses:
</p>

<ul class="org-ul">
<li><a href="https://github.com/ocaml/ocaml/archive/4.12.0-alpha1.tar.gz">https://github.com/ocaml/ocaml/archive/4.12.0-alpha1.tar.gz</a></li>
<li><a href="https://caml.inria.fr/pub/distrib/ocaml-4.12/ocaml-4.12.0~alpha1.tar.gz">https://caml.inria.fr/pub/distrib/ocaml-4.12/ocaml-4.12.0~alpha1.tar.gz</a></li>
</ul>

<p>
If you find any bugs, please report them here:
</p>

<ul class="org-ul">
<li><a href="https://github.com/ocaml/ocaml/issues">https://github.com/ocaml/ocaml/issues</a></li>
</ul>

<p>
If you are interested by the ongoing list of new features and fixed bugs, the
updated change log for OCaml 4.12.0 is available at:
</p>

<ul class="org-ul">
<li><a href="https://github.com/ocaml/ocaml/blob/4.12/Changes">https://github.com/ocaml/ocaml/blob/4.12/Changes</a></li>
</ul>
</div>
</div>
</div>




<div id="outline-container-org6b2591d" class="outline-2">
<h2 id="13">Experimental new layout for the ocaml-variants packages in opam-repository</h2>
<div class="outline-text-2" id="text-13">
<p>
Archive: <a href="https://discuss.ocaml.org/t/experimental-new-layout-for-the-ocaml-variants-packages-in-opam-repository/6779/1">https://discuss.ocaml.org/t/experimental-new-layout-for-the-ocaml-variants-packages-in-opam-repository/6779/1</a>
</p>
</div>

<div id="outline-container-org36696ef" class="outline-3">
<h3 id="org36696ef">David Allsopp announced</h3>
<div class="outline-text-3" id="text-org36696ef">
<p>
The 4.12.0 alpha1 release is out and with it is an experiment for a new layout for the ocaml-variants
packages to try to reduce the number of packages needed for each compiler release and also to allow
packages to depend on particular OCaml configurations.
</p>
</div>

<div id="outline-container-org8b9fd00" class="outline-4">
<h4 id="org8b9fd00">Combinatorial explosions in <code>ocaml-variants</code></h4>
<div class="outline-text-4" id="text-org8b9fd00">
<p>
This may seem like pre-history, but back in OPAM 1.x there was a distinction between the compiler and
the packages installed in a switch. Every switch essentially had just one special package at its root
and OPAM 1.x had the version of OCaml hard-wired into the <code>ocaml-version</code> variable. This set-up meant
that non-vanilla installations of the compiler (for example, with flambda) had to be encoded on the
version number giving us the slightly strange <code>4.07.0+flambda</code> version meaning ‚ÄúOCaml 4.07.0 with
flambda enabled‚Äù.
</p>

<p>
Fast forward to opam 2.0, and this gets generalised with the ‚Äúcompilers-as-packages‚Äù feature. The old
compiler special package got split into <code>ocaml-system</code> (taking on the even more magical and hard-wired
internal <code>system</code> switch from OPAM 1.x), <code>ocaml-base-compiler</code> (for the unaltered or ‚Äúvanilla‚Äù
compiler) and then <code>ocaml-variants</code> which contained, um, everything else!
</p>

<p>
However, ‚Äúcompilers-as-packages‚Äù allows opam 2.x switches not to have the compiler as strictly the root
package. The current scheme has a couple of benefits:
</p>

<ul class="org-ul">
<li>It‚Äôs immediately clear from the version of the <code>ocaml-variants</code> package what you have (for example, <code>ocaml-variants.4.08.1+fp+flambda</code>)</li>
<li>It‚Äôs immediately clear which variants are supported by a given version of OCaml (for example, there is no <code>ocaml-variants.4.02.3+flambda</code> package)</li>
</ul>

<p>
However, it some serious limitations:
</p>

<ul class="org-ul">
<li>The variants should be combinable, but doing this would lead to thousands of variants. If you need a missing one, the only solution is to have a custom repository</li>
<li>Every single release of the compiler needs to have corresponding variant packages</li>
<li>The very large number of compiler packages considerably increases the pressure on opam‚Äôs solvers</li>
<li>It‚Äôs not possible to depend on OCaml options (for example, to depend on, or conflict with, no-naked-pointers mode).</li>
</ul>

<p>
@kit-ty-kate, @AltGr, and I have at various points done experiments to improve this. Thanks to
@octachron, we‚Äôre trying one of them out in the safety of the 4.12 alpha/beta/rc packages and, in
addition of course to testing your code with OCaml 4.12, we could really do with feedback on this new
layout.
</p>
</div>
</div>

<div id="outline-container-org9fe7822" class="outline-4">
<h4 id="org9fe7822">How it works</h4>
<div class="outline-text-4" id="text-org9fe7822">
<p>
The <code>ocaml-variants.4.12.0+trunk</code> package and the new <code>ocaml-variants.4.12.0~alpha1+options</code> packages
both allow compiler options to be customised by also installing <code>ocaml-option-</code> packages:
</p>
<ul class="org-ul">
<li><code>ocaml-option-32bit</code> - 32bit build</li>
<li><code>ocaml-option-afl</code> - enable AFL support</li>
<li><code>ocaml-option-bytecode-only</code> - build bytecode compiler only</li>
<li><code>ocaml-option-default-unsafe-string</code> - enable unsafe-string by default</li>
<li><code>ocaml-option-flambda</code> - enable flambda</li>
<li><code>ocaml-option-fp</code> - enable frame pointers</li>
<li><code>ocaml-option-musl</code> - use musl instead of libc</li>
<li><code>ocaml-option-nnp</code> - enable no-naked-pointers mode</li>
<li><code>ocaml-option-no-flat-float-array</code> - disable flat float arrays in the runtime</li>
<li><code>ocaml-option-spacetime</code> (for 4.12 this option is not available, since spacetime has been removed)</li>
<li><code>ocaml-option-static</code> - no dynamic linking</li>
</ul>

<p>
This allows options to be combined: for example installing <code>ocaml-option-32bit</code> and
<code>ocaml-option-flambda</code> enables a 32-bit flambda compiler. It‚Äôs a bit of a mouthful (more on that
below):
</p>

<pre class="example">
opam switch create 4.12-32-bit-flambda
--packages=ocaml-variants.4.12.0~alpha1+options,ocaml-option-32bit,ocaml-option-flambda
--repos=default,beta
</pre>

<p>
(obviously if the new layout is adopted at release, then the <code>--repos</code> part won‚Äôt be necessary)
</p>

<p>
In addition to these packages, there are also a small number of <code>ocaml-options-only-</code> packages (for
example, <code>ocaml-options-only-flambda</code>). These packages conflict with other options packages, so for
example with this:
</p>

<pre class="example">
opam switch create 4.12-release-builds
--packages=ocaml-variants.4.12.0~alpha1+options,ocaml-options-only-flambda-fp --repos=default,beta
</pre>

<p>
you get a switch with 4.12.0 alpha1 configured for flambda and frame-pointers <span class="underline">and which cannot be
changed</span>. So if you attempt to install a package which depends on <code>ocaml-option-nnp</code>, for example, then
opam will complain of a conflict rather than suggesting that you recompile your switch with
<code>ocaml-config-nnp</code>.
</p>

<p>
The special package <code>ocaml-options-vanilla</code> can be used to make <code>ocaml-variants.4.12.0~alpha1+options</code>
or <code>ocaml-variants.4.12.0+trunk</code> behave like <code>ocaml-base-compiler</code>.
</p>
</div>
</div>

<div id="outline-container-org8dbf9f4" class="outline-4">
<h4 id="org8dbf9f4">Currently</h4>
<div class="outline-text-4" id="text-org8dbf9f4">
<ul class="org-ul">
<li>:white_check_mark: variants can be combined, and they don‚Äôt need to be specified with every compiler release</li>
<li>:grey_question: the CLI invocation is slightly more characters to type, though still about as clunky as the existing package names (opam 2.1 slightly improves this)</li>
<li>:grey_question: there‚Äôs still a combinatorial explosion with the <code>ocaml-options-only-*</code> packages, but we‚Äôre hoping that that‚Äôs less of a problem since these <code>only</code> packages are mainly useful for CI/CD systems</li>
<li>:x: <code>+trunk</code> packages still exist</li>
<li>:x: <code>ocaml-base-compiler.v</code> and <code>ocaml-variants.v+options</code> are an unnecessary and slightly confusing distinction</li>
</ul>
</div>
</div>

<div id="outline-container-org42b8041" class="outline-4">
<h4 id="org42b8041">Future work</h4>
<div class="outline-text-4" id="text-org42b8041">
<ul class="org-ul">
<li>There‚Äôs no reason to be maintaining <code>ocaml-variants</code> and <code>ocaml-base-compiler</code> separately and we could look to merging these into, say, <code>ocaml-compiler</code></li>
<li>The <code>+trunk</code> variants have always been slightly odd - both because the maintenance branches for each release (e.g. <a href="https://github.com/ocaml/ocaml/tree/4.11"><code>4.11</code></a>, <a href="https://github.com/ocaml/ocaml/tree/4.12"><code>4.12</code></a>) are not called <code>trunk</code> and because the version number refers to an as-yet unreleased version of OCaml (e.g. <code>4.11.2+trunk</code>). We‚Äôre looking to switch to using <code>dev-repo</code> field and pinning, as other packages do, but also trying to keep a lid on the number of simultaneous changes!</li>
<li>opam 2.2 has plans in the pipeline to address ‚Äúpackage parameters‚Äù properly, which should hopefully improve both the CLI and the number of ‚Äúconfiguration-related‚Äù packages</li>
<li>The layout <span class="underline">could</span> be back-ported to previous versions of the compiler. There are two questions with this: deleting the old variants packages will cause any existing switches to fail to upgrade, so we may wish to keep virtual packages for the old releases (e.g. have <code>ocaml-variants.4.11.1+flambda</code> depend on <code>ocaml-compiler.4.11.1</code> and <code>ocaml-options-only-flambda</code>) and there‚Äôs also the fact that changing the opam files for these packages will cause <span class="underline">all</span> switches to rebuild at next <code>opam upgrade</code>!</li>
</ul>

<p>
Thanks for making it to the end, and all comments and feedback either to me directly, here on Discuss,
or on the <a href="https://github.com/ocaml/opam-repository/issues">opam-repository issue tracker</a> are very
welcome!
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-orgb142b42" class="outline-2">
<h2 id="14">Messages, a library for type safe encoding and decoding</h2>
<div class="outline-text-2" id="text-14">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-messages-a-library-for-type-safe-encoding-and-decoding/6780/1">https://discuss.ocaml.org/t/ann-messages-a-library-for-type-safe-encoding-and-decoding/6780/1</a>
</p>
</div>

<div id="outline-container-orgb194ff0" class="outline-3">
<h3 id="orgb194ff0">Chimrod announced</h3>
<div class="outline-text-3" id="text-orgb194ff0">
<p>
I have published today a library I ve done for my personnal usage : <code>messages</code>, which allow to encode
and decode json data between ocaml applications. The library as been thought in order to exchange data
between javascript and server side with a minimum of code.
</p>

<p>
The idea is to declare the type of the json content in a shared code, and then let the application
generate the appropriate encoding and decoding functions automaticaly. I wanted something simple and
easy to maintain (or extend), and opt for a classic libray instead of ppx rewrite. I found nothing with
this design and built my own library :)
</p>

<p>
The code is hosted on github : <a href="https://github.com/Chimrod/messages">https://github.com/Chimrod/messages</a>
</p>

<p>
This is the first time I'm annoncing a library publically I hope you you will find it usefull for you !
</p>
</div>
</div>
</div>




<div id="outline-container-orgbdc6060" class="outline-2">
<h2 id="orgbdc6060">Old CWN</h2>
<div class="outline-text-2" id="text-orgbdc6060">
<p>
If you happen to miss a CWN, you can <a href="mailto:alan.schmitt@polytechnique.org">send me a message</a> and I'll mail it to you, or go take a look at <a href="http://alan.petitepomme.net/cwn/">the archive</a> or the <a href="http://alan.petitepomme.net/cwn/cwn.rss">RSS feed of the archives</a>.
</p>

<p>
If you also wish to receive it every week by mail, you may subscribe <a href="http://lists.idyll.org/listinfo/caml-news-weekly/">online</a>.
</p>

<div class="authorname">
<p>
<a href="http://alan.petitepomme.net/">Alan Schmitt</a>
</p>

</div>
</div>
</div>
</div>
</body>
</html>
