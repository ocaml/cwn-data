<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-08-30 Tue 11:46 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OCaml Weekly News</title>
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<style type="text/css">#table-of-contents h2 { display: none } .title { display: none } .authorname { text-align: right }</style>
<style type="text/css">.outline-2 {border-top: 1px solid black;}</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">OCaml Weekly News</h1>
<p>
<a href="https://alan.petitepomme.net/cwn/2022.08.23.html">Previous Week</a> <a href="https://alan.petitepomme.net/cwn/index.html">Up</a> <a href="https://alan.petitepomme.net/cwn/2022.09.06.html">Next Week</a>
</p>

<p>
Hello
</p>

<p>
Here is the latest OCaml Weekly News, for the week of August 23 to 30, 2022.
</p>

<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#1">What&rsquo;s your development workflow?</a></li>
<li><a href="#2">Mirage retreat October 3rd - 9th</a></li>
<li><a href="#3">Experience report: making a JavaScript library from an OCaml library with js_of_ocaml</a></li>
<li><a href="#4">Will I ever understand Format? or How to print a list vertically with indentation</a></li>
<li><a href="#5">GNU Guile 1.0.0 - Bindings to GNU Guile for OCaml</a></li>
<li><a href="#6">Update on Eio (effects-based direct-style IO for OCaml 5)</a></li>
<li><a href="#7">OCaml at First Glance</a></li>
<li><a href="#8">GADTs for typed option getter/setter</a></li>
<li><a href="#9">shuttle v0.3.1 released</a></li>
<li><a href="#10">coinductive data types</a></li>
<li><a href="#orgfbcc7ef">Old CWN</a></li>
</ul>
</div>
</div>


<div id="outline-container-1" class="outline-2">
<h2 id="1">What&rsquo;s your development workflow?</h2>
<div class="outline-text-2" id="text-1">
<p>
Archive: <a href="https://discuss.ocaml.org/t/whats-your-development-workflow/10358/1">https://discuss.ocaml.org/t/whats-your-development-workflow/10358/1</a>
</p>
</div>

<div id="outline-container-orga6b9e9d" class="outline-3">
<h3 id="orga6b9e9d">Bozhidar Batsov asked</h3>
<div class="outline-text-3" id="text-orga6b9e9d">
<p>
I&rsquo;ve started learning OCaml recently and one issue that I struggle with is finding a workflow that gives me quick
feedback about changes I&rsquo;ve made (I&rsquo;m looking to reduce compile/run cycles). To give you some context - most of the
time I&rsquo;m programming in Lisps and Ruby, where it&rsquo;s relatively easy to modify a running application. With all Lists
my workflow is:
</p>

<ul class="org-ul">
<li>I make some change (e.g. I update some function)</li>
<li>I compile the changed bit of code (e.g. a function)</li>
<li>I immediately run this with the help of the REPL</li>
<li>Based on the results I got I go to the beginning or move on to the next things that needs doing</li>
</ul>

<p>
That&rsquo;s known as <a href="https://docs.cider.mx/cider/usage/interactive_programming.html">interactive programming</a> in some
circles and I totally love it. With Ruby I can&rsquo;t do the same, but at least with web apps there&rsquo;s some degree of code
reloading that allows you modify a running app.
</p>

<p>
With OCaml, however, I&rsquo;m not sure how to get the quick feedback, as it seems I need to constantly compile and run
stuff. I&rsquo;m trying to work like with Lisps - I keep a toplevel open alongside my source code and occasionally send
some  code there, but the toplevel is limited in many way (you&rsquo;re just dumping text there at the global level).
`dune utop` helps to some extent, but it can&rsquo;t reload changes. I&rsquo;ve heard that some people were saying they didn&rsquo;t
even use a toplevel, so I&rsquo;m wondering if I&rsquo;m missing something. I&rsquo;d be curious to hear any tips and tricks from your
OCaml workflows.
</p>
</div>
</div>


<div id="outline-container-org5b95db3" class="outline-3">
<h3 id="org5b95db3">Jack Feser suggested</h3>
<div class="outline-text-3" id="text-org5b95db3">
<p>
Have a look at expectation testing with <a href="https://github.com/janestreet/ppx_expect">ppx_expect</a>. That&rsquo;s what I use to
get this kind of quick feedback (and you can keep the results as a test).
</p>

<p>
Instead of sending code to a REPL, you write your test in an expect block and run <code>dune runtest</code>. Anything you print
out in the expect gets captured, and dune shows you the output as a diff.
</p>

<p>
That said, I&rsquo;ve never had good luck with REPLs, so I might be missing something about that workflow.
</p>
</div>
</div>


<div id="outline-container-org04d9fb8" class="outline-3">
<h3 id="org04d9fb8">Later in the thread, Simon Cruanes said</h3>
<div class="outline-text-3" id="text-org04d9fb8">
<p>
Any test can be exploratory if they&rsquo;re expect tests, imho :slightly_smiling_face: . The core requirement is to have
printers for your types (e.g. <code>ppx_deriving.show</code>), so you can just create values and use
</p>
<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #008858;">Format.</span>printf <span style="color: #4250ef;">"my thing is now %a@."</span> pp_thing my_thing<span style="color: #ff4500;">;;</span>
</pre>
</div>

<p>
and see the output in dune. There&rsquo;s a few annoyances (e.g. when it crashes you need a bit of elbow grease to get the
backtrace) but for the most part it&rsquo;s a nice workflow. I don&rsquo;t apply it to everything, though.
</p>
</div>
</div>


<div id="outline-container-org36914b6" class="outline-3">
<h3 id="org36914b6">Kiran Gopinathan said</h3>
<div class="outline-text-3" id="text-org36914b6">
<p>
W.r.t to development cycle in OCaml, I find myself working in 3 distinct ways depending on at which point of a
project I am at:
</p>

<ul class="org-ul">
<li><b>small experiments</b> - sometimes I need a particular function that isn&rsquo;t provided by the stdlib, or some other bespoke well-defined function. In these cases, I write the function directly in the source code - using merlin&rsquo;s typing information etc. to develop as usual. Once I&rsquo;ve done that, just to check the behaviour is as I would expect, I copy over the definition to utop - if the function depends on any larger state from my project, I write a dummy module to mock these parts.</li>
<li><b>exploring a stateful system</b> - sometimes, I&rsquo;m interacting with some kind of stateful existing system that can be hard to run in utop (for example, it might be a pain to get the library working in bytecode) - e.g. gtk. In these cases, I setup a small executable module that performs the minimum required to setup the initial state, and do my iterative experiments by recompiling after each change. Because the module is small, and the OCaml compiler/dune is fast, this leads to a quick iterative editing experience.</li>
<li><b>working on a well-known codebase</b> - in all other cases, I&rsquo;m working on a codebase that I either know fairly well, or has sufficient documentation and typing-discipline to make it easy to understand what&rsquo;s going on. In these cases, I can rely on the types and documentation to make changes/add new functions, and if needed, use tests to document expected behaviours.</li>
</ul>

<p>
As I&rsquo;m speaking to an Emacs celebrity @bbatsov (thank you for your great packages!), I&rsquo;d be remiss if I didn&rsquo;t
mention my own little experiment in this direction - <code>interactive-utop-mode</code>:
</p>


<div id="org33f6ed5" class="figure">
<p><img src="https://global.discourse-cdn.com/standard11/uploads/ocaml/original/2X/5/53856f555462c98314f99209cb3a145a02181428.webp" alt="53856f555462c98314f99209cb3a145a02181428.webp" />
</p>
</div>

<p>
<a href="https://gitlab.com/-/snippets/2170216">https://gitlab.com/-/snippets/2170216</a>
</p>

<p>
It&rsquo;s not quite the same level of interactivity as lisp, granted, but with judicious use of forking, you can emulate
a slightly more interactive repl experience.
</p>

<p>
Disclaimer: I don&rsquo;t actually use this that much myself, it&rsquo;s just more of a proof of concept to show how it works.
</p>
</div>
</div>


<div id="outline-container-org25dbdff" class="outline-3">
<h3 id="org25dbdff">Yaron Minsky said</h3>
<div class="outline-text-3" id="text-org25dbdff">
<p>
Big +1 to expect tests for interactive programming. I wrote a bit about this in an old blog post:
</p>

<p>
<a href="https://blog.janestreet.com/repeatable-exploratory-programming/">https://blog.janestreet.com/repeatable-exploratory-programming/</a>
</p>

<p>
As to how to make things yet better:
</p>

<blockquote>
<p>
On the ppx_expect, this could mean dropping dependencies.
</p>
</blockquote>

<p>
At present, I think ppx_expect itself depends only on a couple other ppx&rsquo;s, and Base and Stdio, so I think it&rsquo;s
already reasonably light, and the libraries in question are all portable.
</p>

<p>
From my perspective, a more important direction is to improve the editor integration. Our internal expect test
workflow is delightful, and quite a bit better than what&rsquo;s available publicly. When an error pops up from the build,
you hit a key to see the diff, hit another key to accept the diff if you want to. It would be great if we could get
something similar to that in vscode.
</p>

<p>
Indeed, I posted an issue about this here:
</p>

<p>
<a href="https://github.com/ocamllabs/vscode-ocaml-platform/issues/226">https://github.com/ocamllabs/vscode-ocaml-platform/issues/226</a>
</p>
</div>
</div>
</div>




<div id="outline-container-2" class="outline-2">
<h2 id="2">Mirage retreat October 3rd - 9th</h2>
<div class="outline-text-2" id="text-2">
<p>
Archive: <a href="https://discuss.ocaml.org/t/mirage-retreat-october-3rd-9th/10363/1">https://discuss.ocaml.org/t/mirage-retreat-october-3rd-9th/10363/1</a>
</p>
</div>

<div id="outline-container-org67eebdc" class="outline-3">
<h3 id="org67eebdc">Hannes Mehnert announced</h3>
<div class="outline-text-3" id="text-org67eebdc">
<p>
Dear (aspiring) <a href="https://mirage.io">MirageOS</a> hacker,
</p>

<p>
it is my please to announce that there will be the 11th MirageOS retreat in early October in Mirleft, southern
Morocco &#x2013; yes, this time at the seaside. Please find more details, including writeups of earlier retreats at
<a href="http://retreat.mirage.io">http://retreat.mirage.io</a>
</p>

<p>
Everyone is welcome, be kind to each other. There won&rsquo;t be much Internet connectivity &#x2013; but there&rsquo;s plenty of
beach, discussions, impromptu talks, and a local network mainly constructed by MirageOS unikernels.
</p>

<p>
If you have questions, don&rsquo;t hesitate to ask them here in this thread, or contact me directly via eMail &ldquo;my first
name&rdquo; at mehnert.org.
</p>
</div>
</div>
</div>




<div id="outline-container-3" class="outline-2">
<h2 id="3">Experience report: making a JavaScript library from an OCaml library with js_of_ocaml</h2>
<div class="outline-text-2" id="text-3">
<p>
Archive: <a href="https://discuss.ocaml.org/t/experience-report-making-a-javascript-library-from-an-ocaml-library-with-js-of-ocaml/10380/1">https://discuss.ocaml.org/t/experience-report-making-a-javascript-library-from-an-ocaml-library-with-js-of-ocaml/10380/1</a>
</p>
</div>

<div id="outline-container-orgfcc9a26" class="outline-3">
<h3 id="orgfcc9a26">John Whitington announced</h3>
<div class="outline-text-3" id="text-orgfcc9a26">
<p>
I have recently compiled our whole codebase with <code>js_of_ocaml</code>, producing a PDF processing library with can be used
from JavaScript programs on the server, or within the browser.
</p>

<p>
I started with no knowledge of JavaScript or its ecosystem, and the <code>js_of_ocaml</code> examples don&rsquo;t touch on this
particular use case, so I thought it would be useful to write up a quick experience report. I&rsquo;m still pretty naive
on the topic, so do take it with a pinch of salt. Corrections welcome.
</p>

<p>
Perhaps you could make your favourite OCaml library accessible from JavaScript?
</p>

<p>
Source code: <a href="https://github.com/coherentgraphics/coherentpdf.js">Coherentpdf.js</a>.
</p>
</div>

<div id="outline-container-orga4d3e09" class="outline-4">
<h4 id="orga4d3e09">Existing Code</h4>
<div class="outline-text-4" id="text-orga4d3e09">
<p>
For this project, I used the OCaml source code from the PDF library CamlPDF, the command line PDF tools CPDF, and
the C interface to CPDF, CPDFLIB. CPDFLIB is an API allowing access to the PDF library from C via the OCaml FFI
(and, therefore, from .NET, Java, Python etc).
</p>

<p>
<a href="https://github.com/johnwhitington/camlpdf">CamlPDF source</a> | <a href="https://github.com/johnwhitington/cpdf-source">CPDF source</a> | <a href="https://github.com/johnwhitington/cpdflib-source">Cpdflib source</a>
</p>

<p>
This code is almost all OCaml, with a small amount of C code for cryptography and compression.
</p>

<p>
We will be recompiling all this code with <code>js_of_ocaml</code>, to yield a JavaScript library which can access all the
functions in CPDFLIB. Since CPDFLIB is a flat API with no direct access to OCaml data structures, this should be
easy to access from JavaScript. Building a JavaScript library which had to directly manipulate OCaml data structures
would be more difficult.
</p>
</div>
</div>

<div id="outline-container-orgea9d1c1" class="outline-4">
<h4 id="orgea9d1c1">Compilation procedure</h4>
<div class="outline-text-4" id="text-orgea9d1c1">
<p>
Our build procedure will be simple. Copy all the OCaml and C source files from the CamlPDF, CPDF and CPDFLIB into
our build directory and then:
</p>

<ul class="org-ul">
<li>compile and link a bytecode executable with ocamlc using a makefile</li>
<li>call <code>js_of_ocaml</code> to turn the resulting bytecode file into JavaScript</li>
</ul>

<p>
(dune can also be used for both these steps)
</p>

<p>
Why the C files? Because we need them to link the bytecode executable: the C code will be thrown away by
<code>js_of_ocaml</code>, but we must get the bytecode linked.
</p>

<p>
<code>Js_of_ocaml</code> informs us that we have missing primitives: the C code we will need to replace with JavaScript later,
but the thing builds, and a couple of megabytes of JavaScript is produced. It doesn&rsquo;t do anything yet, because we
have no way of calling into it. But we can load it as a module in node even at this stage.
</p>

<p>
If we miss out the cpdflib source files, though, and just include camlpdf and cpdf, we get the cpdf command line
tools, which we can run in node as a command line tool, and they work just fine (if we don&rsquo;t use compressed or
encrypted files, of course):
</p>

<pre class="example" id="org36e3d3a">
$node cpdf.js -pages cpdfjsmanual.pdf
152
</pre>

<p>
Magic! About five or six times slower than the native code version, but it works with minimal effort. <code>Js_of_ocaml</code>
has supplied an alternative set of primitives for input and ouput, and an alternative runtime, and they replaces
OCaml&rsquo;s transparently.
</p>
</div>
</div>

<div id="outline-container-orge935f2e" class="outline-4">
<h4 id="orge935f2e">Replacing C with JavaScript</h4>
<div class="outline-text-4" id="text-orge935f2e">
<p>
Our C code will be thrown away by JavaScript, so we need to provide alternatives. <code>js_of_ocaml</code> allows us to write
them in JavaScript with some special comments. It will then plug each in for its corresponding OCaml external (C
symbol in the linked OCaml bytecode). Here&rsquo;s the replacement for one of CamlZip&rsquo;s functions, using node&rsquo;s own zlib
library:
</p>

<div class="org-src-container">
<pre class="src src-javascript"><span style="color: #a65f6a; font-style: italic;">//</span><span style="color: #a65f6a; font-style: italic;">Provides: camlpdf_caml_zlib_compress</span>
<span style="color: #a65f6a; font-style: italic;">//</span><span style="color: #a65f6a; font-style: italic;">Requires: caml_bytes_of_array</span>
<span style="color: #a65f6a; font-style: italic;">//</span><span style="color: #a65f6a; font-style: italic;">Requires: caml_array_of_bytes</span>
<span style="color: #6052cf; font-weight: bold;">function</span> <span style="color: #cf25aa;">camlpdf_caml_zlib_compress</span>(<span style="color: #1f77bb;">s</span>)
{
  <span style="color: #6052cf; font-weight: bold;">var</span> <span style="color: #1f77bb;">s2</span> = caml_array_of_bytes(s);
  <span style="color: #6052cf; font-weight: bold;">var</span> <span style="color: #1f77bb;">buf</span> = Buffer.from(s2);
  <span style="color: #6052cf; font-weight: bold;">var</span> <span style="color: #1f77bb;">output</span> = zlib.deflateSync(buf);
  <span style="color: #6052cf; font-weight: bold;">return</span> caml_bytes_of_array(output);
}
</pre>
</div>

<p>
In this case, it was not a direct replacement - the API is different. So we must modify our OCaml code to be
compilable in both OCaml and <code>js_of_ocaml</code>, like this:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #a65f6a; font-style: italic;">(* </span><span style="color: #a65f6a; font-style: italic;">js_of_ocaml only</span><span style="color: #a65f6a; font-style: italic;"> *)</span>
<span style="color: #000000; font-weight: bold;">external</span> <span style="color: #cf25aa;">camlpdf_caml_zlib_compress</span> : string -&gt; string = <span style="color: #4250ef;">"camlpdf_caml_zlib_compress"</span>
<span style="color: #000000; font-weight: bold;">external</span> <span style="color: #cf25aa;">camlpdf_caml_zlib_decompress</span> : string -&gt; string = <span style="color: #4250ef;">"camlpdf_caml_zlib_decompress"</span>

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #1f77bb;">is_js</span> =
  <span style="color: #008858;">Sys.</span>backend_type = <span style="color: #008858;">Sys.</span><span style="color: #202020; background-color: #ffffff;">Other</span> <span style="color: #4250ef;">"js_of_ocaml"</span>

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #cf25aa;">encode_flate</span> <span style="color: #1f77bb;">stream</span> =
  <span style="color: #6052cf; font-weight: bold;">if</span> is_js <span style="color: #6052cf; font-weight: bold;">then</span>
    <span style="color: #008858;">Pdfio.</span>bytes_of_string (camlpdf_caml_zlib_compress (<span style="color: #008858;">Pdfio.</span>string_of_bytes stream))
  <span style="color: #6052cf; font-weight: bold;">else</span>
    flate_process (<span style="color: #008858;">Pdfflate.</span>compress <span style="color: #065fff;">~level</span>:<span style="color: #a52a2a;">!</span>flate_level) stream
</pre>
</div>

<p>
We also need some fake stubs in our C code to make sure it still compiles in the non-JavaScript case with these new
externals:
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #a65f6a; font-style: italic;">// </span><span style="color: #a65f6a; font-style: italic;">So that the code links ok when using js_of_ocaml</span>
<span style="color: #008858;">char</span>* <span style="color: #cf25aa;">camlpdf_caml_zlib_decompress</span>(<span style="color: #008858;">char</span> *<span style="color: #1f77bb;">s</span>) { <span style="color: #6052cf; font-weight: bold;">return</span> s; }
<span style="color: #008858;">char</span>* <span style="color: #cf25aa;">camlpdf_caml_zlib_compress</span>(<span style="color: #008858;">char</span> *<span style="color: #1f77bb;">s</span>) { <span style="color: #6052cf; font-weight: bold;">return</span> s; }
</pre>
</div>

<p>
This code will never be called, of course: it is simply to make the symbol available.
</p>
</div>
</div>

<div id="outline-container-org4dff153" class="outline-4">
<h4 id="org4dff153">Writing the JavaScript interface</h4>
<div class="outline-text-4" id="text-org4dff153">
<p>
Now, we use the provided PPX <code>js_of_ocaml-ppx</code> to provide a JavaScript interface to each function, and export them
as functions in our JavaScript module:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #008858;">Js.</span>export_all
  (<span style="color: #000000; font-weight: bold;">object</span><span style="color: #e00033;">%js</span>
     <span style="color: #000000; font-weight: bold;">method</span> <span style="color: #cf25aa;">fromFile</span> <span style="color: #1f77bb;">filename</span> <span style="color: #1f77bb;">userpw</span> =
       checkerror (<span style="color: #008858;">Cpdflib.</span>fromFile (<span style="color: #008858;">Js.</span>to_string filename) (<span style="color: #008858;">Js.</span>to_string userpw))
     ...hundreds more functions...
  )
</pre>
</div>

<p>
Notice <code>Js.to_string</code> here. Conversions to and from JavaScript will be required for many data types, for example
strings, arrays, bigarrays and so on. In our case, <code>Cpdflib.fromFile</code> returns a simple integer, so no conversion is
required.
</p>
</div>
</div>

<div id="outline-container-org701bfd0" class="outline-4">
<h4 id="org701bfd0">Trying it out</h4>
<div class="outline-text-4" id="text-org701bfd0">
<p>
Now that we have the library working, we can try it out by running a JavaScript file with node, or by typing into
the node REPL:
</p>

<div class="org-src-container">
<pre class="src src-javascript"><span style="color: #a65f6a; font-style: italic;">//</span><span style="color: #a65f6a; font-style: italic;">Load coherentpdf.js</span>
<span style="color: #6052cf; font-weight: bold;">const</span> <span style="color: #1f77bb;">coherentpdf</span> = require(<span style="color: #4250ef;">'./coherentpdf.js'</span>);

<span style="color: #6052cf; font-weight: bold;">var</span> <span style="color: #1f77bb;">pdf</span> = coherentpdf.fromFile(<span style="color: #4250ef;">'hello.pdf'</span>, <span style="color: #4250ef;">''</span>);
<span style="color: #6052cf; font-weight: bold;">var</span> <span style="color: #1f77bb;">merged</span> = coherentpdf.mergeSimple([pdf, pdf, pdf]);
coherentpdf.toFile(merged, <span style="color: #4250ef;">'merged.pdf'</span>, <span style="color: #065fff;">false</span>, <span style="color: #065fff;">false</span>);

coherentpdf.deletePdf(pdf);
coherentpdf.deletePdf(merged);
</pre>
</div>
</div>
</div>

<div id="outline-container-org5c64339" class="outline-4">
<h4 id="org5c64339">Compiling for the browser</h4>
<div class="outline-text-4" id="text-org5c64339">
<p>
We can use the <a href="https://browserify.org">browserify</a> tool to bundle up our code and its external libraries, including
the parts of the node standard library we use, to make single JavaScript file for use within a web page. This nearly
doubles the size:
</p>

<pre class="example" id="org6343a97">
2192588 coherentpdf.browser.js
1136687 coherentpdf.js
</pre>

<p>
Here is an example of a web page which uses coherentpdf.js to process a PDF file entirely in the browser. You can
choose a file, and it will be processed and a download initiated with the output:
</p>

<p>
<a href="https://coherentpdf.com/coherentpdfjs/index.html">https://coherentpdf.com/coherentpdfjs/index.html</a>
</p>

<p>
Of course, we have a problem now: in the browser, there are no files to read to or write from - the browser is a
sandboxed environment. So we must make sure our API also contains functions to read to and write from PDF files
represented as byte arrays.
</p>

<p>
There is an additional issue: JavaScript in the browser does not cope well with large chunks of synchronous code
like ours: processing a big PDF file would lock up the browser (or at least the tab). We must use what is called a
&ldquo;web worker&rdquo; to run it in the background in another JavaScript environment, and communicate by message-passing only.
See the file <code>cpdfworker.js</code> for this code.
</p>
</div>
</div>

<div id="outline-container-orgd05d559" class="outline-4">
<h4 id="orgd05d559">Minification</h4>
<div class="outline-text-4" id="text-orgd05d559">
<p>
The <a href="https://www.npmjs.com/package/uglify-js">uglify-js</a> tool can be used to minify the JavaScript for deployment on
the web:
</p>

<pre class="example" id="orgcdc55ea">
2192588 coherentpdf.browser.js
1324660 coherentpdf.browser.min.js
1136687 coherentpdf.js
849949  coherentpdf.min.js
</pre>

<p>
We are now down to 1.3Mb. Many web servers can serve gzip&rsquo;d content too, so that helps further, and we get down to
514Kb actually sent over the web.
</p>
</div>
</div>

<div id="outline-container-org0e579d9" class="outline-4">
<h4 id="org0e579d9">Documentation</h4>
<div class="outline-text-4" id="text-org0e579d9">
<p>
Because we built our library from within OCaml, and had it generated for us by <code>js_of_ocaml-ppx</code>, there is no place
to put the docstrings. So, unfortunately, we must write a separate JavaScript source file with empty functions like
this:
</p>

<div class="org-src-container">
<pre class="src src-javascript"><span style="color: #506fa0; font-style: italic;">/** Returns the number of pages in a given PDF, with given user password. It</span>
<span style="color: #506fa0; font-style: italic;">tries to do this as fast as possible, without loading the whole file.</span>
<span style="color: #506fa0; font-style: italic;">@arg {string} password user password</span>
<span style="color: #506fa0; font-style: italic;">@arg {Uint8Array} data PDF file as a byte array</span>
<span style="color: #506fa0; font-style: italic;">@return {number} number of pages */</span>
<span style="color: #6052cf; font-weight: bold;">function</span> <span style="color: #cf25aa;">pagesFastMemory</span>(<span style="color: #1f77bb;">password</span>, <span style="color: #1f77bb;">data</span>) {}
</pre>
</div>

<p>
Now we can run any standard JavaScript documentation generator over this to produce the HTML documentation.
</p>
</div>
</div>

<div id="outline-container-org88be457" class="outline-4">
<h4 id="org88be457">Publishing the package</h4>
<div class="outline-text-4" id="text-org88be457">
<p>
Publishing the package on the npm package system is alarmingly easy - a <code>package.json</code> file, mostly autogenerated,
is added, and then it is published from the command line. You can see it here:
</p>

<p>
<a href="https://www.npmjs.com/package/coherentpdf">https://www.npmjs.com/package/coherentpdf</a>
</p>

<p>
Here is the source, including the <code>package.json</code>:
<a href="https://github.com/coherentgraphics/coherentpdf.js">Coherentpdf.js</a>.
</p>
</div>
</div>

<div id="outline-container-org7443b52" class="outline-4">
<h4 id="org7443b52">Licensing</h4>
<div class="outline-text-4" id="text-org7443b52">
<p>
Our command line PDF tools and C/.NET/Java/Python APIs are under a commercial license, or alternatively a
non-standard &ldquo;not for commercial use&rdquo; license. This is tiresome, because this non-standard license prevents them
being included in, for example, linux distributions.
</p>

<p>
For coherentpdf.js, the license is just for the JavaScript output of <code>js_of_ocaml</code>, not the original OCaml source,
so it can be given a more standard AGPL license, whilst still being available for purchase, and without opening up
the commercial OCaml code. The AGPL isn&rsquo;t everyone&rsquo;s favourite license, of course, but we start there for now.
</p>
</div>
</div>

<div id="outline-container-orga9e2611" class="outline-4">
<h4 id="orga9e2611">To do</h4>
<div class="outline-text-4" id="text-orga9e2611">
<p>
What doesn&rsquo;t work yet? Just two things:
</p>

<ul class="org-ul">
<li>The default stack available in many browsers is small (and some have a smaller stack for web workers), so coherentpdf.js can choke on very large PDF files. This is not a problem in node on the server. This will have to be fixed by modifications to the OCaml code itself.</li>

<li><code>js_of_ocaml</code> installs its own top-level error handler, with the unfortunate side-effect that any error in the node REPL after the module is loaded - even a syntax error - causes the REPL to exit. I plan to produce a patch to make this behaviour optional.</li>
</ul>
</div>
</div>

<div id="outline-container-orgffd4cd5" class="outline-4">
<h4 id="orgffd4cd5">Final Remarks</h4>
<div class="outline-text-4" id="text-orgffd4cd5">
<p>
<code>js_of_ocaml</code> is a remarkably solid piece of kit. To be able to recompile fifteen years of accumulated code with
just a few changes was very surprising to me.
</p>

<p>
Thanks to the <code>js_of_ocaml</code> team and others for answering all my questions during this process, and correcting some
of my misconceptions.
</p>

<p>
I&rsquo;m still very much a JavaScript newbie, and it&rsquo;s not a language or platform I&rsquo;ve grown to love, but if you want
your OCaml code to run in the browser, or your OCaml library to be available to millions of JavaScript programmers,
you might try giving it a go.
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-4" class="outline-2">
<h2 id="4">Will I ever understand Format? or How to print a list vertically with indentation</h2>
<div class="outline-text-2" id="text-4">
<p>
Archive: <a href="https://discuss.ocaml.org/t/will-i-ever-understand-format-or-how-to-print-a-list-vertically-with-indentation/10289/16">https://discuss.ocaml.org/t/will-i-ever-understand-format-or-how-to-print-a-list-vertically-with-indentation/10289/16</a>
</p>
</div>

<div id="outline-container-org299fca6" class="outline-3">
<h3 id="org299fca6">Deep in this thread, Gaga said</h3>
<div class="outline-text-3" id="text-org299fca6">
<p>
There is also a nice document called &ldquo;Format Unraveled&rdquo;, if you want to learn more about <code>Format</code>. It can be found
<a href="https://hal.archives-ouvertes.fr/hal-01503081/file/format-unraveled.pdf">here</a>
</p>
</div>
</div>
</div>




<div id="outline-container-5" class="outline-2">
<h2 id="5">GNU Guile 1.0.0 - Bindings to GNU Guile for OCaml</h2>
<div class="outline-text-2" id="text-5">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-gnu-guile-1-0-0-bindings-to-gnu-guile-for-ocaml/10393/1">https://discuss.ocaml.org/t/ann-gnu-guile-1-0-0-bindings-to-gnu-guile-for-ocaml/10393/1</a>
</p>
</div>

<div id="outline-container-org7df5ac4" class="outline-3">
<h3 id="org7df5ac4">Kiran Gopinathan announced</h3>
<div class="outline-text-3" id="text-org7df5ac4">
<p>
Hi everyone! I am pleased to announce a brand new package for the OCaml ecosystem: Guile-ocaml
</p>

<blockquote>
<p>
Guile-ocaml is a Free Software library that provides high-level OCaml bindings to the FFI interface for GNU Guile
Scheme. The aim of these bindings are to provide an easy way for OCaml developers to extend their OCaml
applications with GNU Guile scheme scripting capabilities, providing simple combinators to translate terms and
send queries between the two languages.
</p>
</blockquote>

<p>
You can find the documentation <a href="https://gopiandcode.github.io/guile-ocaml/">here</a> - alongside a fairly comprehensive
documentation of all the bindings, it provides a step by step guide on implementing the classical GNU Guile based
turtle drawing program, except using OCaml&rsquo;s graphics module.
</p>

<p>
Here&rsquo;s a sneak preview from that guide of what passing an OCaml function to GNU Guile looks like using these
bindings:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #cf25aa;">move_by</span> <span style="color: #1f77bb;">n</span> =
  <span style="color: #6052cf; font-weight: bold;">if</span> <span style="color: #a52a2a;">not</span> <span style="color: #a52a2a;">@@</span> <span style="color: #008858;">Guile.Number.</span>is_integer n <span style="color: #6052cf; font-weight: bold;">then</span>
    <span style="color: #ba35af; font-weight: bold;">failwith</span> <span style="color: #4250ef;">"expected numeric arg"</span>;
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #1f77bb;">n</span> = <span style="color: #008858;">Guile.Number.</span>int_from_raw n <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #1f77bb;">x</span>, <span style="color: #1f77bb;">y</span> =
    <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #1f77bb;">cur_pos</span> = <span style="color: #008858;">Graphics.</span>current_point () <span style="color: #000000; font-weight: bold;">in</span>
    move n cur_pos <span style="color: #a52a2a;">!</span>direction <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #6052cf; font-weight: bold;">if</span> <span style="color: #a52a2a;">!</span>pen_down <span style="color: #6052cf; font-weight: bold;">then</span>
    <span style="color: #008858;">Graphics.</span>lineto x y;
  <span style="color: #008858;">Graphics.</span>moveto x y;
  <span style="color: #008858;">Guile.</span>eol

<span style="color: #000000; font-weight: bold;">let</span> () = <span style="color: #ba35af; font-weight: bold;">ignore</span> <span style="color: #a52a2a;">@@</span> <span style="color: #008858;">Guile.Functions.</span>register_fun1 <span style="color: #4250ef;">"move-by"</span> move_by
</pre>
</div>

<p>
Also, I&rsquo;d like to give extra thanks to opam-repository&rsquo;s tireless maintainers! The package was in limbo for a while
because I couldn&rsquo;t work out why conf-guile was failing to build on certain distributions, but thankfully @mseri and
@kit-ty-kate were able to fix the issue!
</p>
</div>
</div>
</div>




<div id="outline-container-6" class="outline-2">
<h2 id="6">Update on Eio (effects-based direct-style IO for OCaml 5)</h2>
<div class="outline-text-2" id="text-6">
<p>
Archive: <a href="https://discuss.ocaml.org/t/update-on-eio-effects-based-direct-style-io-for-ocaml-5/10395/1">https://discuss.ocaml.org/t/update-on-eio-effects-based-direct-style-io-for-ocaml-5/10395/1</a>
</p>
</div>

<div id="outline-container-orga7acbb9" class="outline-3">
<h3 id="orga7acbb9">Thomas Leonard announced</h3>
<div class="outline-text-3" id="text-orga7acbb9">
<p>
<a href="https://github.com/ocaml-multicore/eio">Eio</a> provides an effects-based direct-style IO stack for OCaml 5.0. It aims
to be easy to use, secure, well documented, and fast. It consists of a generic cross-platform API, plus optimised
backends for different platforms. It can be used instead of (or alongside) Lwt and Async.
</p>
</div>

<div id="outline-container-org35a8641" class="outline-4">
<h4 id="org35a8641">Recent changes</h4>
<div class="outline-text-4" id="text-org35a8641">
<p>
There have been several releases since the last announcement here. The bigger changes include:
</p>

<ul class="org-ul">
<li><a href="https://ocaml-multicore.github.io/eio/eio/Eio/Fiber/index.html#fiber-local-variables">Fiber-local storage</a> (thanks to Jonathan Coates). This allows e.g. a web-server to attach a request ID to the fiber that is handling it, and then display this in all log messages generated by that request.</li>
<li><a href="https://ocaml-multicore.github.io/eio/eio/Eio/Mutex/index.html">Eio.Mutex</a> and <a href="https://ocaml-multicore.github.io/eio/eio/Eio/Condition/index.html">Eio.Condition</a> (@Lortex). These are similar to the ones in the standard library, but they allow other fibers to run while waiting instead of blocking the whole domain.</li>
<li><a href="https://ocaml-multicore.github.io/eio/eio/Eio/Buf_write/index.html">Eio.Buf_write</a> is a port of Faraday to Eio, allowing efficient output buffering.</li>
<li><a href="https://ocaml-multicore.github.io/eio/eio/Eio/Fiber/index.html#val-fork_daemon">Fiber.fork_daemon</a> allows spawning a fiber that will be cancelled automatically when the non-daemon fibers have finished. This is useful for e.g. running a thread to collect entropy for a random number generator while a program is running, without it preventing the program from finishing.</li>
<li><a href="https://ocaml-multicore.github.io/eio/eio/Eio/Fiber/index.html#concurrent-list-operations">Fiber.{iter,map,filter,fiter_map}</a> provide concurrent versions of the corresponding operations in <code>List</code>.</li>
<li><a href="https://ocaml-multicore.github.io/eio/eio/Eio/Path/index.html">Eio.Path</a> provides file-system access. New operations include <code>read_dir</code> (@patricoferris), <code>unlink</code>, <code>rmdir</code> and <code>rename</code>.</li>
<li><a href="https://ocaml-multicore.github.io/eio/eio/Eio/Net/index.html">The networking APIs</a> now include UDP (@patricoferris) and DNS (@bikalgurung), and IPv6 now works (@haesbaert).</li>
<li><a href="https://ocaml-multicore.github.io/eio/eio/Eio_mock/index.html">Eio_mock</a> provides a framework for creating mocks for testing, along with pre-defined ones for flows and networks. <code>Eio_mock.Backend</code> is a special backend for tests. It does no real IO, but can report if your tests deadlock.</li>
<li>The much-requested <a href="https://ocaml-multicore.github.io/eio/eio/Eio_unix/index.html#val-sleep">Eio_unix.sleep</a> is now available as a direct replacement for <code>Lwt_unix.sleep</code>.</li>
</ul>

<p>
See the <a href="https://github.com/ocaml-multicore/eio/releases">release notes</a> for full details, and <a href="https://github.com/ocaml-multicore/eio#getting-ocaml-50">the
tutorial</a> for an introduction.
</p>
</div>
</div>

<div id="outline-container-orgcc05ce0" class="outline-4">
<h4 id="orgcc05ce0">Integration with Lwt and Async</h4>
<div class="outline-text-4" id="text-orgcc05ce0">
<p>
<a href="https://github.com/ocaml-multicore/lwt_eio">Lwt_eio</a> allows running Lwt and Eio code together in a single domain.
The 0.2 release adds support for integrating Lwt and Eio cancellation. The <a href="https://github.com/ocaml-multicore/lwt_eio#porting-a-lwt-application-to-eio">porting
guide</a> shows how to update an Lwt
application to Eio incrementally.
</p>

<p>
<a href="https://github.com/talex5/async_eio">Async_eio</a> allows running Async and Eio code together in a single domain. This
is experimental and requires some changes to Async itself.
</p>

<p>
<a href="https://github.com/talex5/async-eio-lwt-chimera">async-eio-lwt-chimera</a> shows how Async, Eio and Lwt code can all
be used together in a single event loop. It runs an Async server that handles connections using an Lwt handler that
reads a line from the request and then handles it by using Eio to read the named file from its data directory.
</p>
</div>
</div>

<div id="outline-container-orgc999a72" class="outline-4">
<h4 id="orgc999a72">Porting</h4>
<div class="outline-text-4" id="text-orgc999a72">
<p>
It&rsquo;s useful for people to try porting applications and libraries to Eio so we can get feedback on the APIs and
prioritise missing features. The Lwt and Async porting guides linked above may be helpful. Some examples so far
include:
</p>

<ul class="org-ul">
<li><a href="https://github.com/mirage/ocaml-cohttp/tree/master/cohttp-eio">ocaml-cohttp</a> (@bikalgurung)</li>
<li><a href="https://github.com/geocaml/ocaml-geojson/tree/effects">ocaml-geojson</a> (@patricoferris)</li>
<li><a href="https://github.com/mirage/capnp-rpc/pull/256">capnp-rpc</a> (@talex5)</li>
<li><a href="https://github.com/haesbaert/rawlink">rawlink</a> (@haesbaert)</li>
<li><a href="https://github.com/aantron/dream/pull/194">dream</a> (@talex5)</li>
<li><a href="https://github.com/TheLortex/mirage-monorepo">mirage</a> (@Lortex)</li>
<li><a href="https://github.com/mirage/mirage-crypto/pull/155">mirage-crypto</a> (@BikalGurung)</li>
</ul>
</div>
</div>

<div id="outline-container-orgfe0378a" class="outline-4">
<h4 id="orgfe0378a">Backends</h4>
<div class="outline-text-4" id="text-orgfe0378a">
<p>
The recent <a href="https://github.com/ocaml-multicore/ocaml-uring/releases">uring releases</a> have brought improved
performance and several new features to the <code>eio_linux</code> backend.
</p>

<p>
We are still hoping to persuade a Windows user to try using Eio. The Luv backend should mostly work, but there are
likely some problems with paths, etc. Even better would be if someone writes a dedicated <code>eio_windows</code> backend.
</p>

<p>
To add a backend for a new platform, it is best to start by studying
<a href="https://github.com/ocaml-multicore/eio/blob/main/lib_eio/mock/backend.ml">Eio_mock.Backend</a>, which is very simple
as it does no IO. To add IO, you can copy the pattern in either <code>eio_linux</code> (which provides its own event loop that
asks the OS to sleep) or the one in <code>eio_luv</code> (which delegates to an event loop provided by another library).
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-7" class="outline-2">
<h2 id="7">OCaml at First Glance</h2>
<div class="outline-text-2" id="text-7">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ocaml-at-first-glance/10396/1">https://discuss.ocaml.org/t/ocaml-at-first-glance/10396/1</a>
</p>
</div>

<div id="outline-container-orge92109e" class="outline-3">
<h3 id="orge92109e">Bozhidar Batsov announced</h3>
<div class="outline-text-3" id="text-orge92109e">
<p>
This morning I spent a bit of time writing down some of <a href="https://batsov.com/articles/2022/08/29/ocaml-at-first-glance/">my initial observations, experiences and thoughts about
OCaml</a>. Hopefully they&rsquo;ll be useful to other
newcomers to the language.
</p>

<p>
TLDR; I can&rsquo;t say that my initial experience with OCaml was mind-blowing, but it was definitely pleasant and with
time the language grows on me. I miss the simplicity and uniformity of Clojure (still my favorite programming
language by far) and Lisps in general or some of Haskell&rsquo;s goodies (e.g. typeclasses,
<a href="https://hackage.haskell.org/">Hackage</a> and <code>ghci</code>), but I feel OCaml strikes a very good balance between functional
programming, pragmatism and performance. It&rsquo;s a <code>fun</code> language to work with!
</p>

<p>
I&rsquo;d be really curious to hear your own thoughts on the subject and to receive feedback about any mistakes I might
have made due to not being familiar enough with OCaml and its ecosystem.
</p>
</div>
</div>


<div id="outline-container-org40550b5" class="outline-3">
<h3 id="org40550b5">Kiran Gopinathan replied</h3>
<div class="outline-text-3" id="text-org40550b5">
<p>
Nice blog post!
</p>

<blockquote>
<p>
I’d say the development tooling for OCaml is pretty decent, although I wouldn’t go as far as saying it’s great.
</p>
</blockquote>

<p>
Finally, a shameless plug, if you&rsquo;re more familiar with lisp development tooling, have you tried
<a href="https://github.com/gopiandcode/gopcaml-mode">gopcaml-mode</a>? It provides paredit style structural editing support
for OCaml:
</p>


<div id="org3552c04" class="figure">
<p><img src="https://global.discourse-cdn.com/standard11/uploads/ocaml/original/2X/9/99180dcb28ea3021307e66801d8ee6f9f9b2c1b5.gif" alt="99180dcb28ea3021307e66801d8ee6f9f9b2c1b5.gif" />
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-8" class="outline-2">
<h2 id="8">GADTs for typed option getter/setter</h2>
<div class="outline-text-2" id="text-8">
<p>
Archive: <a href="https://discuss.ocaml.org/t/gadts-for-typed-option-getter-setter/10398/1">https://discuss.ocaml.org/t/gadts-for-typed-option-getter-setter/10398/1</a>
</p>
</div>

<div id="outline-container-org01c1628" class="outline-3">
<h3 id="org01c1628">Romain Beauxis announced</h3>
<div class="outline-text-3" id="text-org01c1628">
<p>
I&rsquo;ve had a nice use-case of GADTs recently in <a href="https://github.com/savonet/ocaml-srt">ocaml-srt</a> that I thought I
would share.
</p>

<p>
On the <code>C</code> side, the library implements an API <i>a la</i> <code>syscall</code> with named options and polymorphic types:
</p>
<div class="org-src-container">
<pre class="src src-c">SRT_API       <span style="color: #008858;">int</span> <span style="color: #cf25aa;">srt_getsockopt</span>   (<span style="color: #008858;">SRTSOCKET</span> <span style="color: #1f77bb;">u</span>, <span style="color: #008858;">int</span> <span style="color: #1f77bb;">level</span> <span style="color: #a65f6a; font-style: italic;">/*</span><span style="color: #a65f6a; font-style: italic;">ignored</span><span style="color: #a65f6a; font-style: italic;">*/</span>, <span style="color: #008858;">SRT_SOCKOPT</span> <span style="color: #1f77bb;">optname</span>, <span style="color: #008858;">void</span>* <span style="color: #1f77bb;">optval</span>, <span style="color: #008858;">int</span>*
<span style="color: #1f77bb;">optlen</span>);
SRT_API       <span style="color: #008858;">int</span> <span style="color: #cf25aa;">srt_setsockopt</span>   (<span style="color: #008858;">SRTSOCKET</span> <span style="color: #1f77bb;">u</span>, <span style="color: #008858;">int</span> <span style="color: #1f77bb;">level</span> <span style="color: #a65f6a; font-style: italic;">/*</span><span style="color: #a65f6a; font-style: italic;">ignored</span><span style="color: #a65f6a; font-style: italic;">*/</span>, <span style="color: #008858;">SRT_SOCKOPT</span> <span style="color: #1f77bb;">optname</span>, <span style="color: #6052cf; font-weight: bold;">const</span> <span style="color: #008858;">void</span>* <span style="color: #1f77bb;">optval</span>, <span style="color: #008858;">int</span>
<span style="color: #1f77bb;">optlen</span>);
</pre>
</div>
<p>
And the socket options are listed in an <code>enum</code>:
</p>
<div class="org-src-container">
<pre class="src src-c"><span style="color: #6052cf; font-weight: bold;">typedef</span> <span style="color: #6052cf; font-weight: bold;">enum</span> <span style="color: #008858;">SRT_SOCKOPT</span> {

   <span style="color: #1f77bb;">SRTO_MSS</span> = <span style="color: #065fff;">0</span>,             <span style="color: #a65f6a; font-style: italic;">// </span><span style="color: #a65f6a; font-style: italic;">the Maximum Transfer Unit</span>
   <span style="color: #1f77bb;">SRTO_SNDSYN</span> = <span style="color: #065fff;">1</span>,          <span style="color: #a65f6a; font-style: italic;">// </span><span style="color: #a65f6a; font-style: italic;">if sending is blocking</span>
   <span style="color: #1f77bb;">SRTO_RCVSYN</span> = <span style="color: #065fff;">2</span>,          <span style="color: #a65f6a; font-style: italic;">// </span><span style="color: #a65f6a; font-style: italic;">if receiving is blocking</span>
   <span style="color: #1f77bb;">SRTO_ISN</span> = <span style="color: #065fff;">3</span>,             <span style="color: #a65f6a; font-style: italic;">// </span><span style="color: #a65f6a; font-style: italic;">Initial Sequence Number (valid only after srt_connect or srt_accept-ed sockets)</span>
   <span style="color: #1f77bb;">SRTO_FC</span> = <span style="color: #065fff;">4</span>,              <span style="color: #a65f6a; font-style: italic;">// </span><span style="color: #a65f6a; font-style: italic;">Flight flag size (window size)</span>
   <span style="color: #1f77bb;">SRTO_SNDBUF</span> = <span style="color: #065fff;">5</span>,          <span style="color: #a65f6a; font-style: italic;">// </span><span style="color: #a65f6a; font-style: italic;">maximum buffer in sending queue</span>
   <span style="color: #1f77bb;">SRTO_RCVBUF</span> = <span style="color: #065fff;">6</span>,          <span style="color: #a65f6a; font-style: italic;">// </span><span style="color: #a65f6a; font-style: italic;">UDT receiving buffer size</span>
...
</pre>
</div>

<p>
On the OCaml side, it is then pretty natural to also want a polymorphic API;
</p>
<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">type</span> <span style="color: #008858;">'a socket_opt</span>

<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #cf25aa;">messageapi</span> : bool socket_opt
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #cf25aa;">payloadsize</span> : int socket_opt
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #cf25aa;">rcvsyn</span> : bool socket_opt
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #cf25aa;">sndsyn</span> : bool socket_opt

<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #cf25aa;">getsockflag</span> : socket -&gt; 'a socket_opt -&gt; 'a
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #cf25aa;">setsockflag</span> : socket -&gt; 'a socket_opt -&gt; 'a -&gt; unit
</pre>
</div>

<p>
This can be achieved in a cool type-safe way and without writing any C by combining
<a href="https://github.com/ocamllabs/ocaml-ctypes">ctypes</a> and GADTs!
</p>

<p>
First, we export the socket  option enums as OCaml polymorphic variants using the <code>ctypes</code> API:
</p>
<div class="org-src-container">
<pre class="src src-ocaml">  <span style="color: #000000; font-weight: bold;">type</span> <span style="color: #008858;">socket_opt</span> =
    [ <span style="color: #202020; background-color: #ffffff;">`Messageapi</span>
    | <span style="color: #202020; background-color: #ffffff;">`Payloadsize</span>
    | <span style="color: #202020; background-color: #ffffff;">`Rcvsyn</span>
    | <span style="color: #202020; background-color: #ffffff;">`Sndsyn</span>]

  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #1f77bb;">socket_opt</span> :<span style="color: #008858;"> socket_opt typ </span>=
    enum <span style="color: #4250ef;">"SRT_SOCKOPT"</span>
      [
        (<span style="color: #202020; background-color: #ffffff;">`Messageapi</span>, constant <span style="color: #4250ef;">"SRTO_MESSAGEAPI"</span> int64_t);
        (<span style="color: #202020; background-color: #ffffff;">`Payloadsize</span>, constant <span style="color: #4250ef;">"SRTO_PAYLOADSIZE"</span> int64_t);
        (<span style="color: #202020; background-color: #ffffff;">`Rcvsyn</span>, constant <span style="color: #4250ef;">"SRTO_RCVSYN"</span> int64_t);
        (<span style="color: #202020; background-color: #ffffff;">`Sndsyn</span>, constant <span style="color: #4250ef;">"SRTO_SNDSYN"</span> int64_t)
      ]
</pre>
</div>

<p>
Next, on our public OCaml API side, we use regular variant types with a type annotation to use for GADTs pattern
matching and match then with the polymorphic variants returned by <code>ctypes</code>:
</p>
<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">type</span> <span style="color: #008858;">_ socket_opt</span> =
  | <span style="color: #202020; background-color: #ffffff;">Messageapi</span> : bool socket_opt
  | <span style="color: #202020; background-color: #ffffff;">Payloadsize</span> : int socket_opt
  | <span style="color: #202020; background-color: #ffffff;">Rcvsyn</span> : bool socket_opt
  | <span style="color: #202020; background-color: #ffffff;">Sndsyn</span> : bool socket_opt

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #1f77bb;">messageapi</span> = <span style="color: #202020; background-color: #ffffff;">Messageapi</span>
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #1f77bb;">payloadsize</span> = <span style="color: #202020; background-color: #ffffff;">Payloadsize</span>
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #1f77bb;">rcvsyn</span> = <span style="color: #202020; background-color: #ffffff;">Rcvsyn</span>
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #1f77bb;">sndsyn</span> = <span style="color: #202020; background-color: #ffffff;">Sndsyn</span>

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #cf25aa;">srt_socket_opt_of_socket_opt</span> (<span style="color: #6052cf; font-weight: bold;">type</span> <span style="color: #008858;">a</span>) :<span style="color: #008858;"> a socket_opt -&gt; </span><span style="color: #008858;">Srt.</span><span style="color: #008858;">socket_opt </span>=
  <span style="color: #6052cf; font-weight: bold;">function</span>
  | <span style="color: #202020; background-color: #ffffff;">Messageapi</span> -&gt; <span style="color: #202020; background-color: #ffffff;">`Messageapi</span>
  | <span style="color: #202020; background-color: #ffffff;">Payloadsize</span> -&gt; <span style="color: #202020; background-color: #ffffff;">`Payloadsize</span>
  | <span style="color: #202020; background-color: #ffffff;">Rcvsyn</span> -&gt; <span style="color: #202020; background-color: #ffffff;">`Rcvsyn</span>
  | <span style="color: #202020; background-color: #ffffff;">Sndsyn</span> -&gt; <span style="color: #202020; background-color: #ffffff;">`Sndsyn</span>
</pre>
</div>

<p>
<code>ctypes</code> also. gives us bindings to the <code>get~/~set</code> functions from the <code>C</code> library:
</p>
<div class="org-src-container">
<pre class="src src-ocaml">  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #1f77bb;">setsockflag</span> =
    foreign <span style="color: #4250ef;">"srt_setsockflag"</span>
      (int <span style="color: #a52a2a;">@-&gt;</span> socket_opt <span style="color: #a52a2a;">@-&gt;</span> ptr void <span style="color: #a52a2a;">@-&gt;</span> int <span style="color: #a52a2a;">@-&gt;</span> returning int)

  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #1f77bb;">getsockflag</span> =
    foreign <span style="color: #4250ef;">"srt_getsockflag"</span>
      (int <span style="color: #a52a2a;">@-&gt;</span> socket_opt <span style="color: #a52a2a;">@-&gt;</span> ptr void <span style="color: #a52a2a;">@-&gt;</span> ptr int <span style="color: #a52a2a;">@-&gt;</span> returning int)
</pre>
</div>

<p>
Now, we&rsquo;re ready to implement our <code>get~/~set</code> polymorphic functions:
</p>
<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #1f77bb;">getsockflag</span> :<span style="color: #008858;"> </span><span style="color: #6052cf; font-weight: bold;">type</span><span style="color: #008858;"> a. socket -&gt; a socket_opt -&gt; a </span>=
 <span style="color: #6052cf; font-weight: bold;">fun</span> <span style="color: #1f77bb;">sock</span> <span style="color: #1f77bb;">opt</span> -&gt;
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #1f77bb;">arg</span> = allocate int <span style="color: #065fff;">0</span> <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #1f77bb;">arglen</span> = allocate int (sizeof int) <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #ba35af; font-weight: bold;">ignore</span>
    (check_err
       (getsockflag sock
          (srt_socket_opt_of_socket_opt opt)
          (to_voidp arg) arglen));
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #cf25aa;">to_bool</span> () = <span style="color: #a52a2a;">!@</span>arg &lt;&gt; <span style="color: #065fff;">0</span> <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #cf25aa;">to_int</span> () = <span style="color: #a52a2a;">!@</span>arg <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #6052cf; font-weight: bold;">match</span> opt <span style="color: #6052cf; font-weight: bold;">with</span>
    | <span style="color: #202020; background-color: #ffffff;">Rcvsyn</span> -&gt; to_bool ()
    | <span style="color: #202020; background-color: #ffffff;">Sndsyn</span> -&gt; to_bool ()
    | <span style="color: #202020; background-color: #ffffff;">Messageapi</span> -&gt; to_bool ()
    | <span style="color: #202020; background-color: #ffffff;">Payloadsize</span> -&gt; to_int ()

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #1f77bb;">setsockflag</span> :<span style="color: #008858;"> </span><span style="color: #6052cf; font-weight: bold;">type</span><span style="color: #008858;"> a. socket -&gt; a socket_opt -&gt; a -&gt; unit </span>=
 <span style="color: #6052cf; font-weight: bold;">fun</span> <span style="color: #1f77bb;">sock</span> <span style="color: #1f77bb;">opt</span> <span style="color: #1f77bb;">v</span> -&gt;
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #cf25aa;">f</span> <span style="color: #1f77bb;">t</span> <span style="color: #1f77bb;">v</span> = to_voidp (allocate t v) <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #cf25aa;">of_bool</span> <span style="color: #1f77bb;">v</span> =
    <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #1f77bb;">v</span> = <span style="color: #6052cf; font-weight: bold;">if</span> v <span style="color: #6052cf; font-weight: bold;">then</span> <span style="color: #065fff;">1</span> <span style="color: #6052cf; font-weight: bold;">else</span> <span style="color: #065fff;">0</span> <span style="color: #000000; font-weight: bold;">in</span>
    (f int v, sizeof int)
  <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #cf25aa;">of_int</span> <span style="color: #1f77bb;">v</span> = (f int v, sizeof int) <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #1f77bb;">arg</span>, <span style="color: #1f77bb;">arglen</span> =
    <span style="color: #6052cf; font-weight: bold;">match</span> opt <span style="color: #6052cf; font-weight: bold;">with</span>
      | <span style="color: #202020; background-color: #ffffff;">Rcvsyn</span> -&gt; of_bool v
      | <span style="color: #202020; background-color: #ffffff;">Sndsyn</span> -&gt; of_bool v
      | <span style="color: #202020; background-color: #ffffff;">Messageapi</span> -&gt; of_bool v
      | <span style="color: #202020; background-color: #ffffff;">Payloadsize</span> -&gt; of_int v
</pre>
</div>

<p>
<b>⚠️ Question ⚠️</b>
</p>

<p>
I wasn&rsquo;t able to join cases of the same type, for instance this:
</p>
<div class="org-src-container">
<pre class="src src-ocaml">  <span style="color: #6052cf; font-weight: bold;">match</span> opt <span style="color: #6052cf; font-weight: bold;">with</span>
    | <span style="color: #202020; background-color: #ffffff;">Rcvsyn</span>
    | <span style="color: #202020; background-color: #ffffff;">Sndsyn</span>
    | <span style="color: #202020; background-color: #ffffff;">Messageapi</span> -&gt; to_bool ()
    | <span style="color: #202020; background-color: #ffffff;">Payloadsize</span> -&gt; to_int ()
</pre>
</div>
<p>
Is this a theoretical or implementation limitation?
</p>
</div>
</div>


<div id="outline-container-orgb619885" class="outline-3">
<h3 id="orgb619885">yallop replied</h3>
<div class="outline-text-3" id="text-orgb619885">
<p>
It&rsquo;s an implementation limitation.  There are some details at <a href="https://github.com/ocaml/ocaml/issues/5736">https://github.com/ocaml/ocaml/issues/5736</a>
</p>
</div>
</div>


<div id="outline-container-orgf03f6d7" class="outline-3">
<h3 id="orgf03f6d7">Christian Lindig said</h3>
<div class="outline-text-3" id="text-orgf03f6d7">
<p>
Slightly related to the problem of sharing constants between the C side and the OCaml side but much less
sophisticated:
</p>

<p>
For my small epoll library <a href="https://github.com/lindig/polly">polly</a> I am creating a function in C using a macro that
returns the constant:
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #a65f6a; font-style: italic;">/* </span><span style="color: #a65f6a; font-style: italic;">Make all constants available to clients by exporting them via a</span>
<span style="color: #a65f6a; font-style: italic;"> * function. This avoids having to hard code them on the client side.</span>
<span style="color: #a65f6a; font-style: italic;"> *</span><span style="color: #a65f6a; font-style: italic;"> */</span>

<span style="color: #e00033;">#define</span> <span style="color: #cf25aa;">CONSTANT</span>(<span style="color: #1f77bb;">name</span>) \
  CAMLprim <span style="color: #008858;">value</span> <span style="color: #cf25aa;">caml_polly_</span> ## name(<span style="color: #008858;">value</span> <span style="color: #1f77bb;">unit</span>) { <span style="color: #6052cf; font-weight: bold;">return</span> Val_int(name); }

<span style="color: #cf25aa;">CONSTANT</span>(EPOLLIN);
<span style="color: #cf25aa;">CONSTANT</span>(EPOLLPRI);
<span style="color: #cf25aa;">CONSTANT</span>(EPOLLOUT);
</pre>
</div>

<p>
In the bindings I have one function per constant and call it once to obtain the constant; the actual value of the
constant is not part of the OCaml code.
</p>

<div class="org-src-container">
<pre class="src src-ocaml">  <span style="color: #000000; font-weight: bold;">type</span> <span style="color: #008858;">t</span> = int

  <span style="color: #000000; font-weight: bold;">external</span> <span style="color: #cf25aa;">polly_IN</span> : unit -&gt; t = <span style="color: #4250ef;">"caml_polly_EPOLLIN"</span>
  <span style="color: #000000; font-weight: bold;">external</span> <span style="color: #cf25aa;">polly_PRI</span> : unit -&gt; t = <span style="color: #4250ef;">"caml_polly_EPOLLPRI"</span>
  <span style="color: #000000; font-weight: bold;">external</span> <span style="color: #cf25aa;">polly_OUT</span> : unit -&gt; t = <span style="color: #4250ef;">"caml_polly_EPOLLOUT"</span>

  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #1f77bb;">inp</span> = polly_IN ()
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #1f77bb;">pri</span> = polly_PRI ()
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #1f77bb;">out</span> = polly_OUT ()
</pre>
</div>
</div>
</div>
</div>




<div id="outline-container-9" class="outline-2">
<h2 id="9">shuttle v0.3.1 released</h2>
<div class="outline-text-2" id="text-9">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-shuttle-v0-3-1-released/8684/2">https://discuss.ocaml.org/t/ann-shuttle-v0-3-1-released/8684/2</a>
</p>
</div>

<div id="outline-container-org318b94a" class="outline-3">
<h3 id="org318b94a">Anurag Soni announced</h3>
<div class="outline-text-3" id="text-org318b94a">
<p>
There have been some significant changes since this last release (Versions 0.4.0 and 0.5.0 are available on opam):
</p>

<ul class="org-ul">
<li>Buffered reader has a new utility method that allows reading lines</li>
<li>Shuttle now supports file descriptors that don&rsquo;t support nonblocking I/O. For blocking I/O Shuttle uses async&rsquo;s support for running syscalls in its thread pool</li>
<li>Buffered reader&rsquo;s api has been simplified to remove <code>read_one_chunk_at_a_time</code> in favor of a more familiar <code>read</code>, <code>read_line</code> etc. <code>refill</code> operation is supported to perform a read syscall to fill a channel&rsquo;s buffer, and <code>Input_channel.view</code> can be used to get a view into the channel&rsquo;s underlying buffer.</li>
<li>Supports v0.15 series of the janestreet libraries</li>
<li>Buffered reader now uses an auto-growing buffer instead of a fixed size buffer than notified users that the internal buffer is full and no progress can be made unless some content is consumed. This should allow starting with a smaller buffer without needing to worry about implementing some client side buffering to hold unconsumed data. Channels allow configuring an upper bound on the internal buffer length, if a buffer grows beyond that an exception is raised.</li>
<li>Buffered writer&rsquo;s support a richer flush interface. Flush operations report errors encountered while attempting to write any pending bytes. This results in a flush operation that returns a deferred that will resolve at some point with either a success or an error, instead of the older flush operation that would return a deferred that never resolved if there was an error during a write syscall.</li>
</ul>
</div>
</div>
</div>




<div id="outline-container-10" class="outline-2">
<h2 id="10">coinductive data types</h2>
<div class="outline-text-2" id="text-10">
<p>
Archive: <a href="https://sympa.inria.fr/sympa/arc/caml-list/2022-08/msg00009.html">https://sympa.inria.fr/sympa/arc/caml-list/2022-08/msg00009.html</a>
</p>
</div>

<div id="outline-container-orgcb65c7a" class="outline-3">
<h3 id="orgcb65c7a">Aaron Gray asked and François Pottier replied</h3>
<div class="outline-text-3" id="text-orgcb65c7a">
<blockquote>
<p>
Does either ML or OCaML have coinductive data types ? And if so could
you please point me at the/some appropriate documentation on them.
</p>
</blockquote>

<p>
ML and OCaml have algebraic data types, which are recursive (that is,
more general than inductive and co-inductive types). Algebraic data
type definitions are not subject to a positivity restriction, and
algebraic data types can be constructed and deconstructed by recursive
functions, which are not subject to a termination check.
</p>

<p>
If you want to see a typical example of a &ldquo;co-inductive&rdquo; data structure
encoded in OCaml, I suggest to have a look at &ldquo;sequences&rdquo;, which can be
described as potentially infinite lists:
</p>

<p>
<a href="https://v2.ocaml.org/api/Seq.html">https://v2.ocaml.org/api/Seq.html</a>
</p>
</div>
</div>
</div>




<div id="outline-container-orgfbcc7ef" class="outline-2">
<h2 id="orgfbcc7ef">Old CWN</h2>
<div class="outline-text-2" id="text-orgfbcc7ef">
<p>
If you happen to miss a CWN, you can <a href="mailto:alan.schmitt@polytechnique.org">send me a message</a> and I&rsquo;ll mail it to you, or go take a look at <a href="https://alan.petitepomme.net/cwn/">the archive</a> or the <a href="https://alan.petitepomme.net/cwn/cwn.rss">RSS feed of the archives</a>.
</p>

<p>
If you also wish to receive it every week by mail, you may subscribe <a href="http://lists.idyll.org/listinfo/caml-news-weekly/">online</a>.
</p>

<div class="authorname" id="org08df864">
<p>
<a href="https://alan.petitepomme.net/">Alan Schmitt</a>
</p>

</div>
</div>
</div>
</div>
</body>
</html>
