<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-12-08 Tue 12:04 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OCaml Weekly News</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<style type="text/css">#table-of-contents h2 { display: none } .title { display: none } .authorname { text-align: right }</style>
<style type="text/css">.outline-2 {border-top: 1px solid black;}</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">OCaml Weekly News</h1>
<p>
<a href="http://alan.petitepomme.net/cwn/2020.12.01.html">Previous Week</a> <a href="http://alan.petitepomme.net/cwn/index.html">Up</a> <a href="http://alan.petitepomme.net/cwn/2020.12.15.html">Next Week</a>
</p>

<p>
Hello
</p>

<p>
Here is the latest OCaml Weekly News, for the week of December 01 to 08, 2020.
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#1">OCaml 4.12.0, second alpha release</a></li>
<li><a href="#2">ez_subst.0.1.0 and ez_cmdliner.0.2.0</a></li>
<li><a href="#3">New release of Menhir (20201201)</a></li>
<li><a href="#4">http-multipart-formdata 1.0.0</a></li>
<li><a href="#5">Multicore OCaml: November 2020</a></li>
<li><a href="#6">Seq vs List, optimization</a></li>
<li><a href="#7">dap 1.0.0 &#x2013; Debug Adapter Protocol for OCaml</a></li>
<li><a href="#8">✂️ form2xml - a tiny cli tool to slice http form-data dumps</a></li>
<li><a href="#9">http-multipart-formdata 1.0.1</a></li>
<li><a href="#10">Set up OCaml 1.1.4</a></li>
<li><a href="#11">First Public Release (beta) of the Memthol memory profiling visualizer</a></li>
<li><a href="#12">Exception vs Result</a></li>
<li><a href="#13">Making web calls to OCaml</a></li>
<li><a href="#14">wasmtime 0.0.1: lightweight WebAssembly runtime</a></li>
<li><a href="#15">First release of Lwt-exit</a></li>
<li><a href="#org27184e8">Old CWN</a></li>
</ul>
</div>
</div>


<div id="outline-container-org8f0369c" class="outline-2">
<h2 id="1">OCaml 4.12.0, second alpha release</h2>
<div class="outline-text-2" id="text-1">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ocaml-4-12-0-second-alpha-release/6887/1">https://discuss.ocaml.org/t/ocaml-4-12-0-second-alpha-release/6887/1</a>
</p>
</div>

<div id="outline-container-org83241c3" class="outline-3">
<h3 id="org83241c3">octachron announced</h3>
<div class="outline-text-3" id="text-org83241c3">
<p>
The release of OCaml 4.12.0 is approaching. We have released a second alpha
version to help fellow hackers join us early in our bug hunting and
opam ecosystem fixing fun.
</p>

<p>
Beyond the usual bug fixes this new alpha version removes the type system change that
restricted the propagation of type information between branches of a "match".
The newly introduced warning was more troublesome than expected, the feature has
been thus postponed to 4.13 .
</p>

<p>
The base compiler can be installed as an opam switch with the following commands
</p>
<div class="org-src-container">
<pre class="src src-shell">opam update
opam switch create 4.12.0~alpha2
--repositories=default,<span style="color: #a0522d;">beta</span>=git+https://github.com/ocaml/ocaml-beta-repository.git
</pre>
</div>
<p>
If you want to tweak the configuration of the compiler, you can pick configuration options with
</p>
<div class="org-src-container">
<pre class="src src-shell">opam update
opam switch create &lt;switch_name&gt; --packages=ocaml-variants.4.12.0~alpha2+options,&lt;option_list&gt;
--repositories=default,<span style="color: #a0522d;">beta</span>=git+https://github.com/ocaml/ocaml-beta-repository.git
</pre>
</div>
<p>
where <code>&lt;option_list&gt;</code> is a comma separated list of ocaml-option-* packages. For
instance, for a flambda and afl enabled switch:
</p>
<div class="org-src-container">
<pre class="src src-shell">opam switch create 4.12.0~alpha2+flambda+afl
--packages=ocaml-variants.4.12.0~alpha2+options,ocaml-option-flambda,ocaml-option-afl
--repositories=default,<span style="color: #a0522d;">beta</span>=git+https://github.com/ocaml/ocaml-beta-repository.git
</pre>
</div>
<p>
All available options can be listed with "opam search ocaml-option".
</p>

<p>
The source code for the alpha is also available at these addresses:
</p>

<ul class="org-ul">
<li><a href="https://github.com/ocaml/ocaml/archive/4.12.0-alpha2.tar.gz">https://github.com/ocaml/ocaml/archive/4.12.0-alpha2.tar.gz</a></li>
<li><a href="https://caml.inria.fr/pub/distrib/ocaml-4.12/ocaml-4.12.0~alpha2.tar.gz">https://caml.inria.fr/pub/distrib/ocaml-4.12/ocaml-4.12.0~alpha2.tar.gz</a></li>
</ul>

<p>
If you want to test this version, it is advised to install the alpha opam repository
</p>

<p>
<a href="https://github.com/kit-ty-kate/opam-alpha-repository">https://github.com/kit-ty-kate/opam-alpha-repository</a>
</p>

<p>
with
</p>
<div class="org-src-container">
<pre class="src src-shell">opam repo add alpha git://github.com/kit-ty-kate/opam-alpha-repository.git
</pre>
</div>
<p>
This alpha repository contains various packages patched with fixes in the
process of being upstreamed. Once the repository installed, these patched
packages will take precedence over the non-patched version.
</p>

<p>
If you find any bugs, please report them here:
 <a href="https://github.com/ocaml/ocaml/issues">https://github.com/ocaml/ocaml/issues</a>
</p>
</div>
</div>
</div>




<div id="outline-container-orgb3f257c" class="outline-2">
<h2 id="2">ez_subst.0.1.0 and ez_cmdliner.0.2.0</h2>
<div class="outline-text-2" id="text-2">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-ez-subst-0-1-0-and-ez-cmdliner-0-2-0/6888/1">https://discuss.ocaml.org/t/ann-ez-subst-0-1-0-and-ez-cmdliner-0-2-0/6888/1</a>
</p>
</div>

<div id="outline-container-orge4550cb" class="outline-3">
<h3 id="orge4550cb">Fabrice Le Fessant announced</h3>
<div class="outline-text-3" id="text-orge4550cb">
<p>
I am please to announce the new releases of two opam packages: <code>ez_subst</code> and <code>ez_cmdliner</code>. We use
both of them as dependencies of <code>drom</code> (and use <code>drom</code> to manage them).
</p>

<ul class="org-ul">
<li><p>
<code>ez_subst</code> is a simple library to perform string replacements in strings. It can be seen as a replacement for <code>Printf</code> when you are lost with too many <code>%s</code> in one format, or a replacement for <code>Buffer.add_substitute</code> when you want a more control. Replacements are chosen by functions, and can be separately specified using optional arguments <code>`brace</code> (for <code>${var}</code>), <code>`paren</code> (for <code>$(var)</code>), <code>`bracket</code> (for <code>$[var]</code>) and <code>`var</code> (for <code>$alphanum</code>). Separator <code>$</code> can be changed, and notation can be symmetric (<code>%{x}%</code>).
</p>

<p>
<a href="https://ocamlpro.github.io/ez_subst">https://ocamlpro.github.io/ez_subst</a> <br />
<a href="https://ocamlpro.github.io/ez_subst/doc/ez_subst/Ez_subst/V1/EZ_SUBST/index.html">https://ocamlpro.github.io/ez_subst/doc/ez_subst/Ez_subst/V1/EZ_SUBST/index.html</a>
</p>

<p>
For example:
</p>
<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">open </span><span style="color: #228b22;">Ez_subst.V1</span> <span style="color: #b22222;">(* </span><span style="color: #b22222;">versionned interface </span><span style="color: #b22222;">*)</span>

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">s</span> = <span style="color: #228b22;">EZ_SUBST.</span>string <span style="color: #008b8b;">~brace</span>:(<span style="color: #a020f0;">fun</span> <span style="color: #a0522d;">ctxt</span> <span style="color: #a0522d;">n</span> -&gt; string_of_int
   (ctxt + int_of_string n)) <span style="color: #008b8b;">~ctxt</span>:3 <span style="color: #8b2252;">"${4} ${5}"</span>

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">s</span> = <span style="color: #228b22;">EZ_SUBST.</span>string <span style="color: #008b8b;">~sep</span>:<span style="color: #8b2252;">'!'</span>  <span style="color: #008b8b;">~paren</span>:(<span style="color: #a020f0;">fun</span> () <span style="color: #a0522d;">s</span> -&gt;
   <span style="color: #228b22;">String.</span>uppercase s) <span style="color: #008b8b;">~ctxt</span>:() <span style="color: #8b2252;">"!(abc) !(def)"</span>

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">s</span> = <span style="color: #228b22;">EZ_SUBST.</span>string <span style="color: #008b8b;">~sym</span>:<span style="color: #008b8b;">true</span> <span style="color: #008b8b;">~sep</span>:<span style="color: #8b2252;">'%'</span> <span style="color: #008b8b;">~brace</span>:(<span style="color: #a020f0;">fun</span> <span style="color: #a0522d;">ctxt_</span> <span style="color: #a0522d;">s</span>
   -&gt; ctxt <span style="color: #a52a2a;">^</span> <span style="color: #8b2252;">" "</span> <span style="color: #a52a2a;">^</span> s) <span style="color: #008b8b;">~ctxt</span>:<span style="color: #8b2252;">"Hello"</span> <span style="color: #8b2252;">"%{John}% %{Sandy}%"</span>

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">s</span> = <span style="color: #228b22;">EZ_SUBST.</span>string_from_list <span style="color: #008b8b;">~default</span>:<span style="color: #8b2252;">"unknown"</span> [ <span style="color: #8b2252;">"name"</span>,
   <span style="color: #8b2252;">"Doe"</span>; <span style="color: #8b2252;">"surname"</span>, <span style="color: #8b2252;">"John"</span> ] <span style="color: #8b2252;">"${name} $(surname) is missing"</span>
</pre>
</div></li>

<li><p>
<code>ez_cmdliner</code> is a simple layer over <code>cmdliner</code> to provide an interface à la <code>Arg</code> module. It provides support for a one-command and sub-commands modes. It also provides a ReST generator to document sub-commands and integrate the documentation in a Sphinx documentation (to use with <code>drom</code> for example).
</p>

<p>
<a href="https://ocamlpro.github.io/ez_cmdliner">https://ocamlpro.github.io/ez_cmdliner</a>
</p>

<p>
For example:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">open </span><span style="color: #228b22;">Ezcmd.V2</span>
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">cmd_new</span> =  <span style="color: #228b22;">EZCMD.</span>sub <span style="color: #8b2252;">"new"</span>   <span style="color: #b22222;">(* </span><span style="color: #b22222;">for `drom new` </span><span style="color: #b22222;">*)</span>
 <span style="color: #008b8b;">~args</span>: [
  [ <span style="color: #8b2252;">"dir"</span> ],  <span style="color: #228b22;">Arg.</span><span style="color: #000000; background-color: #ffffff;">String</span> (<span style="color: #a020f0;">fun</span> <span style="color: #a0522d;">s</span> -&gt; dir := <span style="color: #000000; background-color: #ffffff;">Some</span> s),
     <span style="color: #228b22;">EZCMD.</span>info <span style="color: #008b8b;">~docv</span>:<span style="color: #8b2252;">"DIRECTORY"</span>
      <span style="color: #8b2252;">"Dir where package sources are stored (src by default)"</span>;
  [ <span style="color: #8b2252;">"library"</span> ],  <span style="color: #228b22;">Arg.</span><span style="color: #000000; background-color: #ffffff;">Unit</span> (<span style="color: #a020f0;">fun</span> () -&gt; skeleton := <span style="color: #000000; background-color: #ffffff;">Some</span> <span style="color: #8b2252;">"library"</span>),
     <span style="color: #228b22;">EZCMD.</span>info <span style="color: #8b2252;">"Project contains only a library"</span>;
  [ <span style="color: #8b2252;">"i"</span>; <span style="color: #8b2252;">"inplace"</span> ], <span style="color: #228b22;">Arg.</span><span style="color: #000000; background-color: #ffffff;">Set</span> inplace, <span style="color: #b22222;">(* </span><span style="color: #b22222;">for `-i` or `--inplace` </span><span style="color: #b22222;">*)</span>
      <span style="color: #228b22;">EZCMD.</span>info <span style="color: #8b2252;">"Create project in the the current directory"</span>;
  <span style="color: #000000; background-color: #ffffff;">[]</span>,    <span style="color: #228b22;">Arg.</span><span style="color: #000000; background-color: #ffffff;">Anon</span> (0, <span style="color: #a020f0;">fun</span> <span style="color: #a0522d;">name</span> -&gt; project_name := <span style="color: #000000; background-color: #ffffff;">Some</span> name),
      <span style="color: #228b22;">EZCMD.</span>info <span style="color: #008b8b;">~docv</span>:<span style="color: #8b2252;">"PROJECT"</span> <span style="color: #8b2252;">"Name of the project"</span>
 ]
 <span style="color: #008b8b;">~doc</span>:<span style="color: #8b2252;">"Create a new project"</span>
 (<span style="color: #a020f0;">fun</span> () -&gt;
    action <span style="color: #008b8b;">~name</span>:<span style="color: #a52a2a;">!</span>project_name <span style="color: #008b8b;">~skeleton</span>:<span style="color: #a52a2a;">!</span>skeleton <span style="color: #008b8b;">~dir</span>:<span style="color: #a52a2a;">!</span>dir
      <span style="color: #008b8b;">~inplace</span>:<span style="color: #a52a2a;">!</span>inplace ~args)
 <span style="color: #008b8b;">~man</span>: [
   <span style="color: #000000; background-color: #ffffff;">`S</span> <span style="color: #8b2252;">"DESCRIPTION"</span>;
   <span style="color: #000000; background-color: #ffffff;">`Blocks</span> [
     <span style="color: #000000; background-color: #ffffff;">`P</span> <span style="color: #8b2252;">"This command performs the following actions:"</span>;
   ]
]
<span style="color: #000000; font-weight: bold;">let</span> () = <span style="color: #228b22;">EZCMD.</span>main_with_subcommands <span style="color: #008b8b;">~name</span>:<span style="color: #8b2252;">"drom"</span> <span style="color: #008b8b;">~version</span>:<span style="color: #8b2252;">"0.1.0"</span>
   <span style="color: #008b8b;">~doc</span>:<span style="color: #8b2252;">"Create and manage an OCaml project"</span> <span style="color: #008b8b;">~man</span>:<span style="color: #000000; background-color: #ffffff;">[]</span> ~argv [ cmd_new ]
   ~common_args
</pre>
</div></li>
</ul>

<p>
Both packages are now available in opam repository.
</p>
</div>
</div>
</div>




<div id="outline-container-orgee56770" class="outline-2">
<h2 id="3">New release of Menhir (20201201)</h2>
<div class="outline-text-2" id="text-3">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-new-release-of-menhir-20201201/6892/1">https://discuss.ocaml.org/t/ann-new-release-of-menhir-20201201/6892/1</a>
</p>
</div>

<div id="outline-container-org3f15f59" class="outline-3">
<h3 id="org3f15f59">François Pottier announced</h3>
<div class="outline-text-3" id="text-org3f15f59">
<p>
I would like to announce a new release of Menhir, the LR(1) parser generator
for OCaml. The most prominent new features are intended to improve the comfort
of the machinery that allows producing custom syntax error messages: a demo of
this machinery has been added, new library functions have been added so as to
make it easier to use, and the commands that deal with <code>.messages</code> files have
been improved. An excerpt of the changelog appears below.
</p>

<div class="org-src-container">
<pre class="src src-shell">opam update
opam upgrade menhir
</pre>
</div>

<p>
Happy parsing!
</p>
</div>

<div id="outline-container-orgd627454" class="outline-4">
<h4 id="orgd627454">2020/12/01</h4>
<div class="outline-text-4" id="text-orgd627454">
<ul class="org-ul">
<li>The module <code>MenhirLib.ErrorReports</code> is extended with new functions:
<code>wrap_supplier</code>, <code>extract</code>, <code>sanitize</code>, <code>compress</code>, <code>shorten</code>, <code>expand</code>.</li>

<li>The new module <code>MenhirLib.LexerUtil</code> offers a few functions that help
reading a file, setting up a lexing buffer, printing source code positions,
etc.</li>

<li>The new demo <code>calc-syntax-errors</code> demonstrates how to produce customized
syntax error messages.</li>

<li>The new command <code>--merge-errors</code> merges two <code>.messages</code> files. It can be
useful when two or more users have independently produced partial
<code>.messages</code> files and wish to combine their work.
(Suggested by Gabriel Scherer and François Bobot.)</li>

<li>The commands that read <code>.messages</code> files have been hardened so as to
tolerate situations where a sentence mentions a nonexistent symbol or does
not lead to an error state. When such a sentence is encountered, an error
message is produced on the standard error channel; then, this sentence is
ignored and processing continues. (As an exception, the command
<code>--compile-errors</code> refuses to proceed in the presence of such sentences.)</li>
</ul>
</div>
</div>

<div id="outline-container-org6f1d69e" class="outline-4">
<h4 id="org6f1d69e">2020/11/22</h4>
<div class="outline-text-4" id="text-org6f1d69e">
<ul class="org-ul">
<li>The new command line switch <code>--dump-resolved</code> writes a description of the
automaton to the file <code>.automaton.resolved</code> after all conflicts have been
resolved and after extra reductions have been introduced. This file also
shows which states have a default reduction.</li>

<li>The command line switch <code>--dump</code> writes a description of the automaton to
the file <code>.automaton</code> after benign conflicts have been silently resolved,
but <b>before</b> severe conflicts are resolved and before extra reductions are
introduced. (This behavior is unchanged.) The manner in which end-of-stream
conflicts are displayed in this file has been improved.</li>

<li>In the files <code>.automaton</code> and <code>.automaton.resolved</code>, the reduction table in
each state is now presented in a much more compact and readable way.</li>

<li>In the files <code>.automaton</code> and <code>.automaton.resolved</code>, the known suffix of the
stack in each state is now explicitly shown. (Although it can be deduced
from the LR(1) items, showing it helps.)</li>

<li>Document the problem caused by placing a module alias declaration
in an <code>.mly</code> file. (See <b>Questions and Answers</b> in the manual.)</li>

<li>Turn off a costly internal well-formedness assertion.
This allows a 30% speedup in the construction of large automata
and in the conflict explanation process. (Reported by Joe.)</li>
</ul>
</div>
</div>
</div>
</div>




<div id="outline-container-orgc6370d8" class="outline-2">
<h2 id="4">http-multipart-formdata 1.0.0</h2>
<div class="outline-text-2" id="text-4">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-http-multipart-formdata-1-0-0/6893/1">https://discuss.ocaml.org/t/ann-http-multipart-formdata-1-0-0/6893/1</a>
</p>
</div>

<div id="outline-container-org15a8358" class="outline-3">
<h3 id="org15a8358">Bikal Lem announced</h3>
<div class="outline-text-3" id="text-org15a8358">
<p>
It is my pleasure to announce the release of http-multipart-formdata v1.0.0. As the name suggests, the
library implements functionality to allow HTTP file uploads and form processing. Tangentially, it
implements the standard <a href="https://tools.ietf.org/html/rfc7578">RFC 7578 - Returning Values from Forms:
multipart/form-data</a> which is the standard browsers use to send
form data to a web server.
</p>

<p>
I developed this library as part of my endeavour to create ocaml web applications.
</p>

<p>
It is also an example of the parser construction library
<a href="https://discuss.ocaml.org/t/ann-reparse-2-0-0/6868/3">reparse</a> which I also released a few days ago.
</p>

<ul class="org-ul">
<li><a href="https://github.com/lemaetech/http-multipart-formdata">http-multipart-formdata</a></li>
<li><a href="https://lemaetech.co.uk/http-multipart-formdata/">API docs</a></li>
</ul>
</div>
</div>
</div>




<div id="outline-container-orge1735c4" class="outline-2">
<h2 id="5">Multicore OCaml: November 2020</h2>
<div class="outline-text-2" id="text-5">
<p>
Archive: <a href="https://discuss.ocaml.org/t/multicore-ocaml-november-2020/6899/1">https://discuss.ocaml.org/t/multicore-ocaml-november-2020/6899/1</a>
</p>
</div>

<div id="outline-container-orgabda9db" class="outline-3">
<h3 id="orgabda9db">Anil Madhavapeddy announced</h3>
<div class="outline-text-3" id="text-orgabda9db">
<p>
Welcome to the November 2020 Multicore OCaml report! This update along with the <a href="https://discuss.ocaml.org/tag/multicore-monthly">previous
updates</a> have been compiled by @shakthimaan,
@kayceesrk, and @avsm.
</p>

<p>
<b>Multicore OCaml:</b> Since the support for systhreads has been merged last month, many more ecosystem
packages compile.  We have been doing bulk builds (using a specialised <a href="http://check.ocamllabs.io:8082">opam-health-check
instance</a>) against the opam repository in order to chase down the last
of the lingering build bugs. Most of the breakage is around packages using C stubs related to the
garbage collector, although we did find a few actual multicore bugs (related to the thread machinery
when using dynlink). The details are under "ecosystem" below. We also spent a lot of time on optimising
the stack discipline in the multicore compiler, as part of writing a draft paper on the effect system
(more details on that later).
</p>

<p>
<b>Upstream OCaml:</b> The <a href="https://discuss.ocaml.org/t/ocaml-4-12-0-second-alpha-release/6887">4.12.0alpha2
release</a> is now out, featuring the
dynamic naked pointer checker to help make your code only used external pointers that are boxed. Please
do run your codebase on it to help prepare.  For OCaml 4.13 (currently the <code>trunk</code>) branch, we had a
full OCaml developers meeting where we decided on the worklist for what we're going to submit upstream.
The major effort is on <a href="https://github.com/ocaml/ocaml/pull/10039">GC safe points</a> and not caching the
<a href="https://github.com/ocaml/ocaml/pull/9876">minor heap pointer</a>, after which the runtime domains support
has all the necessary prerequisites upstream.  Both of those PRs are highly performance sensitive, so
there is a lot of poring over graphs going on (notwithstanding the irrepressible @stedolan offering <a href="https://github.com/ocaml/ocaml/pull/10039#issuecomment-733912979">a
massive driveby optimisation</a>).
</p>

<p>
<b>Sandmark Benchmarking:</b> The lockfree and Graph500 benchmarks have been added and updated to Sandmark
respectively, and we continue to work on the tooling aspects. Benchmarking tests are also being done on
AMD, ARM and PowerPC hardware to study the performance of the compiler. With reference to stock OCaml,
the safepoints PR has now landed for review.
</p>

<p>
As with previous updates, the Multicore OCaml tasks are listed first, which are then followed by the
progress on the Sandmark benchmarking test suite. Finally, the upstream OCaml related work is mentioned
for your reference.
</p>
</div>

<div id="outline-container-orga5529ad" class="outline-4">
<h4 id="orga5529ad">Multicore OCaml</h4>
<div class="outline-text-4" id="text-orga5529ad">
</div>
<ul class="org-ul">
<li><a id="org357b446"></a>Ongoing<br />
<div class="outline-text-5" id="text-org357b446">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/439">ocaml-multicore/ocaml-multicore#439</a>
Systhread lifecycle work
</p>

<p>
An improvement to the initialization of systhreads for general
resource handling, and freeing up of descriptors and stacks. There
now exists a new hook on domain termination in the runtime.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/issues/440">ocaml-multicore/ocaml-multicore#440</a>
<code>ocamlfind ocamldep</code> hangs in no-effect-syntax branch
</p>

<p>
The <code>nocrypto</code> package fails to build for Multicore OCaml
no-effect-syntax branch, and ocamlfind loops continuously. A minimal
test example has been created to reproduce the issue.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/issues/443">ocaml-multicore/ocaml-multicore#443</a>
Minor heap allocation startup cost
</p>

<p>
An issue to keep track of the ongoing investigations on the impact
of large minor heap size for OCaml Multicore programs. The
sequential and parallel exeuction run results for various minor heap
sizes are provided in the issue.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/446">ocaml-multicore/ocaml-multicore#446</a>
Collect GC stats at the end of minor collection
</p>

<p>
The objective is to remove the use of double buffering in the GC
statistics collection by using the barrier present during minor
collection in the parallel_minor_gc schema. There is not much
slowdown for the benchmark runs, normalized against stock OCaml as
seen in the illustration.
<img src="https://aws1.discourse-cdn.com/standard11/uploads/ocaml/original/2X/7/7ea3f6d4aed319353e711ad8d75acb5093a087ad.png" alt="7ea3f6d4aed319353e711ad8d75acb5093a087ad.png" />
</p></li>
</ul>
</div>
</li>

<li><a id="org24b4097"></a>Completed<br />
<ul class="org-ul">
<li><a id="org24d9d71"></a>Upstream<br />
<div class="outline-text-6" id="text-org24d9d71">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/426">ocaml-multicore/ocaml-multicore#426</a>
Replace global roots implementation
</p>

<p>
This PR replaces the existing global roots implementation with that
of OCaml's <code>globroots</code>, wherein the implementation places locks
around the skip lists. In future, the <code>Caml_root</code> usage will be
removed along with its usage in globroots.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/427">ocaml-multicore/ocaml-multicore#427</a>
Garbage Collector colours change backport
</p>

<p>
The <a href="https://github.com/ocaml/ocaml/pull/9756">Garbage Collector colours
change</a> PR from trunk for
the major collector have now been backported to Multicore
OCaml. This includes the optimization for <code>mark_stack_push</code>, the
<code>mark_entry</code> does not include <code>end</code>, and <code>caml_shrink_mark_stack</code>
has been adapted from trunk.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/432">ocaml-multicore/ocaml-multicore#432</a>
Remove caml_context push/pop on stack switch
</p>

<p>
The motivation to remove the use of <code>caml_context</code> push/pop on stack
switches to make the implementation easier to understand, and to be
closer to upstream OCaml.
</p></li>
</ul>
</div>
</li>

<li><a id="orgca6e9d1"></a>Stack Improvements<br />
<div class="outline-text-6" id="text-orgca6e9d1">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/431">Fix stack overflow on scan stack#431</a>
Fix issue 421: Stack overflow on scan stack
</p>

<p>
The <code>caml_scan_stack</code> now uses a while loop to avoid a stack
overflow corner case where there is a deep nesting of fibers.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/434">ocaml-multicore/ocaml-multicore#434</a>
DWARF fixups for effect stack switching
</p>

<p>
The PR provides fixes for <code>runtime/amd64.S</code> on issues found using a
DWARF validator. The patch also cleans up dead commented out code,
and updates the DWARF information when we do <code>caml_free_stack</code> in
<code>caml_runstack</code>.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/435">ocaml-multicore/ocaml-multicore#435</a>
Mark stack overflow backport
</p>

<p>
The mark-stack overflow implementation has been updated to be closer
to trunk OCaml. The pools are added to a skiplist first to avoid any
duplicates, and the pools in <code>pools_to_rescan</code> are marked later
during a major cycle. The result of the <code>finalise</code> benchmark time
difference with mark stack overflow is shown below:
</p>


<div class="figure">
<p><img src="https://aws1.discourse-cdn.com/standard11/uploads/ocaml/optimized/2X/e/ee388eb5cd9cb9d5bc49f1ec8cc2f205fd350bf0_2_1380x434.png" alt="ee388eb5cd9cb9d5bc49f1ec8cc2f205fd350bf0_2_1380x434.png" />
</p>
</div></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/437">ocaml-multicore/ocaml-multicore#437</a>
Avoid an allocating C call when switching stacks with continue
</p>

<p>
The <code>caml_continuation_use</code> has been updated to use
<code>caml_continuation_use_noexc</code> and it does not throw an
exception. The allocating C <code>caml_c_call</code> is no longer required to
call <code>caml_continuation_use_noexc</code>.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/441">ocaml-multicore/ocaml-multicore#441</a>
Tidy up and more commenting of caml_runstack in amd64.S
</p>

<p>
The PR adds comments on how stacks are switched, and removes
unnecessary instructions in the x86 assembler.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/442">ocaml-multicore/ocaml-multicore#442</a>
Fiber stack cache (v2)
</p>

<p>
Addition of stack caching for fiber stacks, which also fixes up bugs
in the test suite (DEBUG memset, order of initialization). We avoid
indirection out of <code>struct stack_info</code> when managing the stack
cache, and efficiently calculate the cache freelist bucket for a
given stack size.
</p></li>
</ul>
</div>
</li>

<li><a id="org3c4c338"></a>Ecosystem<br />
<div class="outline-text-6" id="text-org3c4c338">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/lockfree/pull/5">ocaml-multicore/lockfree#5</a>
Remove Kcas dependency
</p>

<p>
The <code>Kcas.Wl</code> module is now replaced with the Atomic module
available in Multicore stdlib. The exponential backoff is
implemented with <code>Domain.Sync.cpu_relax</code>.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/domainslib/pull/21">ocaml-multicore/domainslib#21</a>
Point to the new repository URL
</p>

<p>
Thanks to Sora Morimoto (@smorimoto) for providing a patch that
updates the URL to the correct ocaml-multicore repository.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/multicore-opam/pull/40">ocaml-multicore/multicore-opam#40</a>
Add multicore Merlin and dot-merlin-reader
</p>

<p>
A patch to merlin and dot-merlin-reader to work with Multicore OCaml
4.10.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/issues/403">ocaml-multicore/ocaml-multicore#403</a>
Segmentation fault when trying to build Tezos on Multicore
</p>

<p>
The latest fixes on replacing the global roots implementation, and
fixing the STW interrupt race to the no-effect-syntax branch has
resolved the issue.
</p></li>
</ul>
</div>
</li>

<li><a id="org9b69965"></a>Compiler Fixes<br />
<div class="outline-text-6" id="text-org9b69965">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/438">ocaml-multicore/ocaml-multicore#438</a>
Allow C++ to use caml/camlatomic.h
</p>

<p>
The inclusion of extern "C" headers to allow C++ to use
caml/camlatomic.h for building ubpf.0.1.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/447">ocaml-multicore/ocaml-multicore#447</a>
domain_state.h: Remove a warning when using -pedantic
</p>

<p>
A fix that uses <code>CAML_STATIC_ASSERT</code> to check the size of
<code>caml_domain_state</code> in domain_state.h, in order to remove the
warning when using -pedantic.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/449">ocaml-multicore/ocaml-multicore#449</a>
Fix stdatomic.h when used inside C++ for good
</p>

<p>
Update to <code>caml/camlatomic.h</code> with extern C++ declaration to use it
inside C++. This builds upbf.0.1 and libsvm.0.10.0 packages.
</p></li>
</ul>
</div>
</li>

<li><a id="org2fe9a04"></a>Sundries<br />
<div class="outline-text-6" id="text-org2fe9a04">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/422">ocaml-multicore/ocaml-multicore#422</a>
Simplify minor heaps configuration logic and masking
</p>

<p>
A <code>Minor_heap_max</code> size is introduced to reserve the minor heaps
area, and <code>Is_young</code> for relying on a boundary check. The
<code>Minor_heap_max</code> parameter can be overridden using the OCAMLRUNPARAM
environment variable. This implementation approach is geared towards
using Domain local allocation buffers.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/429">ocaml-multicore/ocaml-multicore#429</a>
Fix a STW interrupt race
</p>

<p>
A fix for the STW interrupt race in
<code>caml_try_run_on_all_domains_with_spin_work</code>. The
<code>enter_spin_callback</code> and <code>enter_spin_data</code> fields of <code>stw_request</code>
are now initialized after we interrupt other domains.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/430">ocaml-multicore/ocaml-multicore#430</a>
Add a test to exercise stored continuations and the GC
</p>

<p>
The PR adds test coverage for interactions between the GC with
stored, cloned and dropped continuations to exercise the minor and
major collectors.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/444">ocaml-multicore/ocaml-multicore#444</a>
Merge branch 'parallel_minor_gc' into 'no-effect-syntax'
</p>

<p>
The <code>parallel_minor_gc</code> branch has been merged into the
<code>no-effect-syntax</code> branch, and we will try to keep the
<code>no-effect-syntax</code> branch up-to-date with the latest changes.
</p></li>
</ul>
</div>
</li>
</ul>
</li>
</ul>
</div>

<div id="outline-container-orga8cf96b" class="outline-4">
<h4 id="orga8cf96b">Benchmarking</h4>
<div class="outline-text-4" id="text-orga8cf96b">
</div>
<ul class="org-ul">
<li><a id="org7a03efc"></a>Ongoing<br />
<div class="outline-text-5" id="text-org7a03efc">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/196">ocaml-bench/sandmark#196</a>
Filter benchmarks based on tag
</p>

<p>
An enhancement to move towards a generic implementation to filter
the benchmarks based on tags, instead of relying on custom targets
such as _macro.json or _ci.json.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/191">ocaml-bench/sandmark#191</a>
Make parallel.ipynb notebook interactive
</p>

<p>
The parallel.ipynb notebook has been made interactive with drop-down
menus to select the .bench files for analysis. The notebook README
has been merged with the top-level README file. A sample
4.10.0.orunchrt.bench along with the *pausetimes_multicore.bench
files have been moved to the test artifacts/ folder for user
testing.
</p></li>

<li>We are continuing to test the use of <code>opam-compiler</code> switch
environment to execute the Sandmark benchmark test suite. We have
been able to build the dependencies, <code>orun</code> and <code>rungen</code>, the
<code>OCurrent</code> pipeline and its dependencies, and <code>ocaml-ci</code> for the
ocaml-multicore:no-effect-syntax branch. We hope to converge to a
2.0 implementation with the required OCaml tools and ecosystem.</li>
</ul>
</div>
</li>

<li><a id="orgb0f47eb"></a>Completed<br />
<div class="outline-text-5" id="text-orgb0f47eb">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-bench/sandmark/issues/179">ocaml-bench/sandmark#179</a>
[RFC] Classifying benchmarks based on running time
</p>

<p>
The <a href="https://github.com/ocaml-bench/sandmark/pull/188">Classification of
benchmarks</a> PR has
been resolved, which now classifies the benchmarks based on their
running time:
</p>
<ul class="org-ul">
<li><code>lt_1s</code>: Benchmarks that run for less than 1 second.</li>
<li><code>lt_10s</code>: Benchmarks that run for at least 1 second, but, less than 10 seconds.</li>
<li><code>10s_100s</code>: Benchmarks that run for at least 10 seconds, but, less than 100 seconds.</li>
<li><code>gt_100s</code>: Benchmarks that run for at least 100 seconds.</li>
</ul></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/189">ocaml-bench/sandmark#189</a>
Add environment support for wrapper in JSON configuration file
</p>

<p>
The OCAMLRUNPARAM arguments can now be passed as an environment
variable when executing the benchmarks in runtime. The environment
variables can be specified in the <code>run_config.json</code> file, as shown
below:
</p>

<div class="org-src-container">
<pre class="src src-json">{
   "name": "orun_2M",
   "environment": "OCAMLRUNPARAM='s=2M'",
   "command": "orun -o %{output} -- taskset --cpu-list 5 %{command}"
 }
</pre>
</div></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/183">ocaml-bench/sandmark#183</a>
Use crout_decomposition name for numerical analysis benchmark
</p>

<p>
The <code>numerical-analysis/lu_decomposition.ml</code> benchmark has now been
renamed to <code>crout_decomposition.ml</code> to avoid naming confusion, as
there are a couple of LU decomposition benchmarks in Sandmark.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/190">ocaml-bench/sandmark#190</a>
Bump trunk to 4.13.0
</p>

<p>
The trunk version in Sandmark ocaml-versions/ has now been updated
to use <code>4.13.0+trunk.json</code>.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/192">ocaml-bench/sandmark#192</a>
GraphSEQ corrected
</p>

<p>
The minor fix for the Kronecker generator has been provided for the
Graph500 benchmark.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/194">ocaml-bench/sandmark#194</a>
Lockfree benchmarks
</p>

<p>
The lockfree benchmarks for both the serial and parallel
implementation are now included in Sandmark, and it uses the
<code>lockfree_bench</code> tag. The time and speedup illustrations are as follows:
</p>

<p>
<img src="https://aws1.discourse-cdn.com/standard11/uploads/ocaml/optimized/2X/0/01496cbe634b692538b2863768b4a3ed2e99b68a_2_1380x274.png" alt="01496cbe634b692538b2863768b4a3ed2e99b68a_2_1380x274.png" />
<img src="https://aws1.discourse-cdn.com/standard11/uploads/ocaml/optimized/2X/6/6e26c55539151cc4c3658ebac20e7807d672adce_2_1380x266.png" alt="6e26c55539151cc4c3658ebac20e7807d672adce_2_1380x266.png" />
</p></li>
</ul>
</div>
</li>
</ul>
</div>

<div id="outline-container-orgf80160d" class="outline-4">
<h4 id="orgf80160d">OCaml</h4>
<div class="outline-text-4" id="text-orgf80160d">
</div>
<ul class="org-ul">
<li><a id="orgd491022"></a>Ongoing<br />
<div class="outline-text-5" id="text-orgd491022">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml/ocaml/pull/9876">ocaml/ocaml#9876</a>
Do not cache young_limit in a processor register
</p>

<p>
The removal of <code>young_limit</code> caching in a register is being
evaluated using Sandmark benchmark runs to test the impact change on
for ARM64, PowerPC and RISC-V ports hardware.
</p></li>

<li><p>
<a href="https://github.com/ocaml/ocaml/pull/9934">ocaml/ocaml#9934</a>
Prefetching optimisations for sweeping
</p>

<p>
The PR includes an optimization of <code>sweep_slice</code> for the use of
prefetching, and to reduce cache misses during GC. The normalized
running time graph is as follows:
</p>


<div class="figure">
<p><img src="https://aws1.discourse-cdn.com/standard11/uploads/ocaml/optimized/2X/4/4d3ea2a50b4a40998c23b23a88ff65bbaadafbbf_2_1380x542.png" alt="4d3ea2a50b4a40998c23b23a88ff65bbaadafbbf_2_1380x542.png" />
</p>
</div></li>

<li><p>
<a href="https://github.com/ocaml/ocaml/pull/10039">ocaml/ocaml#10039</a>
Safepoints
</p>

<p>
A draft Safepoints implementation for AMD64 for the 4.11 branch that
are implemented by adding a new <code>Ipoll</code> operation to Mach. The
benchmark results on an AMD Zen2 machine are given below:
</p>


<div class="figure">
<p><img src="https://aws1.discourse-cdn.com/standard11/uploads/ocaml/optimized/2X/6/6953eb519379800fda791d122ba3ee6e99ef0b79_2_714x998.png" alt="6953eb519379800fda791d122ba3ee6e99ef0b79_2_714x998.png" />
</p>
</div></li>
</ul>

<p>
Many thanks to all the OCaml users and developers for their continued support, and contribution to the
project.
</p>
</div>
</li>
</ul>
</div>

<div id="outline-container-org670c2e1" class="outline-4">
<h4 id="org670c2e1">Acronyms</h4>
<div class="outline-text-4" id="text-org670c2e1">
<ul class="org-ul">
<li>ARM: Advanced RISC Machine</li>
<li>DWARF: Debugging With Attributed Record Formats</li>
<li>GC: Garbage Collector</li>
<li>JSON: JavaScript Object Notation</li>
<li>OPAM: OCaml Package Manager</li>
<li>PR: Pull Request</li>
<li>PR: Pull Request</li>
<li>RFC: Request For Comments</li>
<li>RISC-V: Reduced Instruction Set Computing - V</li>
<li>STW: Stop-The-World</li>
<li>URL: Uniform Resource Locator</li>
</ul>
</div>
</div>
</div>
</div>




<div id="outline-container-org5977faa" class="outline-2">
<h2 id="6">Seq vs List, optimization</h2>
<div class="outline-text-2" id="text-6">
<p>
Archive: <a href="https://discuss.ocaml.org/t/seq-vs-list-optimization/6885/25">https://discuss.ocaml.org/t/seq-vs-list-optimization/6885/25</a>
</p>
</div>

<div id="outline-container-org9f3884d" class="outline-3">
<h3 id="org9f3884d">Deep in this thread, Sacha Ayoun asked and Raphaël Proust said</h3>
<div class="outline-text-3" id="text-org9f3884d">
<blockquote>
<p>
But then what’s the point of Seq ?
</p>
</blockquote>

<p>
A bit of a spoiler for an upcoming release of a few of our libraries at Nomadic Labs…
</p>

<p>
We had a bug report: calls to some RPCs exposed by some of our binaries would occasionally cause some
lag. One of the root causes of the issue was JSON serialisation. The original serialisation scheme was
intended for a limited range of uses (especially, small sizes) but then it was used outside of this
intended range and some relatively big values were serialised and pushed down the RPC stack.
</p>

<p>
To circumvent this, we are about to release
</p>
<ul class="org-ul">
<li>a “json lexeme sequence” backend for our serialiser library: <code>construct_seq : 'a encoding -&gt; 'a -&gt; json_lexeme Seq.t</code> where <code>json_lexeme = Jsonm.lexeme = [ `Null | `Bool of bool | … | `As | `Ae | `Os | `Oe ]</code></li>
<li>a json lexeme sequence to string sequence converter.</li>
</ul>

<p>
For this second part, we actually have three different converters intended for slightly different uses.
They have different granularity, they have different allocation profiles, and they make slightly
different assumption most notably about concurrency:
</p>
<ul class="org-ul">
<li><code>string_seq_of_json_lexeme_seq : chunk_size_hint:int -&gt; json_lexeme Seq.t -&gt; string Seq.t</code> which uses one (1) internal buffer of size <code>chunk_size_hint</code>. Consuming one element of the resulting sequence causes several json lexemes to be consumed and printed onto the internal buffer until it is full. When this happens, a snapshot (copy) of the buffer is delivered in the <code>Cons</code> cell. So for chunk-size-hint of, say, 1Ko, the sequence translator uses roughly 1Ko of memory and emits 1Ko chunks of memory that the consumer is responsible for.</li>
<li><code>small_string_seq_of_json_lexeme_seq : json_lexeme Seq.t -&gt; string Seq.t</code> which translates each of the lexeme as a single string. It's a little bit more than a simple <code>Seq.map</code> because it needs to insert separators and escape strings. It mostly returns statically allocated strings so there are no big allocations at all.</li>
<li><code>blit_instructions_seq_of_jsonm_lexeme_seq : buffer: bytes -&gt; json_lexeme Seq.t -&gt; (bytes * int * int) Seq.t</code> which works somewhat similarly to the first one but uses <code>buffer</code> instead of allocating its own. And it returns a seq of <code>(source, offset, length)</code> which are intended to be blitted onto whatever the consumer wants to propagates the data too. This barely allocates at all (it currently does allocate relatively big chunks when escaping strings, but we have planned to improve this in the future. (The sequence returns a source to blit; this source is physically equal to <code>buffer</code> most of the time but not always; specifically, for large strings that are present within the json data, the sequence just points to them as a source.)</li>
</ul>

<p>
Note that the description above is a simplification: there is a bit more to it than that. Also note
that all this is still Work In Progress. Check out
<a href="https://gitlab.com/nomadic-labs/json-data-encoding/-/merge_requests/5">https://gitlab.com/nomadic-labs/json-data-encoding/-/merge_requests/5</a> (the value to json lexeme
sequence code) and <a href="https://gitlab.com/nomadic-labs/data-encoding/-/merge_requests/19">https://gitlab.com/nomadic-labs/data-encoding/-/merge_requests/19</a> (the json lexeme
sequence to string sequence code).
</p>
</div>
</div>
</div>




<div id="outline-container-orgc3684e3" class="outline-2">
<h2 id="7">dap 1.0.0 &#x2013; Debug Adapter Protocol for OCaml</h2>
<div class="outline-text-2" id="text-7">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-dap-1-0-0-debug-adapter-protocol-for-ocaml/6903/1">https://discuss.ocaml.org/t/ann-dap-1-0-0-debug-adapter-protocol-for-ocaml/6903/1</a>
</p>
</div>

<div id="outline-container-org4d25b23" class="outline-3">
<h3 id="org4d25b23">文宇祥 announced</h3>
<div class="outline-text-3" id="text-org4d25b23">
<p>
This is the <a href="https://microsoft.github.io/debug-adapter-protocol/">debug adapter protocol</a> library
extract from <a href="https://github.com/hackwaly/ocamlearlybird">ocamlearlybird</a>. Include types generated from
specification and a DAP prioritized JSON RPC implementation. It's useful to implement debug adapter in
OCaml.
</p>

<p>
Debug adapter protocol
</p>

<ul class="org-ul">
<li>Project page: <a href="https://github.com/hackwaly/ocaml-dap">https://github.com/hackwaly/ocaml-dap</a></li>
<li>Documentation: <a href="https://hackwaly.github.io/ocaml-dap/">https://hackwaly.github.io/ocaml-dap/</a></li>
</ul>
</div>

<div id="outline-container-org8ce99c8" class="outline-4">
<h4 id="org8ce99c8">CHANGES:</h4>
<div class="outline-text-4" id="text-org8ce99c8">
<p>
Initial release.
</p>

<ul class="org-ul">
<li>Specification version is 1.43</li>
</ul>
</div>
</div>
</div>
</div>




<div id="outline-container-orgc93ab9d" class="outline-2">
<h2 id="8">✂️ form2xml - a tiny cli tool to slice http form-data dumps</h2>
<div class="outline-text-2" id="text-8">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-form2xml-a-tiny-cli-tool-to-slice-http-form-data-dumps/6912/1">https://discuss.ocaml.org/t/ann-form2xml-a-tiny-cli-tool-to-slice-http-form-data-dumps/6912/1</a>
</p>
</div>

<div id="outline-container-orga1e1031" class="outline-3">
<h3 id="orga1e1031">😷 Marcus Rohrmoser announced</h3>
<div class="outline-text-3" id="text-orga1e1031">
<p>
when doing static web sites, feedback is an issue. form2xml helps you keep the server stupid, but still
makes form-data feedback possible.
</p>

<p>
Just dump the form posts, rsync and merge them into your client-side, unix pipe, toolchain.
</p>

<p>
form2xml bridges the tooling-gap between http and xml/xslt with utmost primitivity in the making. I
chose simplicity over compliance because form2xml isn't intended to run server-side or unattended. I'm
aware of excellent prior art, but hesitated to add build dependencies for now and rather see if it
proves useful as is.
</p>

<p>
<a href="https://mro.name/form2xml">https://mro.name/form2xml</a>
</p>
</div>
</div>
</div>




<div id="outline-container-org3e59401" class="outline-2">
<h2 id="9">http-multipart-formdata 1.0.1</h2>
<div class="outline-text-2" id="text-9">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-http-multipart-formdata-1-0-1/6917/1">https://discuss.ocaml.org/t/ann-http-multipart-formdata-1-0-1/6917/1</a>
</p>
</div>

<div id="outline-container-orge0e41e2" class="outline-3">
<h3 id="orge0e41e2">Bikal Lem announced</h3>
<div class="outline-text-3" id="text-orge0e41e2">
<p>
I have just released a maintenance release of <code>http-multipart-formadata</code>. This is a maintenace release
to address a reported issue.
</p>

<p>
<a href="https://github.com/lemaetech/http-multipart-formdata/issues/10">#10 Fix equality</a>
</p>
</div>
</div>
</div>




<div id="outline-container-org1a0713c" class="outline-2">
<h2 id="10">Set up OCaml 1.1.4</h2>
<div class="outline-text-2" id="text-10">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-set-up-ocaml-1-1-4/6926/1">https://discuss.ocaml.org/t/ann-set-up-ocaml-1-1-4/6926/1</a>
</p>
</div>

<div id="outline-container-orgb994784" class="outline-3">
<h3 id="orgb994784">Sora Morimoto announced</h3>
<div class="outline-text-3" id="text-orgb994784">
<p>
We have a changelog since this release.
</p>

<p>
By the way, I'm preparing to publish v2 of setup-ocaml. It has a cache feature that is entirely
independent of GitHub, so you don't have to worry about cache limit per repository, and you don't have
to spend nearly 10 minutes on setup.
</p>

<p>
<a href="https://github.com/avsm/setup-ocaml/blob/master/CHANGELOG.md">https://github.com/avsm/setup-ocaml/blob/master/CHANGELOG.md</a>
</p>

<p>
<a href="https://github.com/avsm/setup-ocaml/releases/tag/v1.1.4">https://github.com/avsm/setup-ocaml/releases/tag/v1.1.4</a>
</p>
</div>
</div>
</div>




<div id="outline-container-orgf4c310d" class="outline-2">
<h2 id="11">First Public Release (beta) of the Memthol memory profiling visualizer</h2>
<div class="outline-text-2" id="text-11">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-first-public-release-beta-of-the-memthol-memory-profiling-visualizer/6927/1">https://discuss.ocaml.org/t/ann-first-public-release-beta-of-the-memthol-memory-profiling-visualizer/6927/1</a>
</p>
</div>

<div id="outline-container-orga59fd32" class="outline-3">
<h3 id="orga59fd32">OCamlPro announced</h3>
<div class="outline-text-3" id="text-orga59fd32">
<p>
We are happy to announce the first public release of Memthol, a visualizer and analyzer for memory
profiling data generated from OCaml programs, thanks to the work of Adrien Champion and Vincent
Laviron.
</p>

<p>
<b>Memthol</b> is a visualizer and analyzer for program profiling. It works on memory <b>dumps</b> containing
information about the size and (de)allocation date of part of the allocations performed by some
execution of a program. For information regarding building memthol, features, browser compatibility&#x2026;
refer to the <a href="https://github.com/OCamlPro/memthol">memthol github repository</a>.
<b>Please note that Memthol, as a side project, is a work in progress that remains in beta status for
now.</b>
</p>
</div>

<div id="outline-container-org065fdb8" class="outline-4">
<h4 id="org065fdb8">Memthol's background</h4>
<div class="outline-text-4" id="text-org065fdb8">
<p>
The Memthol work was started more than a year ago (we had published a short introductory paper at the
<a href="http://jfla.inria.fr/jfla2020.html">JFLA2020</a>). The whole idea was to use the previous work originally
achieved on <a href="https://memprof.typerex.org/">ocp-memprof</a>, and look for some extra funding to achieve a
usable and industrial version. Then came the excellent <a href="https://blog.janestreet.com/finding-memory-leaks-with-memtrace/">memtrace
profiler</a> by Jane Street's team.
</p>

<p>
The memtrace format is nicely designed and polished enough to be considered a future standard for other
tools. This is why Memthol supports Jane Street's <b>dumper</b> format, instead of our own dumper library's.
</p>

<p>
Memthol is a self-funded side project, that we think is worth giving to the OCaml community. Its
approach is valuable, and can be complementary. It is released under the free GPL licence v3.
</p>

<p>
We welcome any extra funding to achieve a usable and industrial version!
</p>
</div>
</div>

<div id="outline-container-org638d390" class="outline-4">
<h4 id="org638d390"><a href="https://github.com/OCamlPro/memthol">Memthol's features</a>:</h4>
<div class="outline-text-4" id="text-org638d390">
<ul class="org-ul">
<li>multi-client: open several tabs in your browser for the same profiling session to visualize the data separately</li>
<li>self-contained: the BUI packs all its static assets, once you have the binary you do not need anything else (except a browser)</li>
<li>data-splitting: plot several families of data separately in the same chart by separating them based on size, allocation lifetime, source locations in the allocation callstack, etc.</li>
</ul>

<p>
Issues are welcome. As Memthol is mostly tested on the Chrome web browser, you might experience
problems with other browsers. Do not hesitate open issues.
</p>

<p>
We have designed a mini-tutorial on Memthol available on our github repository and our blogpost, which
you can find by following this link :
<a href="https://www.ocamlpro.com/2020/12/01/memthol-exploring-program-profiling/">https://www.ocamlpro.com/2020/12/01/memthol-exploring-program-profiling/</a>
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-orgd192e65" class="outline-2">
<h2 id="12">Exception vs Result</h2>
<div class="outline-text-2" id="text-12">
<p>
Archive: <a href="https://discuss.ocaml.org/t/exception-vs-result/6931/1">https://discuss.ocaml.org/t/exception-vs-result/6931/1</a>
</p>
</div>

<div id="outline-container-org39921a7" class="outline-3">
<h3 id="org39921a7">Chas Emerick discussed</h3>
<div class="outline-text-3" id="text-org39921a7">
<p>
Last week, @BikalGurung blogged <a href="https://lemaetech.co.uk/articles/exceptions.html">On Effectiveness of Exceptions in
OCaml</a>, in part as a follow-up to <a href="https://discuss.ocaml.org/t/ann-reparse-2-0-0/6868">his announcement
of his parser combinator library</a>
<a href="https://github.com/lemaetech/reparse/">reparse</a>, which eschews <code>Result</code>-based error handling in favor
of exceptions. I've long preferred using <code>Result</code> (and its equivalents in other languages), and my
experience so far with OCaml is that that preference is shared by many in the community and by authors
of key libraries, but I was happy to consider a new counterpoint.
</p>

<p>
Doing so prompted me to consider my rationale(s) more than I had previously, and do some additional
reading and research, all of which ended up further cementing my pro-<code>Result</code> bias. What follows are
counterpoints to Bikal's two most consequential arguments (in my opinion), and some elaboration beyond.
Many thanks to Bikal for his posting his experience report!
</p>
</div>

<div id="outline-container-org54176b3" class="outline-4">
<h4 id="org54176b3">Stacktrace / Location Information</h4>
<div class="outline-text-4" id="text-org54176b3">
<p>
First, Bikal focuses in on how useful error handling should "allow us to efficiently, correctly and
accurately identify the source of our errors". I agree, but he compares exceptions and <code>result</code> on this
basis like so:
</p>

<blockquote>
<p>
OCaml exception back traces - or call/stack traces - is one such tool which I have found very
helpful. It gives the offending file and the line number in it. This make investigating and zeroing
in on the error efficient and productive.
</p>

<p>
Using result type means you lose this valuable utility that is in-built to the ocaml language and the
compiler.
</p>
</blockquote>

<p>
It is true that <code>Error</code> does not <span class="underline">implicitly</span> carry backtraces as exceptions do, but there is nothing
preventing one from choosing to include a backtrace with a returned error, since OCaml backtraces
helpfully exist separate from its exception facility:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">b</span> <span style="color: #a0522d;">x</span> =
  <span style="color: #a020f0;">if</span> x &gt; 0
  <span style="color: #a020f0;">then</span> <span style="color: #000000; background-color: #ffffff;">Ok</span> 0
  <span style="color: #a020f0;">else</span> <span style="color: #000000; background-color: #ffffff;">Error</span> (<span style="color: #8b2252;">"unimplemented"</span>, <span style="color: #228b22;">Printexc.</span>get_callstack 10)

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">a</span> <span style="color: #a0522d;">x</span> = b x

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">_</span> = <span style="color: #a020f0;">match</span> a (int_of_string <span style="color: #a52a2a;">@@</span> <span style="color: #228b22;">Sys.</span>argv.(1)) <span style="color: #a020f0;">with</span>
          | <span style="color: #000000; background-color: #ffffff;">Ok</span> v -&gt; <span style="color: #228b22;">Format.</span>printf <span style="color: #8b2252;">"%d@."</span> v
          | <span style="color: #000000; background-color: #ffffff;">Error</span> (msg, stack) -&gt;
            <span style="color: #228b22;">Format.</span>fprintf <span style="color: #228b22;">Format.</span>err_formatter <span style="color: #8b2252;">"Error: %s@."</span> msg;
            <span style="color: #228b22;">Printexc.</span>print_raw_backtrace stderr stack
</pre>
</div>

<pre class="example">
$ ocamlc -g -o demo.exe src/demo.ml
$ ./demo.exe -1
Error: unimplemented
Raised by primitive operation at file "src/demo.ml", line 5, characters 31-56
Called from file "src/demo.ml", line 9, characters 14-47
</pre>

<p>
From a strictly ergonomic standpoint, it makes sense to wish that e.g. the <code>Error</code> constructor were
treated specially such that values it produced always carried a stack trace (as exceptions do/are), so
that programmers would not need to opt into it as above. However, that would not come without costs,
including a maybe-significant runtime penalty that might render <code>Result</code> a less useful way to <span class="underline">cheaply</span>
signal recoverable error conditions (something that other exception-dominant languages/runtimes
struggle to do given that stacktrace generation is far from free).
</p>
</div>
</div>

<div id="outline-container-org7b2dacf" class="outline-4">
<h4 id="org7b2dacf">Correctness</h4>
<div class="outline-text-4" id="text-org7b2dacf">
<p>
Bikal's final topic was re: correctness, and to what extent using one or another error-handling
mechanism tangibly affects his work. What he says is short enough to reproduce in full:
</p>

<blockquote>
<p>
I thought this would be the biggest advantage of using <code>result</code> type and a net benefit. However, my
experience of <b>NOT</b> using it didn't result in any noticeable reduction of <b>correct by construction</b>
OCaml software. Conversely, I didn't notice any noticeable improvement on this metric when <b>using</b>
it. What I have noticed over time is that abstraction/encapsulation mechanisms and type system in
particular play by far the most significant role in creating <b>correct by construction</b> OCaml
software.
</p>
</blockquote>

<p>
There's a lot left undefined here: what "correct by construction" might mean generally, what it means
in the context of OCaml software development, how it could be measured (_is_ there a metric, or are we
just reckoning here?), and so on.
</p>

<p>
While reminding myself of exactly what "correct by construction" meant, I came across a fantastic
lecture by Martyn Thomas[1] that neatly defines it (and goes into some detail of how to go about
achieving it); from the accompanying lecture notes[2]:
</p>

<blockquote>
<p>
…you start by writing a requirements specification in a way that makes it possible to analyse whether
it contains logical omissions or contradictions. Then you develop the software in a way that provides
very strong evidence that the program implements the specification (and does nothing else) and that
it will not fail at runtime. We call this making software “correct by construction”, because the way
in which the software is constructed guarantees that it has these properties.
</p>
</blockquote>

<p>
While we aren't working with anything as formal as a theorem prover when we are programming in OCaml,
it does provide us with a tremendous degree of certainty about how our programs will behave. One of the
greatest sources of that certainty is its default of requiring functions and pattern matches to be
exhaustive with regard to the domain of values of the type(s) they accept; i.e. a function that accepts
a <code>result</code> must provide cases for all of its known constructors:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">get</span> = <span style="color: #a020f0;">function</span> <span style="color: #000000; background-color: #ffffff;">Ok</span> v -&gt; v
</pre>
</div>
<pre class="example">
$ ocamlc -g -o demo.exe src/demo.ml
File "src/demo.ml", line 15, characters 10-28:
15 | let get = function Ok v -&gt; v
               ^^^^^^^^^^^^^^^^^^
Warning 8: this pattern-matching is not exhaustive.
Here is an example of a case that is not matched:
Error _
</pre>

<p>
This one way we "provide evidence" to the OCaml compiler that our code does not not contain "logical
omissions", to use Prof. Thomas' nomenclature.
</p>

<p>
There are ways to relax this requirement, though. Aside from simply telling the compiler to not bother
us with its concerns via an attribute:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">get</span> = <span style="color: #a020f0;">function</span> <span style="color: #000000; background-color: #ffffff;">Ok</span> v -&gt; v <span style="color: #483d8b;">[@@warning </span><span style="color: #8b2252;">"-8"</span><span style="color: #483d8b;">]</span>
</pre>
</div>

<p>
…we could simply use exceptions instead. For example, an exception-based variant of the program I
started with earlier:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #a020f0;">exception</span> <span style="color: #000000; background-color: #ffffff;">Unimplemented</span>

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">a</span> <span style="color: #a0522d;">x</span> =
  <span style="color: #a020f0;">if</span> x &gt; 0
  <span style="color: #a020f0;">then</span> 0
  <span style="color: #a020f0;">else</span> <span style="color: #483d8b;">raise</span> <span style="color: #000000; background-color: #ffffff;">Unimplemented</span>

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">_</span> = <span style="color: #228b22;">Format.</span>printf <span style="color: #8b2252;">"%d@."</span> <span style="color: #a52a2a;">@@</span> a (int_of_string <span style="color: #a52a2a;">@@</span> <span style="color: #228b22;">Sys.</span>argv.(1))
</pre>
</div>

<p>
This approach is less correct by any measure: the <code>Unimplemented</code> exception is not indicated in the
signature of <code>a</code>, making it easy to call <code>a</code> without handling the exception, or being aware of its
possibility at all. Insofar as the exceptions in question are not intended to be fatal,
program-terminating errors, this approach absolutely increases the potential for "logical omissions",
increases the potential for programs to fail at runtime, and hobbles the exhaustivity guarantees that
the OCaml compiler provides for us otherwise.
</p>

<p>
Later in the reparse announcement thread, @rixed said (presumably in response to this tension):
</p>

<blockquote>
<p>
If only we had a way to know statically which exceptions can escape any functions that would be the
best of both worlds!
</p>
</blockquote>

<p>
And indeed, this approach of incorporating known thrown exception types into function signatures is a
known technique, (in)famously included in Java from the beginning (called <b>checked exceptions</b>), but
widely disdained. I suspect that disdain was more due to Java's other weaknesses in exception handling
than the principal notion of propagating exception types in function/method signatures. It would be
interesting to see something like checked exceptions experimented with in OCaml, though it may be that
doing so would nullify one of the primary benefits that those preferring exceptions enjoy (perceived
improved aesthetics/clarity), and/or the work needed to achieve this might approximate the typed effect
handling approaches that @lpw25 et al. have been pursuing for some time.
</p>

<p>
[1]: <b>Making Software 'Correct by Construction'</b>
<a href="https://www.gresham.ac.uk/lectures-and-events/making-software-correct-by-construction">https://www.gresham.ac.uk/lectures-and-events/making-software-correct-by-construction</a> <br />
[2]: <a href="https://www.gresham.ac.uk/lecture/transcript/download/making-software-correct-by-construction/">https://www.gresham.ac.uk/lecture/transcript/download/making-software-correct-by-construction/</a>
</p>
</div>
</div>
</div>


<div id="outline-container-org5511f23" class="outline-3">
<h3 id="org5511f23">bnguyenvanyen said</h3>
<div class="outline-text-3" id="text-org5511f23">
<p>
Just chiming in to note that there has been an interesting discussion on this topic two years ago:
<a href="https://discuss.ocaml.org/t/specific-reason-for-not-embracing-the-use-of-exceptions-for-error-propagation/1666/40">https://discuss.ocaml.org/t/specific-reason-for-not-embracing-the-use-of-exceptions-for-error-propagation/1666/40</a>
</p>

<p>
It's also interesting to note that that discussion also ended up talking about typed effects.
As I understand it, they would indeed subsume checked exceptions, and I'm quite excited about them.
</p>
</div>
</div>


<div id="outline-container-org36883ce" class="outline-3">
<h3 id="org36883ce">Yawar Amin also said</h3>
<div class="outline-text-3" id="text-org36883ce">
<p>
Cristiano Calcagno has been doing some pretty interesting work on this:
<a href="https://github.com/reason-association/reanalyze/blob/72712393459d7e132c78e0700abffc5fc4cd09b8/EXCEPTION.md">https://github.com/reason-association/reanalyze/blob/72712393459d7e132c78e0700abffc5fc4cd09b8/EXCEPTION.md</a>
</p>

<p>
Let me quote the central concept from there:
</p>

<blockquote>
<p>
The exception analysis is designed to keep track statically of the exceptions that might be raised at
runtime. It works by issuing warnings and recognizing annotations. Warnings are issued whenever an
exception is raised and not immediately caught. Annotations are used to push warnings from he local
point where the exception is raised, to the outside context: callers of the current function. Nested
functions need to be annotated separately.
</p>
</blockquote>
</div>
</div>


<div id="outline-container-orgad1703b" class="outline-3">
<h3 id="orgad1703b">Later in the thread, Chet Murthy said</h3>
<div class="outline-text-3" id="text-orgad1703b">
<p>
I'm going to address the general issue of "programming with monads", and not specifically the result
monad, b/c I think it's just an instance of the general phenomenon.
</p>

<p>
TL;DR In 1992, when someone told me about "programming with monads", I replied that I <b>already</b>
programmed with monads: I used the "SML Monad".  And this LtU post seems to me to be pithily succinct (<a href="http://lambda-the-ultimate.org/node/5504">http://lambda-the-ultimate.org/node/5504</a> )
</p>

<p>
(1) when we talk about program correctness, we mean two things: reasoning about programs, and
type-safety.  I'll address each in turn below.
</p>

<p>
(2) All monadic transformations of which I am aware (exceptions, state, control, I/O) are direct
equivalents to the "standard semantics" for such language-features, e.g. as described in Michael J.C.
Gordon's book <i>The Denotational Description of Programming Languages</i>.  <b>Programming with monads is
programming with some combinators and macros, on the right-hand-side of the denotational interpreters</b>
in that book.
</p>

<p>
(3) "reasoning about programs" has historically meant "equational reasoning", and IIUC,
Felleisen&amp;Sabry's work (and follow-on works) proved pretty conclusively that anything you can prove
about the right-hand-side of the denotational semantics interpeter defiition, you can "pull back" to
equational reasoning with extra rules, on the left-hand-side of the DS interpreter.
</p>

<p>
(4) "type safety":
</p>

<blockquote>
<p>
If only we had a way to know statically which exceptions can escape any functions
</p>
</blockquote>

<p>
There was a cottage industry of "effect type systems" to capture/reason-about exceptions, state, maybe
other things, decades ago.  They were judged too cumbersome for programmers to use, and hence died-out.
&gt;10yr ago there was a caml-light (OCaml?) variant that checked exceptions in function-types; it didn't
catch on.  Look at Java, where some exceptions are "checked" and others are not: some exceptions, it's
just too cumbersome to track in the type system.  And so either your "result" monad only captures some
of the exceptions, or it's going to be wildly cumbersome.
</p>

<p>
(5) Monads are less-efficient than direct-style, memory-wise.  For me, the moment in 1992 when I (an
avowed SML/NJ bigot) became convinced of the superiority of caml-light (notwithstanding 2.5x slower on
average) was when I realized that it was -so- much less memory-intensive.  Because it didn't allocate
stack-frames on the heap, and closures started out on the stack and only moved to the heap on-demand.
Henry Baker made the observation &gt;20yr ago that the stack is a form of nursery.  Writing in monadic
style is sacrificing this obviously performance advantage.  In the era of multicore, arguments made
back then about memory, can be recast as arguments about the cache today, since (as hardware designers
put it) "memory is at infinity" today.
</p>

<p>
P.S. And yet, I use monads sometimes, too.  Rarely.  But for instance, it's a good model for (e.g.)
writing a type-checker that wants to type-check a list of expressions (no unification, hence no
side-effects) and not stop at the firs type-error, but rather gather together errors from all the
expressions in the list, and produce an error with all of them combined.  So the type-checker at the
top of each member of the list catches any raised exception, stores it in an accumulator, and goes on
to the rest of the list; at the end of the list, if the accumulator is empty, it returns the list of
result-types; otherwise it raises an exception containing list of errors stored in the accumulator.
</p>

<p>
It's rare, and if the Result monad didn't exist, I'd hack something together, but &#x2026;. it's literally
the only use I can think of, that wasn't driven by a library (e.g. <code>bos</code>) using the Result monad itself
(and my needing to use that library).
</p>

<p>
And this <b>efficiency</b> is the real reason that exception-based backtraces are better: IIUC, OCaml
exceptions are <b>really</b> cheap because they don't materialize that backtrace until demanded.  It means
that you have to be careful what code you put between the "try-with" and the demand for the backtrace,
but it's <b>efficient</b>.  Materializing the backtrace for every exception raised would be &#x2026;.. pretty
horrendously inefficient, and yet that's what you have to do if you use the result monad.
</p>
</div>
</div>


<div id="outline-container-orgf179027" class="outline-3">
<h3 id="orgf179027">Malcolm also said</h3>
<div class="outline-text-3" id="text-orgf179027">
<p>
I wrote two blog posts on my experience using <code>result</code> awhile ago, linked below.  Much of it still
holds.  Many of the pain points others have mentioned do exist, but in my judgement, <b>given the current
state of Ocaml</b>, results are strictly better (at the very least at the API boundary, assuming you can
convince yourself no exceptions escape it) than exceptions.  I also believe that the reasonable error
values are necessary.  For example, I know some APIs like some variation of <code>('a, string) result</code>
which, IMO, is not a great API as I end up comparing strings and hoping the string value is actually
part of the API and not some rando value tossed in there.  Double for when meaningful aspects of the
error are encoded in the string and I have to decode it to decide what to do.
</p>

<p>
For my own things I do require that all errors are convertible to a string so I can just show them to
the user, this is especially important for development and debugging, IME.  This is one of the few
places where I do wish we had something like type classes so I could do something like:
</p>

<div class="org-src-container">
<pre class="src src-ocaml">foo ()
&gt;&gt;= <span style="color: #a020f0;">function</span>
| <span style="color: #000000; background-color: #ffffff;">Ok</span> () -&gt; yadda
| <span style="color: #000000; background-color: #ffffff;">Error</span> err -&gt; show err
</pre>
</div>

<p>
YMMV
</p>

<p>
<a href="http://functional-orbitz.blogspot.com/2013/01/experiences-using-resultt-vs-exceptions.html">http://functional-orbitz.blogspot.com/2013/01/experiences-using-resultt-vs-exceptions.html</a>
</p>

<p>
<a href="http://functional-orbitz.blogspot.com/2013/01/introduction-to-resultt-vs-exceptions.html">http://functional-orbitz.blogspot.com/2013/01/introduction-to-resultt-vs-exceptions.html</a>
</p>
</div>
</div>
</div>




<div id="outline-container-org815fc3f" class="outline-2">
<h2 id="13">Making web calls to OCaml</h2>
<div class="outline-text-2" id="text-13">
<p>
Archive: <a href="https://discuss.ocaml.org/t/making-web-calls-to-ocaml/6932/1">https://discuss.ocaml.org/t/making-web-calls-to-ocaml/6932/1</a>
</p>
</div>

<div id="outline-container-orgda4f381" class="outline-3">
<h3 id="orgda4f381">Peter Fishman asked</h3>
<div class="outline-text-3" id="text-orgda4f381">
<p>
Hi, I am new to OCaml and in fact, I'm not a even a programmer (although I did study CS at Cornell back
in the 80's and learned functional programming in a language called scheme.)  I am thinking about
developing financial wellness web applications with the underlying computations in OCaml, but with the
user interface in something else - like java script.  How would a java script website make a call to an
Ocaml program (or function)?  Or put another way, can I publish a financial model built in OCaml so
that a web (or mobile) application could call it - passing arguments to the function and receiving back
the result of evaluating the functional expression?    My apologies if this is not asked correctly or
if it is a very basic question, but I am not sure I have the right terminology to ask the question
properly!  Help is appreciated!
</p>
</div>
</div>


<div id="outline-container-org1fa02c5" class="outline-3">
<h3 id="org1fa02c5">Wojtek Czekalski replied</h3>
<div class="outline-text-3" id="text-org1fa02c5">
<p>
You can, there are multiple ways to achieve what you want. If I understand correctly you want to build
a web server in OCaml and a web app front end. Here's a list of what different projects used:
<a href="https://discuss.ocaml.org/t/your-production-web-stack-in-2020/6691/11">https://discuss.ocaml.org/t/your-production-web-stack-in-2020/6691/11</a>
</p>

<p>
Edit: To elaborate because I realized I didn't answer your question, typically you'd have a frontend
which uses something like <a href="https://en.wikipedia.org/wiki/Representational_state_transfer">rest</a> or
<a href="https://en.wikipedia.org/wiki/GraphQL">graphql</a> to fetch data from your server. There's a lot to
unpack here. I'm sure you'll be able to pull it off but if you're not comfortable with programming make
sure that you approach the problem gradually and make sure to avoid analysis paralysis.
</p>
</div>
</div>


<div id="outline-container-org9f31e80" class="outline-3">
<h3 id="org9f31e80">Yawar Amin also replied</h3>
<div class="outline-text-3" id="text-org9f31e80">
<p>
Hi, a couple of thoughts here. As @wokalski said, you will need to set up a server application, and a
web frontend. I don't know much about your background but, my guess is you would like to avoid
complexity and keep things simple. Personally here's what I would recommend:
</p>

<ol class="org-ol">
<li><p>
Write a simple command-line application, in the style of a <a href="https://en.wikipedia.org/wiki/Filter_(software)#Unix">Unix filter</a>, in OCaml that takes 'requests' in the form of plain text on standard input and prints its calculation result to standard output. E.g., to take an input of <code>add 2 2</code> and output <code>4</code>, it could work like this:
</p>

<pre class="example">
$ echo 'add 2 2' | my_calculator.exe
4
</pre></li>

<li>Next, use <a href="https://github.com/joewalnes/websocketd">websocketd</a> to wrap your calculator tool and serve it over WebSocket, which is a standard Web technology that allows clients to continuously talk to servers (2-way communication). So, clients could send a plain text command like <code>add 2 2</code> (note, exactly the same as you would have on the command line), and get back a response <code>4</code>.</li>

<li>Finally, write a web application (just some HTML and JavaScript) that connects to the WebSocket server from step (2) and sends and receives messages. Here is an example of that: <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_client_applications">https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_client_applications</a></li>
</ol>

<p>
The reason I am recommending this strategy, is to let you start small and simple, and skip over much of
the complexity of dealing with modern web application development. You can focus on writing your
calculator as a simple command-line tool, and 'outsource' the server part to a specialized tool.
</p>

<p>
Final thought: if you are working on a financial wellness tool, you almost certainly need decimal
arithmetic (as opposed to binary arithmetic from OCaml's built-in float type). You will want to use a
decimal package like <a href="https://github.com/janestreet/bigdecimal">https://github.com/janestreet/bigdecimal</a> , or (disclaimer: mine)
<a href="https://opam.ocaml.org/packages/decimal/">https://opam.ocaml.org/packages/decimal/</a> .
</p>

<p>
Good luck!
</p>
</div>
</div>


<div id="outline-container-org432e2a2" class="outline-3">
<h3 id="org432e2a2">😷 Marcus Rohrmoser also replied</h3>
<div class="outline-text-3" id="text-org432e2a2">
<p>
@peter  I think I'm doing something similar – a simple web tool for geographic calculations from
character sequences called geohash to gps coordinate pairs and vice versa. Here is it:
<a href="https://demo.mro.name/geohash.cgi/u154">https://demo.mro.name/geohash.cgi/u154</a>. You'll find the source there, too.
</p>

<p>
Key is, I scale towards n=1, need no state.
</p>

<p>
The backend is &lt;200 LOC to handle all the http stuff (there isn't much, no auth, no state, no cookies)
and another ~100 LOC for the actual computation.
</p>

<p>
1 dependency, no 'modern' web toolkit, no client libs/frameworks, no concurrency
</p>
</div>
</div>
</div>




<div id="outline-container-orge0d9ad3" class="outline-2">
<h2 id="14">wasmtime 0.0.1: lightweight WebAssembly runtime</h2>
<div class="outline-text-2" id="text-14">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-wasmtime-0-0-1-lightweight-webassembly-runtime/6936/1">https://discuss.ocaml.org/t/ann-wasmtime-0-0-1-lightweight-webassembly-runtime/6936/1</a>
</p>
</div>

<div id="outline-container-orgc04fd2a" class="outline-3">
<h3 id="orgc04fd2a">Laurent Mazare announced</h3>
<div class="outline-text-3" id="text-orgc04fd2a">
<p>
We just released a first version of a package providing OCaml bindings to the
<a href="https://wasmtime.dev">wasmtime</a> WebAssembly runtime. The package is available on opam and can be found
in this <a href="https://github.com/LaurentMazare/ocaml-wasmtime">GitHub repo</a>. It can be used to run .wasm
modules in an OCaml process, including modules making system calls through <a href="https://wasi.dev/">WASI</a>.
For now, the package only provides a low-level api closely matching the Rust implementation. We intend
to provide a higher level api on top of this.
The GitHub repo contains various examples in the <code>tests</code> directory which reproduce some examples from
the main wasmtime repo.
Feedback/issue reports are very welcome!
</p>
</div>
</div>
</div>




<div id="outline-container-orge0981aa" class="outline-2">
<h2 id="15">First release of Lwt-exit</h2>
<div class="outline-text-2" id="text-15">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-first-release-of-lwt-exit/6938/1">https://discuss.ocaml.org/t/ann-first-release-of-lwt-exit/6938/1</a>
</p>
</div>

<div id="outline-container-org6579f97" class="outline-3">
<h3 id="org6579f97">Raphaël Proust announced</h3>
<div class="outline-text-3" id="text-org6579f97">
<p>
On behalf of <a href="https://nomadic-labs.com/">Nomadic Labs</a>, I'm happy to announce the first release of
Lwt-exit, a small opinionated library to cleanly handle exits and signals in applications that use Lwt.
</p>

<p>
The library is available through opam: <code>opam install lwt-exit</code>,
hosted on gitlab: <a href="https://gitlab.com/nomadic-labs/lwt-exit">https://gitlab.com/nomadic-labs/lwt-exit</a>,
distributed under the MIT license: <a href="https://gitlab.com/nomadic-labs/lwt-exit/-/blob/master/LICENSE">https://gitlab.com/nomadic-labs/lwt-exit/-/blob/master/LICENSE</a>
and the documentation is available online: <a href="https://nomadic-labs.gitlab.io/lwt-exit/">https://nomadic-labs.gitlab.io/lwt-exit/</a>
</p>

<p>
This library is used in the <a href="https://gitlab.com/tezos/tezos">Tezos codebase</a> to clean up system
resources (flush buffered writes, cleanly close p2p connections, etc.) during exits. It is also used to
attach signal handlers (both for interactive use via Ctrl+C and for daemonisation via systemctl).
</p>
</div>
</div>
</div>




<div id="outline-container-org27184e8" class="outline-2">
<h2 id="org27184e8">Old CWN</h2>
<div class="outline-text-2" id="text-org27184e8">
<p>
If you happen to miss a CWN, you can <a href="mailto:alan.schmitt@polytechnique.org">send me a message</a> and I'll mail it to you, or go take a look at <a href="http://alan.petitepomme.net/cwn/">the archive</a> or the <a href="http://alan.petitepomme.net/cwn/cwn.rss">RSS feed of the archives</a>.
</p>

<p>
If you also wish to receive it every week by mail, you may subscribe <a href="http://lists.idyll.org/listinfo/caml-news-weekly/">online</a>.
</p>

<div class="authorname">
<p>
<a href="http://alan.petitepomme.net/">Alan Schmitt</a>
</p>

</div>
</div>
</div>
</div>
</body>
</html>
