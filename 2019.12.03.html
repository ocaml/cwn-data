<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2019-12-03 Tue 16:40 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OCaml Weekly News</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<style type="text/css">#table-of-contents h2 { display: none } .title { display: none } .authorname { text-align: right }</style>
<style type="text/css">.outline-2 {border-top: 1px solid black;}</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">OCaml Weekly News</h1>
<p>
<a href="http://alan.petitepomme.net/cwn/2019.11.26.html">Previous Week</a> <a href="http://alan.petitepomme.net/cwn/index.html">Up</a> <a href="http://alan.petitepomme.net/cwn/2019.12.10.html">Next Week</a>
</p>

<p>
Hello
</p>

<p>
Here is the latest OCaml Weekly News, for the week of November 26 to December 03, 2019.
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#1">Irmin 2.0.0 release</a></li>
<li><a href="#2">How viable is delivering binaries linked to Cygwin to Windows customers?</a></li>
<li><a href="#3">Dune 2.0.0</a></li>
<li><a href="#4">Advanced C binding using ocaml-ctypes and dune</a></li>
<li><a href="#5">Upcoming breaking change in Base/Core v0.14</a></li>
<li><a href="#6">CI/CD Pipelines: Monad, Arrow or Dart?</a></li>
<li><a href="#7">Use of functors to approximate F# statically resolved type parameters</a></li>
<li><a href="#org80001a9">Old CWN</a></li>
</ul>
</div>
</div>


<div id="outline-container-org630eaff" class="outline-2">
<h2 id="1">Irmin 2.0.0 release</h2>
<div class="outline-text-2" id="text-1">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-irmin-2-0-0-release/4746/5">https://discuss.ocaml.org/t/ann-irmin-2-0-0-release/4746/5</a>
</p>
</div>

<div id="outline-container-org4c8ded8" class="outline-3">
<h3 id="org4c8ded8">Continuing this thread, samoht announced</h3>
<div class="outline-text-3" id="text-org4c8ded8">
<p>
And there is now a follow-up blog post, explaining how to use the new GraphQL API available in Irmin2: <a href="https://tarides.com/blog/2019-11-27-introducing-irmin-graphql">https://tarides.com/blog/2019-11-27-introducing-irmin-graphql</a>.
</p>
</div>
</div>
</div>




<div id="outline-container-org4869b24" class="outline-2">
<h2 id="2">How viable is delivering binaries linked to Cygwin to Windows customers?</h2>
<div class="outline-text-2" id="text-2">
<p>
Archive: <a href="https://discuss.ocaml.org/t/how-viable-is-delivering-binaries-linked-to-cygwin-to-windows-customers/4775">https://discuss.ocaml.org/t/how-viable-is-delivering-binaries-linked-to-cygwin-to-windows-customers/4775</a>
</p>
</div>

<div id="outline-container-org87b1ac8" class="outline-3">
<h3 id="org87b1ac8">mbacarella asked</h3>
<div class="outline-text-3" id="text-org87b1ac8">
<p>
I’m in the early stages of planning a deliverable binary product that will run on Linux, Mac and Windows.
</p>

<p>
My brief sniff of the air around the OCaml ecosystem says I should expect to target Cygwin to get Windows going (although there’s impressive work to get native Windows stuff done that can become the preferred approach in a few years).
</p>

<p>
My experience using Cygwin as an operating environment is that it’s pretty darn sluggish compared to Linux on the same computer.
</p>

<p>
Why is this? There’s an anecdote that says Cygwin can only fork at about 30-50x a second on Windows, due to how it has to adapt it to work within Windows’ task spawning model. (For contrast, Linux can achieve thousands of forks per second if you play around with it).
</p>

<p>
I understand from another product developer that when they build binaries to deliver to Windows/Cygwin, they actually cross-compile on Linux because of how slowly the toolchain runs on Cygwin.
</p>

<p>
That sounds like bad news if you want to do UNIXy things, but for a single standalone application this might not be so bad? I assume if I ship a deliverable to Windows/Cygwin, the end user may enjoy good performance, so long as I’m not spawning tons of processes or relying on fork for multi-programming. Is this a safe assumptions?
</p>

<p>
Any other gotchas when it comes to OCaml on Cygwin w.r.t. performance?
</p>

<p>
The app pretty much has real-time gaming requirements (though it’s not a game so can side-step worrying about access to GPUs and what-not). Stated another way, although my application will depend on the POSIX layer offered by Cygwin, I expect it not to crunch POSIX related stuff in the main loop.
</p>

<p>
How has your experience gone?
</p>
</div>
</div>


<div id="outline-container-org501e11d" class="outline-3">
<h3 id="org501e11d">John Whitington replied</h3>
<div class="outline-text-3" id="text-org501e11d">
<p>
I have been shipping commercial binaries for Linux (32 and 64 bit), Windows (32 and 64bit) and OS X for years. For example:
<a href="https://github.com/coherentgraphics/cpdf-binaries">https://github.com/coherentgraphics/cpdf-binaries</a>
</p>

<p>
And even static or shared libraries in binary form:
<a href="https://github.com/coherentgraphics/cpdflib-binary">https://github.com/coherentgraphics/cpdflib-binary</a>
</p>

<p>
On OS X, you need to use MACOSX_DEPLOYMENT_TARGET or similar to make sure your builds will run on older systems. And, in fact, you need to use MACOSX_DEPLOYMENT_TARGET when asking OPAM to compile the OCaml compiler itself. And, you will need to deal with codesigning and notarization. But it’s all doable.
</p>

<p>
For linux, you may need to build under older linux versions, to make sure that the glibc in use is old enough. This is not an ocaml-specific problem. I have a 64 bit and 32 bit VM with old-ish glibc versions for this purpose.
</p>

<p>
Under Windows, there are no such backward-compatibility problems. I use the new OCaml for windows system, which comes with OPAM, and is mingw-based. No cygwin remains in the final binary.
</p>

<p>
For more obscure systems (AIX, HPUX, Sparc etc) customers compile from source
(with help from me). Not once in more than ten years has anyone cared that it
was written in OCaml.
</p>
</div>
</div>


<div id="outline-container-org08473a9" class="outline-3">
<h3 id="org08473a9">dbuenzli also replied</h3>
<div class="outline-text-3" id="text-org08473a9">
<p>
remember that on the Windows native port, the Unix module distributed with OCaml is your POSIX compatibility layer. There are a few entry points to avoid though, the list is at the bottom of <a href="https://caml.inria.fr/pub/docs/manual-ocaml/libunix.html">this page</a>.
</p>
</div>
</div>


<div id="outline-container-orgaa0e849" class="outline-3">
<h3 id="orgaa0e849">nojb also replied</h3>
<div class="outline-text-3" id="text-orgaa0e849">
<p>
At LexiFi our main application is developed and shipped on Windows. We use the msvc port of OCaml. This means that you need Cygwin to develop, but the resulting application is fully native and does not depend on the Cygwin DLL. As @dbuenzli mentioned, the Unix module <b>is</b> the POSIX compatibility layer.
</p>

<p>
Compilation speed is slower on Windows because process creation is slower on Windows as a general rule, but it is manageable (our application has around 2000 modules + Js_of_ocaml + C bindings + C# component).
</p>

<p>
We don’t have any issues with runtime performance. The <code>Unix</code> library mentioned above implements Windows support directly without going through any compatibility layer and is quite efficient.
</p>
</div>
</div>


<div id="outline-container-org628fadd" class="outline-3">
<h3 id="org628fadd">BikalGurung also replied</h3>
<div class="outline-text-3" id="text-org628fadd">
<p>
There is an editor being built in ocaml/reasonml which currently targets windows, linux and macos - <a href="https://github.com/onivim/oni2">https://github.com/onivim/oni2</a>. However, the binary is native windows rather than cygwin derivative. So if you don’t have to use cygwin dependencies then native windows binary could be the way to go.
</p>

<p>
Also esy - <a href="https://github.com/esy/esy">https://github.com/esy/esy</a> makes developing ocaml/reasonml on windows viable.
</p>
</div>
</div>


<div id="outline-container-orge4dc266" class="outline-3">
<h3 id="orge4dc266">keleshev also replied</h3>
<div class="outline-text-3" id="text-orge4dc266">
<p>
<b>TLDR</b>: Install the <a href="https://fdopen.github.io/opam-repository-mingw/">Mingw port of OCaml 4</a>, freely use most opam libraries, and compile to native Windows binaries, without licensing issues.
</p>

<p>
I recommend you read the “Release notes for Windows”:
<a href="https://github.com/ocaml/ocaml/blob/trunk/README.win32.adoc">https://github.com/ocaml/ocaml/blob/trunk/README.win32.adoc</a>
</p>

<p>
To summarise, there are three Windows ports:
</p>

<ul class="org-ul">
<li>Native Microsoft port,</li>
<li>Native Mingw port,</li>
<li>Cygwin port.</li>
</ul>

<p>
All three require Cygwin for development purposes. I recommend using the Native Mingw, as:
</p>

<ul class="org-ul">
<li>it <b>doesn’t</b> require Visual Studio (it uses a mingw fork of GCC that “cross-compiles” native Windows executables),</li>
<li>it <b>doesn’t</b> rely on the dreaded cygwin.dll</li>
<li>it has good opam support with opam-repository-mingw: <a href="https://github.com/fdopen/opam-repository-mingw">https://github.com/fdopen/opam-repository-mingw</a></li>
<li>it has a convenient installer: <a href="https://fdopen.github.io/opam-repository-mingw/">https://fdopen.github.io/opam-repository-mingw/</a> 5.</li>
</ul>

<p>
To contrast, Native Microsoft requires Visual Studio, and doesn’t have opam. You can still vendor pure OCaml packages, but as soon as you want to use some C bindings you’re in trouble, because of the “minor” differences between Visual C and GCC. And everything assumes GCC nowadays.
</p>

<p>
Cygwin port is the one I don’t have experience with, but re-reading the “Release notes for Windows” above it strikes me that it mentions that Cygwin was re-licensed from GPL to LGPL with static linking exception. So it looks like the Cygwin port could be viable for commercial use, but I never tried to statically linked <code>cygwin.dll</code>, and I’m not sure what are the benefits of Cygwin port over the Mingw port.
</p>
</div>
</div>


<div id="outline-container-orgab40441" class="outline-3">
<h3 id="orgab40441">dmbaturin also replied</h3>
<div class="outline-text-3" id="text-orgab40441">
<p>
With <a href="https://soupault.neocities.org/">soupault 4</a>, I decided to ship prebuilt binaries for all platforms including Windows. Mostly to see if I can, all its users I know of are on UNIX-like systems and know how to build from source, but that’s beside the point. :wink:
</p>

<p>
I can confirm everything @keleshev says: fdopen’s package just works, opam works exactly like it does on UNIX, pure OCaml libraries are trivial to install, and the binaries don’t depend on cygwin.
Note that “opam switch create” also just works, you can install either MinGW or MSVC compiler versions as opam switches.
I only ever start the Windows VM to make release builds, and the workflow is exactly the same as on Linux where I’m actually writing code.
</p>

<p>
My only obstacle on that path was that FileUtils lost its Windows compatibility, but I wanted to use it, so I worked with @gildor478 to make it cross-platform again. Uncovered a bug in the implementation of Unix.utimes in the process, but it’s hardly a commonly used function.
</p>

<p>
You can also setup AppVeyor builds. It’s not as simple as I wish it would be, but there are projects doing it that you can steal the setup from.
</p>

<p>
There’s also opam-cross-windows, but it’s very incomplete and needs work to be practical. There are no big obstacles, it just needs work. While files in opam-repository-mingw are normally identical to the default opam repository, the cross one needs small adjustments in every package to specify the toolchain to use, so the required work is mostly a lot of trivial but manual actions. I hope eventually it reaches parity with fdopen’s one and we’ll be able to easily build for Windows without ever touching Windows.
</p>

<p>
As of static Linux builds, @JohnWhitington’s approach can work, but there’s a better option if you don’t need anything from glibc specifically and don’t link against any C libs: build statically with musl. There’s a <code>+musl+static+flambda</code> compiler flavour. You need musl and gcc-musl to install it, but after that, just build with <code>-ccopt -static</code> flag and you get a binary that doesn’t depend on anything.
</p>
</div>
</div>
</div>




<div id="outline-container-org947fef0" class="outline-2">
<h2 id="3">Dune 2.0.0</h2>
<div class="outline-text-2" id="text-3">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-dune-2-0-0/4758">https://discuss.ocaml.org/t/ann-dune-2-0-0/4758</a>
</p>
</div>

<div id="outline-container-org5716688" class="outline-3">
<h3 id="org5716688">rgrinberg announced</h3>
<div class="outline-text-3" id="text-org5716688">
<p>
On behalf of the dune team, I’m delighted to announce the release of dune 2.0. This release is the culmination of 4 months of hard work by the dune team and contains new features, bug fixes, and performance improvements . Here’s a selection of new features that I personally find interesting:
</p>

<ul class="org-ul">
<li>New boostrap procedure that works in low memory environments</li>
<li>(<code>deprecated_library_name</code> ..) stanza to properly deprecate old library names</li>
<li>(<code>foreign_library</code> ..) stanza to define C/C++ libraries.</li>
<li>C stubs directly in OCaml executables</li>
</ul>

<p>
Refer to the change log for an exhaustive list.
</p>

<p>
We strive for a good out of the box experience that requires no configuration, so we’ve also tweaked a few defaults. In particular, <code>$ dune build</code> will now build <code>@all</code> instead of <code>@install</code>, and ocamlformat rules are setup by default.
</p>

<p>
Lastly, dune 2.0 sheds all the legacy related to jbuilder and will no longer build jbuilder projects. This change is necessary to ease maintenance and make it easier to add new features down the line. There are a few other minor breaking changes. Refer to the change log for the full list. We apologize in advance for any convenience this might cause.
</p>

<p>
<a href="https://discuss.ocaml.org/t/ann-dune-2-0-0/4758">Changelog</a>
</p>
</div>
</div>
</div>




<div id="outline-container-orge9e889b" class="outline-2">
<h2 id="4">Advanced C binding using ocaml-ctypes and dune</h2>
<div class="outline-text-2" id="text-4">
<p>
Archive: <a href="https://discuss.ocaml.org/t/advanced-c-binding-using-ocaml-ctypes-and-dune/4805">https://discuss.ocaml.org/t/advanced-c-binding-using-ocaml-ctypes-and-dune/4805</a>
</p>
</div>

<div id="outline-container-org7271a0e" class="outline-3">
<h3 id="org7271a0e">toots announced</h3>
<div class="outline-text-3" id="text-org7271a0e">
<p>
I worked on a socket.h binding last summer and had a great experience integrating ocaml-ctypes with dune, I thought that might be of interest to other developers so I wrote about it: <a href="https://medium.com/@romain.beauxis/advanced-c-binding-using-ocaml-ctypes-and-dune-cc3f4cbab302">https://medium.com/@romain.beauxis/advanced-c-binding-using-ocaml-ctypes-and-dune-cc3f4cbab302</a>
</p>
</div>
</div>


<div id="outline-container-orgaa0002f" class="outline-3">
<h3 id="orgaa0002f">rgrinberg replied</h3>
<div class="outline-text-3" id="text-orgaa0002f">
<p>
This is a good article. I encourage anyone who writes C bindings with ctypes to study it carefully.
</p>

<p>
A little bit of advice to shorten your dune files:
</p>

<pre class="example">
(deps    (:gen ./gen_constants_c.exe))
</pre>

<p>
This line isn’t necessary. Dune is smart enough to know that running a binary in a rule incurs a dependency on it.
</p>

<blockquote>
<p>
dune has a truly amazing <a href="https://dune.readthedocs.io/en/latest/cross-compilation.html">support for cross-compiling</a>, which we do not cover here, but, unfortunately, its primitives for building and executing binaries do not yet cover this use case.
</p>
</blockquote>

<p>
Indeed, we don’t have any primitives for running binaries on the target platform. Perhaps we should add some. However, we do in fact have some features in dune to solve this concrete cross compilation problem. As far as I understand, the goal is to obtain some compile time values such as #define constants and field offsets for the target platform. This does not in fact require to run anything on the cross compilation target. In configurator, we have a primitive <code>C_define.import</code> to extract this information. The end result is that these configurator scripts are completely compatible with cross compilation.
</p>

<p>
Perhaps this could be generalized to work with ctypes generators as well?
</p>

<p>
Funny bit of trivia: The hack in configurator required to do this is in fact something I extracted from ctypes itself. The original author is <a href="https://github.com/whitequark">whitequark</a>, who in turn wrote it to make ctypes itself amendable to cross compilation.
</p>
</div>
</div>


<div id="outline-container-orgcebbcba" class="outline-3">
<h3 id="orgcebbcba">emillon then added</h3>
<div class="outline-text-3" id="text-orgcebbcba">
<blockquote>
<p>
This does not in fact require to run anything on the cross compilation target. In configurator, we have a primitive <code>C_define.import</code> to extract this information. The end result is that these configurator scripts are completely compatible with cross compilation.
</p>
</blockquote>

<p>
If anybody wants to know more about this bit, I wrote an article about this last year:
<a href="https://dune.build/blog/configurator-constants/">https://dune.build/blog/configurator-constants/</a>
</p>
</div>
</div>
</div>




<div id="outline-container-org2d0bc17" class="outline-2">
<h2 id="5">Upcoming breaking change in Base/Core v0.14</h2>
<div class="outline-text-2" id="text-5">
<p>
Archive: <a href="https://discuss.ocaml.org/t/upcoming-breaking-change-in-base-core-v0-14/4806">https://discuss.ocaml.org/t/upcoming-breaking-change-in-base-core-v0-14/4806</a>
</p>
</div>

<div id="outline-container-org781c364" class="outline-3">
<h3 id="org781c364">bcc32 announced</h3>
<div class="outline-text-3" id="text-org781c364">
<p>
We’re changing functions in Base that used to use the polymorphic
variant type <code>[ `Fst of 'a | `Snd of 'b ]</code> to use <code>('a, 'b) Either.t</code>
instead. As well as enabling the use of all of the functions in the
Either module, this makes the functions consistent with other
functions that already use <code>Either.t</code>, (currently just
<code>Set.symmetric_diff</code>)
</p>

<p>
The following functions’ types will change:
</p>
<ul class="org-ul">
<li><code>Result.ok_fst</code></li>
<li><code>List.partition_map</code></li>
<li><code>Map.partition_map</code>, <code>Map.partition_mapi</code></li>
<li><code>Hashtbl.partition_map</code>, <code>Hashtbl.partition_mapi</code></li>
</ul>

<p>
The type of List.partition3_map will not change:
</p>

<pre class="example">
val partition3_map
  :  'a t
  -&gt; f:('a -&gt; [ `Fst of 'b | `Snd of 'c | `Trd of 'd ])
  -&gt; 'b t * 'c t * 'd t
</pre>

<p>
We don’t have a generic ternary variant, and it doesn’t seem worth it
to mint one just for this purpose.
</p>

<p>
Since this change is pretty straightforward, we expect that a simple find/replace will be sufficient to update any affected call sites.
</p>
</div>
</div>
</div>




<div id="outline-container-orgd5a8247" class="outline-2">
<h2 id="6">CI/CD Pipelines: Monad, Arrow or Dart?</h2>
<div class="outline-text-2" id="text-6">
<p>
Archive: <a href="https://roscidus.com/blog/blog/2019/11/14/cicd-pipelines/">https://roscidus.com/blog/blog/2019/11/14/cicd-pipelines/</a>
</p>
</div>

<div id="outline-container-orgc4c1fac" class="outline-3">
<h3 id="orgc4c1fac">Thomas Leonard announced</h3>
<div class="outline-text-3" id="text-orgc4c1fac">
<p>
In this post I describe three approaches to building a language for writing CI/CD pipelines. My first attempt used a monad, but this prevented static analysis of the pipelines. I then tried using an arrow, but found the syntax very difficult to use. Finally, I ended up using a light-weight alternative to arrows that I will refer to here as a dart (I don’t know if this has a name already). This allows for static analysis like an arrow, but has a syntax even simpler than a monad.
</p>

<p>
<a href="https://roscidus.com/blog/blog/2019/11/14/cicd-pipelines/">https://roscidus.com/blog/blog/2019/11/14/cicd-pipelines/</a>
</p>
</div>
</div>
</div>




<div id="outline-container-orgf3cb254" class="outline-2">
<h2 id="7">Use of functors to approximate F# statically resolved type parameters</h2>
<div class="outline-text-2" id="text-7">
<p>
Archive: <a href="https://discuss.ocaml.org/t/use-of-functors-to-approximate-f-statically-resolved-type-parameters/4782">https://discuss.ocaml.org/t/use-of-functors-to-approximate-f-statically-resolved-type-parameters/4782</a>
</p>
</div>

<div id="outline-container-orge2db0d0" class="outline-3">
<h3 id="orge2db0d0">cmxa asked</h3>
<div class="outline-text-3" id="text-orge2db0d0">
<p>
I am learning OCaml coming from F#. In F#, to calculate the average of an array whose element type supports addition and division, one can write
</p>

<pre class="example">
let inline average (arr: 'a[]) : 'a
    when ^a : (static member DivideByInt : ^a * int -&gt; ^a)
    and  ^a : (static member (+) : ^a * ^a -&gt; ^a)
    and  ^a : (static member Zero : ^a)
    =
    if Array.length arr = 0 then (LanguagePrimitives.GenericZero) else
    LanguagePrimitives.DivideByInt (Array.fold (+) (LanguagePrimitives.GenericZero) arr) (Array.length arr)
</pre>

<p>
My understanding is that in OCaml, one would have a module type like so:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">module type</span> <span style="color: #228b22;">Averagable</span> = <span style="color: #000000; font-weight: bold;">sig</span>
  <span style="color: #000000; font-weight: bold;">type</span> <span style="color: #228b22;">'a t</span>

  <span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">divide_by_int</span> : 'a -&gt; int -&gt; 'a
  <span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">plus</span> : 'a -&gt; 'a -&gt; 'a
  <span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">zero</span> : 'a
<span style="color: #000000; font-weight: bold;">end</span>
</pre>
</div>

<p>
My question is how the corresponding function would be written:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">average</span> <span style="color: #a0522d;">arr</span> =
  <span style="color: #a52a2a;">???</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orgfd7eafe" class="outline-3">
<h3 id="orgfd7eafe">smolkaj replied</h3>
<div class="outline-text-3" id="text-orgfd7eafe">
<p>
First, <code>Averagable</code> should look like this:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">module type</span> <span style="color: #228b22;">Averagable</span> = <span style="color: #000000; font-weight: bold;">sig</span>
  <span style="color: #000000; font-weight: bold;">type</span> <span style="color: #228b22;">t</span>
  <span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">divide_by_int</span> : t -&gt; int -&gt; t
  <span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">plus</span> : t -&gt; t -&gt; t
  <span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">zero</span> : t
<span style="color: #000000; font-weight: bold;">end</span>
</pre>
</div>

<p>
Then average will look something like this:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">average</span> (<span style="color: #a020f0;">type</span> <span style="color: #228b22;">t</span>) (<span style="color: #a020f0;">module</span> <span style="color: #228b22;">A</span> :<span style="color: #228b22;"> Averagable with type t </span>=<span style="color: #228b22;"> t</span>) (<span style="color: #a0522d;">arr</span> :<span style="color: #228b22;"> t array</span>) :<span style="color: #228b22;"> t </span>=
  <span style="color: #228b22;">Array.</span>fold <span style="color: #008b8b;">~init</span>:<span style="color: #228b22;">A.</span>zero <span style="color: #008b8b;">~f</span>:<span style="color: #228b22;">A.</span>plus arr
</pre>
</div>

<p>
(The code above uses Jane Street’s Base/Core library.)
</p>
</div>
</div>


<div id="outline-container-org2a395b2" class="outline-3">
<h3 id="org2a395b2">ivg then added</h3>
<div class="outline-text-3" id="text-org2a395b2">
<p>
While @smolkaj’s answer is a correct and direct implementation of your F# code, it might be nicer if your code can interplay with existing abstractions in the OCaml infrastructure. For example,
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">open </span><span style="color: #228b22;">Base</span>

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">average</span> (<span style="color: #a020f0;">type</span> <span style="color: #228b22;">a</span>) (<span style="color: #a020f0;">module</span> <span style="color: #228b22;">T</span> :<span style="color: #228b22;"> Floatable.S with type t </span>=<span style="color: #228b22;"> a</span>) <span style="color: #a0522d;">xs</span> =
  <span style="color: #228b22;">Array.</span>fold <span style="color: #008b8b;">~init</span>:0. <span style="color: #008b8b;">~f</span>:(<span style="color: #a020f0;">fun</span> <span style="color: #a0522d;">s</span> <span style="color: #a0522d;">x</span> -&gt; s +. <span style="color: #228b22;">T.</span>to_float x) xs /.
  <span style="color: #228b22;">Float.</span>of_int (<span style="color: #228b22;">Array.</span>length xs)
</pre>
</div>

<p>
and now it could be used with any existing numeric data in Base/Core
</p>

<div class="org-src-container">
<pre class="src src-ocaml">average (<span style="color: #a020f0;">module</span> <span style="color: #228b22;">Int</span>) [|1;2;3;4|]<span style="color: #ff4500;">;;</span>
- : <span style="color: #228b22;">Base.Float.</span>t = 2.5
</pre>
</div>

<p>
and even adapted to non-numbers,
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">average_length</span> = average (<span style="color: #000000; font-weight: bold;">module</span> <span style="color: #000000; font-weight: bold;">struct</span>
    <span style="color: #000000; font-weight: bold;">include</span> <span style="color: #228b22;">String</span>
    <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">to_float</span> <span style="color: #a0522d;">x</span> = <span style="color: #228b22;">Float.</span>of_int (<span style="color: #228b22;">String.</span>length x)
    <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">of_float</span> <span style="color: #a0522d;">_</span> = <span style="color: #a020f0;">assert</span> <span style="color: #008b8b;">false</span>
  <span style="color: #000000; font-weight: bold;">end</span>)
</pre>
</div>

<p>
The latter example shows that we requested more interface than need, a cost that we have to pay for using an existing definition. In cases when it matters, you can specify the specific interface, e.g.,
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">module type</span> <span style="color: #228b22;">Floatable</span> = <span style="color: #000000; font-weight: bold;">sig</span>
  <span style="color: #000000; font-weight: bold;">type</span> <span style="color: #228b22;">t</span>
  <span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">to_float</span> : t -&gt; float
<span style="color: #000000; font-weight: bold;">end</span>

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">average</span> (<span style="color: #a020f0;">type</span> <span style="color: #228b22;">a</span>) (<span style="color: #a020f0;">module</span> <span style="color: #228b22;">T</span> :<span style="color: #228b22;"> Floatable with type t </span>=<span style="color: #228b22;"> a</span>) <span style="color: #a0522d;">xs</span> =
  <span style="color: #228b22;">Array.</span>fold <span style="color: #008b8b;">~init</span>:0. <span style="color: #008b8b;">~f</span>:(<span style="color: #a020f0;">fun</span> <span style="color: #a0522d;">s</span> <span style="color: #a0522d;">x</span> -&gt; s +. <span style="color: #228b22;">T.</span>to_float x) xs /.
  <span style="color: #228b22;">Float.</span>of_int (<span style="color: #228b22;">Array.</span>length xs)
</pre>
</div>

<p>
But we reached the point where using first class modules is totally unnecessary. Our interface has only one function, so the following definition of average, is much more natural
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">average</span> <span style="color: #a0522d;">xs</span> ~<span style="color: #a0522d;">f</span> =
  <span style="color: #228b22;">Array.</span>fold <span style="color: #008b8b;">~init</span>:0. <span style="color: #008b8b;">~f</span>:(<span style="color: #a020f0;">fun</span> <span style="color: #a0522d;">s</span> <span style="color: #a0522d;">x</span> -&gt; s +. f x) xs /.
  <span style="color: #228b22;">Float.</span>of_int (<span style="color: #228b22;">Array.</span>length xs)
</pre>
</div>

<p>
it has type <code>'a array -&gt; f:('a -&gt; float) -&gt; float</code> and computes an average of <code>f x_i</code> for all elements in the array.
</p>
</div>
</div>
</div>




<div id="outline-container-org80001a9" class="outline-2">
<h2 id="org80001a9">Old CWN</h2>
<div class="outline-text-2" id="text-org80001a9">
<p>
If you happen to miss a CWN, you can <a href="mailto:alan.schmitt@polytechnique.org">send me a message</a> and I'll mail it to you, or go take a look at <a href="http://alan.petitepomme.net/cwn/">the archive</a> or the <a href="http://alan.petitepomme.net/cwn/cwn.rss">RSS feed of the archives</a>.
</p>

<p>
If you also wish to receive it every week by mail, you may subscribe <a href="http://lists.idyll.org/listinfo/caml-news-weekly/">online</a>.
</p>

<div class="authorname">
<p>
<a href="http://alan.petitepomme.net/">Alan Schmitt</a>
</p>

</div>
</div>
</div>
</div>
</body>
</html>
