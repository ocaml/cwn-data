<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-03-31 Tue 11:32 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OCaml Weekly News</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<style type="text/css">#table-of-contents h2 { display: none } .title { display: none } .authorname { text-align: right }</style>
<style type="text/css">.outline-2 {border-top: 1px solid black;}</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">OCaml Weekly News</h1>
<p>
<a href="http://alan.petitepomme.net/cwn/2020.03.24.html">Previous Week</a> <a href="http://alan.petitepomme.net/cwn/index.html">Up</a> <a href="http://alan.petitepomme.net/cwn/2020.04.07.html">Next Week</a>
</p>

<p>
Hello
</p>

<p>
Here is the latest OCaml Weekly News, for the week of March 24 to 31, 2020.
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#1">An In-Depth Look at OCaml’s New “Best-Fit” Garbage Collector Strategy</a></li>
<li><a href="#2">First release of Pp, a pretty-printing library</a></li>
<li><a href="#3">soupault: a static website generator based on HTML rewriting</a></li>
<li><a href="#4">routes: path based routing for web applications</a></li>
<li><a href="#5">Compiler Engineer at Mixtional Code in Darmstadt or anywhere else in Germany</a></li>
<li><a href="#6">tiny-httpd 0.5</a></li>
<li><a href="#7">Visual Studio Code plugin for OCaml</a></li>
<li><a href="#8">Dismas: a tool for automatically making cross-versions of opam packages</a></li>
<li><a href="#9">Multicore OCaml: March 2020 update</a></li>
<li><a href="#orgbac2447">Old CWN</a></li>
</ul>
</div>
</div>


<div id="outline-container-org5075284" class="outline-2">
<h2 id="1">An In-Depth Look at OCaml’s New “Best-Fit” Garbage Collector Strategy</h2>
<div class="outline-text-2" id="text-1">
<p>
Archive: <a href="https://discuss.ocaml.org/t/an-in-depth-look-at-ocaml-s-new-best-fit-garbage-collector-strategy/5370/1">https://discuss.ocaml.org/t/an-in-depth-look-at-ocaml-s-new-best-fit-garbage-collector-strategy/5370/1</a>
</p>
</div>

<div id="outline-container-org8ab15b2" class="outline-3">
<h3 id="org8ab15b2">OCamlPro announced</h3>
<div class="outline-text-3" id="text-org8ab15b2">
<p>
The Garbage Collector is probably OCaml’s greatest unsung hero. Its pragmatic approach allows us to allocate without
much fear of efficiency loss. We looked into its new "Best-fit" strategy and here is what we learned!
<a href="http://www.ocamlpro.com/2020/03/23/ocaml-new-best-fit-garbage-collector/">http://www.ocamlpro.com/2020/03/23/ocaml-new-best-fit-garbage-collector/</a>
</p>
</div>
</div>
</div>




<div id="outline-container-orgdacb5a8" class="outline-2">
<h2 id="2">First release of Pp, a pretty-printing library</h2>
<div class="outline-text-2" id="text-2">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-first-release-of-pp-a-pretty-printing-library/5371/1">https://discuss.ocaml.org/t/ann-first-release-of-pp-a-pretty-printing-library/5371/1</a>
</p>
</div>

<div id="outline-container-orgb3f2498" class="outline-3">
<h3 id="orgb3f2498">Jérémie Dimino announced</h3>
<div class="outline-text-3" id="text-orgb3f2498">
<p>
I'm happy to announce the first release of the <a href="https://github.com/diml/pp">pp library</a>! This library provides a lean alternative to the
<a href="https://caml.inria.fr/pub/docs/manual-ocaml/libref/Format.html">Format module</a> of the standard library. It uses the same comcepts of boxes and break hints, however it
defines its own algebra which some might find easier to work with and reason about.  I personally do :) The final
rendering is still done via a formatter which makes it easy to integrate <code>Pp</code> in existing programs using <code>Format</code>.
</p>

<p>
We introduced this module in <a href="https://dune.build">Dune</a> to help improve the formatting of messages printed in the terminal and it
has been a success. The new API is smaller, simpler and makes it easy for developers to do the right thing. Once the
<code>Pp</code> module of Dune was mature enough, we decided to extract it into a separate library so that it could benefit
others.
</p>

<p>
The library itself is composed of a single <code>Pp</code> module and has no dependencies.  Its documentation is self-contained
and no previous knowledge is required to start using it, however the various guides for the <code>Format</code> module such as
<a href="http://caml.inria.fr/resources/doc/guides/format.en.html">this one</a> should be applicable to <code>Pp</code> as well.
</p>

<p>
If you have used <code>Format</code> before and like me found its API complicated and difficult to use, I hope that you will
find <code>Pp</code> nicer to work with!
</p>
</div>
</div>


<div id="outline-container-org05cced5" class="outline-3">
<h3 id="org05cced5">Josh Berdine then said</h3>
<div class="outline-text-3" id="text-org05cced5">
<p>
Another great resource for understanding the core mental model of Format is <a href="https://hal.archives-ouvertes.fr/hal-01503081/file/format-unraveled.pdf">Format
Unraveled</a>, although if I understand pp
correctly the discussion about Format not being document-based won't apply to pp.
</p>
</div>
</div>
</div>




<div id="outline-container-orga74b296" class="outline-2">
<h2 id="3">soupault: a static website generator based on HTML rewriting</h2>
<div class="outline-text-2" id="text-3">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-soupault-a-static-website-generator-based-on-html-rewriting/4126/13">https://discuss.ocaml.org/t/ann-soupault-a-static-website-generator-based-on-html-rewriting/4126/13</a>
</p>
</div>

<div id="outline-container-orge795a9b" class="outline-3">
<h3 id="orge795a9b">Daniil Baturin announced</h3>
<div class="outline-text-3" id="text-orge795a9b">
<p>
<a href="https://soupault.neocities.org/blog/soupault-1.10-release">1.10.0</a> release is available.
</p>

<p>
Bug fixes:
</p>
<ul class="org-ul">
<li>Files without extensions are handled correctly.</li>
</ul>

<p>
New features:
</p>
<ul class="org-ul">
<li>Plugin discovery: if you save a plugin to <code>plugins/my-plugin.lua</code>, it's automatically loaded as a widget named</li>
</ul>
<p>
<code>my-plugin</code>. List of plugin directories is configurable.
</p>
<ul class="org-ul">
<li>New plugin API functions: <code>HTMLget_tag_name</code>, <code>HTML.select_any_of</code>, <code>HTML.select_all_of</code>.</li>
<li>The <code>HTML</code> module is now "monadic": giving a nil to a function that expects an element gives you a nil back, rather than cause a runtime error.</li>
</ul>
</div>
</div>
</div>




<div id="outline-container-org34b9f57" class="outline-2">
<h2 id="4">routes: path based routing for web applications</h2>
<div class="outline-text-2" id="text-4">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-routes-path-based-routing-for-web-applications/3624/6">https://discuss.ocaml.org/t/ann-routes-path-based-routing-for-web-applications/3624/6</a>
</p>
</div>

<div id="outline-container-org834e820" class="outline-3">
<h3 id="org834e820">Anurag Soni announced</h3>
<div class="outline-text-3" id="text-org834e820">
<p>
<a href="http://opam.ocaml.org/packages/routes/">0.7.2</a> release is now available on opam. There have been quite a few changes
since the previous versions.
</p>

<ul class="org-ul">
<li>Routes doesn't deal with HTTP methods anymore</li>
<li>The internal implementation is now based around a trie like data structure</li>
<li>Routes have pretty printers</li>
<li>sprintf style route printing is supported again</li>
<li>Minimum supported OCaml version is now 4.05 (it used to be 4.06)</li>
<li>There is a release available for bucklescript as well and it is available to install via <a href="https://www.npmjs.com/package/@anuragsoni/routes">npm</a>.</li>
</ul>
</div>
</div>
</div>




<div id="outline-container-orgcf36f5a" class="outline-2">
<h2 id="5">Compiler Engineer at Mixtional Code in Darmstadt or anywhere else in Germany</h2>
<div class="outline-text-2" id="text-5">
<p>
Archive: <a href="https://discuss.ocaml.org/t/compiler-engineer-at-mixtional-code-in-darmstadt-or-anywhere-else-in-germany/5377/1">https://discuss.ocaml.org/t/compiler-engineer-at-mixtional-code-in-darmstadt-or-anywhere-else-in-germany/5377/1</a>
</p>
</div>

<div id="outline-container-org225e501" class="outline-3">
<h3 id="org225e501">Gerd Stolpmann announced</h3>
<div class="outline-text-3" id="text-org225e501">
<p>
Type of position:
</p>

<ul class="org-ul">
<li>regular hire (no freelancers)</li>
<li>full time</li>
<li>work from home anywhere in Germany, or in the office in Darmstadt</li>
<li>work for a small and highly skilled international team, located in the US and Europe</li>
<li>the team language is English</li>
</ul>

<p>
We are developing a compiler for a no-code platform that translates our DSL to bytecode and/or WebAssembly. The
language is largely of functional type but is also able to manage state with a spreadsheet model, allowing reactive
programming without having to resort to libraries. The language is statically typed using a Hindley-Milner type
checker. The compiler is primarily written in OCaml. Other languages of our platform are Go, Elm, and Javascript.
</p>

<p>
We are looking for a compiler engineer with strong skills in all relevant areas:
</p>

<ul class="org-ul">
<li>fluent in OCaml or a similar language such as Haskell</li>
<li>Understanding of the structure of the DSL, including syntax and semantics</li>
<li>Translation of FP languages to executable code</li>
<li>Code optimization</li>
<li>Graph algorithms</li>
<li>Type checking</li>
</ul>

<p>
We are open to both juniors and seniors, and payment will be accordingly. We are not so much interested in formal
certifications but rather in real practice, either from previous jobs, research projects, or contributions to open
source projects.
</p>

<p>
The no-code platform is being developed by engineers in Europe and the US at various places, and we usually do not
meet physically but in video conferences. Working from home is very usual. We also get you a desk in your home town
if you prefer this. The compiler development is lead by Gerd Stolpmann from Darmstadt.
</p>

<p>
Due to the strong connections to the US, video conferences will often have to take place in evening hours, until
around 7pm or 8pm.
</p>

<p>
Applications: please follow the "Apply" link at the official web page describing the position:
<a href="https://rmx.mixtional.de/static/54657cda/">https://rmx.mixtional.de/static/54657cda/</a>
</p>

<p>
Gerd Stolpmann <br />
CEO of Mixtional Code GmbH (and OCaml hacker of the first hour) <br />
Contact and company details: <a href="https://www.mixtional.de/contact.html">https://www.mixtional.de/contact.html</a>
</p>
</div>
</div>


<div id="outline-container-orgbaba933" class="outline-3">
<h3 id="orgbaba933">Sébastien Besnier asked</h3>
<div class="outline-text-3" id="text-orgbaba933">
<p>
I'm living in France, can I apply to the position (we are neighbors!)?
</p>
</div>
</div>


<div id="outline-container-org67f6809" class="outline-3">
<h3 id="org67f6809">Gerd Stolpmann replied</h3>
<div class="outline-text-3" id="text-org67f6809">
<p>
Well, I can (at the moment) only make contracts using German law and for the social security system here. So, if you
need a doctor you'd have to travel&#x2026; If my company was a bit bigger there would be the option of opening a second
site in France (even a very minimal one), but the setup costs are so far too high (lawyers and accountants), and it
is too distracting for me to keep up with the fine points of the system in France. Unfortunately, the EU is not that
far that it is super simple for an employer to hire anywhere in Europe. - Thanks for asking.
</p>
</div>
</div>
</div>




<div id="outline-container-org5a4fa8b" class="outline-2">
<h2 id="6">tiny-httpd 0.5</h2>
<div class="outline-text-2" id="text-6">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-tiny-httpd-0-5/5381/1">https://discuss.ocaml.org/t/ann-tiny-httpd-0-5/5381/1</a>
</p>
</div>

<div id="outline-container-org2aec70d" class="outline-3">
<h3 id="org2aec70d">Simon Cruanes announced</h3>
<div class="outline-text-3" id="text-org2aec70d">
<p>
I just released tiny-httpd 0.5 and the new tiny-httpd-camlzip, which makes it possible to use <code>deflate</code> transparently
for queries and responses. The server has evolved quietly and is getting somewhat more robust: I'm using it for an
internal tool with big html pages (up to several MB) and it's reasonably fast and doesn't seem to memleak. There's
also an improved <code>http_of_dir</code> to quickly and simply serve a directory on an arbitrary port.
</p>

<p>
Previous announcement <a href="https://discuss.ocaml.org/t/ann-tiny-httpd-0-1/4727">here</a>
</p>
</div>
</div>
</div>




<div id="outline-container-org74a201a" class="outline-2">
<h2 id="7">Visual Studio Code plugin for OCaml</h2>
<div class="outline-text-2" id="text-7">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-preview-visual-studio-code-plugin-for-ocaml/5395/1">https://discuss.ocaml.org/t/ann-preview-visual-studio-code-plugin-for-ocaml/5395/1</a>
</p>
</div>

<div id="outline-container-orgb844d7c" class="outline-3">
<h3 id="orgb844d7c">Rudi Grinberg announced</h3>
<div class="outline-text-3" id="text-orgb844d7c">
<p>
I'm proud to announce a preview release of an <a href="https://github.com/ocamllabs/vscode-ocaml-platform">VSC extension for
OCaml</a>. You can fetch and install this plugin directly from the
extension marketplace if you search for "OCaml Labs". The extension isn't yet mature, but I believe that it offers a
user experience comparable to other VSC extensions for OCaml already. The plugin should be used in conjunction with
<a href="https://github.com/ocaml/ocaml-lsp">ocaml-lsp</a>
</p>

<p>
The extension is for the OCaml "platform", which means that its scope includes support for various tools used in
OCaml development such as dune, opam.
</p>

<p>
Bug reports &amp; contributions are welcome. Happy hacking.
</p>
</div>
</div>
</div>




<div id="outline-container-org29f011e" class="outline-2">
<h2 id="8">Dismas: a tool for automatically making cross-versions of opam packages</h2>
<div class="outline-text-2" id="text-8">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-prototype-dismas-a-tool-for-automatically-making-cross-versions-of-opam-packages/5404/1">https://discuss.ocaml.org/t/ann-prototype-dismas-a-tool-for-automatically-making-cross-versions-of-opam-packages/5404/1</a>
</p>
</div>

<div id="outline-container-org28c8ae7" class="outline-3">
<h3 id="org28c8ae7">Daniil Baturin announced</h3>
<div class="outline-text-3" id="text-org28c8ae7">
<p>
opam-cross-* are seriously lagging behind the official opam repository and fdopen's opam-windows, not least because
importing packages by hand is a lot of work.
I suppose at least a semi-automated process could help those repos grow and stay in sync with the upstream much
faster.
</p>

<p>
I've made a prototype of a tool for "stealing" packages into cross-repos. For obvious reasons it's called Dismas.
You can find it here: <a href="https://github.com/dmbaturin/scripts/blob/master/dismas.ml">https://github.com/dmbaturin/scripts/blob/master/dismas.ml</a>
</p>

<p>
Limitations:
</p>

<ul class="org-ul">
<li>the code is a real mess for now</li>
<li>only dune is supported by automatic build command adjustment</li>
<li>it cannot handle cases when both native and cross-version of a dependency are needed</li>
</ul>

<p>
However:
</p>

<ul class="org-ul">
<li>For simple packages that use dune exclusively, it's completely automated. I've ported bigstreamaf and angstrom to test it, and cross-versions built just fine from its output, no editing was needed.</li>
<li>It automatically converts dependencies from foo to too-$toolchain and removes dependencies and build steps only</li>
</ul>
<p>
needed for <code>with-test</code> and <code>with-doc</code>.
</p>

<pre class="example">
$ ./dismas.ml windows containers ~/devel/opam-repository/packages/containers/containers.2.8.1/opam
opam-version: "2.0"
maintainer: "simon.cruanes.2007@m4x.org"
synopsis:
  "A modular, clean and powerful extension of the OCaml standard library"
build: [
  ["dune" "build" "-p" "containers" "-j" jobs "-x" "windows"]
]
depends: [
  "ocaml-windows" {&gt;= "4.03.0"}
  "dune" {&gt;= "1.1"}
  "dune-configurator"
  "seq-windows"
]
depopts: ["base-unix" "base-threads"]
tags: ["stdlib" "containers" "iterators" "list" "heap" "queue"]
homepage: "https://github.com/c-cube/ocaml-containers/"
doc: "https://c-cube.github.io/ocaml-containers"
dev-repo: "git+https://github.com/c-cube/ocaml-containers.git"
bug-reports: "https://github.com/c-cube/ocaml-containers/issues/"
authors: "Simon Cruanes"
url {
  src: "https://github.com/c-cube/ocaml-containers/archive/v2.8.1.tar.gz"
  checksum: [
    "md5=d84e09c5d0abc501aa17cd502e31a038"
    "sha512=8b832f4ada6035e80d81be0cfb7bdffb695ec67d465ed6097a144019e2b8a8f909095e78019c3da2d8181cc3cd730cd48f7519e87d3162442562103b7f36aabb"
  ]
}

$ ./dismas.ml windows containers ~/devel/opam-repository/packages/containers/containers.2.8.1/opam | diff
~/devel/opam-repository/packages/containers/containers.2.8.1/opam -
3c3,4
&lt; synopsis: "A modular, clean and powerful extension of the OCaml standard library"
---
&gt; synopsis:
&gt;   "A modular, clean and powerful extension of the OCaml standard library"
5,7c6
&lt;   ["dune" "build" "-p" name "-j" jobs]
&lt;   ["dune" "build" "@doc" "-p" name ] {with-doc}
&lt;   ["dune" "runtest" "-p" name "-j" jobs] {with-test}
---
&gt;   ["dune" "build" "-p" "containers" "-j" jobs "-x" "windows"]
10,11c9,10
&lt;   "ocaml" { &gt;= "4.03.0" }
&lt;   "dune" { &gt;= "1.1" }
---
&gt;   "ocaml-windows" {&gt;= "4.03.0"}
&gt;   "dune" {&gt;= "1.1"}
13,21c12
&lt;   "seq"
&lt;   "qtest" { with-test }
&lt;   "qcheck" { with-test }
&lt;   "ounit" { with-test }
&lt;   "iter" { with-test }
&lt;   "gen" { with-test }
&lt;   "uutf" { with-test }
&lt;   "mdx" { with-test &amp; &gt;= "1.5.0" &amp; &lt; "2.0.0" }
&lt;   "odoc" { with-doc }
---
&gt;   "seq-windows"
23,27c14,15
&lt; depopts: [
&lt;   "base-unix"
&lt;   "base-threads"
&lt; ]
&lt; tags: [ "stdlib" "containers" "iterators" "list" "heap" "queue" ]
---
&gt; depopts: ["base-unix" "base-threads"]
&gt; tags: ["stdlib" "containers" "iterators" "list" "heap" "queue"]
</pre>

<p>
Things to do:
</p>

<ul class="org-ul">
<li>identify all packages that don't need cross-versions. Is cppo one of them, for example?</li>
<li>add support for cases when both native and cross versions are needed. If menhir the only one?</li>
<li>add support for other build systems. Do all of them work well with `OCAMLFIND_TOOLCHAIN=windows` if the build setup is written correctly?</li>
</ul>

<p>
Input from @toots and @pirbo is welcome.
</p>
</div>
</div>


<div id="outline-container-org0a4efe9" class="outline-3">
<h3 id="org0a4efe9">Romain Beauxis then said</h3>
<div class="outline-text-3" id="text-org0a4efe9">
<p>
That's a great initiative! Here are a couple of thoughts:
</p>
<ul class="org-ul">
<li>For dune-based packages, things are indeed pretty straight-forward. Finding out which dependencies need to be ported as cross-dependency is indeed the part that's hard to automatize</li>
<li>For other build systems, it's less clear to me how to automatize. Maybe others have some thoughts about it.</li>
<li>The CI system on opam-cross-windows is pretty good at building from scratch and failing if some deps are missing so trial and error there can be a great tool.</li>
<li>Once solved for one cross situation, the problem of cross-dependencies should be exactly the same for all other cross environment (android, iOS)</li>
</ul>

<p>
I haven't looked at the tool very closely yet but I'd say a first improvement would be to be able to track
cross-dependencies resolution and generate new version of the package using them and/or generate other cross-compiled
packages using them.
</p>
</div>
</div>


<div id="outline-container-org9a70456" class="outline-3">
<h3 id="org9a70456">Anton Kochkov said</h3>
<div class="outline-text-3" id="text-org9a70456">
<p>
For automated pull requests, you might be interested in <a href="https://discuss.ocaml.org/t/dependabot-and-ocaml/4282">https://discuss.ocaml.org/t/dependabot-and-ocaml/4282</a>
</p>
</div>
</div>


<div id="outline-container-org59b5d25" class="outline-3">
<h3 id="org59b5d25">Daniil Baturin then asked</h3>
<div class="outline-text-3" id="text-org59b5d25">
<p>
I'm not sure if I understand the premise of dependabot. Why would anyone hardcode specific dependency versions? Maybe
it makes sense in certain ecosystems that suffer from never-ending ecological disasters&#x2026; ;)
</p>

<p>
In any case, most opam packages don't have a constraint on the upper versions of their dependencies. Can dependabot
use custom tracking rules to check for presense of a newer version in the repo?
My thought was much simpler actually: track the commits in opam-repository, run recently changed files through Dismas
and send pull requests to opam-cross-*
</p>
</div>
</div>


<div id="outline-container-orgf42ab79" class="outline-3">
<h3 id="orgf42ab79">Yawar Amin replied</h3>
<div class="outline-text-3" id="text-orgf42ab79">
<p>
It's common practice nowadays to use semantic versioning and have lockfiles for reproducible builds. Dependabot
updates semantic version ranges and lockfiles. See e.g.
</p>

<ul class="org-ul">
<li><a href="https://github.com/thoughtbot/velveteen/pull/31/files">https://github.com/thoughtbot/velveteen/pull/31/files</a></li>
<li><a href="https://github.com/mozilla/adr/pull/77/files">https://github.com/mozilla/adr/pull/77/files</a></li>
</ul>
</div>
</div>
</div>




<div id="outline-container-org413203f" class="outline-2">
<h2 id="9">Multicore OCaml: March 2020 update</h2>
<div class="outline-text-2" id="text-9">
<p>
Archive: <a href="https://discuss.ocaml.org/t/multicore-ocaml-march-2020-update/5406/1">https://discuss.ocaml.org/t/multicore-ocaml-march-2020-update/5406/1</a>
</p>
</div>

<div id="outline-container-org675c418" class="outline-3">
<h3 id="org675c418">Anil Madhavapeddy announced</h3>
<div class="outline-text-3" id="text-org675c418">
<p>
Welcome to the March 2020 news update from the Multicore OCaml team!  This update has been assembled with
@shakthimaan and @kayceesrk, as with the <a href="https://discuss.ocaml.org/t/multicore-ocaml-feb-2020-update/5227">February</a>
and <a href="https://discuss.ocaml.org/t/multicore-ocaml-january-2020-update/5090">January</a> ones.
</p>

<p>
Our work this month was primarily focused on performance improvements to the Multicore OCaml compiler and runtime, as
part of a comprehensive evaluation exercise. We continue to add additional benchmarks to the Sandmark test suite. The
eventlog tracing system and the use of hash tables for marshaling in upstream OCaml are in progress, and more PRs are
being queued up for OCaml 4.11.0-dev as well.
</p>

<p>
The biggest observable change for users trying the branch is that a new GC (the "parallel minor gc") has been merged
in preference to the previous one ("the concurrent minor gc").  We will have the details in longer form at a later
stage, but the essential gist is that <b>the parallel minor GC no longer requires a read barrier or changes to the C
API</b>.  It may have slightly worse scalability properties at a very high number of cores, but is roughly equivalent
at up to 24 cores in our evaluations.  Given the vast usability improvement from not having to port existing C FFI
uses, we have decided to make the parallel minor GC the default one for our first upstream runtime patches. The
concurrent minor GC follow at a later stage when we ramp up testing to 64-core+ machines.  The <a href="https://github.com/ocaml-multicore/multicore-opam">multicore opam
remote</a> has been updated to reflect these changes, for those who
wish to try it out at home.
</p>

<p>
We are now at a stage where we are porting larger applications to multicore.  Thanks go to:
</p>
<ul class="org-ul">
<li>@UnixJunkie who helped us integrate the Gram Matrix benchmark in <a href="https://github.com/ocaml-bench/sandmark/issues/99">https://github.com/ocaml-bench/sandmark/issues/99</a></li>
<li>@jhw has done extensive work towards supporting Systhreads in <a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/240">https://github.com/ocaml-multicore/ocaml-multicore/pull/240</a>. Systhreads is currently disabled in multicore, leading to some popular packages not compiling.</li>
<li>@antron has been advising us on how best to port `Lwt_preemptive` and the `Lwt_unix` modules to multicore, giving us a widely used IO stack to test more applications against.</li>
</ul>

<p>
If you do have other suggestions for application that you think might provide useful benchmarks, then please do get
in touch with myself or @kayceesrk.
</p>

<p>
Onto the details! The various ongoing and completed tasks for Multicore OCaml are listed first, which is followed by
the changes to the Sandmark benchmarking infrastructure and ongoing PRs to upstream OCaml.
</p>
</div>

<div id="outline-container-orgcf3c624" class="outline-4">
<h4 id="orgcf3c624">Multicore OCaml</h4>
<div class="outline-text-4" id="text-orgcf3c624">
</div>
<ul class="org-ul">
<li><a id="org85b4b94"></a>Ongoing<br />
<div class="outline-text-5" id="text-org85b4b94">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/240">ocaml-multicore/ocaml-multicore#240</a> Proposed implementation of threads in terms of Domain and Atomic
</p>

<p>
A new implementation of the `Threads` library for use with the new `Domain` and `Atomic` modules in Multicore OCaml has been proposed. This builds Dune 2.4.0 which in turn makes it useful to build other packages. This PR is open for review.
</p></li>

<li><p>
<a href="https://github.com/anmolsahoo25/ocaml-multicore/tree/safepoints-cmm-mach">ocaml-multicore/safepoints-cmm-mach</a> Better safe points for OCaml
</p>

<p>
A newer implementation to insert safe points at the Cmm level is being worked upon in this branch.
</p></li>
</ul>
</div>
</li>

<li><a id="org3eaa333"></a>Completed<br />
<div class="outline-text-5" id="text-org3eaa333">
<p>
The following PRs have been merged into Multicore OCaml:
</p>

<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/303">ocaml-multicore/ocaml-multicore#303</a> Account correctly for incremental mark budget
</p>

<p>
The patch correctly measures the incremental mark budget value, and improves the maximum latency for the `menhir.ocamly` benchmark.
</p></li>

<li><a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/307">ocaml-multicore/ocaml-multicore#307</a> Put the phase change event in the actual phase change code. The PR includes the `major_gc/phase_change` event in the appropriate context.</li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/309">ocaml-multicore/ocaml-multicore#309</a> Don't take all the full pools in one go.
</p>

<p>
The code change selects one of the `global_full_pools` to try sweeping it later, instead of adopting all of the full ones.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/310">ocaml-multicore/ocaml-multicore#310</a> Statistics for the current domain are more recent than other domains
</p>

<p>
The statistics (`minor_words`, `promoted_words`, `major_words`, `minor_collections`) for the current domain are more recent, and are used in the right context.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/315">ocaml-multicore/ocaml-multicore#315</a> Writes in `caml_blit_fields` should always use `caml_modify_field` to record `young_to_young` pointers
</p>

<p>
The PR enforces that `caml_modify_field()` is always used to store `young_to_young` pointers.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/316">ocaml-multicore/ocaml-multicore#316</a> Fix bug with `Weak.blit`.
</p>

<p>
The ephemerons are allocated as marked, but, the keys or data can be unmarked. The blit operations copy weak references from one ephemeron to another without marking them. The patch marks the keys that are blitted in order to keep the unreachable keys alive for another major cycle.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/317">ocaml-multicore/ocaml-multicore#317</a> Return early for 0 length blit
</p>

<p>
The PR forces a `CAMLreturn()` call if the blit length is zero in `byterun/weak.c`.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/320">ocaml-multicore/ocaml-multicore#320</a> Move `num_domains_running` decrement
</p>

<p>
The `caml_domain_alone()` invocation needs to be used in the shared heap teardown, and hence the `num_domains_running` decrement is moved as the last operation for at least the `shared_heap` lockfree fast paths.
</p></li>
</ul>
</div>
</li>
</ul>
</div>

<div id="outline-container-orgd7c8a3b" class="outline-4">
<h4 id="orgd7c8a3b">Benchmarking</h4>
<div class="outline-text-4" id="text-orgd7c8a3b">
<p>
The <a href="https://github.com/ocaml-bench/sandmark">Sandmark</a> performance benchmarking test suite has had newer benchmarks
added, and work is underway to enhance its functionality.
</p>

<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/88">ocaml-bench/sandmark#88</a> Add PingPong Multicore benchmark
</p>

<p>
The PingPong benchmark that uses producer and consumer queues has now been included into Sandmark.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/98">ocaml-bench/sandmark#98</a> Add the read/write Irmin benchmark
</p>

<p>
A basic read/write file performance benchmark for Irmin has been added to Sandmark. You can vary the following input parameters: number of branches, number of keys, percentage of reads and writes, number of iterations, and the number of write operations.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/issues/100">ocaml-bench/sandmark#100</a> Add Gram Matrix benchmark
</p>

<p>
 A request <a href="https://github.com/ocaml-bench/sandmark/issues/99">ocaml-bench/sandmark#99</a> to include the Gram Matrix initialization numerical benchmark was created. This is useful for machine learning applications and is now available in the Sandmark performance benchmark suite. The speedup (sequential_time/multi_threaded_time) versus number of cores for Multicore (Concurrent Minor Collector), Parmap and Parany is quite significant and illustrated in the graph:
<img src="https://aws1.discourse-cdn.com/standard11/uploads/ocaml/original/2X/2/20dc869a8dda1c815714a97e6a84f6f81c914cf4.png" alt="20dc869a8dda1c815714a97e6a84f6f81c914cf4.png" />
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/103">ocaml-bench/sandmark#103</a> Add depend target in Makefile
</p>

<p>
Sandmark now includes a `depend` target defined in the Makefile to check that both `libgmp-dev` and `libdw-dev` packages are installed and available on Ubuntu.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/issues/90">ocaml-bench/sandmark#90</a> More parallel benchmarks
</p>

<p>
An issue has been created to add more parallel benchmarks. We will use this to keep track of the requests. Please feel free to add your wish list of benchmarks!
</p></li>
</ul>
</div>
</div>

<div id="outline-container-orgabe62d0" class="outline-4">
<h4 id="orgabe62d0">OCaml</h4>
<div class="outline-text-4" id="text-orgabe62d0">
</div>
<ul class="org-ul">
<li><a id="orgeaf7db1"></a>Ongoing<br />
<div class="outline-text-5" id="text-orgeaf7db1">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml/ocaml/pull/9082">ocaml/ocaml#9082</a> Eventlog tracing system
</p>

<p>
The configure script has now been be updated so that it can build on Windows. Apart from this major change, a number of minor commits have been made for the build and sanity checks. This PR is currently under review.
</p></li>

<li><p>
<a href="https://github.com/ocaml/ocaml/pull/9353">ocaml/ocaml#9353</a> Reimplement output_value using a hash table to detect sharing.
</p>

<p>
The <a href="https://github.com/ocaml/ocaml/pull/9293">ocaml/ocaml#9293</a> "Use addrmap hash table for marshaling" PR has been re-implemented using a hash table and bit vector, thanks to @xavierleroy. This is a pre-requisite for Multicore OCaml that uses a concurrent garbage collector.
</p></li>
</ul>

<p>
As always, we thank the OCaml developers and users in the community for their code reviews, support, and contribution
to the project. From OCaml Labs, stay safe and healthy out there!
</p>
</div>
</li>
</ul>
</div>
</div>
</div>




<div id="outline-container-orgbac2447" class="outline-2">
<h2 id="orgbac2447">Old CWN</h2>
<div class="outline-text-2" id="text-orgbac2447">
<p>
If you happen to miss a CWN, you can <a href="mailto:alan.schmitt@polytechnique.org">send me a message</a> and I'll mail it to you, or go take a look at <a href="http://alan.petitepomme.net/cwn/">the archive</a> or the <a href="http://alan.petitepomme.net/cwn/cwn.rss">RSS feed of the archives</a>.
</p>

<p>
If you also wish to receive it every week by mail, you may subscribe <a href="http://lists.idyll.org/listinfo/caml-news-weekly/">online</a>.
</p>

<div class="authorname">
<p>
<a href="http://alan.petitepomme.net/">Alan Schmitt</a>
</p>

</div>
</div>
</div>
</div>
</body>
</html>
