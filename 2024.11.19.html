<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2024-11-19 Tue 07:51 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OCaml Weekly News</title>
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<style type="text/css">#table-of-contents h2 { display: none } .title { display: none } .authorname { text-align: right }</style>
<style type="text/css">.outline-2 {border-top: 1px solid black;}</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">OCaml Weekly News</h1>
<p>
<a href="https://alan.petitepomme.net/cwn/2024.11.12.html">Previous Week</a> <a href="https://alan.petitepomme.net/cwn/index.html">Up</a> <a href="https://alan.petitepomme.net/cwn/2024.11.26.html">Next Week</a>
</p>

<p>
Hello
</p>

<p>
Here is the latest OCaml Weekly News, for the week of November 12 to 19, 2024.
</p>

<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#1">Boulder Dash in OCaml</a></li>
<li><a href="#2">Jane Street OCaml extensions â€“ now with developer tooling!</a></li>
<li><a href="#3">opam 2.3.0 is out!</a></li>
<li><a href="#4">Installing Developer Tools with Dune</a></li>
<li><a href="#5">Dune Developer Preview Updates</a></li>
<li><a href="#6">First release of cmdlang</a></li>
<li><a href="#7">findlib-1.9.8</a></li>
<li><a href="#8">Testo 0.1.0 - a new testing framework for OCaml</a></li>
<li><a href="#9">Other OCaml News</a></li>
<li><a href="#org9c8f903">Old CWN</a></li>
</ul>
</div>
</div>
<div id="outline-container-1" class="outline-2">
<h2 id="1">Boulder Dash in OCaml</h2>
<div class="outline-text-2" id="text-1">
<p>
Archive: <a href="https://sympa.inria.fr/sympa/arc/caml-list/2024-11/msg00007.html">https://sympa.inria.fr/sympa/arc/caml-list/2024-11/msg00007.html</a>
</p>
</div>
<div id="outline-container-org711e739" class="outline-3">
<h3 id="org711e739">Andreas Rossberg announced</h3>
<div class="outline-text-3" id="text-org711e739">
<p>
Boulder Dash(*) was my favourite computer game in the 8-bit era, first released on the Atari
400/800 in 1984. Though I never owned an 8-bit machine myself, I had friends that I annoyed
enough to let me play it on theirs.
</p>

<p>
As a homage to its 40th anniversary, I put together a fairly faithful clone of the original game,
implemented in just a few 100 lines of bare OCaml, with nothing but the homely Graphics library.
It should run on Windows, Mac, and Linux, though I was too lazy to test the latter.
</p>

<p>
Features:
</p>
<ul class="org-ul">
<li>Faithful original physics, graphics, and animations</li>
<li>Authentic scrolling mechanics combined with dynamic window resizing</li>
<li>All 20 levels, including intermissions, and 5 difficulties</li>
<li>Pause-and-go mode for relaxed playing</li>
</ul>

<p>
It is open-source here:
</p>

<p>
<a href="https://github.com/rossberg/boulder-dash">https://github.com/rossberg/boulder-dash</a>
</p>

<p>
Enjoy!
</p>

<p>
/Andreas
</p>

<p>
(*) <a href="https://en.wikipedia.org/wiki/Boulder_Dash_(video_game)">https://en.wikipedia.org/wiki/Boulder_Dash_(video_game)</a> 
    "Boulder Dash" is a trademark of BBG Entertainment
</p>
</div>
</div>
</div>
<div id="outline-container-2" class="outline-2">
<h2 id="2">Jane Street OCaml extensions â€“ now with developer tooling!</h2>
<div class="outline-text-2" id="text-2">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-jane-street-ocaml-extensions-now-with-developer-tooling/15597/1">https://discuss.ocaml.org/t/ann-jane-street-ocaml-extensions-now-with-developer-tooling/15597/1</a>
</p>
</div>
<div id="outline-container-org6b4109e" class="outline-3">
<h3 id="org6b4109e">Diana Kalinichenko announced</h3>
<div class="outline-text-3" id="text-org6b4109e">
<p>
Hi everyone! We've just released a new version of our compiler extensions, complete with all our packages and support for developer tooling, including ocamlformat, merlin and ocaml-lsp-server. Get the install instructions at our <a href="https://github.com/janestreet/opam-repository/tree/with-extensions">GitHub</a>, and enjoy the experience in your favorite editor like VSCode, Emacs or Vim.
</p>

<p>
More documentation coming soon :slight_smile:. Stay tuned for future releases!
</p>
</div>
</div>
</div>
<div id="outline-container-3" class="outline-2">
<h2 id="3">opam 2.3.0 is out!</h2>
<div class="outline-text-2" id="text-3">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-opam-2-3-0-is-out/15609/1">https://discuss.ocaml.org/t/ann-opam-2-3-0-is-out/15609/1</a>
</p>
</div>
<div id="outline-container-orgf3fb960" class="outline-3">
<h3 id="orgf3fb960">Kate announced</h3>
<div class="outline-text-3" id="text-orgf3fb960">
<p>
Hi everyone,
</p>

<p>
As mentioned in <a href="https://icfp24.sigplan.org/details/ocaml-2024-papers/10/Opam-2-2-and-beyond">our talk at the OCaml Workshop 2024</a>, we decided to switch to a time-based release cycle (every 6 months), starting with opam 2.3.
</p>

<p>
As promised, we are happy to announce the final release of opam 2.3.0.
</p>
</div>
<div id="outline-container-org3d7bd49" class="outline-4">
<h4 id="org3d7bd49">Whatâ€™s new?</h4>
<div class="outline-text-4" id="text-org3d7bd49">
<ul class="org-ul">
<li>When loading a repository, <b>opam now ignores files in packagesâ€™ files/ directories which arenâ€™t listed in the extra-files field</b> of the opam file. :warning: If you maintain an opam repository, please read our <a href="https://opam.ocaml.org/blog/opam-2-3-0/">blog post</a> to make sure your repository stays compatible.</li>
<li><b>Packages requiring an unsupported version of opam are now marked unavailable</b>, instead of causing a repository error. This means an opam repository can now allow smoother upgrade in the future</li>
<li><b>opam list &#x2013;latests-only</b>: a new option to list only the latest versions of packages</li>
<li><b>&#x2013;verbose-on</b>: a new option to enable verbose output for specified package names.</li>
<li><b>opam switch import &#x2013;deps-only</b>: a new option to install only the dependencies of the root packages listed in the opam switch export file</li>
<li><b>opam switch list-available</b> no longer displays compilers flagged with <code>avoid-version~/~deprecated</code> unless <code>--all</code> is given, meaning that pre-release or unreleased OCaml packages no longer appear to be the latest version</li>
<li><b>The builtin-0install solver was improved</b> and should now be capable of being your default solver instead of <code>builtin-mccs+glpk</code>. If you wish to give it a try, simply calling <code>opam option solver=builtin-0install</code> (call <code>opam option solver=</code> restores the default)</li>
<li>Most of the <b>unhelpful conflict messages were fixed</b> :flashlight:</li>
<li><b>Fix the internal cache of installed packages</b>, which was storing the wrong version of the opam file after a build failure. (<a href="https://github.com/ocaml/opam/pull/6213">#6213</a>)</li>
</ul>

<p>
Various performance and other improvements were made and bugs were fixed.
</p>

<p>
:open_book: You can read our <a href="https://opam.ocaml.org/blog/opam-2-3-0/">blog post</a> for more information about these changes and more, and for even more details you can take a look at the <a href="https://github.com/ocaml/opam/releases/tag/2.3.0">release note</a> or the <a href="https://github.com/ocaml/opam/blob/2.3.0/CHANGES">changelog</a>.
</p>
</div>
</div>
<div id="outline-container-org3399690" class="outline-4">
<h4 id="org3399690">Try it!</h4>
<div class="outline-text-4" id="text-org3399690">
<p>
The upgrade instructions are unchanged:
</p>

<p>
For Unix systems
</p>
<pre class="example" id="org910478f">
bash -c "sh &lt;(curl -fsSL https://opam.ocaml.org/install.sh)"
</pre>
<p>
or from PowerShell for Windows systems
</p>
<pre class="example" id="orga434916">
Invoke-Expression "&amp; { $(Invoke-RestMethod https://opam.ocaml.org/install.ps1) }"
</pre>
<p>
Please report any issues to the <a href="https://github.com/ocaml/opam/issues">bug-tracker</a>.
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-4" class="outline-2">
<h2 id="4">Installing Developer Tools with Dune</h2>
<div class="outline-text-2" id="text-4">
<p>
Archive: <a href="https://discuss.ocaml.org/t/installing-developer-tools-with-dune/15612/1">https://discuss.ocaml.org/t/installing-developer-tools-with-dune/15612/1</a>
</p>
</div>
<div id="outline-container-orga9e20de" class="outline-3">
<h3 id="orga9e20de">Steve Sherratt announced</h3>
<div class="outline-text-3" id="text-orga9e20de">
<p>
Dune can install and run developer tools in the context of a project. This feature is available in the <a href="https://preview.dune.build/">Dune Developer Preview</a> and in the upcoming release of Dune 3.17. As with all of Dune's package management features, consider this feature to be unstable as its UI and semantics may change without notice.
</p>

<p>
The currently supported tools are <code>ocamllsp</code> and <code>ocamlformat</code>. Dune has a new command <code>dune tools exec &lt;TOOL&gt; -- [ARGS]...</code> which downloads and installs the given tool, and then runs it with the given arguments (note the <code>--</code> which separates arguments to <code>dune</code> from arguments to the tool). Tools are installed locally to the project, in its <code>_build</code> directory, which makes it easy to use different versions of a tool in different projects. An unfortunate consequence of installing tools into <code>_build</code> is that for the time being all tools are uninstalled whenever <code>dune clean</code> is run.
</p>

<p>
Let's see it in action:
</p>
<pre class="example" id="org376c53c">
$ dune tools exec ocamlformat -- --version
Solution for dev-tools.locks/ocamlformat:
- ocamlformat.0.26.2+binary-ocaml-5.2.0-built-2024-11-07.0-x86_64-unknown-linux-musl
    Building ocamlformat.0.26.2+binary-ocaml-5.2.0-built-2024-11-07.0-x86_64-unknown-linux-musl
     Running 'ocamlformat --version'
0.26.2
</pre>
</div>
<div id="outline-container-org4f5709f" class="outline-4">
<h4 id="org4f5709f">Precompiled Binaries</h4>
<div class="outline-text-4" id="text-org4f5709f">
<p>
Note that in the example above, Dune's package solver chose to install version <code>0.26.2+binary-ocaml-5.2.0-built-2024-11-07.0-x86_64-unknown-linux-musl</code> of <code>ocamlformat</code>. This packages comes from a new <a href="https://github.com/ocaml-dune/ocaml-binary-packages">repository of binary packages</a> containing pre-built executables for a select few Opam packages. Dune will search this repository in addition to the default repositories when solving packages for tools only (if a project has <code>ocamlformat</code> in its dependencies, the binary repository won't be searched while solving the project's dependencies).
</p>

<p>
The goal of the binary repository is to reduce the time it takes to get started working on a new project. Without it, Dune would need to build <code>ocamlformat</code> from source along with all of its dependencies, which can take several minutes.
</p>

<p>
For now only a small number of package versions are contained in the binary repository. To demonstrate, here's what happens if we run <code>dune tools exec ocamlformat</code> in a project with <code>version=0.26.1</code> in its <code>.ocamlformat</code> file:
</p>
<pre class="example" id="org73ed39a">
 $ dune tools exec ocamlformat -- --version
Solution for dev-tools.locks/ocamlformat:
- astring.0.8.5
- base.v0.17.1
- base-bytes.base
- base-unix.base
- camlp-streams.5.0.1
- cmdliner.1.3.0
...
- ocamlformat.0.26.1
...
    Building base-unix.base
    Building ocaml-base-compiler.5.1.1
    Building ocaml-config.3
    Building ocaml.5.1.1
    Building seq.base
    Building cmdliner.1.3.0
...
    Building ocamlformat.0.26.1
     Running 'ocamlformat --version'
0.26.1
</pre>

<p>
Dune parses <code>.ocamlformat</code> to determine which version of <code>ocamlformat</code> to install, and <code>0.26.1</code> is not in the binary repo so it needed to be built from source.
</p>

<p>
If your project requires a version of a package not available in the binary repository, or you're on an operating system or architecture for which no binary version of a package exists, the package will be built from source instead. Currently the binary repository contains binaries of <code>ocamlformat.0.26.2</code>, <code>ocaml-lsp-server.1.18.0</code> and <code>ocaml-lsp-server.1.19.0</code> for <code>x86_64-unknown-linux-musl</code>, <code>x86_64-apple-darwin</code> and <code>aarch64-apple-darwin</code>.
</p>

<p>
Note that Linux binaries are statically linked with muslc so they should work on all distros regardless of dynamic linker.
</p>
</div>
</div>
<div id="outline-container-org5df49c1" class="outline-4">
<h4 id="org5df49c1">Running <code>ocamllsp</code></h4>
<div class="outline-text-4" id="text-org5df49c1">
<p>
The program <code>ocamllsp</code> from the package <code>ocaml-lsp-server</code> analyzes OCaml code and sends information to text editors using the <a href="https://microsoft.github.io/language-server-protocol/">Language Server Protocol</a>. The tool is crucial to OCaml's editor integration and it has a couple of quirks that are worth mentioning here.
</p>

<p>
TL;DR: Install Dune with the install script on the <a href="https://preview.dune.build/">Developer Preview page</a> and you'll get an <a href="https://github.com/ocaml-dune/binary-distribution/blob/main/tool-wrappers/ocamllsp"><code>ocamllsp</code> shell script</a> that will install and run the correct version of <code>ocamllsp</code> for your project.
</p>

<p>
Firstly the <code>ocamllsp</code> executable can only analyze code that has been compiled with the same version of the OCaml compiler as was used to compile the <code>ocamllsp</code> executable itself. Different versions of the <code>ocaml-lsp-server</code> package are incompatible with some versions of the OCaml compiler (e.g. <code>ocaml-lsp-server.1.19.0</code> must be built with at least <code>5.2.0</code> of the compiler). This means that when Dune is choosing which version of <code>ocaml-lsp-server</code> to install it needs to know which version of the compiler your project is using. This is only known after the project has been locked (by running <code>dune pkg lock</code>), so Dune will refuse to install <code>ocamllsp</code> in a project that doesn't have a lock directory or for a project that doesn't depend on the OCaml compiler.
</p>

<pre class="example" id="orgd9d22b6">
$ dune tools exec ocamllsp
Error: Unable to load the lockdir for the default build context.
Hint: Try running 'dune pkg lock'
</pre>

<p>
The <code>ocaml-lsp-server</code> packages in the <a href="https://github.com/ocaml-dune/ocaml-binary-packages">binary repository</a> contain metadata to ensure that the <code>ocamllsp</code> executable that gets installed was built with the same version of the compiler as your project. For example the <code>ocaml-lsp-server</code> package built with <code>ocaml.5.2.0</code> contains this line:
</p>

<pre class="example" id="orgb6c163b">
conflicts: "ocaml" {!= "5.2.0"}
</pre>

<p>
This prevents it from being chosen if the project depends on any version of the compiler other than <code>5.2.0</code>.
</p>

<p>
Another quirk is that <code>ocamllsp</code> will try to invoke the binaries <code>ocamlformat</code> and <code>ocamlformat-rpc</code>, both found in the <code>ocamlformat</code> package. The <code>ocaml-lsp-server</code> package doesn't depend on <code>ocamlformat</code> as the specific version of <code>ocamlformat</code> needed by a project is implied by the project's <code>.ocamlformat</code> file, which package managers don't consider when solving dependencies. This means that in general (whether using Dune or Opam for package management) it's up to the user to make sure that the correct version of <code>ocamlformat</code> is installed in order to use the formatting features of <code>ocamllsp</code>.
</p>

<p>
Otherwise expect this error in your editor:
</p>
<pre class="example" id="org93401c7">
Unable to find 'ocamlformat-rpc' binary. Types on hover may not be well-formatted. You need to install either 'ocamlformat' of version &gt; 0.21.0 or, otherwise, 'ocamlformat-rpc' package.
</pre>

<p>
Even if <code>ocamllsp</code> and <code>ocamlformat</code> are both installed by Dune, if you run <code>dune tools exec ocamllsp</code> you will find that <code>ocamllsp</code> still can't find the <code>ocamlformat</code> or <code>ocamlformat-rpc</code> executables. This is because unlike Opam, Dune does not install tools into your <code>$PATH</code>, and for the sake of simplicity, the <code>dune tools exec &lt;TOOL&gt;</code> command does not modify the environment of the tool it launches. This can be fixed by adding <code>_build/_private/default/.dev-tool/ocamlformat/ocamlformat/target/bin</code> (the directory containing <code>ocamlformat</code> and <code>ocamlformat-rpc</code> when <code>ocamlformat</code> is installed by dune) to the start of your <code>$PATH</code> variable before running <code>dune tools exec ocamllsp</code>. For example starting <code>ocamllsp</code> with the following shell script:
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #6fafff;">OCAMLFORMAT_TARGET</span>=<span style="color: #f06a3f;">"_build/_private/default/.dev-tool/ocamlformat/ocamlformat/target"</span>

<span style="color: #c48702; font-weight: bold;">if</span> [ <span style="font-weight: bold;">!</span> -f $<span style="color: #6fafff;">OCAMLFORMAT_TARGET</span>/cookie ]; <span style="color: #c48702; font-weight: bold;">then</span>
    <span style="color: #cf9f7f; font-style: italic;"># </span><span style="color: #cf9f7f; font-style: italic;">Make sure that the ocamlformat dev tool is installed as it's needed by</span>
    <span style="color: #cf9f7f; font-style: italic;"># </span><span style="color: #cf9f7f; font-style: italic;">ocamllsp. There's currently no command that just installs ocamlformat so</span>
    <span style="color: #cf9f7f; font-style: italic;"># </span><span style="color: #cf9f7f; font-style: italic;">we need to run it and ignore the result.</span>
    dune tools exec ocamlformat -- --help &gt; /dev/null
<span style="color: #c48702; font-weight: bold;">fi</span>

<span style="color: #cf9f7f; font-style: italic;"># </span><span style="color: #cf9f7f; font-style: italic;">Add ocamlformat to the environment in which ocamllsp runs so ocamllsp can invoke ocamlformat.</span>
<span style="color: #ff7a7f; font-weight: bold;">export</span> <span style="color: #6fafff;">PATH</span>=<span style="color: #f06a3f;">"$PWD/$OCAMLFORMAT_TARGET/bin:$PATH"</span>

<span style="color: #cf9f7f; font-style: italic;"># </span><span style="color: #cf9f7f; font-style: italic;">Build and run ocamllsp.</span>
dune tools exec ocamllsp -- <span style="color: #f06a3f;">"$@"</span>
</pre>
</div>

<p>
Of course, it's rare to manually start <code>ocamllsp</code> directly from your terminal. It's normally launched by text editors. It would be impractical to configure your text editor to modify <code>$PATH</code> and run a custom command to start <code>ocamllsp</code> via Dune, and doing so would make it impossible to edit any project that <span class="underline">doesn't</span> use Dune for package management. Instead, the Dune Developer Preview ships with <a href="https://github.com/ocaml-dune/binary-distribution/blob/main/tool-wrappers/ocamllsp">a shell script</a> which installs <code>ocamlformat</code> and adds its <code>bin</code> directory to <code>$PATH</code> before launching <code>dune tools exec ocamllsp</code>. The script is simply named <code>ocamllsp</code>, and the Dune Developer Preview install script adds it to <code>~/.dune/bin</code> which should already be in your <code>$PATH</code> if you're using the Developer Preview. The <code>ocamllsp</code> script also attempts to fall back to an Opam-managed installation of <code>ocamllsp</code> if it doesn't detect a Dune lockdir so the same script should work for non-Dune projects. Because the script is named the same as the <code>ocamllsp</code> executable, most editors don't require special configuration to run it. See the "Editor Configuration" section of the <a href="https://preview.dune.build/">Dune Developer Preview page</a> for more information about setting up your editor.
</p>

<p>
Some parts of the <code>ocamllsp</code> shell script may eventually make their way into Dune itself, but for the time being the shell script is the recommended way to launch <code>ocamllsp</code> for users of the Dune Developer Preview. The net result is that as long as your project has a lockfile, the first time you edit some OCaml code in the project Dune will download and run the appropriate version of <code>ocamllsp</code>.
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-5" class="outline-2">
<h2 id="5">Dune Developer Preview Updates</h2>
<div class="outline-text-2" id="text-5">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-dune-developer-preview-updates/15160/52">https://discuss.ocaml.org/t/ann-dune-developer-preview-updates/15160/52</a>
</p>
</div>
<div id="outline-container-org6c648be" class="outline-3">
<h3 id="org6c648be">Steve Sherratt announced</h3>
<div class="outline-text-3" id="text-org6c648be">
<p>
A new version of the <a href="https://marketplace.visualstudio.com/items?itemName=ocamllabs.ocaml-platform">vscode-ocaml-platform</a> was just released which fixes a few issues with ocamllsp. You'll probably have to update your install of the Dune Developer Preview (just rerun the command on <a href="https://preview.dune.build/">this page</a>). You'll need to configure a custom sandbox for vscode by putting this in your <code>settings.json</code> file as otherwise the plugin assumes you're using <code>opam</code> to launch <code>ocamllsp</code>:
</p>
<div class="org-src-container">
<pre class="src src-json">{
  "ocaml.sandbox": {
    "kind": "custom",
    "template": "$prog $args"
  }
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-6" class="outline-2">
<h2 id="6">First release of cmdlang</h2>
<div class="outline-text-2" id="text-6">
<p>
Archive: <a href="https://discuss.ocaml.org/t/first-release-of-cmdlang/15616/1">https://discuss.ocaml.org/t/first-release-of-cmdlang/15616/1</a>
</p>
</div>
<div id="outline-container-org93a73a9" class="outline-3">
<h3 id="org93a73a9">Mathieu Barbin announced</h3>
<div class="outline-text-3" id="text-org93a73a9">
<p>
Hi everyone!
</p>

<p>
A little while ago, I <a href="https://discuss.ocaml.org/t/cmdlang-yet-another-cli-library-well-not-really/15258">posted</a> about <a href="https://github.com/mbarbin/cmdlang">cmdlang</a>, a library for creating command-line parsers in OCaml.
</p>

<p>
Today, I am happy to give you an update on this project with the announcement of an initial release of cmdlang packages to the opam-repository.
</p>

<p>
These are very early days for this project. I have started using the <code>cmdlang+cmdliner</code> combination in personal projects, and plan to experiment with <code>climate</code> in the near future. Please feel free to engage in issues/discussions, etc.
</p>

<p>
The most recent addition on the project is the development of an evaluation engine based on <code>stdlib/arg</code>.
</p>

<p>
I'd also like to highlight some examples from the project's tests. Developing these characterization tests was a fun way to learn more about the different CLI libraries and their differences:
</p>

<ul class="org-ul">
<li>Short, long and prefix <a href="https://github.com/mbarbin/cmdlang/blob/main/test/expect/test__flag.ml">flag names</a>.</li>
<li>Various syntaxes for <a href="https://github.com/mbarbin/cmdlang/blob/main/test/expect/test__named.ml">named arguments</a> (<code>-pVALUE</code>, <code>-p=VALUE</code>, <code>-p VALUE</code>).</li>
<li>Handling of <a href="https://github.com/mbarbin/cmdlang/blob/main/test/expect/test__negative_int_args.ml">negative integers</a> as named arguments.</li>
</ul>

<p>
If you have ideas for more cases to add (entertaining or otherwise), I'd love to integrate them into the test suite. Thanks!
</p>

<p>
Below, you'll find details of the released packages. Happy command parsing!
</p>

<p>
<b>cmdlang</b> the user facing library to build the commands. It has no dependencies
</p>

<p>
<b>cmdlang-to-cmdliner</b> translate cmdlang commands to cmdliner
</p>

<p>
<b>cmdlang-to-climate</b> translate cmdlang commands to the newly released climate (compatibility checked with 0.1.0 &amp; 0.2.0)
</p>

<p>
<b>cmdlang-stdlib-runner</b> an execution engine implemented on top of stdlib.arg
</p>

<p>
Thank you to @mseri and the opam-repository maintainers for their help.
</p>
</div>
</div>
</div>
<div id="outline-container-7" class="outline-2">
<h2 id="7">findlib-1.9.8</h2>
<div class="outline-text-2" id="text-7">
<p>
Archive: <a href="https://sympa.inria.fr/sympa/arc/caml-list/2024-11/msg00014.html">https://sympa.inria.fr/sympa/arc/caml-list/2024-11/msg00014.html</a>
</p>
</div>
<div id="outline-container-org68d1566" class="outline-3">
<h3 id="org68d1566">Gerd Stolpmann announced</h3>
<div class="outline-text-3" id="text-org68d1566">
<p>
Hi list,
</p>

<p>
findlib-1.9.8 is out, fixing a few issues that slipped into 1.9.7.
</p>

<p>
For manual, download, manuals, etc. see here:
</p>

<p>
<a href="http://projects.camlcity.org/projects/findlib.html">http://projects.camlcity.org/projects/findlib.html</a>
</p>

<p>
An updated OPAM package will follow soon.
</p>
</div>
</div>
</div>
<div id="outline-container-8" class="outline-2">
<h2 id="8">Testo 0.1.0 - a new testing framework for OCaml</h2>
<div class="outline-text-2" id="text-8">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-testo-0-1-0-a-new-testing-framework-for-ocaml/15624/1">https://discuss.ocaml.org/t/ann-testo-0-1-0-a-new-testing-framework-for-ocaml/15624/1</a>
</p>
</div>
<div id="outline-container-org2b70075" class="outline-3">
<h3 id="org2b70075">Martin Jambon announced</h3>
<div class="outline-text-3" id="text-org2b70075">
<p>
On this 86th anniversary of the first synthesis of LSD by Albert Hofmann, it is my pleasure to announce <a href="https://github.com/semgrep/testo">Testo</a>, a new testing library for OCaml.
</p>

<p>
It borrows a lot of ideas from Alcotest and is similar in spirit but adds a few key features that seemed too difficult to incorporate into Alcotest. For a gentle introduction, check out our <a href="https://semgrep.github.io/testo/tutorial/">tutorial</a>. Important features include:
</p>

<ul class="org-ul">
<li>support for many options when creating a test of type <code>Testo.t</code>;</li>
<li>capturing stdout or stderr output for comparison against the expected output aka snapshots;</li>
<li>reviewing and approving tests without re-running them;</li>
<li>support for nested categories while keeping the test suite as a flat list;</li>
<li>parallel execution using multiprocessing.</li>
</ul>

<p>
This is the first official release of Testo and its interface is likely to change in minor ways until we release version 1.0.0. We've been using it internally at Semgrep for about a year and it's been working well for us.
</p>

<p>
Happy testing!
</p>
</div>
</div>
</div>
<div id="outline-container-9" class="outline-2">
<h2 id="9">Other OCaml News</h2>
<div class="outline-text-2" id="text-9">
</div>
<div id="outline-container-orgff54900" class="outline-3">
<h3 id="orgff54900">From the ocaml.org blog</h3>
<div class="outline-text-3" id="text-orgff54900">
<p>
Here are links from many OCaml blogs aggregated at <a href="https://ocaml.org/blog/">the ocaml.org blog</a>.
</p>

<ul class="org-ul">
<li><a href="https://tarides.com/blog/2024-11-13-the-new-conference-on-the-block-what-is-fun-ocaml">The New Conference on the Block: What is FUN OCaml?</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org9c8f903" class="outline-2">
<h2 id="org9c8f903">Old CWN</h2>
<div class="outline-text-2" id="text-org9c8f903">
<p>
If you happen to miss a CWN, you can <a href="mailto:alan.schmitt@polytechnique.org">send me a message</a> and I'll mail it to you, or go take a look at <a href="https://alan.petitepomme.net/cwn/">the archive</a> or the <a href="https://alan.petitepomme.net/cwn/cwn.rss">RSS feed of the archives</a>.
</p>

<p>
If you also wish to receive it every week by mail, you may subscribe to the <a href="https://sympa.inria.fr/sympa/info/caml-list">caml-list</a>.
</p>

<div class="authorname" id="org3a42df7">
<p>
<a href="https://alan.petitepomme.net/">Alan Schmitt</a>
</p>

</div>
</div>
</div>
</div>
</body>
</html>
