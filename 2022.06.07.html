<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-06-07 Tue 12:11 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OCaml Weekly News</title>
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
</style>
<style type="text/css">#table-of-contents h2 { display: none } .title { display: none } .authorname { text-align: right }</style>
<style type="text/css">.outline-2 {border-top: 1px solid black;}</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">OCaml Weekly News</h1>
<p>
<a href="https://alan.petitepomme.net/cwn/2022.05.31.html">Previous Week</a> <a href="https://alan.petitepomme.net/cwn/index.html">Up</a> <a href="https://alan.petitepomme.net/cwn/2022.06.14.html">Next Week</a>
</p>

<p>
Hello
</p>

<p>
Here is the latest OCaml Weekly News, for the week of May 31 to June 07, 2022.
</p>

<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#1">carray.0.0.1</a></li>
<li><a href="#2">ML Family Workshop 2022: Final Call for Presentations</a></li>
<li><a href="#3">OCaml Users and Developers Workshop 2022</a></li>
<li><a href="#4">dkml-c-probe.2.0.0: Cross-compiler friendly definitions for C compiling</a></li>
<li><a href="#5">Full-Stack Web Dev in OCaml Tutorial w/ Dream, Bonsai, and GraphQL</a></li>
<li><a href="#6">Sketch.sh now supports multiple compiler versions, starting with 4.13.1</a></li>
<li><a href="#7">Explicit type binding and mutual recursion</a></li>
<li><a href="#8">findlib-1.9.4</a></li>
<li><a href="#9">omake-0.10.4</a></li>
<li><a href="#org52f95df">Old CWN</a></li>
</ul>
</div>
</div>


<div id="outline-container-1" class="outline-2">
<h2 id="1">carray.0.0.1</h2>
<div class="outline-text-2" id="text-1">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-carray-0-0-1/9938/6">https://discuss.ocaml.org/t/ann-carray-0-0-1/9938/6</a>
</p>
</div>

<div id="outline-container-org51c9368" class="outline-3">
<h3 id="org51c9368">Deep in this threas, Fabian said</h3>
<div class="outline-text-3" id="text-org51c9368">
<p>
Note that you can, to a certain degree, build your own flat structures with the <code>Bytes</code>
module. Compared to bigarrays, <code>Bytes.t</code> has less indirection, a lower constant memory
overhead and can be allocated on the minor heap. The contents of <code>Bytes.t</code> are not scanned by
the GC, just like bigarrays.
</p>

<p>
For example, a more efficient <code>int32 Array.t</code>:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">module</span> <span style="color: #228b22;">Int32_array</span> : <span style="color: #000000; font-weight: bold;">sig</span>
  <span style="color: #000000; font-weight: bold;">type</span> <span style="color: #228b22;">t</span>
  <span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">equal</span> : t -&gt; t -&gt; bool
  <span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">create</span> : int -&gt; t
  <span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">length</span> : t -&gt; int
  <span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">get</span> : t -&gt; int -&gt; int32
  <span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">set</span> : t -&gt; int -&gt; int32 -&gt; unit
  <span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">sub</span> : t -&gt; int -&gt; int -&gt; t
  <span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">to_list</span> : bytes -&gt; int32 list
<span style="color: #000000; font-weight: bold;">end</span> = <span style="color: #000000; font-weight: bold;">struct</span>
  <span style="color: #000000; font-weight: bold;">type</span> <span style="color: #228b22;">t</span> = <span style="color: #228b22;">Bytes.</span>t
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">equal</span> = <span style="color: #228b22;">Bytes.</span>equal
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">create</span> <span style="color: #a0522d;">len</span> = <span style="color: #228b22;">Bytes.</span>create (4 * len)
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">length</span> <span style="color: #a0522d;">t</span> = <span style="color: #228b22;">Bytes.</span>length t / 4
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">get</span> <span style="color: #a0522d;">t</span> <span style="color: #a0522d;">i</span> = <span style="color: #228b22;">Bytes.</span>get_int32_le t (4 * i)
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">set</span> <span style="color: #a0522d;">t</span> <span style="color: #a0522d;">i</span> <span style="color: #a0522d;">x</span> = <span style="color: #228b22;">Bytes.</span>set_int32_le t (4 * i) x
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">sub</span> <span style="color: #a0522d;">t</span> <span style="color: #a0522d;">pos</span> <span style="color: #a0522d;">len</span> = <span style="color: #228b22;">Bytes.</span>sub t (4 * pos) (4 * len)
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">to_list</span> <span style="color: #a0522d;">t</span> = <span style="color: #228b22;">List.</span>init (length t) (get t)
<span style="color: #000000; font-weight: bold;">end</span>
</pre>
</div>

<p>
A more efficient <code>(int * int)</code>:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">module</span> <span style="color: #228b22;">Point</span> : <span style="color: #000000; font-weight: bold;">sig</span>
  <span style="color: #000000; font-weight: bold;">type</span> <span style="color: #228b22;">t</span>
  <span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">create</span> : int -&gt; int -&gt; t
  <span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">x</span> : t -&gt; int
  <span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">y</span> : t -&gt; int
<span style="color: #000000; font-weight: bold;">end</span> = <span style="color: #000000; font-weight: bold;">struct</span>
  <span style="color: #000000; font-weight: bold;">external</span> <span style="color: #0000ff;">get_int64_unsafe</span> : bytes -&gt; int -&gt; int64 = <span style="color: #8b2252;">"%caml_bytes_get64u"</span>
  <span style="color: #000000; font-weight: bold;">external</span> <span style="color: #0000ff;">set_int64_unsafe</span> : bytes -&gt; int -&gt; int64 -&gt; unit = <span style="color: #8b2252;">"%caml_bytes_set64u"</span>
  <span style="color: #000000; font-weight: bold;">type</span> <span style="color: #228b22;">t</span> = <span style="color: #228b22;">Bytes.</span>t
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">create</span> <span style="color: #a0522d;">x</span> <span style="color: #a0522d;">y</span> =
    <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">p</span> = <span style="color: #228b22;">Bytes.</span>create 16 <span style="color: #000000; font-weight: bold;">in</span>
    set_int64_unsafe p 0 (<span style="color: #228b22;">Int64.</span>of_int x);
    set_int64_unsafe p 8 (<span style="color: #228b22;">Int64.</span>of_int y);
    p
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">x</span> <span style="color: #a0522d;">t</span> = <span style="color: #228b22;">Int64.</span>to_int (get_int64_unsafe t 0)
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">y</span> <span style="color: #a0522d;">t</span> = <span style="color: #228b22;">Int64.</span>to_int (get_int64_unsafe t 8)
<span style="color: #000000; font-weight: bold;">end</span>
</pre>
</div>

<p>
(making a more efficient <code>(int * int) Array.t</code> is left as an exercise to the reader)
</p>

<p>
The downside compared to bigarrays is that it doesn't support <code>sub</code> without copying. Also,
bytes can be moved by the GC (during minor GCs or compaction), and therefore you cannot
release the runtime lock when passing them to C. The latter point is less relevant with the
multicore extensions, especially since there is no compactor yet. There is some related
discussion on the eio repository: <a href="https://github.com/ocaml-multicore/eio/issues/140">https://github.com/ocaml-multicore/eio/issues/140</a>
</p>
</div>
</div>
</div>




<div id="outline-container-2" class="outline-2">
<h2 id="2">ML Family Workshop 2022: Final Call for Presentations</h2>
<div class="outline-text-2" id="text-2">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ml-family-workshop-2022-final-call-for-presentations/9877/2">https://discuss.ocaml.org/t/ml-family-workshop-2022-final-call-for-presentations/9877/2</a>
</p>
</div>

<div id="outline-container-orgb7ecb95" class="outline-3">
<h3 id="orgb7ecb95">Benoit Montagu announced</h3>
<div class="outline-text-3" id="text-orgb7ecb95">
</div>
<div id="outline-container-orgea0558f" class="outline-4">
<h4 id="orgea0558f">ML Family Workshop 2022: DEADLINE EXTENSION</h4>
<div class="outline-text-4" id="text-orgea0558f">
<p>
To increase your chances of submitting your work to the ML workshop,
<b>the submission deadline is extended by a week</b>.
The new deadline is Friday 10th June (AoE).
</p>

<p>
A quick reminder:
</p>
<ul class="org-ul">
<li>The workshop does not have proceedings, making it the perfect venue
to run some ideas with the community or present some work in
progress within a friendly environment.</li>
<li>The work load as an author is low: submissions are only 3 pages long
(excluding references)</li>
<li>YOU have the power to make the ML workshop a success!</li>
<li>You have one more full week to submit to <a href="https://ml2022.hotcrp.com/">https://ml2022.hotcrp.com/</a>
(please register your submission early!)</li>
<li>All the details are here:
<a href="https://icfp22.sigplan.org/home/mlfamilyworkshop-2022#Call-for-Presentations">https://icfp22.sigplan.org/home/mlfamilyworkshop-2022#Call-for-Presentations</a></li>
<li>The ML workshop is colocated with ICFP 2022 <a href="https://icfp22.sigplan.org/">https://icfp22.sigplan.org/</a></li>
</ul>
</div>
</div>
</div>
</div>




<div id="outline-container-3" class="outline-2">
<h2 id="3">OCaml Users and Developers Workshop 2022</h2>
<div class="outline-text-2" id="text-3">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ocaml-users-and-developers-workshop-2022/9726/4">https://discuss.ocaml.org/t/ocaml-users-and-developers-workshop-2022/9726/4</a>
</p>
</div>

<div id="outline-container-org149ca72" class="outline-3">
<h3 id="org149ca72">Matija Pretnar announced</h3>
<div class="outline-text-3" id="text-org149ca72">
<p>
To offer additional opportunities to contribute to the OCaml workshop, and to align with the
<a href="https://icfp22.sigplan.org/home/mlfamilyworkshop-2022#Call-for-Presentations">ML family
workshop</a>, to
which you are also cordially invited, the submission deadline has been extended by a week to
<b>Friday, June 10</b> (anywhere on Earth).
</p>
</div>
</div>
</div>




<div id="outline-container-4" class="outline-2">
<h2 id="4">dkml-c-probe.2.0.0: Cross-compiler friendly definitions for C compiling</h2>
<div class="outline-text-2" id="text-4">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-dkml-c-probe-2-0-0-cross-compiler-friendly-definitions-for-c-compiling/9950/1">https://discuss.ocaml.org/t/ann-dkml-c-probe-2-0-0-cross-compiler-friendly-definitions-for-c-compiling/9950/1</a>
</p>
</div>

<div id="outline-container-org0466af4" class="outline-3">
<h3 id="org0466af4">jbeckford announced</h3>
<div class="outline-text-3" id="text-org0466af4">
<p>
Summary: dkml-c-probe is a new package for maintainers who compile or link C code. Install it
with <code>opam install dkml-c-probe</code>. Full docs are at
<a href="https://github.com/diskuv/dkml-c-probe#readme">https://github.com/diskuv/dkml-c-probe#readme</a>
</p>
</div>

<div id="outline-container-org9e8345c" class="outline-4">
<h4 id="org9e8345c">Problem</h4>
<div class="outline-text-4" id="text-org9e8345c">
<p>
You are creating an OCaml package that has foreign C code. Perhaps you need special C headers
or libraries when you are targeting Apple users, or perhaps you need to execute custom OCaml
code for Android users. More generally you need a way to determine whether your OCaml or C
code is compiling for a Linux AMD/Intel 64-bit, Android ARM 32-bit, or any other ABI target.
</p>
</div>
</div>

<div id="outline-container-orga3aa096" class="outline-4">
<h4 id="orga3aa096">Solution</h4>
<div class="outline-text-4" id="text-orga3aa096">
<p>
A user of your OCaml package may, for example, be on a 64-bit AMD/Intel Linux machine using a
32-bit OCaml system compiled with <code>gcc -m32</code>; additionally they have a 32-bit Android ARM
cross-compiler toolchain. <code>dkml-c-probe</code> will tell you the target operating system is <code>Linux</code>
and the target ABI is <code>Linux_x86</code> except when the cross-compiler toolchain is invoked. With
the cross-compiler toolchain <code>dkml-c-probe</code> will tell you the target operating system is
<code>Android</code> and the target ABI is <code>Android_arm32v7a</code>.
</p>
</div>
</div>

<div id="outline-container-org15cff99" class="outline-4">
<h4 id="org15cff99">How it works</h4>
<div class="outline-text-4" id="text-org15cff99">
<p>
<code>dkml-c-probe</code> uses C preprocessor definitions (ex. <code>#if TARGET_CPU_X86_64</code>, <code>#if
__ANDROID__</code>, etc.) to determine which ABI the C compiler (ex. <code>ocamlopt -config | grep
native_c_compiler</code>) is targeting.
</p>

<p>
This isn't a new idea. The pattern is used in Esy and Mirage code as well. <code>dkml-c-probe</code>
just codifies the pattern for use in your own code.
</p>
</div>
</div>

<div id="outline-container-org6d88006" class="outline-4">
<h4 id="org6d88006">Usage</h4>
<div class="outline-text-4" id="text-org6d88006">
<p>
In OCaml code you can use the <i>versioned</i> module:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">module</span> <span style="color: #228b22;">V2</span> :
  <span style="color: #000000; font-weight: bold;">sig</span>
    <span style="color: #000000; font-weight: bold;">type</span> <span style="color: #228b22;">t_os</span> = <span style="color: #000000; background-color: #ffffff;">Android</span> | <span style="color: #000000; background-color: #ffffff;">IOS</span> | <span style="color: #000000; background-color: #ffffff;">Linux</span> | <span style="color: #000000; background-color: #ffffff;">OSX</span> | <span style="color: #000000; background-color: #ffffff;">Windows</span>
    <span style="color: #000000; font-weight: bold;">type</span> <span style="color: #228b22;">t_abi</span> =
        <span style="color: #000000; background-color: #ffffff;">Android_arm64v8a</span>
      | <span style="color: #000000; background-color: #ffffff;">Android_arm32v7a</span>
      | <span style="color: #000000; background-color: #ffffff;">Android_x86</span>
      | <span style="color: #000000; background-color: #ffffff;">Android_x86_64</span>
      | <span style="color: #000000; background-color: #ffffff;">Darwin_arm64</span>
      | <span style="color: #000000; background-color: #ffffff;">Darwin_x86_64</span>
      | <span style="color: #000000; background-color: #ffffff;">Linux_arm64</span>
      | <span style="color: #000000; background-color: #ffffff;">Linux_arm32v6</span>
      | <span style="color: #000000; background-color: #ffffff;">Linux_arm32v7</span>
      | <span style="color: #000000; background-color: #ffffff;">Linux_x86_64</span>
      | <span style="color: #000000; background-color: #ffffff;">Linux_x86</span>
      | <span style="color: #000000; background-color: #ffffff;">Windows_x86_64</span>
      | <span style="color: #000000; background-color: #ffffff;">Windows_x86</span>
      | <span style="color: #000000; background-color: #ffffff;">Windows_arm64</span>
      | <span style="color: #000000; background-color: #ffffff;">Windows_arm32</span>
    <span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">get_os</span> : (t_os, <span style="color: #228b22;">Rresult.R.</span>msg) result <span style="color: #228b22;">Lazy.</span>t
    <span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">get_abi</span> : (t_abi, <span style="color: #228b22;">Rresult.R.</span>msg) result <span style="color: #228b22;">Lazy.</span>t
    <span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">get_abi_name</span> : (string, <span style="color: #228b22;">Rresult.R.</span>msg) result <span style="color: #228b22;">Lazy.</span>t
  <span style="color: #000000; font-weight: bold;">end</span>
</pre>
</div>

<p>
In C code you can use the <a href="https://github.com/diskuv/dkml-c-probe#c-header">provided <code>dkml_compiler_probe.h</code>
header</a> from within Dune or Opam. Here is a
snippet that handles part of the Linux introspection:
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #483d8b;">#elif</span> __linux__
<span style="color: #483d8b;">#   if</span> __ANDROID__
#       ...
<span style="color: #483d8b;">#   else</span>
<span style="color: #483d8b;">#       define</span> <span style="color: #a0522d;">DKML_OS_NAME</span> <span style="color: #8b2252;">"Linux"</span>
<span style="color: #483d8b;">#       define</span> <span style="color: #a0522d;">DKML_OS_Linux</span>
<span style="color: #483d8b;">#       if</span> __aarch64__
<span style="color: #483d8b;">#           define</span> <span style="color: #a0522d;">DKML_ABI</span> <span style="color: #8b2252;">"linux_arm64"</span>
<span style="color: #483d8b;">#           define</span> <span style="color: #a0522d;">DKML_ABI_linux_arm64</span>
<span style="color: #483d8b;">#       elif</span> __arm__
<span style="color: #483d8b;">#           if</span> <span style="color: #483d8b;">defined</span>(__ARM_ARCH_6__) || <span style="color: #483d8b;">defined</span>(__ARM_ARCH_6J__) ||
defined(__ARM_ARCH_6K__) || defined(__ARM_ARCH_6Z__) || defined(__ARM_ARCH_6ZK__) ||
defined(__ARM_ARCH_6T2__)
<span style="color: #483d8b;">#               define</span> <span style="color: #a0522d;">DKML_ABI</span> <span style="color: #8b2252;">"linux_arm32v6"</span>
<span style="color: #483d8b;">#               define</span> <span style="color: #a0522d;">DKML_ABI_linux_arm32v6</span>
<span style="color: #483d8b;">#           elif</span> <span style="color: #483d8b;">defined</span>(__ARM_ARCH_7__) || <span style="color: #483d8b;">defined</span>(__ARM_ARCH_7A__) ||
<span style="color: #0000ff;">defined</span>(__ARM_ARCH_7R__) || defined(__ARM_ARCH_7M__) || defined(__ARM_ARCH_7S__)
<span style="color: #483d8b;">#               define</span> <span style="color: #a0522d;">DKML_ABI</span> <span style="color: #8b2252;">"linux_arm32v7"</span>
<span style="color: #483d8b;">#               define</span> <span style="color: #a0522d;">DKML_ABI_linux_arm32v7</span>
<span style="color: #483d8b;">#           endif</span> <span style="color: #b22222;">/* </span><span style="color: #b22222;">__ARM_ARCH_6__ || ...,  __ARM_ARCH_7__ || ...</span><span style="color: #b22222;"> */</span>
<span style="color: #483d8b;">#       elif</span> __x86_64__
<span style="color: #483d8b;">#           define</span> <span style="color: #a0522d;">DKML_ABI</span> <span style="color: #8b2252;">"linux_x86_64"</span>
<span style="color: #483d8b;">#           define</span> <span style="color: #a0522d;">DKML_ABI_linux_x86_64</span>
<span style="color: #483d8b;">#       elif</span> __i386__
<span style="color: #483d8b;">#           define</span> <span style="color: #a0522d;">DKML_ABI</span> <span style="color: #8b2252;">"linux_x86"</span>
<span style="color: #483d8b;">#           define</span> <span style="color: #a0522d;">DKML_ABI_linux_x86</span>
<span style="color: #483d8b;">#       elif</span> <span style="color: #483d8b;">defined</span>(__ppc64__) || <span style="color: #483d8b;">defined</span>(__PPC64__)
<span style="color: #483d8b;">#           define</span> <span style="color: #a0522d;">DKML_ABI</span> <span style="color: #8b2252;">"linux_ppc64"</span>
<span style="color: #483d8b;">#           define</span> <span style="color: #a0522d;">DKML_ABI_linux_ppc64</span>
<span style="color: #483d8b;">#       elif</span> __s390x__
<span style="color: #483d8b;">#           define</span> <span style="color: #a0522d;">DKML_ABI</span> <span style="color: #8b2252;">"linux_s390x"</span>
<span style="color: #483d8b;">#           define</span> <span style="color: #a0522d;">DKML_ABI_linux_s390x</span>
<span style="color: #483d8b;">#       endif</span> <span style="color: #b22222;">/* </span><span style="color: #b22222;">__aarch64__, __arm__, __x86_64__, __i386__, __ppc64__ || __PPC64__,</span>
<span style="color: #b22222;">__s390x__</span><span style="color: #b22222;"> */</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge32b3ca" class="outline-4">
<h4 id="orge32b3ca">Versioning and Contributing</h4>
<div class="outline-text-4" id="text-orge32b3ca">
<p>
Whenever a new ABI is added, it goes into a new version (ex. <code>module V3</code>). Your existing code
that uses <code>module V2</code> will be unaffected.
</p>

<p>
But each new ABI needs to have its own maintainer because I don't have access to every
hardware platform on the planet!
</p>

<p>
For example, PowerPC (<code>ppc64</code>) and Linux on IBM Z (<code>s390x</code>) are supported in the C Header but
not the OCaml module because there are no PowerPC and S390x maintainers.
</p>

<p>
Please consider contributing, especially if you want others to have an easier compilation
story for your favorite hardware platform.
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-5" class="outline-2">
<h2 id="5">Full-Stack Web Dev in OCaml Tutorial w/ Dream, Bonsai, and GraphQL</h2>
<div class="outline-text-2" id="text-5">
<p>
Archive: <a href="https://discuss.ocaml.org/t/full-stack-web-dev-in-ocaml-tutorial-w-dream-bonsai-and-graphql/9963/1">https://discuss.ocaml.org/t/full-stack-web-dev-in-ocaml-tutorial-w-dream-bonsai-and-graphql/9963/1</a>
</p>
</div>

<div id="outline-container-org9cac6e7" class="outline-3">
<h3 id="org9cac6e7">Alexander (Sasha) Skvortsov announced</h3>
<div class="outline-text-3" id="text-org9cac6e7">
<p>
Hi everyone! I’ve written a tutorial blog series about full-stack web development in OCaml,
and wanted to share it here.
</p>

<p>
Last semester, I took Penn State's <a href="https://bulletins.psu.edu/university-course-descriptions/undergraduate/cmpsc/#:~:text=CMPSC%20431W%3A%20Database%20Management%20Systems">CMPSC
431W</a>,
where our final project was to build a database-driven web application. Since I'm fairly
familiar with web programming through my work on <a href="https://flarum.org/">Flarum</a> and past
internships/side projects, I decided to use this opportunity to explore the OCaml web
development ecosystem. I used <a href="https://aantron.github.io/dream/">Dream</a> for the backend, and
<a href="https://github.com/janestreet/bonsai">Bonsai</a> for the frontend.
</p>

<p>
While working on this project, I realized two things:
</p>

<ul class="org-ul">
<li>OCaml is very underrated for web development. In addition to all the language’s great features and safety guarantees, the ecosystem is pretty good! Dream near-perfectly coincides with my vision of backend webdev, and Bonsai has a great balance of flexibility/elegance and safety.</li>
<li>I couldn’t find realistic but accessible full-stack web projects in OCaml available for reference. I found <a href="https://github.com/paurkedal/ocaml-caqti">tutorials</a> for <a href="https://jsthomas.github.io/ocaml-dream-api.html">bits</a> and <a href="https://github.com/janestreet/bonsai/blob/master/docs/getting_started/counters.mdx">pieces</a>, but nothing that connected all the dots.</li>
</ul>

<p>
I really enjoyed writing an article series on <a href="https://discuss.ocaml.org/t/hardcaml-mips-cpu-learning-project-and-blog/8088">hardware design with
OCaml</a>, so I
decided to do so for web development as well. In total, I wrote 7 articles that walk through
my project’s:
</p>

<ol class="org-ol">
<li><a href="https://ceramichacker.com/blog/26-1x-full-stack-webdev-in-ocaml-intro">Full-Stack WebDev in OCaml Intro</a>. This includes some background on the project, and instructions for accessing the <a href="https://cmpsc431.ceramichacker.com/">live demo</a>.</li>
<li><a href="https://ceramichacker.com/blog/28-2x-backend-webdev-w-dream-and-caqti">Backend WebDev w/ Dream and Caqti</a>.</li>
<li><a href="https://ceramichacker.com/blog/29-3x-building-graphql-apis-with-dream">Building GraphQL APIs with Dream</a></li>
<li><a href="https://ceramichacker.com/blog/30-4x-setting-up-bonsai">Setting up Bonsai</a>.</li>
<li><a href="https://ceramichacker.com/blog/31-5x-understanding-bonsai">Understanding Bonsai</a>. I actually wrote the first draft of this before I decided to do a blog, while trying to, well, understand Bonsai. It goes over some underlying concepts (SPAs, Frontend State Management, Algebraic Effects, Monads), as well as Bonsai’s core design.</li>
<li><a href="https://ceramichacker.com/blog/32-6x-using-graphql-in-bonsai">Using GraphQL in Bonsai</a>.</li>
<li><a href="https://ceramichacker.com/blog/33-77-routing-in-bonsai-and-project-conclusion">Routing in Bonsai and Project Conclusion</a>.</li>
</ol>

<p>
Additionally, the <a href="https://github.com/askvortsov1/nittany_market">project’s README</a> has a
comprehensive overview of the tech stack, folder structure, and usage instructions. It also
includes some reflections on design decisions and my experience working with these libraries.
</p>

<p>
I had a lot of fun writing these, and I hope they’re useful to anyone considering OCaml for
web development. Would be happy to answer any questions or comments.
</p>
</div>
</div>


<div id="outline-container-org339df25" class="outline-3">
<h3 id="org339df25">Alexander (Sasha) Skvortsov later added</h3>
<div class="outline-text-3" id="text-org339df25">
<p>
Also, forgot to mention this
originally, but I recommend accessing the demo with one of the emails from <a href="https://github.com/askvortsov1/nittany_market/blob/main/data/Local_Vendors.csv">this
file</a> or
<a href="https://github.com/askvortsov1/nittany_market/blob/main/data/Sellers.csv">this file</a> (all
passwords are still
<a href="https://github.com/askvortsov1/nittany_market/blob/main/data/Users.csv">here</a>), as those
users can also demo create/update functionalities.
</p>
</div>
</div>


<div id="outline-container-org8bb2e88" class="outline-3">
<h3 id="org8bb2e88">Daniel Bünzli replied</h3>
<div class="outline-text-3" id="text-org8bb2e88">
<p>
People who are looking for more lightweight alternatives – and want to do web programming without bothering too much about front end insanity can have a look at
<a href="https://erratique.ch/software/hc">hc</a> (yes indeed: sending HTML over <code>fetch</code>, web programming excels at running in circles).
</p>

<p>
The front JavaScript for that <a href="https://github.com/dbuenzli/hyperbib">CRUD webapp</a> comes out at 132Ko uncompressed without even trying to tweak anything.
</p>
</div>
</div>
</div>




<div id="outline-container-6" class="outline-2">
<h2 id="6">Sketch.sh now supports multiple compiler versions, starting with 4.13.1</h2>
<div class="outline-text-2" id="text-6">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-sketch-sh-now-supports-multiple-compiler-versions-starting-with-4-13-1/9971/1">https://discuss.ocaml.org/t/ann-sketch-sh-now-supports-multiple-compiler-versions-starting-with-4-13-1/9971/1</a>
</p>
</div>

<div id="outline-container-orgf7a3a35" class="outline-3">
<h3 id="orgf7a3a35">Javier Chávarri announced</h3>
<div class="outline-text-3" id="text-orgf7a3a35">
<p>
The interactive OCaml sketchbook <a href="https://sketch.sh/">sketch.sh</a> has now support to store,
edit and run sketches in different versions of the OCaml compiler.
</p>
</div>

<div id="outline-container-org67fb6d4" class="outline-4">
<h4 id="org67fb6d4">Support for 4.13</h4>
<div class="outline-text-4" id="text-org67fb6d4">
<p>
Storing and running sketches using the compiler version 4.13.1 is now possible, this
functionality has been added to the already existing support for version 4.06.1. The Reason
parser and formatting tool refmt were also updated to a more recent version that supports
4.13.1.
</p>

<p>
Here you can see a sketch showcasing the monadic let syntax, using the example from the
official OCaml docs: <a href="https://sketch.sh/s/8cnNChTTq6IoGeFQarbvN2/">ZipSeq - Sketch.sh</a>.
</p>
</div>
</div>

<div id="outline-container-org20945b8" class="outline-4">
<h4 id="org20945b8">Existing sketches and forks</h4>
<div class="outline-text-4" id="text-org20945b8">
<p>
Previously existing sketches remain in 4.06.1, while newly created sketches will be on
4.13.1. For now, the only way to "migrate" a sketch to the newer version of the compiler is
by copying its content and pasting it in a new sketch.
</p>

<p>
Forked sketches inherit the compiler version of the forked sketch.
</p>
</div>
</div>

<div id="outline-container-org57f918f" class="outline-4">
<h4 id="org57f918f">Future plans</h4>
<div class="outline-text-4" id="text-org57f918f">
<p>
In the future, there are plans to support version 4.14.0 of the compiler, and we are
considering adding a way so that the version of the compiler can be chosen for a given
sketch. We are also working on migrating the editor UI codebase to a more recent version of
ReasonReact, and use JSX3 instead of JSX2.
</p>
</div>
</div>

<div id="outline-container-org77898f8" class="outline-4">
<h4 id="org77898f8">Feature requests and bugs</h4>
<div class="outline-text-4" id="text-org77898f8">
<p>
Please <a href="https://github.com/Sketch-sh/sketch-sh/issues/new">let us know</a> in case you have a
feature request, or if you encounter any issues or bugs. Also, don't hesitate to reach out
via DM or any other means if you would like to contribute or participate in the project in
some way.
</p>

<p>
Thanks to <a href="https://ahrefs.com/">Ahrefs</a> for supporting an Open Source Day initiative, which
allowed to allocate time to work on this improvement for sketch.sh, and for providing the
infrastructure to run the sketch.sh service for the community. Thanks as well to the authors
and maintainers of the OCaml compiler, js_of_ocaml, and ReScript, that sketch.sh relies upon.
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-7" class="outline-2">
<h2 id="7">Explicit type binding and mutual recursion</h2>
<div class="outline-text-2" id="text-7">
<p>
Archive: <a href="https://discuss.ocaml.org/t/explicit-type-binding-and-mutual-recursion/9973/3">https://discuss.ocaml.org/t/explicit-type-binding-and-mutual-recursion/9973/3</a>
</p>
</div>

<div id="outline-container-org366e1c0" class="outline-3">
<h3 id="org366e1c0">Deep in this thread, octachron explained</h3>
<div class="outline-text-3" id="text-org366e1c0">
<p>
For most use cases, if you want an explicit annotation for recursive function, it will be
much simpler to use the <code>type a. ...</code> form:
</p>
<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #000000; font-weight: bold;">rec</span> <span style="color: #0000ff;">foo</span>:<span style="color: #228b22;"> </span><span style="color: #a020f0;">type</span><span style="color: #228b22;"> a. a -&gt; a </span>= <span style="color: #a020f0;">fun</span> <span style="color: #a0522d;">x</span> -&gt; x
<span style="color: #000000; font-weight: bold;">and</span> <span style="color: #0000ff;">bar</span>:<span style="color: #228b22;"> </span><span style="color: #a020f0;">type</span><span style="color: #228b22;"> a. a -&gt; a </span>= <span style="color: #a020f0;">fun</span> <span style="color: #a0522d;">x</span> -&gt; foo x
</pre>
</div>
<p>
This form is a shortcut for both adding an explicit universal quantified and and a
corresponding locally abstract type (in other words ~let f :  'a . &#x2026;. = fun (type a) -&gt; &#x2026; ~).
</p>

<p>
The root issue with
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #000000; font-weight: bold;">rec</span> <span style="color: #0000ff;">f</span> (<span style="color: #a020f0;">type</span> <span style="color: #228b22;">a</span>) (<span style="color: #a0522d;">x</span>:<span style="color: #228b22;">a</span>) = f x
</pre>
</div>
<p>
is that the locally abstract type <code>a</code> is introduced after <code>f</code>. Moreover, without an explicit
type annotation, a recursive function like <code>f</code> is monomorphic in its body and a monorphic
function cannot be called on a type that was defined after the function.
</p>

<p>
In other words, the issue is that in term of type scopes, the function <code>f</code> is equivalent to
</p>
<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">f</span> = <span style="color: #483d8b;">ref</span> <span style="color: #228b22;">Fun.</span>id
<span style="color: #000000; font-weight: bold;">type</span> <span style="color: #228b22;">t</span> = <span style="color: #000000; background-color: #ffffff;">A</span>
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">x</span> = <span style="color: #a52a2a;">!</span>f A
</pre>
</div>
<p>
which also fails with
</p>
<pre class="example" id="orgf529507">
Error: This expression has type t but an expression was expected of type 'a
       The type constructor t would escape its scope
</pre>
<p>
This is why the second solution proposed by @Gopiandcode  works. Indeed, in
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">foo</span>, <span style="color: #a0522d;">bar</span> = <span style="color: #a020f0;">fun</span> (<span style="color: #a020f0;">type</span> <span style="color: #228b22;">a</span>) -&gt;
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #000000; font-weight: bold;">rec</span> <span style="color: #0000ff;">foo</span> (<span style="color: #a0522d;">x</span>:<span style="color: #228b22;"> a</span>) :<span style="color: #228b22;"> a </span>= x
  <span style="color: #000000; font-weight: bold;">and</span> <span style="color: #0000ff;">bar</span> (<span style="color: #a0522d;">x</span>:<span style="color: #228b22;"> a</span>) :<span style="color: #228b22;"> a </span>= foo x <span style="color: #000000; font-weight: bold;">in</span>
  foo, bar
</pre>
</div>
<p>
the type <code>a</code> is defined before the recursive functions <code>foo</code> and <code>bar</code>, thus <code>foo a</code> does not
break any scope constraint.
</p>
</div>
</div>
</div>




<div id="outline-container-8" class="outline-2">
<h2 id="8">findlib-1.9.4</h2>
<div class="outline-text-2" id="text-8">
<p>
Archive: <a href="https://sympa.inria.fr/sympa/arc/caml-list/2022-06/msg00004.html">https://sympa.inria.fr/sympa/arc/caml-list/2022-06/msg00004.html</a>
</p>
</div>

<div id="outline-container-org090e473" class="outline-3">
<h3 id="org090e473">Gerd Stolpmann announced</h3>
<div class="outline-text-3" id="text-org090e473">
<p>
findlib-1.9.4 is out. It mainly includes a change in the configuration
script needed for OCaml-4-14.
</p>

<p>
For manual, download, manuals, etc. see here:
</p>

<p>
<a href="http://projects.camlcity.org/projects/findlib.html">http://projects.camlcity.org/projects/findlib.html</a>
</p>

<p>
An updated OPAM package will follow soon.
</p>
</div>
</div>
</div>




<div id="outline-container-9" class="outline-2">
<h2 id="9">omake-0.10.4</h2>
<div class="outline-text-2" id="text-9">
<p>
Archive: <a href="https://sympa.inria.fr/sympa/arc/caml-list/2022-06/msg00005.html">https://sympa.inria.fr/sympa/arc/caml-list/2022-06/msg00005.html</a>
</p>
</div>

<div id="outline-container-orgc8e7c93" class="outline-3">
<h3 id="orgc8e7c93">Gerd Stolpmann announced</h3>
<div class="outline-text-3" id="text-orgc8e7c93">
<p>
I just released omake-0.10.4, the build utility. This finally includes
the fix for Apple Silicon, but also
a couple of small changes (roughly everything since PR#100 to PR#146 on
GitHub).
</p>

<p>
For docs and the download link see
<a href="http://projects.camlcity.org/projects/omake.html">http://projects.camlcity.org/projects/omake.html</a>. opam is underway.
</p>
</div>
</div>
</div>




<div id="outline-container-org52f95df" class="outline-2">
<h2 id="org52f95df">Old CWN</h2>
<div class="outline-text-2" id="text-org52f95df">
<p>
If you happen to miss a CWN, you can <a href="mailto:alan.schmitt@polytechnique.org">send me a message</a> and I'll mail it to you, or go take a look at <a href="https://alan.petitepomme.net/cwn/">the archive</a> or the <a href="https://alan.petitepomme.net/cwn/cwn.rss">RSS feed of the archives</a>.
</p>

<p>
If you also wish to receive it every week by mail, you may subscribe <a href="http://lists.idyll.org/listinfo/caml-news-weekly/">online</a>.
</p>

<div class="authorname" id="orgc343c75">
<p>
<a href="https://alan.petitepomme.net/">Alan Schmitt</a>
</p>

</div>
</div>
</div>
</div>
</body>
</html>
