<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2024-12-03 Tue 15:42 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OCaml Weekly News</title>
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<style type="text/css">#table-of-contents h2 { display: none } .title { display: none } .authorname { text-align: right }</style>
<style type="text/css">.outline-2 {border-top: 1px solid black;}</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">OCaml Weekly News</h1>
<p>
<a href="https://alan.petitepomme.net/cwn/2024.11.26.html">Previous Week</a> <a href="https://alan.petitepomme.net/cwn/index.html">Up</a> <a href="https://alan.petitepomme.net/cwn/2024.12.10.html">Next Week</a>
</p>

<p>
Hello
</p>

<p>
Here is the latest OCaml Weekly News, for the week of November 26 to December 03, 2024.
</p>

<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#1">Good example of handwritten Lexer + Recursive Descent Parser?</a></li>
<li><a href="#2">Boulder Dash in OCaml</a></li>
<li><a href="#3">Js_of_ocaml 5.9.0</a></li>
<li><a href="#4">Liquidsoap 2.3.0</a></li>
<li><a href="#5">Bytesrw 0.1.0 – Composable byte stream readers and writers</a></li>
<li><a href="#6">dream-html and pure-html 3.5.2</a></li>
<li><a href="#7">Second beta release of OCaml 5.3.0</a></li>
<li><a href="#8">New release of Monolith</a></li>
<li><a href="#9">Jsont 0.1.0 – Declarative JSON data manipulation for OCaml</a></li>
<li><a href="#10">Tiny educational concurrent I/O and promises library</a></li>
<li><a href="#11">Eliom 11.1: Towards Web Assembly support</a></li>
<li><a href="#12">Areas and Adversaries</a></li>
<li><a href="#13">MariaDB 1.2.0</a></li>
<li><a href="#14">Proposed Package Archiving Policy for the opam Repository</a></li>
<li><a href="#15">capnp-rpc 2.0</a></li>
<li><a href="#16">Other OCaml News</a></li>
<li><a href="#org9cd4b78">Old CWN</a></li>
</ul>
</div>
</div>
<div id="outline-container-1" class="outline-2">
<h2 id="1">Good example of handwritten Lexer + Recursive Descent Parser?</h2>
<div class="outline-text-2" id="text-1">
<p>
Archive: <a href="https://discuss.ocaml.org/t/good-example-of-handwritten-lexer-recursive-descent-parser/15672/1">https://discuss.ocaml.org/t/good-example-of-handwritten-lexer-recursive-descent-parser/15672/1</a>
</p>
</div>
<div id="outline-container-org22bb946" class="outline-3">
<h3 id="org22bb946">Axel Baudot asked</h3>
<div class="outline-text-3" id="text-org22bb946">
<p>
I am looking for an idiomatic implementation of a Lexer + Recursive Descent Parser not making use of ocamllex, ocamlyacc or menhir. The kind you would write during the first chapters of Crafting Interpreters [0][1] in OCaml.
</p>

<p>
This Markdown parser [2] by @dbuenzli is a great example of what I am looking for. I'd be happy if you can recommend similar resources.
</p>

<p>
There are many OCaml repos for Lox interpreters but it's hard to assess quality. And the readme often says "I am doing this to learn OCaml", which doesn't inspire confidence.
</p>

<p>
As a broader note, it would be nice to have (community vetted) OCaml translations of well-known learning material using mainstream languages. But I'll raise the topic in another thread later.
</p>

<p>
Thanks in advance.
</p>

<ul class="org-ul">
<li>[0] <a href="https://craftinginterpreters.com/scanning.html">https://craftinginterpreters.com/scanning.html</a></li>
<li>[1] <a href="https://craftinginterpreters.com/parsing-expressions.html">https://craftinginterpreters.com/parsing-expressions.html</a></li>
<li>[2] <a href="https://github.com/dbuenzli/cmarkit/blob/af8930c307957a546ea833bbdabda94a2fa60b4b/src/cmarkit.ml#L879">https://github.com/dbuenzli/cmarkit/blob/af8930c307957a546ea833bbdabda94a2fa60b4b/src/cmarkit.ml#L879</a></li>
</ul>
</div>
</div>
<div id="outline-container-org69ed476" class="outline-3">
<h3 id="org69ed476">Mikhail replied</h3>
<div class="outline-text-3" id="text-org69ed476">
<p>
You might be interested in the book <a href="https://keleshev.com/compiling-to-assembly-from-scratch/">Compiling to Assembly from Scratch</a>.
There is a <a href="https://github.com/keleshev/compiling-to-assembly-from-scratch/tree/main/contrib/ocaml">port to OCaml</a>. It suggests the
use of <a href="https://en.wikipedia.org/wiki/Parser_combinator">parser combinators</a>. 
</p>

<p>
Parser combinators is the same manual recursive descent method, but in a functional way.   You can either use <a href="https://github.com/inhabitedtype/angstrom">an existing
library</a> or you <a href="https://www.youtube.com/watch?v=Y5IIXUBXvLs">can write your own</a>.
</p>
</div>
</div>
<div id="outline-container-org84a1d3e" class="outline-3">
<h3 id="org84a1d3e">Anton Bachin also replied</h3>
<div class="outline-text-3" id="text-org84a1d3e">
<p>
odoc's parser is half of what you're asking for. It uses ocamllex for the lexical scan, because it's very simple and convenient to
do it that way, but the syntax is then analyzed by a hand-written <a href="https://github.com/ocaml/odoc/blob/822d266232fccdffbd4922434c81c45ab6d583f4/src/parser/syntax.ml">recursive descent
parser</a>, in large part because
<i>that's</i> easier for the doc language.
</p>

<p>
An example of a non-ocamllex and non-ocamlyacc parser is Markup.ml
(<a href="https://github.com/aantron/markup.ml/blob/d686cce6bac6ff46a49b28ed0d957ffa1e37fda5/src/html_tokenizer.ml#L390">tokenizer</a>,
<a href="https://github.com/aantron/markup.ml/blob/d686cce6bac6ff46a49b28ed0d957ffa1e37fda5/src/html_parser.ml#L1386">parser</a>). But this
isn't a traditional recursive descent parser. Rather, it's a pretty huge hand-written state machine in continuation-passing style,
almost completely implementing the corresponding huge state machine specified in HTML5. But it's the kind of code that fits well the
topics of an impure FP class, especially since it has mutable cells for its continuations, that it uses to mimic effects.
</p>
</div>
</div>
</div>
<div id="outline-container-2" class="outline-2">
<h2 id="2">Boulder Dash in OCaml</h2>
<div class="outline-text-2" id="text-2">
<p>
Archive: <a href="https://sympa.inria.fr/sympa/arc/caml-list/2024-11/msg00023.html">https://sympa.inria.fr/sympa/arc/caml-list/2024-11/msg00023.html</a>
</p>
</div>
<div id="outline-container-orgd16abac" class="outline-3">
<h3 id="orgd16abac">Continuing this thread, Andreas Rossberg announced</h3>
<div class="outline-text-3" id="text-orgd16abac">
<p>
Couldn’t let it rest, so I’m (already) announcing version 2 of it — now a much improved, practically feature-complete
reimplementation of both Boulder Dash 1 &amp; 2.
</p>

<p>
Version 2 was an excuse for me to mess around with the OCaml bindings to popular graphics engines, and as a result, it now comes
with 3 backends to choose from:
</p>

<ol class="org-ol">
<li>the homely bare OCaml Graphics library (<a href="https://github.com/ocaml/graphics">https://github.com/ocaml/graphics</a>),</li>
<li>the TSDL binding to the SDL2 API (<a href="https://github.com/dbuenzli/tsdl">https://github.com/dbuenzli/tsdl</a>),</li>
<li>the binding to the Raylib engine (<a href="https://github.com/tjammer/raylib-ocaml">https://github.com/tjammer/raylib-ocaml</a>).</li>
</ol>

<p>
The list is in order of increasingly better user experience, for the price of a potentially harder build experience. In theory, all
versions should run on Windows, Mac, and Linux, though I was too lazy to test all combinations, and I (or my opam) had trouble
installing some of the dependencies on some of the systems.
</p>

<p>
Features:
</p>

<ul class="org-ul">
<li>Faithful original physics, graphics, animations, sound, and music</li>
<li>Authentic scrolling mechanics combined with dynamic resizing</li>
<li>All 40 levels and 5 difficulties of Boulder Dash 1 &amp; 2</li>
<li>Pause-and-go mode for relaxed playing</li>
</ul>

<p>
Relative to the previous release, version 2 adds the following niceties:
</p>

<ul class="org-ul">
<li>Support for SDL and Raylib engines, which allow all of the following</li>
<li>Original sound effects and music</li>
<li>Original level color schemes</li>
<li>Full screen mode</li>
<li>Faster graphics</li>
<li>Dynamic graphics scaling adjustment</li>
<li>Gamepad/joystick support as well as more precise keyboard controls</li>
<li>Boulder Dash 2 levels and decoder</li>
</ul>

<p>
Almost looks like a real game now. One from the 80s anyways. :)
</p>
</div>
</div>
</div>
<div id="outline-container-3" class="outline-2">
<h2 id="3">Js_of_ocaml 5.9.0</h2>
<div class="outline-text-2" id="text-3">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-js-of-ocaml-5-9-0/15674/1">https://discuss.ocaml.org/t/ann-js-of-ocaml-5-9-0/15674/1</a>
</p>
</div>
<div id="outline-container-orgd73d6c6" class="outline-3">
<h3 id="orgd73d6c6">Hhugo announced</h3>
<div class="outline-text-3" id="text-orgd73d6c6">
<p>
I’m pleased to announce the release of js_of_ocaml 5.9.0. It should soon be available in opam.
</p>

<p>
Js_of_ocaml is a compiler from OCaml bytecode to JavaScript. It makes it
possible to run pure OCaml programs in JavaScript environment like browsers and
Node.js.
</p>

<p>
Most significant changes:
</p>

<ul class="org-ul">
<li>Support for OCaml 5.3</li>
<li>Speedup sourcemap generation and improve sourcemap accuracy.</li>
<li>Prepare the merge of the wasm_of_ocaml fork back into the js_of_ocaml repo.</li>
<li>JS backtraces are really expansive. They now need to be explicitly requested with <code>OCAMLRUNPARM=b=1</code>. This speeds up programs linked with libraries enabling backtraces programmatically using <code>Printexc.record_backtrace true</code>.</li>
</ul>

<p>
See the <a href="https://github.com/ocsigen/js_of_ocaml/blob/master/CHANGES.md">Changelog </a> for other changes.
</p>
</div>
</div>
</div>
<div id="outline-container-4" class="outline-2">
<h2 id="4">Liquidsoap 2.3.0</h2>
<div class="outline-text-2" id="text-4">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-liquidsoap-2-3-0/15677/1">https://discuss.ocaml.org/t/ann-liquidsoap-2-3-0/15677/1</a>
</p>
</div>
<div id="outline-container-orgdb38999" class="outline-3">
<h3 id="orgdb38999">Romain Beauxis announced</h3>
<div class="outline-text-3" id="text-orgdb38999">
<p>
We are stoked to announce the <code>2.3.0</code> release of liquidsoap, a general-purpose scripting language written in OCaml with specialized operators to build media streams.
</p>

<p>
The release is available on github: <a href="https://github.com/savonet/liquidsoap/releases/tag/v2.3.0">https://github.com/savonet/liquidsoap/releases/tag/v2.3.0</a>
</p>

<p>
During this release cycle, we have rewritten huge chunk of the application's internal, including a new media streaming abstraction and clock system.
</p>

<p>
As an OCaml application, liquidsoap's scope and complexity has greatly expanded in the next years.
</p>

<p>
Some of the most challenging areas for us at this point are memory usage (and, incidentally, CPU usage).
</p>

<p>
Although OCaml's garbage collection is a very powerful tool, in the context of very short lived streaming cycles (typically <code>0.02s</code>) with potentially quite large memory allocations (typically video images), controlling the timing of memory allocations and release is becoming more and more critical.
</p>

<p>
We are also aware of the work done by Jane St on adding a <code>local</code> call stack. This could be an avenue to explore as well but:
</p>
<ol class="org-ol">
<li>Some of our content has to be stored in the long-term heap</li>
<li>We want to work with an official OCaml compiler for obvious long-term maintenance concerns.</li>
</ol>

<p>
Nonetheless, we are thrilled to be part of a community whose array of tools (building, packaging, debugging, etc) and libraries has expanded so well along with a vibrant compiler development team.
</p>

<p>
In the future, we wish to explore more of the new OCaml concurrency features. This might require that we revisit the way we handle short-term memory first.
</p>
</div>
</div>
</div>
<div id="outline-container-5" class="outline-2">
<h2 id="5">Bytesrw 0.1.0 – Composable byte stream readers and writers</h2>
<div class="outline-text-2" id="text-5">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-bytesrw-0-1-0-composable-byte-stream-readers-and-writers/15696/1">https://discuss.ocaml.org/t/ann-bytesrw-0-1-0-composable-byte-stream-readers-and-writers/15696/1</a>
</p>
</div>
<div id="outline-container-orgacbfc50" class="outline-3">
<h3 id="orgacbfc50">Daniel Bünzli announced</h3>
<div class="outline-text-3" id="text-orgacbfc50">
<p>
It's my pleasure to announce the first release of the <code>bytesrw</code> library:
</p>

<blockquote>
<p>
Bytesrw extends the OCaml <code>Bytes</code> module with composable, memory efficient, byte stream readers and writers compatible with effect-based concurrency.
</p>

<p>
Except for byte slice life-times, these abstractions intentionally  separate away ressource management and the specifics of reading and writing bytes.
</p>

<p>
Bytesrw distributed under the ISC license. It has no dependencies.
</p>

<p>
Optional support for compressed and hashed bytes depend, at your wish, on  the C <a href="https://zlib.net"><code>zlib</code></a>, <a href="http://zstd.net"><code>libzstd</code></a>, <a href="https://blake3.io"><code>blake3</code></a>, <a href="https://www.hadrons.org/software/libmd/"><code>libmd</code></a>, <a href="https://xxhash.com/"><code>xxhash</code></a> and libraries.
</p>
</blockquote>

<p>
The only reason I was longing for OCaml algebraic effects was so that I could avoid using them: when you write codecs on byte streams it should not be a concern where your bytes are coming from or headed to. The <code>bytesrw</code> library provides structures to abstract this. Additionally it establishes a buffer ownership discipline that enables byte streams to (de)compose while remaining memory efficient.
</p>

<p>
I do not expect the library to change much and it has been used. But it's new and practice may call for adjustments. Do not hesitate to get in touch if you run into problems or see obvious defects or improvements. I do expect the library will add more convenience (e.g. for processing lines and UTF) and more optional stream formats over time.
</p>

<ul class="org-ul">
<li>Homepage: <a href="https://erratique.ch/software/bytesrw">https://erratique.ch/software/bytesrw</a></li>
<li>Docs: <a href="https://erratique.ch/software/bytesrw/doc">https://erratique.ch/software/bytesrw/doc</a> or <code>odig doc bytesrw</code></li>
<li>Install: <code>opam install bytesrw conf-zlib conf-zstd conf-libblake3 conf-libmd conf-xxhash</code> (<a href="https://github.com/ocaml/opam-repository/pull/26990">opam PR</a>)</li>
</ul>

<p>
This first release was made possible thanks to a grant from the <a href="https://ocaml-sf.org/">OCaml Software Foundation</a>. I also thank my <a href="https://github.com/sponsors/dbuenzli">donors</a> for their support.
</p>
</div>
</div>
</div>
<div id="outline-container-6" class="outline-2">
<h2 id="6">dream-html and pure-html 3.5.2</h2>
<div class="outline-text-2" id="text-6">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-dream-html-pure-html-3-5-2/14808/5">https://discuss.ocaml.org/t/ann-dream-html-pure-html-3-5-2/14808/5</a>
</p>
</div>
<div id="outline-container-orga86adff" class="outline-3">
<h3 id="orga86adff">Yawar Amin announced</h3>
<div class="outline-text-3" id="text-orga86adff">
<p>
[ANN] dream-html 3.7.0
</p>

<p>
Happy to announce the addition of a helper module for typed form decoding functionality. See the docs here: <a href="https://yawaramin.github.io/dream-html/dream-html/Dream_html/Form/index.html">https://yawaramin.github.io/dream-html/dream-html/Dream_html/Form/index.html</a>
</p>

<p>
An example:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">type</span> <span style="color: #444fcf;">user</span> = { name : string; age : int option }

<span style="color: #000000; font-weight: bold;">open </span><span style="color: #444fcf;">Dream_html.Form</span>

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #007a9f;">user_form</span> =
  <span style="color: #000000; font-weight: bold;">let+</span> <span style="color: #007a9f;">name</span> = required string <span style="color: #ca3400;">"name"</span>
  <span style="color: #000000; font-weight: bold;">and+</span> <span style="color: #007a9f;">age</span> = optional int <span style="color: #ca3400;">"age"</span> <span style="color: #000000; font-weight: bold;">in</span>
  { name; age }

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #007a9f;">dream_form</span> = [<span style="color: #ca3400;">"age"</span>, <span style="color: #ca3400;">"42"</span>; <span style="color: #ca3400;">"name"</span>, <span style="color: #ca3400;">"Bob"</span>]
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #007a9f;">user_result</span> = validate user_form dream_form
<span style="color: #8f6f4a; font-style: italic;">(* </span><span style="color: #8f6f4a; font-style: italic;">=&gt; Ok { name = "Bob"; age = Some 42 }</span><span style="color: #8f6f4a; font-style: italic;"> *)</span>

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #007a9f;">error_result</span> = validate user_form [<span style="color: #ca3400;">"age"</span>, <span style="color: #ca3400;">"none"</span>]
<span style="color: #8f6f4a; font-style: italic;">(* </span><span style="color: #8f6f4a; font-style: italic;">=&gt; Error [("age", "error.expected.int"); ("name", "error.required")]</span><span style="color: #8f6f4a; font-style: italic;"> *)</span>
</pre>
</div>

<p>
Astute readers may observe that this provides some convenience functionality beyond what Dream itself offers; to validate the above form and get a <span class="underline">complete</span> set of field validation errors using only Dream you would do something like:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #007a9f;">user_result</span> = <span style="color: #006f00; font-weight: bold;">match</span> dream_form <span style="color: #006f00; font-weight: bold;">with</span>
  | [<span style="color: #ca3400;">"age"</span>, age; <span style="color: #ca3400;">"name"</span>, name] -&gt;
    (<span style="color: #006f00; font-weight: bold;">match</span> int_of_string age <span style="color: #006f00; font-weight: bold;">with</span>
    | age -&gt; <span style="color: #242521; background-color: #fcf7ef;">Ok</span> { name; age = <span style="color: #242521; background-color: #fcf7ef;">Some</span> age }
    | <span style="color: #006f00; font-weight: bold;">exception</span> <span style="color: #242521; background-color: #fcf7ef;">Failure</span> _ -&gt; <span style="color: #242521; background-color: #fcf7ef;">Error</span> [<span style="color: #ca3400;">"age"</span>, <span style="color: #ca3400;">"error.expected.int"</span>])
  | [<span style="color: #ca3400;">"name"</span>, name] -&gt; <span style="color: #242521; background-color: #fcf7ef;">Ok</span> { name; age = <span style="color: #242521; background-color: #fcf7ef;">None</span> }
  | [<span style="color: #ca3400;">"age"</span>, age] -&gt;
    (<span style="color: #006f00; font-weight: bold;">match</span> int_of_string age <span style="color: #006f00; font-weight: bold;">with</span>
    | age -&gt; <span style="color: #242521; background-color: #fcf7ef;">Error</span> [<span style="color: #ca3400;">"name"</span>, <span style="color: #ca3400;">"error.required"</span>]
    | <span style="color: #006f00; font-weight: bold;">exception</span> <span style="color: #242521; background-color: #fcf7ef;">Failure</span> _ -&gt; <span style="color: #242521; background-color: #fcf7ef;">Error</span> [<span style="color: #ca3400;">"age"</span>, <span style="color: #ca3400;">"error.expected.int"</span>; <span style="color: #ca3400;">"name"</span>, <span style="color: #ca3400;">"error.required"</span>])
  | _ -&gt; <span style="color: #242521; background-color: #fcf7ef;">Error</span> [<span style="color: #ca3400;">"name"</span>, <span style="color: #ca3400;">"error.required"</span>]
</pre>
</div>

<p>
And this is a form with only two fields. You can imagine how convoluted the logic would be for more complex forms. Of course, you might just decide to use <code>List.assoc_opt</code> and build up the validation errors, but even that can get tricky. So if you are making heavy use of HTML forms, a helper module that takes care of all these validation details can be very useful. Enjoy!
</p>
</div>
</div>
</div>
<div id="outline-container-7" class="outline-2">
<h2 id="7">Second beta release of OCaml 5.3.0</h2>
<div class="outline-text-2" id="text-7">
<p>
Archive: <a href="https://discuss.ocaml.org/t/second-beta-release-of-ocaml-5-3-0/15700/1">https://discuss.ocaml.org/t/second-beta-release-of-ocaml-5-3-0/15700/1</a>
</p>
</div>
<div id="outline-container-org3a12c35" class="outline-3">
<h3 id="org3a12c35">octachron announced</h3>
<div class="outline-text-3" id="text-org3a12c35">
<p>
One month after the release of the first beta for OCaml 5.3.0,  we are releasing a second and hopefully last beta release for OCaml 5.3.0 .
</p>

<p>
The most notable changes for this second beta are probably a handful of type system bugfixes. In particular, those fixes revert a change of behaviour in the first beta when pattern matching GADTs with non-injective type parameters.
</p>

<p>
We also have a C++ header compatibility fix and the restoration of some configuration variable in Makefiles for the sake of backward compatibility.
</p>

<p>
Overall, the release is converging and we are expecting to have a first release candidate around the middle of December. The progresses on stabilising the ecosystem are tracked on the
<a href="https://github.com/ocaml/opam-repository/issues/26596">opam readiness for 5.3.0 meta-issue</a>.
</p>

<p>
Meanwhile, the second beta release of OCaml 5.3.0 is here to help you update
your software and libraries ahead of the release (see below for the installation
instructions).
</p>

<p>
The full release is expected before the end of December.
</p>

<p>
If you find any bugs, please report them on <a href="https://github.com/ocaml/ocaml/issues">OCaml's issue tracker</a>.
</p>

<p>
If you are interested in full list of features and bug fixes of the new OCaml version, the updated change log for OCaml 5.3.0 is available <a href="https://github.com/ocaml/ocaml/blob/5.3/Changes">on GitHub</a>.
</p>

<p>
Happy hacking,
Florian Angeletti for the OCaml team.
</p>
</div>
<div id="outline-container-org75755e1" class="outline-4">
<h4 id="org75755e1">Installation Instructions</h4>
<div class="outline-text-4" id="text-org75755e1">
<p>
The base compiler can be installed as an opam switch with the following commands
on opam 2.1 and later:
</p>

<pre class="example" id="orgd5c226f">
opam update
opam switch create 5.3.0~beta2
</pre>

<p>
The source code for the beta is also available at these addresses:
</p>

<ul class="org-ul">
<li><a href="https://github.com/ocaml/ocaml/archive/5.3.0-beta2.tar.gz">GitHub</a></li>
<li><a href="https://caml.inria.fr/pub/distrib/ocaml-5.3/ocaml-5.3.0~beta2.tar.gz">OCaml archives at Inria</a></li>
</ul>
</div>
<ul class="org-ul">
<li><a id="org12c6846"></a>Fine-Tuned Compiler Configuration<br />
<div class="outline-text-5" id="text-org12c6846">
<p>
If you want to tweak the configuration of the compiler, you can switch to the option variant with:
</p>

<pre class="example" id="orgc4c2724">
opam update
opam switch create &lt;switch_name&gt; ocaml-variants.5.3.0~beta2+options &lt;option_list&gt;
</pre>

<p>
where <code>option_list</code> is a space separated list of <code>ocaml-option-*</code> packages. For instance, for a flambda and no-flat-float-array switch:
</p>

<pre class="example" id="orgce428b3">
opam switch create 5.3.0~beta2+flambda+nffa ocaml-variants.5.3.0~beta2+options ocaml-option-flambda ocaml-option-no-flat-float-array
</pre>

<p>
All available options can be listed with <code>opam search ocaml-option</code>.
</p>
</div>
</li>
</ul>
</div>
<div id="outline-container-org59be94f" class="outline-4">
<h4 id="org59be94f">Changes Since The First Beta</h4>
<div class="outline-text-4" id="text-org59be94f">
</div>
<ul class="org-ul">
<li><a id="org1c97905"></a>Type system fixes<br />
<div class="outline-text-5" id="text-org1c97905">
<ul class="org-ul">
<li><a href="https://github.com/ocaml/ocaml/issues/13501">#13501</a>: Regression on mutually recursive types caused by <a href="https://github.com/ocaml/ocaml/issues/12180">#12180</a>.
Resuscitate Typedecl.update_type.
(Jacques Garrigue and Takafumi Saikawa, review by Florian Angeletti, Richard
Eisenberg and Gabriel Scherer)</li>

<li><a href="https://github.com/ocaml/ocaml/issues/13495">#13495</a>, <a href="https://github.com/ocaml/ocaml/issues/13514">#13514</a>: Fix typechecker crash while typing objects
(Jacques Garrigue, report by Nicolás Ojeda Bär, review by
 Nicolas Ojeda Bär, Gabriel Scherer, Stephen Dolan, Florian Angeletti)</li>

<li><a href="https://github.com/ocaml/ocaml/issues/13598">#13598</a>: Falsely triggered warning 56 [unreachable-case]
This was caused by unproper protection of the retyping function.
(Jacques Garrigue, report by Tõivo Leedjärv, review by Florian Angeletti)</li>
</ul>
</div>
</li>
<li><a id="org4b37038"></a>Configuration fixes<br />
<div class="outline-text-5" id="text-org4b37038">
<ul class="org-ul">
<li>(<b>breaking change</b>) <a href="https://github.com/ocaml/ocaml/issues/12578">#12578</a>, <a href="https://github.com/ocaml/ocaml/issues/12589">#12589</a>, <a href="https://github.com/ocaml/ocaml/issues/13322">#13322</a>, +<a href="https://github.com/ocaml/ocaml/issues/13519">#13519</a>: Use configured CFLAGS and CPPFLAGS <i>only</i>
during the build of the compiler itself. Do not use them when
compiling third-party C sources through the compiler. Flags for
compiling third-party C sources can still be specified at configure
time in the COMPILER_{BYTECODE,NATIVE}_{CFLAGS,CPPFLAGS}
configuration variables.
 (Sébastien Hinderer, report by William Hu, review by David Allsopp)</li>
</ul>
</div>
</li>
<li><a id="org969e483"></a>C++ header compatibility<br />
<div class="outline-text-5" id="text-org969e483">
<ul class="org-ul">
<li><a href="https://github.com/ocaml/ocaml/issues/13541">#13541</a>, <a href="https://github.com/ocaml/ocaml/issues/13591">#13591</a>: Fix headers for C++ inclusion.
(Antonin Décimo, review by Nick Barnes, report by Kate Deplaix)</li>
</ul>
</div>
</li>
<li><a id="orgb4ea645"></a>Compiler library bug fix<br />
<div class="outline-text-5" id="text-orgb4ea645">
<ul class="org-ul">
<li><a href="https://github.com/ocaml/ocaml/issues/13603">#13603</a>, <a href="https://github.com/ocaml/ocaml/issues/13604">#13604</a>: fix source printing in the presence of the escaped raw
identifier <code>\#mod</code>.
(Florian Angeletti, report by Chris Casinghino, review by Gabriel Scherer)</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-8" class="outline-2">
<h2 id="8">New release of Monolith</h2>
<div class="outline-text-2" id="text-8">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-new-release-of-monolith/15701/1">https://discuss.ocaml.org/t/ann-new-release-of-monolith/15701/1</a>
</p>
</div>
<div id="outline-container-org1fa9576" class="outline-3">
<h3 id="org1fa9576">François Pottier announced</h3>
<div class="outline-text-3" id="text-org1fa9576">
<p>
I am pleased to announce a new release of <a href="https://cambium.inria.fr/~fpottier/monolith/doc/monolith/Monolith/">Monolith</a>, a library that helps perform strong automated testing of OCaml libraries.
</p>
<pre class="example" id="org71e5155">
opam update
opam install monolith.20241126
</pre>

<p>
The changes are as follows:
</p>

<ul class="org-ul">
<li>The documentation of the specification combinators has been re-organized
in sections and subsections. Finding the desired combinator should now be
easier.</li>

<li>The new combinator <code>naive_array</code> offers limited support for arrays.</li>

<li>The new combinator <code>naive_seq</code> offers limited support for sequences
(that is, for the type constructor <code>Seq.t</code>).</li>

<li>The new combinator <code>pair</code> is a synonym for <code>( *** )</code>.</li>

<li>The new combinator <code>triple</code> offers support for triples.</li>

<li>The new combinator <code>either</code> offers support for the type constructor
<code>Either.t</code>.</li>

<li>The new combinators <code>iter</code>, <code>foldr</code>, <code>foldl</code>, <code>iteri</code>, <code>foldri</code>, <code>foldli</code>
offer support for iteration functions.</li>

<li>An unintentional and undocumented limitation has been fixed: so far, uses of
the combinator <code>map_into</code> would work only at the root of the specification
or in the right-hand side of an arrow <code>^&gt;</code>. It should now be possible to use
<code>map_into</code> under other combinators that expect a deconstructible
specification, such as <code>^!&gt;</code> (in the right-hand side), <code>( *** )</code>, <code>option</code>,
<code>result</code>, <code>list</code>, etc. This improvement affects not only <code>map_into</code>, but
also a number of other combinators that are defined in terms of <code>map_into</code>.</li>

<li>Monolith now requires OCaml 4.12 or later.</li>

<li>In <code>Makefile.monolith</code>,
<ul class="org-ul">
<li>the default switch is changed from 4.11.1 to 4.14.2;
this can be overridden by defining <code>SWITCH</code>;</li>
<li><code>make test</code> automatically disables the MacOS crash reporter;</li>
<li>the use of <code>ulimit -s</code> is abandoned.</li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-9" class="outline-2">
<h2 id="9">Jsont 0.1.0 – Declarative JSON data manipulation for OCaml</h2>
<div class="outline-text-2" id="text-9">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-jsont-0-1-0-declarative-json-data-manipulation-for-ocaml/15702/1">https://discuss.ocaml.org/t/ann-jsont-0-1-0-declarative-json-data-manipulation-for-ocaml/15702/1</a>
</p>
</div>
<div id="outline-container-org18df70e" class="outline-3">
<h3 id="org18df70e">Daniel Bünzli announced</h3>
<div class="outline-text-3" id="text-org18df70e">
<p>
It's my pleasure to announce the first release of the jsont libary: 
</p>

<blockquote>
<p>
Jsont is an OCaml library for declarative JSON data manipulation. It provides:
</p>

<ul class="org-ul">
<li>Combinators for describing JSON data using the OCaml values of your choice. The descriptions can be used by generic functions to decode, encode, query and update JSON data without having to construct a generic JSON representation.</li>
<li>A JSON codec with optional text location tracking and layout preservation. The codec is compatible with effect-based concurrency.</li>
</ul>

<p>
The descriptions are independent from the codec and can be used by third-party processors or codecs.
</p>

<p>
Jsont is distributed under the ISC license. It has no dependencies. The codec is optional and depends on the <a href="https://erratique.ch/software/bytesrw"><code>bytesrw</code></a> library. The JavaScript support is optional and depends on the <a href="https://erratique.ch/software/brr"><code>brr</code></a> library.
</p>
</blockquote>

<p>
The library has been used in practice but it's new so a few adjustments may be needed and more convenience combinators added.
</p>

<p>
The library also enables quite a few things that I did not have the time to explore like schema description generation from descriptions, quasi-streaming JSON transformations, description generation from dynamic type representations, etc. Lots of this can be done outside the core library, do not hesitate to get in touch if you use the library and find interesting applications or pesking limitations.
</p>

<ul class="org-ul">
<li>Homepage: <a href="https://erratique.ch/software/jsont">https://erratique.ch/software/jsont</a></li>
<li>Docs: <a href="https://erratique.ch/software/jsont/doc">https://erratique.ch/software/jsont/doc</a> (or <code>odig doc jsont</code>)</li>
<li>Install: <code>opam install jsont bytesrw</code></li>
</ul>

<p>
This first release was made possible thanks to a grant from the <a href="https://ocaml-sf.org/">OCaml Software Foundation</a>. I also thank my <a href="https://github.com/sponsors/dbuenzli">donors</a> for their support.
</p>

<p>
Best,
</p>

<p>
Daniel
</p>

<p>
P.S. I think that the technique used by the library, which I dubbed <i>finally tagged</i> is interesting in itself. You can read a paper about it <a href="https://github.com/dbuenzli/jsont/tree/main/paper">here</a> along with a smaller, self-contained, implementation of what the library does.
</p>
</div>
</div>
</div>
<div id="outline-container-10" class="outline-2">
<h2 id="10">Tiny educational concurrent I/O and promises library</h2>
<div class="outline-text-2" id="text-10">
<p>
Archive: <a href="https://discuss.ocaml.org/t/tiny-educational-concurrent-i-o-and-promises-library/15703/1">https://discuss.ocaml.org/t/tiny-educational-concurrent-i-o-and-promises-library/15703/1</a>
</p>
</div>
<div id="outline-container-org1d974d4" class="outline-3">
<h3 id="org1d974d4">Mikhail announced</h3>
<div class="outline-text-3" id="text-org1d974d4">
<p>
I like <a href="https://github.com/ocsigen/lwt">Lwt</a>. It's a fantastic library, but how does it work? I spent a few days studying its source code. 
</p>

<p>
Finally, inspired by the implementation of <a href="https://github.com/ocsigen/lwt">Lwt</a> and <a href="https://cs3110.github.io/textbook/chapters/ds/promises.html">the CS3110 chapter, 8.7. Promises</a>. I wrote a maximally stupid <a href="https://github.com/dx3mod/tiny-async-lib"><b>tiny-async-lib</b></a> library. 
</p>

<p>
Maybe you may be interested in this naive implementation. 
</p>
</div>
<div id="outline-container-org27a2532" class="outline-4">
<h4 id="org27a2532">Examples of use</h4>
<div class="outline-text-4" id="text-org27a2532">
<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> () = 
  <span style="color: #444fcf;">Engine.</span>run main <span style="color: #000000; font-weight: bold;">begin</span>
    <span style="color: #000000; font-weight: bold;">let*</span> () = <span style="color: #444fcf;">Io.</span>(write_all stdout) <span style="color: #ca3400;">"Hi! What's your name? "</span> <span style="color: #000000; font-weight: bold;">in</span>
    <span style="color: #000000; font-weight: bold;">let*</span> <span style="color: #007a9f;">name</span> = <span style="color: #444fcf;">Io.</span>(read_line stdin) <span style="color: #000000; font-weight: bold;">in</span>
    <span style="color: #444fcf;">Io.</span>(write_all stdout) (<span style="color: #ca3400;">"Hello, "</span> <span style="color: #a52a2a;">^</span> name <span style="color: #a52a2a;">^</span> <span style="color: #ca3400;">"!\n"</span>)
  <span style="color: #000000; font-weight: bold;">end</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a7601f;">read_and_print_file</span> <span style="color: #007a9f;">filename</span> = 
  <span style="color: #444fcf;">Io.</span>(read_file filename &gt;&gt;= write_all stdout)

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #007a9f;">_</span> =
  <span style="color: #444fcf;">Engine.</span>run <span style="color: #000000; font-weight: bold;">begin</span>
    <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #007a9f;">filenames</span> = [ <span style="color: #8f6f4a; font-style: italic;">(* </span><span style="color: #8f6f4a; font-style: italic;">...</span><span style="color: #8f6f4a; font-style: italic;"> *)</span> ] <span style="color: #000000; font-weight: bold;">in</span>  

    filenames
    <span style="color: #a52a2a;">|&gt;</span> <span style="color: #444fcf;">List.</span>map read_and_print_file
    <span style="color: #a52a2a;">|&gt;</span> <span style="color: #444fcf;">Promise.</span>join
  <span style="color: #000000; font-weight: bold;">end</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org79689c3" class="outline-4">
<h4 id="org79689c3">Implementation details</h4>
<div class="outline-text-4" id="text-org79689c3">
<p>
The first key abstraction of the whole library is, of course, Promise. <a href="https://en.wikipedia.org/wiki/Futures_and_promises">Promise</a> is an abstraction for synchronizing program execution in concurrent evaluations. In simple terms, it's an abstraction over callbacks. Promises allows us to build (monadic) sequence evaluations inside of non-sequence evaluations.
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #8f6f4a; font-style: italic;">(* </span><span style="color: #8f6f4a; font-style: italic;">promise.ml</span><span style="color: #8f6f4a; font-style: italic;"> *)</span>

<span style="color: #000000; font-weight: bold;">type</span> <span style="color: #444fcf;">'a t</span> = { <span style="color: #006f00; font-weight: bold;">mutable</span> state: 'a state }  

<span style="color: #000000; font-weight: bold;">and</span> 'a <span style="color: #007a9f;">state</span> = 
  | <span style="color: #242521; background-color: #fcf7ef;">Fulfilled</span> <span style="color: #006f00; font-weight: bold;">of</span> 'a 
  | <span style="color: #242521; background-color: #fcf7ef;">Rejected</span> <span style="color: #006f00; font-weight: bold;">of</span> exn
  | <span style="color: #242521; background-color: #fcf7ef;">Pending</span> <span style="color: #006f00; font-weight: bold;">of</span> 'a callback list 

<span style="color: #000000; font-weight: bold;">and</span> 'a <span style="color: #007a9f;">callback</span> = 'a state -&gt; unit 
</pre>
</div>

<p>
Promises are represented as a mutable record with three possible states: fulfilled (contains a value), rejected (contains an exception), and pending (contains callbacks). 
</p>

<p>
Callbacks are functions that are called when a promise is resolved.
So when we <code>bind</code>, if the promise is in pending state, we add a callback that calls the following monadic sequence when the promise is resolved.
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #8f6f4a; font-style: italic;">(* </span><span style="color: #8f6f4a; font-style: italic;">io.ml</span><span style="color: #8f6f4a; font-style: italic;"> *)</span>

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a7601f;">sleep</span> <span style="color: #007a9f;">delay</span> =
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #007a9f;">p</span>, <span style="color: #007a9f;">r</span> = <span style="color: #444fcf;">Promise.</span>make () <span style="color: #000000; font-weight: bold;">in</span>

  <span style="color: #444fcf;">Engine.</span>(on_timer instance) delay (<span style="color: #006f00; font-weight: bold;">fun</span> <span style="color: #007a9f;">handler</span> -&gt;
      <span style="color: #444fcf;">Engine.</span>stop_handler handler;
      <span style="color: #444fcf;">Promise.</span>fulfill r ());

  p
</pre>
</div>

<p>
The second key abstraction is an <a href="https://en.wikipedia.org/wiki/Asynchronous_I/O">asynchronous I/O</a> engine that polls I/O events and dispatches them to handlers. Original Lwt has few engines (like based libev, select, poll), but I hardcoded a [select](<a href="https://en.wikipedia.org/wiki/Select_(Unix)">https://en.wikipedia.org/wiki/Select_(Unix)</a>)-based engine inspired by <code>Lwt_engine.select_based</code>. 
</p>

<p>
The typical async engine in internals has an event loop. At each iteration of the event loop, the engine polls for new events and calls handlers to handle them. 
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #8f6f4a; font-style: italic;">(* </span><span style="color: #8f6f4a; font-style: italic;">engine.ml</span><span style="color: #8f6f4a; font-style: italic;"> *)</span>

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a7601f;">iter</span> <span style="color: #007a9f;">engine</span> =
  <span style="color: #8f6f4a; font-style: italic;">(* </span><span style="color: #8f6f4a; font-style: italic;">...</span><span style="color: #8f6f4a; font-style: italic;"> *)</span>

  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #007a9f;">readable_fds</span>, <span style="color: #007a9f;">writable_fds</span>, <span style="color: #007a9f;">_</span> =
    <span style="color: #444fcf;">Unix.</span>select readable_fds writable_fds <span style="color: #242521; background-color: #fcf7ef;">[]</span> timeout
  <span style="color: #000000; font-weight: bold;">in</span>

  engine.sleepers &lt;- restart_sleepers now engine.sleepers;

  invoke_io_handlers engine.wait_readable readable_fds;
  invoke_io_handlers engine.wait_writable writable_fds
</pre>
</div>

<p>
How to execute I/O promise? It's not a big deal. 
</p>
<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #8f6f4a; font-style: italic;">(* </span><span style="color: #8f6f4a; font-style: italic;">engine.ml</span><span style="color: #8f6f4a; font-style: italic;"> *)</span>

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #000000; font-weight: bold;">rec</span> <span style="color: #a7601f;">run</span> <span style="color: #007a9f;">promise</span> =
  <span style="color: #006f00; font-weight: bold;">match</span> <span style="color: #444fcf;">Promise.</span>state promise <span style="color: #006f00; font-weight: bold;">with</span>
  | <span style="color: #242521; background-color: #fcf7ef;">Fulfilled</span> value -&gt; value
  | <span style="color: #242521; background-color: #fcf7ef;">Rejected</span> exc -&gt; <span style="color: #557400; font-weight: bold;">raise</span> exc
  | <span style="color: #242521; background-color: #fcf7ef;">Pending</span> _ -&gt;
      iter instance;
      run promise
</pre>
</div>

<p>
We just need to loop the event loop until the promis is resolved.
</p>

<p>
It's just a toy! I'm not an expert in such things, so the library is very naive and tries to mimic Lwt. But I think it's a good demonstration. 
</p>

<p>
Repository
<a href="https://github.com/dx3mod/tiny-async-lib">https://github.com/dx3mod/tiny-async-lib</a>
</p>

<p>
Thank you for your attention!
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-11" class="outline-2">
<h2 id="11">Eliom 11.1: Towards Web Assembly support</h2>
<div class="outline-text-2" id="text-11">
<p>
Archive: <a href="https://discuss.ocaml.org/t/eliom-11-1-towards-web-assembly-support/15704/1">https://discuss.ocaml.org/t/eliom-11-1-towards-web-assembly-support/15704/1</a>
</p>
</div>
<div id="outline-container-orgaa21888" class="outline-3">
<h3 id="orgaa21888">Vincent Balat announced</h3>
<div class="outline-text-3" id="text-orgaa21888">
<p>
Eliom 11.1 has been released recently.
This minor release brings compatibility with Web Assembly and the upcoming version of js_of_ocaml.
Ocsigen Toolkit and Ocsigen Start have been updated as well.
</p>

<p>
Stay tuned for further announcements concerning client-server Web and mobile apps in Ocaml with Web Assembly!
</p>

<p>
Links:
</p>

<ul class="org-ul">
<li><a href="https://ocsigen.org">Ocsigen</a></li>
<li><a href="https://ocsigen.org/eliom">Eliom</a></li>
<li><a href="https://ocsigen.org/tuto/latest/manual/basics">Documentation</a></li>
<li><a href="https://github.com/ocsigen/eliom">Github</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-12" class="outline-2">
<h2 id="12">Areas and Adversaries</h2>
<div class="outline-text-2" id="text-12">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-areas-and-adversaries/15706/1">https://discuss.ocaml.org/t/ann-areas-and-adversaries/15706/1</a>
</p>
</div>
<div id="outline-container-org0aa7a0c" class="outline-3">
<h3 id="org0aa7a0c">Raphaël Proust announced</h3>
<div class="outline-text-3" id="text-org0aa7a0c">
<p>
I figured people might be bored of <a href="https://discuss.ocaml.org/t/ann-queenshead-a-british-pub-name-generator/13124">British pub names</a> by now so I did another thing: <a href="https://raphael-proust.gitlab.io/code/areas-and-adversaries.html">a generator for titles of table-top role-playing games</a>.
</p>

<pre class="example" id="orgd80d08d">
$ opam install areas-and-adversaries
...
$ areas-and-adversaries
Woods &amp; Wizards
</pre>

<p>
The code is on Gitlab: <a href="https://gitlab.com/raphael-proust/areas-and-adversaries">https://gitlab.com/raphael-proust/areas-and-adversaries</a>
</p>

<p>
It was a good excuse to experiment with non-dune build systems (to scope things out). I went for a plain Makefile in the end which works well.
</p>

<p>
I also wanted to figure out a better way to embed data in an executable. I ended up wondering about moving as much of the processing as possible into the build phase. What I ended up with is a small program which prints a compilation unit (<code>.ml</code>) which has mostly array literals. Still have some open questions on that, any input welcome:
</p>
<ul class="org-ul">
<li>Should I have used meta-ocaml to print the code? The <code>data/munch.ml</code> would probably be more readable, but the build probably less.</li>
<li>How could I generate this kind of processed-data code for data-structures which don't have a literal (maps, sets, hash tables, etc.)? How can I minimise the initialisation cost of the program for such situations?</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-13" class="outline-2">
<h2 id="13">MariaDB 1.2.0</h2>
<div class="outline-text-2" id="text-13">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-mariadb-1-2-0/15709/1">https://discuss.ocaml.org/t/ann-mariadb-1-2-0/15709/1</a>
</p>
</div>
<div id="outline-container-org967f885" class="outline-3">
<h3 id="org967f885">Petter A. Urkedal announced</h3>
<div class="outline-text-3" id="text-org967f885">
<p>
I'm please to announce a new release of the <a href="https://github.com/ocaml-community/ocaml-mariadb">mariadb</a> package, which provides client bindings for MariaDB and MySQL. See the full release notes below.
</p>

<p>
This is also to announce that I have taken over maintenance of the project.  Currently I am the sole maintainer (and I usually use PostgreSQL for my own deployments), so if someone has the time en interest to contribute, let me know.  The main focus from my side is to keep the project up to date and stable, rather than making major changes.
</p>

<p>
Release notes:
</p>

<ul class="org-ul">
<li>Added <code>Stmt.start_txn</code> (#59 by Corentin Leruth).</li>
<li>Added <code>Res.insert_id</code> as binding for <code>mysql_stmt_insert_id</code> (#58 by            
Corentin Leruth).</li>
<li>Updated to support recent OCaml versions (#45 by @kit-ty-kate).</li>
<li>Fixed too-early retrieval of statement metadata (#41 by Albert Peschar).</li>
<li>Fixed decoding bug for the integer type (#54 by Raman Varabets, tested         
by #61 by Corentin Leruth).</li>
<li>Fixed a memory leaks related to result metadata (#39 by Albert Peschar).</li>
<li>The build system is now dune and dune-configurator (#52 by Petter A.           
Urkedal) and some of the examples have been converted to a test suite          
(#60 by Petter A. Urkedal).</li>
<li>The project has been transferred to ocaml-community with Petter A.             
Urkedal as the new maintainer.</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-14" class="outline-2">
<h2 id="14">Proposed Package Archiving Policy for the opam Repository</h2>
<div class="outline-text-2" id="text-14">
<p>
Archive: <a href="https://discuss.ocaml.org/t/proposed-package-archiving-policy-for-the-opam-repository/15713/1">https://discuss.ocaml.org/t/proposed-package-archiving-policy-for-the-opam-repository/15713/1</a>
</p>
</div>
<div id="outline-container-orgfd53f1e" class="outline-3">
<h3 id="orgfd53f1e">Hannes Mehnert announced</h3>
<div class="outline-text-3" id="text-orgfd53f1e">
<p>
It is my please to announce the proposed package archiving policy in the name of the opam-repository maintainers.
</p>
</div>
<div id="outline-container-org27a4f77" class="outline-4">
<h4 id="org27a4f77">Context</h4>
<div class="outline-text-4" id="text-org27a4f77">
<p>
The opam repository differs from nearly all other programming-language-centric package repositories in that it is manually curated by volunteer maintainers and protected by a robust continuous integration system that (generally) ensures published packages work as expected across a <a href="https://github.com/ocurrent/opam-repo-ci/blob/master/doc/platforms.md">large matrix of supported platforms</a>.
</p>

<p>
Over the past few years the repository has kept growing steadily, when not accelerating, and this has started raising questions about the size, weight and sustainability of the repository and its processes. Last year, <a href="https://github.com/hannesm">Hannes Mehnert</a> requested comments on a <a href="https://github.com/ocaml/opam-repository/issues/23789">proposed initiative</a> to improve the sustainability and quality of the opam package repository on the long term.
</p>
</div>
</div>
<div id="outline-container-org64a8c4e" class="outline-4">
<h4 id="org64a8c4e">Problem</h4>
<div class="outline-text-4" id="text-org64a8c4e">
<p>
The problem, in a nutshell, is that the <code>opam-repository</code> will keep steadily growing, using an increasing and substantial amount of space and inodes. Every opam user needs to invest a large amount of computational resources for the solver, every time they want to install or update a package. Additionally, a large amount of computational resources are spent in the continuous integration process and yet a lot of the packages have become stale or uninstallable.
</p>
</div>
</div>
<div id="outline-container-orgff75d3f" class="outline-4">
<h4 id="orgff75d3f">Solution</h4>
<div class="outline-text-4" id="text-orgff75d3f">
<p>
<a href="https://github.com/ocaml/opam-repository/issues/23789">After much deliberation</a>, the discussion converged on a solution: introduce a package archiving policy and supporting processes, to periodically identify and prune unmaintained and broken packages from the repository. This will improve the performance of the opam solvers, of the opam-repo CI, and most importantly improve the quality of the package repository, while keeping a sort of immutability of the repository content and preserving the usability of historical packages for the users that want or need them.
</p>

<p>
The opam repository maintainers propose a <a href="https://github.com/ocaml/opam-repository/blob/master/governance/policies/archiving.md">policy</a>.
</p>

<p>
The currently empty <a href="https://github.com/ocaml/opam-repository-archive">repository archive</a> has been created, waiting for packages to be moved.
</p>
</div>
</div>
<div id="outline-container-orgca012b2" class="outline-4">
<h4 id="orgca012b2">Call to action</h4>
<div class="outline-text-4" id="text-orgca012b2">
<p>
If you maintain packages in the opam-repository, you can help by defining your maintanence intent: add a new field <code>x-maintenance-intent</code> to your opam file(s) (the most recent release of your package is sufficient - please also put this field in your git repository so it will be part of future releases). The value is defined in <a href="https://github.com/ocaml/opam-repository/blob/master/governance/policies/archiving.md#specification-of-the-x--fields-used-in-the-archiving-process">the policy</a>.
</p>
</div>
</div>
<div id="outline-container-org23d93f1" class="outline-4">
<h4 id="org23d93f1">Roadmap</h4>
<div class="outline-text-4" id="text-org23d93f1">
<p>
All announcements will be on discuss.ocaml.org with the opam-repository tag. If you like to follow these announcements, keep your eyes at <a href="https://discuss.ocaml.org/tag/opam-repository">the opam-repository tag</a>.
</p>

<ul class="org-ul">
<li>December 1st 2024: announcement of this proposal</li>
<li>December 15th 2024: announcement of the packages affected by Phase 1 (uninstallable packages ("available: false", "flags: avoid-version" or "deprecated", "opam admin check &#x2013;installable", does not compile &#x2013; opam health check <a href="https://check.ci.ocaml.org/">https://check.ci.ocaml.org/</a>)</li>
<li>January 1st 2025: Phase 1 cutting point: packages are moved to opam-repository-archive</li>
<li>January 15th 2025: announcement of the packages affected by Phase 2 (OCaml lower bound 4.08)</li>
<li>February 1st 2025: Phase 2 cutting point: packages are moved to opam-repository-archive</li>
<li>February 15th 2025: initial spring cleaning, announcement of packages (based on maintenance-intent)</li>
<li>March 1st 2025: spring cleaning cutting point: packages are moved to opam-repository-archive</li>
<li>Every quarter: repeat Phase 3</li>
<li>Every year: reconsider Phase 2 with an increased OCaml lower bound</li>
</ul>

<p>
We now invite members of the OCaml community who may not follow the ocaml-repository issues to review our plans and submit comments, questions, or suggestions.
</p>

<p>
Thank you in advance for your support!
</p>
</div>
</div>
<div id="outline-container-org8f58479" class="outline-4">
<h4 id="org8f58479">References</h4>
<div class="outline-text-4" id="text-org8f58479">
<ul class="org-ul">
<li><a href="https://github.com/ocaml/opam-repository-archive">Opam repository archive</a></li>
<li><a href="https://github.com/ocaml/opam-repository/blob/master/governance/policies/archiving.md">Proposed policy</a></li>
<li><a href="https://github.com/ocaml/opam-repository/wiki/Package-Archiving:-Plan">Plan of action</a></li>
<li><a href="https://github.com/ocaml/opam-repository/issues/23789">Issue and discussion</a></li>
<li><a href="https://discuss.ocaml.org/t/discussions-on-the-future-of-the-opam-repository/13898">Previous announcement</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgb77cb49" class="outline-4">
<h4 id="orgb77cb49">Acknowledgment</h4>
<div class="outline-text-4" id="text-orgb77cb49">
<p>
Thanks to the following individuals for valuable input and contributions to the planning process (sorry in case we forgot you):
</p>

<ul class="org-ul">
<li>Marcello Seri</li>
<li>Shon Feder</li>
<li>Thomas Gazagnaire</li>
<li>kit-ty-kate</li>
<li>Weng Shiwei 翁士伟</li>
<li>Marcus Rohrmoser</li>
<li>Reynir Björnsson</li>
<li>Stephen Sherratt</li>
<li>Simon Cruanes</li>
<li>Marek Kubica</li>
<li>Raphaël Proust</li>
<li>Romain Beauxis</li>
<li>Yawar Amin</li>
<li>Anil Madhavapeddy</li>
<li>Boning D.</li>
<li>Mathieu Barbin</li>
<li>Hannes Mehnert</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-15" class="outline-2">
<h2 id="15">capnp-rpc 2.0</h2>
<div class="outline-text-2" id="text-15">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-capnp-rpc-2-0/15739/1">https://discuss.ocaml.org/t/ann-capnp-rpc-2-0/15739/1</a>
</p>
</div>
<div id="outline-container-org0da49ee" class="outline-3">
<h3 id="org0da49ee">Thomas Leonard announced</h3>
<div class="outline-text-3" id="text-org0da49ee">
<p>
I'm pleased to announce the release of <a href="https://github.com/mirage/capnp-rpc/releases/tag/v2.0">capnp-rpc 2.0</a>, an OCaml implementation of the Cap'n Proto RPC specification.
</p>

<p>
If you haven't used the library before, please see the <a href="https://github.com/mirage/capnp-rpc/blob/master/README.md">documentation and tutorial</a>. Cap'n Proto RPC aims to provide secure, efficient, typed communications between multiple parties.
</p>

<p>
The main change in this version is the switch from Lwt to Eio for concurrency. The echo benchmark is about 40% faster than before. This isn't because Eio is actually that much faster than Lwt, but more because it has better profiling support so spotting problems was easier. See <a href="https://roscidus.com/blog/blog/2024/07/22/performance/">https://roscidus.com/blog/blog/2024/07/22/performance/</a> for an example:
</p>


<div id="org5178cc8" class="figure">
<p><img src="https://roscidus.com/blog/images/perf/capnp-eio-slow-zoom1-debug.png" alt="capnp-eio-slow-zoom1-debug.png" />
</p>
</div>

<p>
There is a <code>capnp-rpc-lwt</code> compatibility package that provides the old Lwt API using the new Eio version, allowing libraries using the old API to be used in applications using the new code, without having to update everything at once.
</p>

<p>
To migrate to the new version (checking everything still works after each step):
</p>

<ol class="org-ol">
<li>First, update to capnp-rpc 1.2.4 (this ensures you are using the newer mirage-crypto API, to get that migration out of the way first).</li>
<li>Switch your application (that sets up the networking) to capnp-rpc-unix 2.0.</li>
<li>Migrate client and server code away from capnp-rpc-lwt when convenient.</li>
</ol>

<p>
For more detailed instructions, see <a href="https://github.com/mirage/capnp-rpc/blob/master/CHANGES.md#v20">the changelog</a>.
</p>

<p>
Here's an example of the changes needed in the solver-service project:
</p>
<ul class="org-ul">
<li><a href="https://github.com/talex5/solver-service/commit/a4af17b5ea44e94579fc0ca01fd0c618a5182df4">Update to capnp-rpc-unix 2.0</a></li>
<li><a href="https://github.com/talex5/solver-service/commit/74431efd36f4474236401f0556fad80de22b1b42">Remove Capnp_rpc_lwt</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-16" class="outline-2">
<h2 id="16">Other OCaml News</h2>
<div class="outline-text-2" id="text-16">
</div>
<div id="outline-container-org28ad7a9" class="outline-3">
<h3 id="org28ad7a9">From the ocaml.org blog</h3>
<div class="outline-text-3" id="text-org28ad7a9">
<p>
Here are links from many OCaml blogs aggregated at <a href="https://ocaml.org/blog/">the ocaml.org blog</a>.
</p>

<ul class="org-ul">
<li><a href="https://tarides.com/blog/2024-11-27-irmin-on-mirageos-introducing-the-notafs-file-system">Irmin on MirageOS: Introducing the Notafs File System</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org9cd4b78" class="outline-2">
<h2 id="org9cd4b78">Old CWN</h2>
<div class="outline-text-2" id="text-org9cd4b78">
<p>
If you happen to miss a CWN, you can <a href="mailto:alan.schmitt@polytechnique.org">send me a message</a> and I'll mail it to you, or go take a look at <a href="https://alan.petitepomme.net/cwn/">the archive</a> or the <a href="https://alan.petitepomme.net/cwn/cwn.rss">RSS feed of the archives</a>.
</p>

<p>
If you also wish to receive it every week by mail, you may subscribe to the <a href="https://sympa.inria.fr/sympa/info/caml-list">caml-list</a>.
</p>

<div class="authorname" id="orgf915cdc">
<p>
<a href="https://alan.petitepomme.net/">Alan Schmitt</a>
</p>

</div>
</div>
</div>
</div>
</body>
</html>
