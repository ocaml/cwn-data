<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-04-13 Tue 11:38 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OCaml Weekly News</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<style type="text/css">#table-of-contents h2 { display: none } .title { display: none } .authorname { text-align: right }</style>
<style type="text/css">.outline-2 {border-top: 1px solid black;}</style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">OCaml Weekly News</h1>
<p>
<a href="https://alan.petitepomme.net/cwn/2021.04.06.html">Previous Week</a> <a href="https://alan.petitepomme.net/cwn/index.html">Up</a> <a href="https://alan.petitepomme.net/cwn/2021.04.20.html">Next Week</a>
</p>

<p>
Hello
</p>

<p>
Here is the latest OCaml Weekly News, for the week of April 06 to 13, 2021.
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#1">ocaml-wayland (pure OCaml wayland protocol library)</a></li>
<li><a href="#2">Reparse v2.1.0 release</a></li>
<li><a href="#3">Open source editor for iOS, iPadOS and macOS</a></li>
<li><a href="#4">OCaml Café - Tue, Apr 13 @ 7pm Central</a></li>
<li><a href="#5">Directories, an ocaml library</a></li>
<li><a href="#6">Multicore OCaml: March 2021</a></li>
<li><a href="#7">ML Family Workshop 2021: first call for short abstracts and presentations</a></li>
<li><a href="#8">ppx_let_locs - improve stack traces</a></li>
<li><a href="#9">Converting typing information from one OCaml version to a later one?</a></li>
<li><a href="#10">Set up OCaml 1.1.10</a></li>
<li><a href="#org11338f6">Old CWN</a></li>
</ul>
</div>
</div>


<div id="outline-container-1" class="outline-2">
<h2 id="1">ocaml-wayland (pure OCaml wayland protocol library)</h2>
<div class="outline-text-2" id="text-1">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-ocaml-wayland-pure-ocaml-wayland-protocol-library/7616/1">https://discuss.ocaml.org/t/ann-ocaml-wayland-pure-ocaml-wayland-protocol-library/7616/1</a>
</p>
</div>

<div id="outline-container-org1694936" class="outline-3">
<h3 id="org1694936">Thomas Leonard announced</h3>
<div class="outline-text-3" id="text-org1694936">
<p>
I've just released <a href="https://github.com/talex5/ocaml-wayland">ocaml-wayland</a>, a pure OCaml Wayland implementation. You
can get it with:
</p>

<pre class="example" id="org20ce938">
opam install wayland
</pre>

<p>
Wayland is a communications system intended for use between processes on a single computer. It is mainly used by
graphical applications (clients) to talk to display servers, but nothing about it is specific to graphics and it
could be used for other things.
</p>

<p>
A Wayland protocol is defined by writing a schema file. Typed bindings can then be created automatically from that
for various languages. Wayland's main interesting feature is that you can pass file descriptors as message arguments.
For example, to send a frame of video you can get a file descriptor to some shared memory, draw the image to it, and
then pass the FD to the server for rendering, with no need to copy the data.
</p>

<p>
The ocaml-wayland library can be used to write applications, display servers, or proxies. The
<a href="https://github.com/talex5/ocaml-wayland/blob/master/example/test.ml">example</a> in the repository opens a window
showing some scrolling squares. Clicking reverses the direction and pressing keys changes the colours.
</p>

<p>
I used the library to write <a href="https://github.com/talex5/wayland-virtwl-proxy">wayland-virtwl-proxy</a>, which allows
applications running in VMs to open windows directly on the host desktop, as described in my recent blog post
"<a href="https://roscidus.com/blog/blog/2021/03/07/qubes-lite-with-kvm-and-wayland/">Qubes-lite with KVM and Wayland</a>".
</p>

<p>
Note that, unlike the older X11 protocol, Wayland doesn't provide any graphics primitives (such as drawing rectangles
or text). Instead, applications render the window contents however they please and then simply share the buffer with
the compositor. So if you want to write a normal application using it, you'll need to find or write a separate GUI
toolkit too.
</p>
</div>
</div>
</div>




<div id="outline-container-2" class="outline-2">
<h2 id="2">Reparse v2.1.0 release</h2>
<div class="outline-text-2" id="text-2">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-reparse-v2-1-0-release/7619/1">https://discuss.ocaml.org/t/ann-reparse-v2-1-0-release/7619/1</a>
</p>
</div>

<div id="outline-container-org94fe774" class="outline-3">
<h3 id="org94fe774">Bikal Lem announced</h3>
<div class="outline-text-3" id="text-org94fe774">
<p>
I have just released v2.1.0 of reparse to opam. Below are the CHANGES for this release.
CHANGES:
</p>

<p>
This release has backwards incompatible changes.
</p>

<ul class="org-ul">
<li>Infix functions are now available (opened by default) in <code>Parser</code> module itself.</li>
<li>Add support for let operators - <code>let+</code> , <code>let*</code> , <code>and+</code> and <code>and*</code> .</li>
<li><code>bind</code> and <code>map</code> function are now labelled following <code>base</code> library dependency convention.</li>
<li>Items in <code>all_unit</code> are now <code>unit t</code> rather than <code>_ t</code> following monad combinator convention in <code>base</code> library dependency.</li>
<li><code>pure</code> is now deprecated. Use <code>return</code> instead. This is to stay consistent with monad conventions in <code>base</code> library dependency.</li>
<li><code>&gt;|=</code> is deprecated. Use <code>&gt;&gt;|</code> instead. This is to stay consistent with monad conventions in <code>base</code> library dependency.</li>
<li>Removed <code>map4</code> function.</li>
<li>Add support for <code>ppx_let</code> .</li>
<li>Deprecate <code>Parser</code> module. Use <code>Reparse</code> instead.</li>
</ul>
</div>
</div>
</div>




<div id="outline-container-3" class="outline-2">
<h2 id="3">Open source editor for iOS, iPadOS and macOS</h2>
<div class="outline-text-2" id="text-3">
<p>
Archive: <a href="https://discuss.ocaml.org/t/open-source-editor-for-ios-ipados-and-macos/7624/1">https://discuss.ocaml.org/t/open-source-editor-for-ios-ipados-and-macos/7624/1</a>
</p>
</div>

<div id="outline-container-orgc09433d" class="outline-3">
<h3 id="orgc09433d">Nathan Fallet announced</h3>
<div class="outline-text-3" id="text-orgc09433d">
<p>
I'm proud to share with you the editor I've been working on theses last weeks, which is also open source!
</p>

<p>
The editor is available here: <a href="https://apps.apple.com/app/ocaml-learn-code/id1547506826">App Store link</a>
And the source code here: <a href="https://github.com/GroupeMINASTE/OCaml-iOS">GitHub repository</a>
</p>

<p>
A Pull Request just got merged, it is now part of the "Mobile" section on the Install page on the OCaml website.
</p>

<p>
Feel free to give your feedback, and/or contribute to the project on GitHub to help us to make a better tool!
</p>
</div>
</div>


<div id="outline-container-org4a0e678" class="outline-3">
<h3 id="org4a0e678">EduardoRFS then said and borisd replied</h3>
<div class="outline-text-3" id="text-org4a0e678">
<blockquote>
<p>
I have dream, a day where this kind of app will be written in OCaml
</p>
</blockquote>

<p>
I've done some experimental Cocoa bindings, and the basics are working, but the scope of the project is too large for
a single person effort. Here's an example basic app:
<a href="https://github.com/dboris/ocaml-cocoa/blob/master/examples/count_clicks.ml">https://github.com/dboris/ocaml-cocoa/blob/master/examples/count_clicks.ml</a>
</p>

<p>
Would be interested to contribute to a project with a similar goal, if someone has a better idea how to approach
this.
</p>
</div>
</div>


<div id="outline-container-org4b3133f" class="outline-3">
<h3 id="org4b3133f">Yawar Amin added</h3>
<div class="outline-text-3" id="text-org4b3133f">
<p>
Jeffrey Scofield has built some iOS apps with OCaml, so it's certainly possible:
<a href="https://psellos.com/ocaml/compile-to-iphone.html">https://psellos.com/ocaml/compile-to-iphone.html</a>
</p>
</div>
</div>


<div id="outline-container-org4c19a26" class="outline-3">
<h3 id="org4c19a26">Returning to the original post, Nathan Fallet answered a question</h3>
<div class="outline-text-3" id="text-org4c19a26">
<p>
Yes, this app can be used offline!
</p>

<p>
It works with a toplevel built with js_of_ocaml, stored in the app, and everything runs on the device (You can browse
on GitHub the <code>OCaml/JavaScript/</code> folder which contains the toplevel itself). So as everything is already built-in,
no internet connection is required.
</p>

<p>
I will clarify it on the App Store page, because even if it was evident for me, I notice it is not for everyone.
</p>

<p>
Last thing, I'm myself in CPGE (MPSI to be exact), and that's the reason why I started working on this app on my free
time.
</p>
</div>
</div>


<div id="outline-container-org1be60e7" class="outline-3">
<h3 id="org1be60e7">Lilian Besson asked and Nathan Fallet replied</h3>
<div class="outline-text-3" id="text-org1be60e7">
<blockquote>
<ul class="org-ul">
<li>how is automated the build and the upload of the app on the App Store? If a new OCaml version comes every couple of months, how much time would it require to rebuild and upgrade the app and publish/update it on the App Store?</li>
</ul>
</blockquote>
<ul class="org-ul">
<li>I build the app manually, and upload the file to the App Store. So if a new version of OCaml is released, I need to rebuild the top level with Js_of_ocaml, and build a new version of the app that I upload.</li>
</ul>

<blockquote>
<ul class="org-ul">
<li>Can users save (export) and import <code>.ml</code> files? If so, advertise this feature too! Can users write in more than one file at a time (like it's possible for BetterOCaml.ml in a single browser tab!)</li>
</ul>
</blockquote>
<ul class="org-ul">
<li>Users can open and save their .ml files, and even open them from the file explorer (double click on a .ml file will open it in the app), it's like a real code editor. For now only one file can be opened at time, but I plan to make a way to open multiple files (still thinking about it&#x2026;)</li>
</ul>

<blockquote>
<ul class="org-ul">
<li>I guess I know the answer but&#x2026; the technology you chose to build the app is limited to Apple-products only, and it's not a cross-platform technology like Flutter.dev or others recent technologies based on HTML/CSS/Javascript? If it is, how hard do you think it would be for you to also publish your app on Google Play store, and F-Droid.org ? The only app on Google Play is 10 year-old, for OCaml 3.12! <a href="https://play.google.com/store/apps/details?id=fr.vernoux.ocaml">https://play.google.com/store/apps/details?id=fr.vernoux.ocaml</a>, it would be so great to publish a more recent and modern alternative!</li>
</ul>
</blockquote>
<ul class="org-ul">
<li>Of course I wrote the app with pure Swift (except the top level which is built with JS), but an Android version of the app can be written without problem (it's just about the user interface), and then published to the Google Play Store and whatever other store for Android phones.</li>
</ul>

<p>
As holidays are starting now in France, I will consider improving the app with feedbacks I got those last days,
publish an update to the App Store, and start working on an Android version.
</p>
</div>
</div>
</div>




<div id="outline-container-4" class="outline-2">
<h2 id="4">OCaml Café - Tue, Apr 13 @ 7pm Central</h2>
<div class="outline-text-2" id="text-4">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ocaml-cafe-tue-apr-13-7pm-central/7627/1">https://discuss.ocaml.org/t/ocaml-cafe-tue-apr-13-7pm-central/7627/1</a>
</p>
</div>

<div id="outline-container-orgc6a9576" class="outline-3">
<h3 id="orgc6a9576">Claude Jager-Rubinson announced</h3>
<div class="outline-text-3" id="text-orgc6a9576">
<p>
Please join us this coming Tuesday, April 13 at 7pm Central for OCaml Café.  Zoom info is at
<a href="https://hfpug.org/event/ocaml-cafe-3/">https://hfpug.org/event/ocaml-cafe-3/</a>
</p>

<p>
OCaml Café offers a friendly, low stakes opportunity to ask questions about the OCaml language and ecosystem, work
through programming problems that you’re stuck on, and get feedback on your code. Especially geared toward new and
intermediate users, experienced OCaml developers will be available to answer your questions.
</p>

<p>
Whether you’re still trying to make sense of currying or can spot non-tail-recursive code from across the room, we
hope that you’ll join us with your questions about OCaml, or just to hang out with the OCaml community.
</p>
</div>
</div>
</div>




<div id="outline-container-5" class="outline-2">
<h2 id="5">Directories, an ocaml library</h2>
<div class="outline-text-2" id="text-5">
<p>
Archive: <a href="https://discuss.ocaml.org/t/directories-an-ocaml-library/6753/2">https://discuss.ocaml.org/t/directories-an-ocaml-library/6753/2</a>
</p>
</div>

<div id="outline-container-org8cdcd6f" class="outline-3">
<h3 id="org8cdcd6f">zapashcanon announced</h3>
<div class="outline-text-3" id="text-org8cdcd6f">
<p>
We released directories 0.3 recently. In this release, we dropped the Windows dependency on ctypes-foreign and use
ctypes.stubs instead. See <a href="https://github.com/OCamlPro/directories/pull/10">#10</a>
</p>

<p>
This allowed us to clean the code and to remove <a href="https://github.com/OCamlPro/directories/pull/11">some dirty hacks</a>.
</p>
</div>
</div>
</div>




<div id="outline-container-6" class="outline-2">
<h2 id="6">Multicore OCaml: March 2021</h2>
<div class="outline-text-2" id="text-6">
<p>
Archive: <a href="https://discuss.ocaml.org/t/multicore-ocaml-march-2021/7639/1">https://discuss.ocaml.org/t/multicore-ocaml-march-2021/7639/1</a>
</p>
</div>

<div id="outline-container-org2e6c28f" class="outline-3">
<h3 id="org2e6c28f">Anil Madhavapeddy announced</h3>
<div class="outline-text-3" id="text-org2e6c28f">
<p>
Welcome to the March 2021 <a href="https://github.com/ocaml-multicore/ocaml-multicore">Multicore OCaml</a> monthly report! The
following update and the <a href="https://discuss.ocaml.org/tag/multicore-monthly">previous ones</a> have been compiled by me,
@kayceesrk and @shakthimaan.  We remain broadly on track to integrate the last of the multicore prerequisites into
the next (4.13) release, and to propose domains-only parallelism for OCaml 5.0.
</p>
</div>

<div id="outline-container-org5a3e896" class="outline-4">
<h4 id="org5a3e896">Upstream OCaml 4.13 development</h4>
<div class="outline-text-4" id="text-org5a3e896">
<p>
The complex safe points PR (<a href="https://github.com/ocaml/ocaml/pull/10039">#10039</a>) is continuing to make progress, with
more refinement towards reducing the binary size increase that results from the introduction of more polling points.
Special thanks to @damiendoligez for leaping in with a <a href="https://github.com/sadiqj/ocaml/pull/3">PR-to-the-PR</a> to home
in on a workable algorithm!
</p>
</div>
</div>

<div id="outline-container-org97ec1bc" class="outline-4">
<h4 id="org97ec1bc">Multicore OCaml trees</h4>
<div class="outline-text-4" id="text-org97ec1bc">
<p>
If there's one thing we're not going to miss, it's git rebasing. The multicore journey began many moons ago with
OCaml <a href="https://github.com/ocaml-multicore/ocaml-multicore/commits/master-4.02.2">4.02</a>, and then
<a href="https://github.com/ocaml-multicore/ocaml-multicore/tree/4.04.2+multicore">4.04</a>,
<a href="https://github.com/ocaml-multicore/ocaml-multicore/tree/4.06.1+multicore">4.06</a>, and the current
<a href="https://github.com/ocaml-multicore/ocaml-multicore/commits/parallel_minor_gc">4.10</a>.  We're pleased to announce the
hopefully-last rebase of the multicore OCaml trees to OCaml 4.12.0 are now available.  There is now a simpler naming
scheme as well to reflect our upstreaming strategy more closely:
</p>

<ul class="org-ul">
<li>OCaml 4.12.0+domains is the domains-only parallelism that will be submitted for OCaml 5.0</li>
<li>OCaml 4.12.0+domains+effects is the version with domains parallelism and effects-based concurrency.</li>
</ul>

<p>
You can find opam installation instructions for these over at <a href="https://github.com/ocaml-multicore/multicore-opam">the
multicore-opam</a> repository. There is even an ocaml-lsp-server
available, so that your favourite IDE should just work!
</p>
</div>

<div id="outline-container-orga80fe3d" class="outline-5">
<h5 id="orga80fe3d">Domains-only parallelism trees</h5>
<div class="outline-text-5" id="text-orga80fe3d">
<p>
The bulk of effort this month has been around the integration and debugging of Domain Local Allocation Buffers
(DLABs), and also chasing down corner-case failures from stress testing and opam bulk builds. For details, see the
long list of PRs in the next section.
</p>

<p>
We're also cleaning up historical vestiges in order to reduce the diff to OCaml trunk, in order to clear the path to
a clean diff for generating OCaml 5.0 PRs for upstream integration.
</p>
</div>
</div>

<div id="outline-container-org8738dd8" class="outline-5">
<h5 id="org8738dd8">Concurrency and Effects trees</h5>
<div class="outline-text-5" id="text-org8738dd8">
<p>
<b>The camera-ready paper for PLDI 2021 on <a href="https://arxiv.org/abs/2104.00250">Retrofitting Effect handlers onto OCaml</a> is now available on arXiv.</b> The code described in the paper can be used via the <code>4.12.0+domains+effects</code> opam
switches. Please feel free to keep any comments coming to @kayceesrk and myself.
</p>

<p>
We've also been hacking on the multicore IO stack and just beginning to combine concurrency (via effects) and
parallelism (via domains) into Linux io_uring, macOS' Grand Central Dispatch and Windows iocp. We'll have more to
report on this over the next few months, but early benchmarking numbers on Linux are promising.
</p>
</div>
</div>
</div>

<div id="outline-container-orge34b048" class="outline-4">
<h4 id="orge34b048">CI and Benchmarking</h4>
<div class="outline-text-4" id="text-orge34b048">
<p>
We are continuing to expand the testing for different CI configurations for the project. With respect to Sandmark
benchmarking, we are in the process of adding the Irmin layers.ml benchmark. There is also an end-to-end pipeline of
using the OCurrent <a href="https://github.com/ocurrent/current-bench">current-bench</a> framework to give us benchmarking
results from PRs that can be compared to previous runs.
</p>

<p>
As always, we begin with the Multicore OCaml updates, which are then followed by the ongoing and completed tasks for
the Sandmark benchmarking project. Finally, the upstream OCaml work is listed for your reference.
</p>
</div>
</div>

<div id="outline-container-org112a5bf" class="outline-4">
<h4 id="org112a5bf">Detailed Updates</h4>
</div>

<div id="outline-container-org12a25dd" class="outline-4">
<h4 id="org12a25dd">Multicore OCaml</h4>
<div class="outline-text-4" id="text-org12a25dd">
</div>
<div id="outline-container-orge7269df" class="outline-5">
<h5 id="orge7269df">Ongoing</h5>
<div class="outline-text-5" id="text-orge7269df">
</div>
<div id="outline-container-org2f01a57" class="outline-6">
<h6 id="org2f01a57">DLAB</h6>
<div class="outline-text-6" id="text-org2f01a57">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/484">ocaml-multicore/ocaml-multicore#484</a>
Thread allocation buffers
</p>

<p>
The PR provides an implementation for thread local allocation
buffers or <code>Domain Local Allocation Buffers</code>. Code review and
testing of the changes is in progress.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/508">ocaml-multicore/ocaml-multicore#508</a>
Domain Local Allocation Buffers
</p>

<p>
This is an extension to the <code>Thread allocation buffers</code> PR with
initialization, lazy resizing of the global minor heap size, and
rebase to 4.12 branch.
</p></li>
</ul>
</div>
</div>

<div id="outline-container-org887a4ea" class="outline-6">
<h6 id="org887a4ea">Testing</h6>
<div class="outline-text-6" id="text-org887a4ea">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/issues/522">ocaml-multicore/ocaml-multicore#522</a>
Building the runtime with -O0 rather than -O2 causes testsuite to fail
</p>

<p>
The runtime tests fail when using <code>-O0</code> instead of <code>-O2</code> and this
needs to be investigated further.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/issues/526">ocaml-multicore/ocaml-multicore#526</a>
weak-ephe-final issue468 can fail with really small minor heaps
</p>

<p>
The <code>weak-ephe-final</code> tests with a small minor heap (4096 words) cause
the issue468 test to fail.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/528">ocaml-multicore/ocaml-multicore#528</a>
Expand CI runs
</p>

<p>
A list of requirements to expand the scope and execution of our
existing CI runs for comprehensive testing.
</p></li>
</ul>
</div>
</div>

<div id="outline-container-orga3108f4" class="outline-6">
<h6 id="orga3108f4">Sundries</h6>
<div class="outline-text-6" id="text-orga3108f4">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/514">ocaml-multicore/ocaml-multicore#514</a>
Update instructions in ocaml-variants.opam
</p>

<p>
The <code>ocaml-variants.opam</code> and <code>configure.ac</code> files have been updated
to use the Multicore OCaml repository, and to use a local switch
instead of a global one. The current Multicore OCaml is at the 4.12
branch.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/523">ocaml-multicore/ocaml-multicore#523</a>
Systhreads Mutex raises Sys_error
</p>

<p>
The error checking for Systhreads Mutex should be inline with trunk,
instead of the fatal errors reported by Multicore OCaml.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/527">ocaml-multicore/ocaml-multicore#527</a>
Port eventlog to CTF
</p>

<p>
The <code>eventlog</code> implementation has to be ported to the Common Trace
Format. The log output should be consistent with the
parallel_minor_gc output, and stress testing need to be performed.
</p></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org6518d52" class="outline-5">
<h5 id="org6518d52">Completed</h5>
<div class="outline-text-5" id="text-org6518d52">
</div>
<div id="outline-container-org75e93d3" class="outline-6">
<h6 id="org75e93d3">Upstream</h6>
<div class="outline-text-6" id="text-org75e93d3">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/490">ocaml-multicore/ocaml-multicore#490</a>
Remove getmutablefield from bytecode
</p>

<p>
The bytecode compiler and interpreter have been updated by removing
the <code>getmutablefield</code> opcodes.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/496">ocaml-multicore/ocaml-multicore#496</a>
Replace caml_initialize_field with caml_initialize
</p>

<p>
A patch to replace <code>caml_initialize_field</code>, which was earlier used
with the concurrent minor collector, is now replaced with
<code>caml_initialize</code>.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/503">ocaml-multicore/ocaml-multicore#503</a>
Re-enable lib-obj and asmcomp/is_static tests
</p>

<p>
The <code>lib-obj</code> and <code>asmcomp/is_static</code> tests have been re-enabled and
the configure settings have been updated for Multicore
NO_NAKED_POINTERS.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/506">ocaml-multicore/ocaml-multicore#506</a>
Replace <code>Op_val</code> with <code>Field</code>
</p>

<p>
The use of <code>Op_val (x)[i]</code> has been replaced with <code>Field (x, i)</code> to
be consistent with trunk implementation.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/507">ocaml-multicore/ocaml-multicore#507</a>
Change interpreter to use naked code pointers
</p>

<p>
The changes have been made to identify naked pointers in the
interpreter stack to be compatible with trunk.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/516">ocaml-multicore/ocaml-multicore#516</a>
Remove caml_root API
</p>

<p>
The <code>caml_root</code> variables have been changed to <code>value</code> type and are
managed as generational global roots. Hence, the <code>caml_root</code> API is
now removed.
</p></li>
</ul>
</div>
</div>

<div id="outline-container-org993daf9" class="outline-6">
<h6 id="org993daf9">DLAB</h6>
<div class="outline-text-6" id="text-org993daf9">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/511">ocaml-multicore/ocaml-multicore#511</a>
Allocate unique root token on the major heap instead of the minor
</p>

<p>
The unique root token allocation is now done on the major heap
allocation that does not raise any exception, and exits cleanly when
a domain creation fails.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/513">ocaml-multicore/ocaml-multicore#513</a>
Clear the minor heap at the end of a collection in debug runtime
</p>

<p>
A debug value is written to every element of the minor heap for
debugging failures. We now clear the minor heap at the end of a
minor collection.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/519">ocaml-multicore/ocaml-multicore#519</a>
Make timing test more robust
</p>

<p>
The <code>timing.ml</code> test has been updated to be more resilient for
testing with DLABs.
</p></li>
</ul>
</div>
</div>

<div id="outline-container-org0bb694e" class="outline-6">
<h6 id="org0bb694e">Enhancements</h6>
<div class="outline-text-6" id="text-org0bb694e">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/477">ocaml-multicore/ocaml-multicore#477</a>
Move TLS areas to a dedicated memory space
</p>

<p>
In order to support Domain Local Allocation Buffer, we now move the
TLS areas to its own memory alloted space thereby changing the way
we allocate an individual domain's TLS.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/480">ocaml-multicore/ocaml-multicore#480</a>
Remove leave_when_done and friends from STW API
</p>

<p>
The barriers from <code>caml_try_run_on_all_domains*</code> and <code>stw_request</code>
are removed by cleaning up the <code>stw_request.leave_when_done</code>
implementation.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/481">ocaml-multicore/ocaml-multicore#481</a>
Don't share array amongst domains in gc-roots tests
</p>

<p>
Every domain should have its own array, and the parallel global
roots tests have been updated with this change.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/494">ocaml-multicore/ocaml-multicore#494</a>
Stronger invariants on unix_fork
</p>

<p>
We now enforce stronger invariants such that no other domain can run
alongside domain 0 (<code>caml_domain_alone</code>) for <code>unix_fork</code>.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/515">ocaml-multicore/ocaml-multicore#515</a>
Add memprof stubs to build and stdlib
</p>

<p>
The required <code>memprof</code> functions have been added to build <code>stdlib</code>,
and also to build memprof for the runtime.
</p></li>
</ul>
</div>
</div>

<div id="outline-container-org7621a5a" class="outline-6">
<h6 id="org7621a5a">Lazy Updates</h6>
<div class="outline-text-6" id="text-org7621a5a">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/501">ocaml-multicore/ocaml-multicore#501</a>
Safepoints lazy fix
</p>

<p>
The lazy implementation need to be aware of safe points, and we need
to differentiate between recursive forcing of lazy values from
parallel forcing. These fixes are from
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/492">ocaml-multicore#492</a>
and
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/493">ocaml-multicore#493</a>.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/505">ocaml-multicore/ocaml-multicore#505</a>
Add a unique domain token to distinguish lazy forcing failure
</p>

<p>
A <code>caml_ml_domain_unique_token</code> has been added to handle racy access
by multiple mutators. This fixes the <a href="https://github.com/ocaml-multicore/ocaml-multicore/issues/504">using domain id
(int)</a>
to identify forcing domain of lazy block issue.
</p></li>
</ul>
</div>
</div>

<div id="outline-container-org8c618b8" class="outline-6">
<h6 id="org8c618b8">Fixes</h6>
<div class="outline-text-6" id="text-org8c618b8">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/487">ocaml-multicore/ocaml-multicore#487</a>
systhreads: set gc_regs_buckets and friends to NULL at thread startup
</p>

<p>
Pointers have been initialized to NULL in <code>systhreads/st_stubs.c</code>
which solves the <a href="https://github.com/ocaml-multicore/ocaml-multicore/issues/485">segmentation
fault</a>
observed when running the Layers benchmark.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/491">ocaml-multicore/ocaml-multicore#491</a>
Reinitialize child locks after fork
</p>

<p>
The runtime needs to operate correctly after a <code>fork</code>, and this
patch fixes it with proper resetting of domain lock.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/495">ocaml-multicore/ocaml-multicore#495</a>
Fix problems with finaliser orphaning
</p>

<p>
A fix for how we merge finalization tables for orphaned finaliser
work. A test case has also been added to the PR.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/499">ocaml-multicore/ocaml-multicore#499</a>
Fix backtrace unwind
</p>

<p>
The unwinding of stacks over callbacks was not happening correctly
and the discrepancy in <code>caml_next_frame_descriptior</code> is now resolved.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/509">ocaml-multicore/ocaml-multicore#509</a>
Fix for bad setup of Continuation_already_taken exception in bytecode
</p>

<p>
A patch to fix the <code>Continuation_already_taken</code> exception which was
not set up as needed in the bytecode execution.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/510">ocaml-multicore/ocaml-multicore#510</a>
Update a testcase in principality-and-gadts.ml
</p>

<p>
A change in <code>principality-and-gadts.ml</code> to log the correct output as
compared to 4.12 branch in ocaml/ocaml.
</p></li>
</ul>
</div>
</div>

<div id="outline-container-orgb08a557" class="outline-6">
<h6 id="orgb08a557">Ecosystem</h6>
<div class="outline-text-6" id="text-orgb08a557">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/multicore-opam/pull/46">ocaml-multicore/multicore-opam#46</a>
Multicore compatible ocaml-migrate-parsetree.2.1.0
</p>

<p>
The <code>ocaml-migrate-parsetree</code> package uses the effect syntax and now
builds with Multicore OCaml <code>parallel_minor_gc</code> branch.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/multicore-opam/pull/47">ocaml-multicore/multicore-opam#47</a>
Multicore compatible ppxlib
</p>

<p>
The effect syntax has been added to <code>ppxlib</code> and is also now
compatible with Multicore OCaml.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/multicore-opam/pull/49">ocaml-multicore/multicore-opam#49</a>
4.12 Multicore configs
</p>

<p>
Added configurations to install <code>4.12.0+domains+effects</code> and
<code>4.12.0+domains</code> OCaml variants.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/issues/473">ocaml-multicore/ocaml-multicore#473</a>
Building on musl requires dynamically linked execinfo
</p>

<p>
The opam files to allow installation on musl-based environments for
Multicore OCaml have been added to the repository.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/482">ocaml-multicore/ocaml-multicore#482</a>
Check for -lexecinfo in order to build on musl/alpine
</p>

<p>
A <code>configure</code> script has been added which checks for <code>-lexecinfo</code> in
order to support building Multicore OCaml on musl/alpine.
</p></li>
</ul>
</div>
</div>

<div id="outline-container-org7ee8f54" class="outline-6">
<h6 id="org7ee8f54">Documentation</h6>
<div class="outline-text-6" id="text-org7ee8f54">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/502">ocaml-multicore/ocaml-multicore#502</a>
Update README to introduce 4.12+domains+effects and 4.12+domains
</p>

<p>
We have updated the README file with the current list of active
branches, and the names of the historic variants.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/520">ocaml-multicore/ocaml-multicore#520</a>
Clarify comment on RacyLazy
</p>

<p>
A documentation update in <code>stdlib/lazy.mli</code> that clarifies when
<code>RacyLazy</code> and <code>Undefined</code> are raised.
</p></li>
</ul>
</div>
</div>

<div id="outline-container-org40b8880" class="outline-6">
<h6 id="org40b8880">Sundries</h6>
<div class="outline-text-6" id="text-org40b8880">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/486">ocaml-multicore/ocaml-multicore#486</a>
Sync no-effects-syntax to parallel_minor_gc branch
</p>

<p>
The <code>ocaml-multicore:no-effects-syntax</code> branch is now up to date
with the <code>parallel_minor_gc</code> branch changes.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/489">ocaml-multicore/ocaml-multicore#489</a>
Remove promote_to
</p>

<p>
The <code>promote_to</code> function was used in the concurrent minor GC. It is
not required any more and hence has been removed.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/500">ocaml-multicore/ocaml-multicore#500</a>
Replace caml_modify_field with caml_modify
</p>

<p>
The <code>caml_modify_field</code> is no longer necessary and has been replaced
with <code>caml_modify</code>.
</p></li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc36e9a4" class="outline-4">
<h4 id="orgc36e9a4">Benchmarking</h4>
<div class="outline-text-4" id="text-orgc36e9a4">
</div>
<div id="outline-container-orge703db5" class="outline-5">
<h5 id="orge703db5">Ongoing</h5>
<div class="outline-text-5" id="text-orge703db5">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/204">ocaml-bench/sandmark#204</a>
Adding layers.ml as a benchmark to Sandmark
</p>

<p>
The inclusion of Irmin layers.ml benchmark with updates to all its
dependency requirements.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/209">ocaml-bench/sandmark#209</a>
Use rule target kronecker.txt and remove from macro_bench
</p>

<p>
A review of the graph500seq <code>kernel1.ml</code> implementation has been
done, and code changes have been proposed. The <code>macro_bench</code> tag
will be retained for the <code>graph500</code> benchmarks.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/212">ocaml-bench/sandmark#212</a>
Increasing the major heap allocation on some benchmarks
</p>

<p>
A work in progress to add more longer running benchmarks that
involve major heap allocation. Some of the parameters have been
updated with higher values, and more loops have been added as well.
</p></li>

<li><p>
We now have integrated the build of Sandmark 2.0 with
<a href="https://github.com/ocurrent/current-bench">current-bench</a> for
CI. The results of the benchmark runs are now pushed to a PostgreSQL
database as shown below:
</p>

<pre class="example" id="org2e1e86a">
docker=# select * from benchmarks;
-[ RECORD 1 ]--+-------------------------------------------------------
run_at         | 2021-03-26 11:21:20.64
repo_id        | local/local
commit         | 55c6fb6416548737b715d6d8fde6c0f690526e42
branch         | 2.0.0-alpha+001
pull_number    |
benchmark_name |
test_name      | coq.BasicSyntax.v
metrics        | {"maxrss_kB": 678096, "time_secs": 101.99969387054443}
duration       | 00:37:52.776357
-[ RECORD 2 ]--+-------------------------------------------------------
run_at         | 2021-03-26 11:21:20.64
repo_id        | local/local
commit         | 55c6fb6416548737b715d6d8fde6c0f690526e42
branch         | 2.0.0-alpha+001
pull_number    |
benchmark_name |
test_name      | thread_ring_lwt_mvar.20_000
metrics        | {"maxrss_kB": 8096, "time_secs": 2.6146790981292725}
duration       | 00:37:52.776357
...
</pre>

<p>
We will continue to work on adding more workflows and features to
<code>current-bench</code> to support Sandmark builds.
</p></li>
</ul>
</div>
</div>

<div id="outline-container-orgedfa106" class="outline-5">
<h5 id="orgedfa106">Completed</h5>
<div class="outline-text-5" id="text-orgedfa106">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/202">ocaml-bench/sandmark#202</a>
Added bench clean target in the Makefile
</p>

<p>
A <code>benchclean</code> target to remove the generated benchmarks and its
results while still retaining the <code>_opam</code> folder has been added to
the Makefile.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/203">ocaml-bench/sandmark#203</a>
Implement ITER support
</p>

<p>
The use of ITER variable is now supported in Sandmark, and you can
run multiple iterations of the benchmarks. For example, with
<code>ITER=2</code>, a couple of summary .bench files are created with the
benchmark results as shown below:
</p>

<pre class="example" id="org48a4493">
$ TAG='"run_in_ci"' make run_config_filtered.json
$ ITER=2 RUN_CONFIG_JSON=run_config_filtered.json make ocaml-versions/4.10.0+multicore.bench

$ ls _results/
4.10.0+multicore_1.orun.summary.bench  4.10.0+multicore_2.orun.summary.bench
</pre></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/208">ocaml-bench/sandmark#208</a>
Fix params for simple-tests/capi
</p>

<p>
A minor fix in <code>run_config.json</code> to correctly pass the arguments to
the <code>simple-tests/capi</code> benchmark execution. You can verify the same
using the following commands:
</p>

<pre class="example" id="orge588b21">
$ TAG='"lt_1s"' make run_config_filtered.json
$ RUN_CONFIG_JSON=run_config_filtered.json make ocaml-versions/4.10.0+multicore.bench
</pre></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/210">ocaml-bench/sandmark#210</a>
Don't share array in global roots parallel benchmarks
</p>

<p>
A patch to not share array in global roots implementation for
parallel benchmarks.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/213">ocaml-bench/sandmark#213</a>
Resolve dependencies for 4.12.1+trunk, 4.12.0+domains and 4.12.0+domains+effects
</p>

<p>
The <code>dependencies/packages</code> have now been updated to be able to
build <code>4.12.1+trunk</code>, <code>4.12.0+domains</code> and <code>4.12.0+domains+effects</code>
branches with Sandmark.
</p></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org21b6388" class="outline-4">
<h4 id="org21b6388">OCaml</h4>
<div class="outline-text-4" id="text-org21b6388">
</div>
<div id="outline-container-org9b7a4b5" class="outline-5">
<h5 id="org9b7a4b5">Ongoing</h5>
<div class="outline-text-5" id="text-org9b7a4b5">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml/ocaml/pull/10039">ocaml/ocaml#10039</a>
Safepoints
</p>

<p>
The review of the Safepoints PR is in progress. Special thanks to
Damien Doligez for his <a href="https://github.com/sadiqj/ocaml/pull/3">code
suggestions</a> on safepoints
and inserting polls. There is still work to be done on
optimizations.
</p></li>
</ul>

<p>
Many thanks to all the OCaml users, developers and contributors in the
community for their support to the project. Stay safe!
</p>
</div>
</div>
</div>

<div id="outline-container-org3758923" class="outline-4">
<h4 id="org3758923">Acronyms</h4>
<div class="outline-text-4" id="text-org3758923">
<ul class="org-ul">
<li>API: Application Programming Interface</li>
<li>CI: Continuous Integration</li>
<li>CTF: Common Trace Format</li>
<li>DLAB: Domain Local Allocation Buffer</li>
<li>GC: Garbage Collector</li>
<li>OPAM: OCaml Package Manager</li>
<li>PR: Pull Request</li>
<li>STW: Stop The World</li>
<li>TLS: Thread Local Storage</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-org30c93b1" class="outline-3">
<h3 id="org30c93b1">Nate asked and Anil Madhavapeddy replied</h3>
<div class="outline-text-3" id="text-org30c93b1">
<blockquote>
<p>
Sorry if this has been answered elsewhere – am I reading this correctly that effects aren’t intended for OCaml 5? If not, are there plans to merge effect handlers into mainline OCaml at some later stage, or is it going to be kept
separate?
</p>
</blockquote>

<p>
Just to be clear, effects are not slated for any official release of OCaml yet.  The focus is on making sure that
OCaml 5.0 is a really solid release with domains-only parallelism, and then to look into subsequent changes required
for concurrency.  There are some considerations about how precisely effects should work when they materialise in a
mainline OCaml release:
</p>

<ul class="org-ul">
<li><b>semantics:</b> how will the introduction of effect handlers complicate (or improve!) reasoning about OCaml programs? @fpottier and Paulo Emílio de Vilhena have a paper on <a href="http://cambium.inria.fr/~fpottier/publis/de-vilhena-pottier-sleh.pdf">"separation logic for effect handlers"</a> at POPL 2021 that is a good starting point to read from.</li>
<li><b>performance:</b> on the other side, we want to make sure that effect handlers do not introduce a runtime overhead to sequential OCaml code. Our paper on "<a href="https://arxiv.org/abs/2104.00250">retrofitting effect handlers onto OCaml</a>" addresses this, with a particular restriction on making sure handlers are one-shot only (a position conveniently reinforced by @fpottier's paper above, as it also makes program reasoning much easier).</li>
<li><b>type safety:</b> our current implementation of effects is untyped, which doesn't fit that well into the spirit of ML. There is active research ongoing into developing a theory of typed effects lead by @lpw25, and you can see a <a href="https://www.janestreet.com/tech-talks/effective-programming/">tech talk about this</a>.</li>
<li><b>portability:</b> OCaml is an extremely portable language, we want to make sure we can maintain clean compilation to existing targets (such as js_of_ocaml) and new ones (such as webassembly). @kayceesrk is active in the <a href="https://kcsrk.info/slides/WASM_CG_4Aug20.pdf">wasm working groups</a> on this topic, and we're using MirageOS (which has compiler forks for esp32 embedded systems) to experiment with overheads using unikernels.</li>
<li><b>ergonomics:</b> and last but not least, the hardest one to answer: once we develop a workable model for typed effects in OCaml, does it work at scale on large codebases and also for writing incremental code that can be locally reasoned about? The only answer to this is to build prototypes of a significant size, which is something we're working on at OCaml Labs as part of efforts like our multicore IO stack. I don't talk about this much at the moment as we regularly thrown prototypes away, but we're converging on some stability in recent months.</li>
</ul>

<p>
To risk an analogy, imagine that we're flying from Cambridge to Fiji for a nice post-pandemic vacation. To get to our
end goal, we have to fly via a few intermediate cities (say, London and Sydney).  We need to be very careful not to
screw up our landing into Sydney because we're so excited about eventually getting to Fiji &#x2013; if we do that, there is
no glorious holiday for us!  And you know what? Sydney's not so bad a place to hang out and adjust to jetlag while we
carefully plan the flight path to Fiji.
</p>

<p>
We could really use the community's help with OCaml 5.0, as it's going to be a major release. Rest assured that we're
thinking (and working hard) on how concurrency should also show up in OCaml, but it won't happen until we get OCaml
5.0 out of the door.  Core OCaml development is all about careful, iterative progress to avoid the risk of losing the
properties that make OCaml so reliable for all the downstream projects that depend on us.
</p>

<p>
Having said all that, I can't wait to get to get to Fiji either. It's going to be an awesome vacation when we finally
arrive.
</p>
</div>
</div>
</div>




<div id="outline-container-7" class="outline-2">
<h2 id="7">ML Family Workshop 2021: first call for short abstracts and presentations</h2>
<div class="outline-text-2" id="text-7">
<p>
Archive: <a href="https://sympa.inria.fr/sympa/arc/caml-list/2021-04/msg00010.html">https://sympa.inria.fr/sympa/arc/caml-list/2021-04/msg00010.html</a>
</p>
</div>

<div id="outline-container-org3f0cdb8" class="outline-3">
<h3 id="org3f0cdb8">Jonathan Protzenko announced</h3>
<div class="outline-text-3" id="text-org3f0cdb8">
<p>
(tl;dr)
</p>

<p>
The ML family workshop is back, and will be held virtually along with
ICFP 2021. The workshop does not have proceedings, making it the perfect
venue to run some ideas with the community or present some work in
progress within a friendly environment. The PC has a broad expertise and
submissions are 3 pages long: when in doubt, just submit!
</p>

<p>
(long version)
</p>

<p>
We are happy to announce that the ML Family Workshop is back for its
2021 edition, which we will be held online on Thursday August 26th, in
conjunction with ICFP 2021.
</p>

<p>
The ML family workshop warmly welcomes submission touching on the
programming languages traditionally seen as part of the "ML family"
(Standard ML, OCaml, F#, CakeML, SML#, Manticore, MetaOCaml, etc.). The
scope of the workshop includes all aspects of the design, semantics,
theory, application, implementation, and teaching of the members of the
ML family. We also encourage presentations from related languages (such
as Haskell, Scala, Rust, Nemerle, Links, Koka, F*, Eff, ATS, etc), to
exchange experience of further developing ML ideas.
</p>
</div>

<div id="outline-container-org70ac308" class="outline-4">
<h4 id="org70ac308">Submission details</h4>
<div class="outline-text-4" id="text-org70ac308">
<p>
Submissions must be at most three pages long; see the full call for
papers
<a href="https://icfp21.sigplan.org/home/mlfamilyworkshop-2021#Call-for-Presentations">https://icfp21.sigplan.org/home/mlfamilyworkshop-2021#Call-for-Presentations</a>
for details.
</p>

<p>
Submission site: <a href="https://ml21.hotcrp.com/">https://ml21.hotcrp.com/</a>
</p>
</div>
</div>

<div id="outline-container-org64d1f83" class="outline-4">
<h4 id="org64d1f83">Important dates</h4>
<div class="outline-text-4" id="text-org64d1f83">
<ul class="org-ul">
<li>Thu, May 27th 2021 (AoE): submission deadline</li>
<li>Thu, Jun 17th 2021 (AoE): author notification</li>
<li>Thu, Aug 26th: workshop (time slots TBD)</li>
</ul>
</div>
</div>

<div id="outline-container-orgefeed2c" class="outline-4">
<h4 id="orgefeed2c">Program committee</h4>
<div class="outline-text-4" id="text-orgefeed2c">
<ul class="org-ul">
<li>Danel Ahman (University of Ljubljana)</li>
<li>Robert Atkey (University of Strathclyde)</li>
<li>Frédéric Bour (Tarides)</li>
<li>Ezgi Çiçek (Facebook London)</li>
<li>Youyou Cong (Tokyo Institute of Technology)</li>
<li>Richard A. Eisenberg (Tweag I/O)</li>
<li>Martin Elsman (University of Copenhagen, Denmark)</li>
<li>Ohad Kammar (University of Edinburgh)</li>
<li>Naoki Kobayashi (University of Tokyo, Japan)</li>
<li>Benoît Montagu (Inria)</li>
<li>Jonathan Protzenko (Microsoft Research) (Chair)</li>
<li>Kristina Sojakova (INRIA Paris)</li>
<li>Don Syme (Microsoft)</li>
<li>Matías Toro (University of Chile)</li>
<li>Katsuhiro Ueno (Tohoku University)</li>
</ul>
</div>
</div>
</div>
</div>




<div id="outline-container-8" class="outline-2">
<h2 id="8">ppx_let_locs - improve stack traces</h2>
<div class="outline-text-2" id="text-8">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-ppx-let-locs-improve-stack-traces/7646/1">https://discuss.ocaml.org/t/ann-ppx-let-locs-improve-stack-traces/7646/1</a>
</p>
</div>

<div id="outline-container-orgd39cc62" class="outline-3">
<h3 id="orgd39cc62">EduardoRFS announced</h3>
<div class="outline-text-3" id="text-orgd39cc62">
<p>
A common problem that I personally had when developing async code in OCaml is that both <code>Lwt</code> and <code>Async</code> leads to
useless stack traces. When using <code>lwt_ppx</code> that is handled by the ppx, but the same is not possible with <code>let*</code>,
<code>let.await</code> or <code>&gt;&gt;=</code>.
</p>

<p>
If you want to solve that, you can use <a href="https://github.com/EduardoRFS/ppx_let_locs">ppx_let_locs</a>, it will detect
your calls and when there is a replacement function available that would allow stack traces to be enhanced it will
enhance that by default for you.
</p>
</div>

<div id="outline-container-org8bfe06f" class="outline-4">
<h4 id="org8bfe06f">How it works</h4>
<div class="outline-text-4" id="text-org8bfe06f">
<p>
Everytime an ident is applied it tries to find a <code>backtrace_ident</code> or <code>ident_backtrace</code> version of it, if that is
present and it has the right signature, the PPX will then apply the backtraced one with the additional argument.
This means it also works with operators, like <code>&gt;&gt;=_backtrace</code>, as they're just normal function application.
</p>

<p>
For letop there is a special case, the signature of the letop must be slightly different to ensure that the typing
order was not changed, essentially the <code>let*_backtrace</code> must have the following signature <code>(exn -&gt; exn * 'a) -&gt; 'b
-&gt; 'c</code>.
</p>

<p>
To achieve that this is actually a typed PPX, which runs a slightly patched version of the OCaml typechecker, then
untype it and pass to the OCaml compiler. This implies a couple of things:
</p>

<ul class="org-ul">
<li>it needs to be executed as <code>(staged_pps ppx_let_locs)</code> on dune</li>
<li>versions must be explicitly supported, for now only 4.10 and 4.12 are supported, if you need any other version feel free to request.</li>
<li>it can be quite slow on some codebases</li>
</ul>

<p>
To solve the above problems, an important property is that, assuming the backtraced version behaves identically to
the non backtraced one, it is in theory a noop, as removing or adding the PPX should not change the behavior of the
code. So it can be used only for development or for production, as adding or removing the PPX will not break your
code.
</p>
</div>
</div>

<div id="outline-container-orgdb81e47" class="outline-4">
<h4 id="orgdb81e47">Async</h4>
<div class="outline-text-4" id="text-orgdb81e47">
<p>
Currently it seems like Async doesn't provide anything similar to <code>Lwt.backtrace_bind</code> and <code>Async.try_with</code> also
looses the stack trace, so I would love help in this area.
</p>
</div>
</div>

<div id="outline-container-orga74895b" class="outline-4">
<h4 id="orga74895b">Examples</h4>
<div class="outline-text-4" id="text-orga74895b">
<p>
<b>from:</b>
</p>


<div id="org9ca128d" class="figure">
<p><img src="https://aws1.discourse-cdn.com/standard11/uploads/ocaml/original/2X/1/14332ae62e5262a9d4e960e6f7324145b56713f7.png" alt="14332ae62e5262a9d4e960e6f7324145b56713f7.png" />
</p>
</div>

<p>
<b><b>to:</b></b>
</p>


<div id="org44d34ee" class="figure">
<p><img src="https://aws1.discourse-cdn.com/standard11/uploads/ocaml/original/2X/d/d67eaf5bb0fbb94a84f602de9bd02580f350ff68.png" alt="d67eaf5bb0fbb94a84f602de9bd02580f350ff68.png" />
</p>
</div>

<p>
As you can see, on the second stack trace you can find out that it was actually being called on
<code>test_interpretation.ml</code>.
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-9" class="outline-2">
<h2 id="9">Converting typing information from one OCaml version to a later one?</h2>
<div class="outline-text-2" id="text-9">
<p>
Archive: <a href="https://discuss.ocaml.org/t/converting-typing-information-from-one-ocaml-version-to-a-later-one/7608/6">https://discuss.ocaml.org/t/converting-typing-information-from-one-ocaml-version-to-a-later-one/7608/6</a>
</p>
</div>

<div id="outline-container-orgb25eb70" class="outline-3">
<h3 id="orgb25eb70">Deep in this thread, EduardoRFS announced</h3>
<div class="outline-text-3" id="text-orgb25eb70">
<p>
For me reading the <code>cmi</code> is enough, so I implemented it on <code>ocaml-migrate-types</code>, it can do 411 -&gt; 412 types, will
implement 410 -&gt; 411, which is probably painful because of the Uid
</p>

<p>
<a href="https://github.com/EduardoRFS/ocaml-migrate-types/blob/main/src/migrate_411_412.ml">https://github.com/EduardoRFS/ocaml-migrate-types/blob/main/src/migrate_411_412.ml</a>
</p>
</div>
</div>
</div>




<div id="outline-container-10" class="outline-2">
<h2 id="10">Set up OCaml 1.1.10</h2>
<div class="outline-text-2" id="text-10">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-set-up-ocaml-1-1-10/7667/1">https://discuss.ocaml.org/t/ann-set-up-ocaml-1-1-10/7667/1</a>
</p>
</div>

<div id="outline-container-orgf90f02d" class="outline-3">
<h3 id="orgf90f02d">Sora Morimoto announced</h3>
<div class="outline-text-3" id="text-orgf90f02d">
</div>
<div id="outline-container-org20fc3d0" class="outline-4">
<h4 id="org20fc3d0">Changed</h4>
<div class="outline-text-4" id="text-org20fc3d0">
<ul class="org-ul">
<li>Run <code>brew update</code> before set up to avoid an issue with Bintray transition period.</li>
</ul>

<p>
<a href="https://github.com/avsm/setup-ocaml/releases/tag/v1.1.10">https://github.com/avsm/setup-ocaml/releases/tag/v1.1.10</a>
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-org11338f6" class="outline-2">
<h2 id="org11338f6">Old CWN</h2>
<div class="outline-text-2" id="text-org11338f6">
<p>
If you happen to miss a CWN, you can <a href="mailto:alan.schmitt@polytechnique.org">send me a message</a> and I'll mail it to you, or go take a look at <a href="https://alan.petitepomme.net/cwn/">the archive</a> or the <a href="https://alan.petitepomme.net/cwn/cwn.rss">RSS feed of the archives</a>.
</p>

<p>
If you also wish to receive it every week by mail, you may subscribe <a href="http://lists.idyll.org/listinfo/caml-news-weekly/">online</a>.
</p>

<div class="authorname" id="org8429b8b">
<p>
<a href="https://alan.petitepomme.net/">Alan Schmitt</a>
</p>

</div>
</div>
</div>
</div>
</body>
</html>
