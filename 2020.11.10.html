<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-11-10 Tue 09:31 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OCaml Weekly News</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<style type="text/css">#table-of-contents h2 { display: none } .title { display: none } .authorname { text-align: right }</style>
<style type="text/css">.outline-2 {border-top: 1px solid black;}</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">OCaml Weekly News</h1>
<p>
<a href="http://alan.petitepomme.net/cwn/2020.11.03.html">Previous Week</a> <a href="http://alan.petitepomme.net/cwn/index.html">Up</a> <a href="http://alan.petitepomme.net/cwn/2020.11.17.html">Next Week</a>
</p>

<p>
Hello
</p>

<p>
Here is the latest OCaml Weekly News, for the week of November 03 to 10, 2020.
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#1">OCaml native library to draw, scale, rotate shapes on screen</a></li>
<li><a href="#2">GuaCaml.0.02 : A Generic Unspecific Algorithmic in OCaml</a></li>
<li><a href="#3">Snowflake : a Generic Symbolic Dynamic Programming framework</a></li>
<li><a href="#4">Using CLI arguments through modules and configuration files</a></li>
<li><a href="#5">Multicore OCaml: October 2020</a></li>
<li><a href="#6">Other OCaml News</a></li>
<li><a href="#org18fc434">Old CWN</a></li>
</ul>
</div>
</div>


<div id="outline-container-org5ea982d" class="outline-2">
<h2 id="1">OCaml native library to draw, scale, rotate shapes on screen</h2>
<div class="outline-text-2" id="text-1">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ocaml-native-library-to-draw-scale-rotate-shapes-on-screen/6706/1">https://discuss.ocaml.org/t/ocaml-native-library-to-draw-scale-rotate-shapes-on-screen/6706/1</a>
</p>
</div>

<div id="outline-container-orgc26d47e" class="outline-3">
<h3 id="orgc26d47e">Yoann asked announced</h3>
<div class="outline-text-3" id="text-orgc26d47e">
<p>
Is there any library to easily draw shapes (circle, rectangles, etc.) and rotate or scale them, and
that also supports some alpha layer.
</p>

<p>
I know Graphics, but it does not look like you can rotate/scale/alpha easily shapes.
I know Cairo but it depends on lablgtk to draw things on the screen and I don't need any widgets and
I'd rather avoid dependencies to gtk.
</p>

<p>
For context I'm trying to port elm-playgound which allows to super easily code pictures, animations, or
games (see <a href="https://package.elm-lang.org/packages/evancz/elm-playground/latest/">https://package.elm-lang.org/packages/evancz/elm-playground/latest/</a> for its API).
I am almost done porting it in a Web context thanks to js_of_ocaml, ocaml-vdom, and the SVG support in
a browser, but I'd like now to port it in a native context.
</p>
</div>
</div>


<div id="outline-container-org5d0e9dc" class="outline-3">
<h3 id="org5d0e9dc">Armael replied</h3>
<div class="outline-text-3" id="text-org5d0e9dc">
<p>
I'm using the <a href="https://github.com/Chris00/ocaml-cairo">ocaml-cairo</a> in a project, and it works
relatively well. The library is also very nicely documented (there's an ocaml translation of the cairo
tutorial, and various examples). Note that it corresponds to the <code>cairo2</code> package in opam, which does
<b>not</b> depend on lablgtk!
(the downside being, I think, that the API provided by the cairo ( C) library is very imperative and
can be a bit tricky to use at times).
</p>

<p>
I also know of the <a href="https://github.com/dbuenzli/vg">vg</a> library for vector graphics, which has the
virtue of being pure ocaml code. It is also very well documented. I suspect that it has a smaller
feature set and number of supported backends than Cairo, but has a nicer API.
Actually, it seems that you can use Cairo as a backend for Vg
(<a href="https://erratique.ch/software/vg/doc/Vgr_cairo/index.html">https://erratique.ch/software/vg/doc/Vgr_cairo/index.html</a>), which might give you the best of both
worlds, in the case where you want to use Vg with a backend only supported by Cairo.
</p>
</div>
</div>


<div id="outline-container-org3216289" class="outline-3">
<h3 id="org3216289">Igarnier added</h3>
<div class="outline-text-3" id="text-org3216289">
<p>
You an use e.g. <code>Cairo.Image.create_for_data32</code> to create a Cairo RGBA surface from a bigarray (that
can be then shared with Sdl or whatever other lib for displaying).
</p>
</div>
</div>


<div id="outline-container-orgc6072a5" class="outline-3">
<h3 id="orgc6072a5">Yoann Padioleau then replied</h3>
<div class="outline-text-3" id="text-orgc6072a5">
<p>
Oh you're right. I just found this example to transfer pictures from cairo to graphics:
<a href="https://github.com/Chris00/ocaml-cairo/blob/master/examples/graphics_demo.ml">https://github.com/Chris00/ocaml-cairo/blob/master/examples/graphics_demo.ml</a>
</p>
</div>
</div>


<div id="outline-container-org0b00f0d" class="outline-3">
<h3 id="org0b00f0d">Armael added</h3>
<div class="outline-text-3" id="text-org0b00f0d">
<p>
Oh, and I should note that I know of a third option: <a href="https://github.com/let-def/wall">https://github.com/let-def/wall</a>
</p>

<p>
It also has a nice vector-graphics API, and can render to Tsdl (see <a href="https://github.com/let-def/wall/blob/master/example/minimal.ml">the
example</a>).
(downside: it's maybe a bit less mature and less documented than the other two, but seems to correspond
to what you're looking for.)
</p>
</div>
</div>


<div id="outline-container-org8e67f31" class="outline-3">
<h3 id="org8e67f31">Florent Monnier said</h3>
<div class="outline-text-3" id="text-org8e67f31">
<p>
You can scale and rotate with SDL2 and it's bindings.
Use the function <a href="https://fccm.github.io/OCamlSDL2/Sdlrender.html#VALcopyEx">Render.copyEx</a> to copy a
sprite on screen. Use the <code>angle</code> parameter to rotate and use rectangles of different <code>width</code> and
<code>height</code> to scale.
SDL2 doesn't permit to draw much shapes though, only rectangles by default, because it's made for
gamedev, but you can use the <code>SDL2_gfx</code> lib in addition with SDL2, with its template bindings
<a href="https://github.com/fccm/OCamlSDL2_Gfx">OCamlSDL2_Gfx</a>.
</p>
</div>
</div>


<div id="outline-container-org3d52fe9" class="outline-3">
<h3 id="org3d52fe9">Florent Monnier later added</h3>
<div class="outline-text-3" id="text-org3d52fe9">
<p>
SFML and its bindings <a href="https://github.com/fccm/ocaml-sfml">ocaml-sfml</a> allow more shapes drawing than
SDL2.
</p>

<p>
You will probably be able to do everything you want with it, any shapes, rotate, scale, translate and
more!
Have a look at its <a href="http://fccm.github.io/ocaml-sfml/">api-doc</a>, and in particular the <a href="http://fccm.github.io/ocaml-sfml/SFShape.html">SFShape
module</a>.
</p>

<p>
(Also please notice that SDL and SDL2 are 2 different libs, that don’t share any code, and have 2
different licenses, and with different implementations, SDL 1.2 uses software render, and SDL2 uses
OpenGL inside.)
</p>
</div>
</div>
</div>




<div id="outline-container-org18589d4" class="outline-2">
<h2 id="2">GuaCaml.0.02 : A Generic Unspecific Algorithmic in OCaml</h2>
<div class="outline-text-2" id="text-2">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-guacaml-0-02-a-generic-unspecific-algorithmic-in-ocaml/6712/1">https://discuss.ocaml.org/t/ann-guacaml-0-02-a-generic-unspecific-algorithmic-in-ocaml/6712/1</a>
</p>
</div>

<div id="outline-container-org6091dce" class="outline-3">
<h3 id="org6091dce">Joan Thibault announced</h3>
<div class="outline-text-3" id="text-org6091dce">
<p>
GuaCaml is a simple extension to the Standard OCaml Library (Stdlib).
</p>

<p>
<a href="https://gitlab.com/boreal-ldd/guacaml">https://gitlab.com/boreal-ldd/guacaml</a>
</p>
</div>
</div>
</div>




<div id="outline-container-orgf65e33e" class="outline-2">
<h2 id="3">Snowflake : a Generic Symbolic Dynamic Programming framework</h2>
<div class="outline-text-2" id="text-3">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-snowflake-a-generic-symbolic-dynamic-programming-framework/6714/1">https://discuss.ocaml.org/t/ann-snowflake-a-generic-symbolic-dynamic-programming-framework/6714/1</a>
</p>
</div>

<div id="outline-container-orgb57dbf6" class="outline-3">
<h3 id="orgb57dbf6">Joan Thibault announced</h3>
<div class="outline-text-3" id="text-orgb57dbf6">
<p>
I have the pleasure to announce the to announce the first opam release of
<a href="https://gitlab.com/boreal-ldd/snowflake">Snowflake</a> : a Generic Symbolic Dynamic Programming framework
interfacing WAP, RBTF and <a href="https://github.com/arlencox/mlbdd">MLBDD</a>.
</p>

<blockquote>
<p>
Complex systems (either physical or logical) are usually structured and sparse, that is, they are
build from individual components linked together, and any component is only linked to a rather small
number of other components with respects to the size of the global system.
</p>

<p>
RBTF exploits this structure, by over-approximating the relations between components as a tree
(called decomposition tree in the graph literature) each node of this tree being a set of components
of the initial systems. Then, starting from leaves, each sub-system is solved and the solutions are
projected as a new constraints on their parent node, this process is iterated until all sub-systems
are solved. This step allows to condensate all constraints into a single sub-system and check their
satisfiability. We call this step the <b>Forward Reduction Process</b> (FRP).
</p>

<p>
Finally, we can propagate all the constraints back into their initial sub-system by performing those
same projection in the reverse direction. That is, each sub-system update its set of solution given
the information from its parent then send the information to its children sub-systems (possibly none,
if its a leaf). We call this step the <b>Backward Propagation Process</b> (BPP).
</p>
</blockquote>

<p>
<a href="https://gitlab.com/boreal-ldd/snowflake">https://gitlab.com/boreal-ldd/snowflake</a>
</p>
</div>
</div>
</div>




<div id="outline-container-org334c9e5" class="outline-2">
<h2 id="4">Using CLI arguments through modules and configuration files</h2>
<div class="outline-text-2" id="text-4">
<p>
Archive: <a href="https://discuss.ocaml.org/t/using-cli-arguments-through-modules-and-configuration-files/6725/1">https://discuss.ocaml.org/t/using-cli-arguments-through-modules-and-configuration-files/6725/1</a>
</p>
</div>

<div id="outline-container-orga98eb59" class="outline-3">
<h3 id="orga98eb59">erhan gundogan asked</h3>
<div class="outline-text-3" id="text-orga98eb59">
<p>
I was looking for common approaches and best practises regarding to CLI argument passing and
configuration files. I couldn't find much after googling so here is my questions:
</p>

<ol class="org-ol">
<li>I am getting arguments with cmdliner library and passing those arguments through functions. And sometimes I have to pass these arguments through multiple functions. I am not sure if that's the correct way of doing it. Let's say I have <code>verbose</code> flag defined and I have logs in various modules. So how can I receive this flag whenever needed? Could you please share any resources regarding to saving arguments and accessing them from different modules?</li>

<li>Is there a configuration file concept in OCaml? Files such as <code>.yaml</code> and <code>.json</code></li>
</ol>
</div>
</div>


<div id="outline-container-org82392ff" class="outline-3">
<h3 id="org82392ff">Craig Ferguson replied</h3>
<div class="outline-text-3" id="text-org82392ff">
<p>
For the specific case of logging, my advice is to use the <a href="https://erratique.ch/software/logs">Logs</a>
library or – failing that – to just copy the approach that it takes verbatim. <code>Logs</code> looks after some
global mutable state that contains the current logging level of the program, so you don't have to
bother with propagating this information throughout your program. When I'm reading OCaml code, I'm not
concerned with whether any particular function might emit log lines, so I don't need this to be made
painfully obvious at each call-site. If you do use <code>Logs</code>, it comes pre-packaged with Cmdliner
specifications for setting the logging level in the <code>logs.cli</code> package (example
<a href="https://github.com/CraigFe/oskel/blob/master/bin/main.ml#L187-L193">here</a>).
</p>

<p>
Generally, there are several options for propagating state throughout an OCaml program. In roughly
decreasing order of explicitness:
</p>
<ul class="org-ul">
<li>pass all params explicitly to the functions that need them, precisely as you're doing right now.</li>

<li>pack params into a "context" record (or object) that is passed explicitly where it's needed. (c.f. Dune's <a href="https://github.com/ocaml/dune/blob/master/src/dune_rules/context.mli#L46"><code>Context</code></a> and <a href="https://github.com/ocaml/dune/blob/master/src/dune_rules/super_context.ml#L187"><code>Super_context</code></a>.)</li>

<li>pack params into a "context" module that is then used to instantiate functors elsewhere in your program. (c.f. <a href="https://ocaml-ppx.github.io/ppxlib/ppxlib/Ppxlib/Ast_builder/index.html"><code>Ppxlib.Ast_builder</code></a> as a way of propagating a <code>~loc</code> flag everywhere.)</li>

<li>use global mutable state, as in <code>Logs</code>.</li>
</ul>

<p>
I've seen all four of these used sensibly in OCaml programs; the best one will depend on your
particular application requirements / how much you care about tracking which part of the program use
which arguments.
</p>

<p>
Regarding your second point, AFAIK there's no generic library for managing config files in OCaml (i.e.
what <a href="https://github.com/davidtheclark/cosmiconfig">Cosmiconfig</a> provides for NPM). Every OCaml library
that I've seen that uses one tends to roll their own logic for it. You could of course use Yojson or
OCaml-Yaml to read a file in one of those formats, but you'll end up managing the details yourself. The
lightweight approach is to use environment variables, since Cmdliner will handle that boilerplate for
you; managing config files is a pain, particularly w.r.t. things like respecting <code>XDG_CONFIG</code> and it's
analogues on Windows.
</p>
</div>
</div>


<div id="outline-container-org7b634dd" class="outline-3">
<h3 id="org7b634dd">Xavier Leroy also replied</h3>
<div class="outline-text-3" id="text-org7b634dd">
<p>
Re: configuration files, there are a few libraries in OPAM:
</p>
<ul class="org-ul">
<li><a href="http://opam.ocaml.org/packages/config-file/">http://opam.ocaml.org/packages/config-file/</a></li>
<li><a href="http://opam.ocaml.org/packages/ocplib-config/">http://opam.ocaml.org/packages/ocplib-config/</a></li>
<li><a href="http://opam.ocaml.org/packages/ez_config/">http://opam.ocaml.org/packages/ez_config/</a></li>
</ul>
</div>
</div>


<div id="outline-container-orgacc08b1" class="outline-3">
<h3 id="orgacc08b1">Josh Berdine said</h3>
<div class="outline-text-3" id="text-orgacc08b1">
<p>
If you want to use globals with cmdliner, you might find it convenient to use some code such as:
</p>
<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #8b2252;">(** Extension of Cmdliner supporting lighter-weight option definition *)</span>
<span style="color: #000000; font-weight: bold;">module</span> <span style="color: #228b22;">Cmdliner</span> : <span style="color: #000000; font-weight: bold;">sig</span>
  <span style="color: #000000; font-weight: bold;">include</span> <span style="color: #000000; font-weight: bold;">module type of</span> <span style="color: #228b22;">Cmdliner</span>

  <span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">mk</span> : <span style="color: #008b8b;">default</span>:'a -&gt; 'a <span style="color: #228b22;">Term.</span>t -&gt; 'a <span style="color: #483d8b;">ref</span>
  <span style="color: #8b2252;">(** [mk ~default term] is a ref which, after [parse] is called, contains</span>
<span style="color: #8b2252;">      the value of the command line option specified by [term]. *)</span>

  <span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">parse</span> : <span style="color: #228b22;">Term.</span>info -&gt; (unit -&gt; unit <span style="color: #228b22;">Term.</span>ret) -&gt; unit
  <span style="color: #8b2252;">(** [parse info validate] parses the command line according to the options</span>
<span style="color: #8b2252;">      declared by calls to [mk], using manual and version [info], and</span>
<span style="color: #8b2252;">      calling [validate] to check usage constraints not expressible in the</span>
<span style="color: #8b2252;">      [Term] language. *)</span>
<span style="color: #000000; font-weight: bold;">end</span> = <span style="color: #000000; font-weight: bold;">struct</span>
  <span style="color: #000000; font-weight: bold;">include</span> <span style="color: #228b22;">Cmdliner</span>

  <span style="color: #8b2252;">(** existential package of a Term and a setter for a ref to receive the</span>
<span style="color: #8b2252;">      parsed value *)</span>
  <span style="color: #000000; font-weight: bold;">type</span> <span style="color: #228b22;">arg</span> = <span style="color: #000000; background-color: #ffffff;">Arg</span> : 'a <span style="color: #228b22;">Term.</span>t * ('a -&gt; unit) -&gt; arg

  <span style="color: #8b2252;">(** convert a list of arg packages to a term for the tuple of all the arg</span>
<span style="color: #8b2252;">      terms, and apply it to a function that sets all the receiver refs *)</span>
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">tuple</span> <span style="color: #a0522d;">args</span> =
    <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">pair</span> (<span style="color: #000000; background-color: #ffffff;">Arg</span> (<span style="color: #a0522d;">trm_x</span>, <span style="color: #a0522d;">set_x</span>)) (<span style="color: #000000; background-color: #ffffff;">Arg</span> (<span style="color: #a0522d;">trm_y</span>, <span style="color: #a0522d;">set_y</span>)) =
      <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">trm_xy</span> = <span style="color: #228b22;">Term.</span>(const (<span style="color: #a020f0;">fun</span> <span style="color: #a0522d;">a</span> <span style="color: #a0522d;">b</span> -&gt; (a, b)) <span style="color: #a52a2a;">$</span> trm_x <span style="color: #a52a2a;">$</span> trm_y) <span style="color: #000000; font-weight: bold;">in</span>
      <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">set_xy</span> (<span style="color: #a0522d;">a</span>, <span style="color: #a0522d;">b</span>) = set_x a ; set_y b <span style="color: #000000; font-weight: bold;">in</span>
      <span style="color: #000000; background-color: #ffffff;">Arg</span> (trm_xy, set_xy)
    <span style="color: #000000; font-weight: bold;">in</span>
    <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">init</span> = <span style="color: #000000; background-color: #ffffff;">Arg</span> (<span style="color: #228b22;">Term.</span>const (), <span style="color: #a020f0;">fun</span> () -&gt; ()) <span style="color: #000000; font-weight: bold;">in</span>
    <span style="color: #000000; font-weight: bold;">let</span> (<span style="color: #000000; background-color: #ffffff;">Arg</span> (<span style="color: #a0522d;">trm</span>, <span style="color: #a0522d;">set</span>)) = <span style="color: #228b22;">List.</span>fold_right <span style="color: #008b8b;">~f</span>:pair args ~init <span style="color: #000000; font-weight: bold;">in</span>
    <span style="color: #228b22;">Term.</span>app (<span style="color: #228b22;">Term.</span>const set) trm

  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">args</span> :<span style="color: #228b22;"> arg list </span><span style="color: #483d8b;">ref</span><span style="color: #228b22;"> </span>= <span style="color: #483d8b;">ref</span> <span style="color: #000000; background-color: #ffffff;">[]</span>

  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">mk</span> ~<span style="color: #a0522d;">default</span> <span style="color: #a0522d;">arg</span> =
    <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">var</span> = <span style="color: #483d8b;">ref</span> default <span style="color: #000000; font-weight: bold;">in</span>
    <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">set</span> <span style="color: #a0522d;">x</span> = var := x <span style="color: #000000; font-weight: bold;">in</span>
    args := <span style="color: #000000; background-color: #ffffff;">Arg</span> (arg, set) <span style="color: #000000; background-color: #ffffff;">::</span> <span style="color: #a52a2a;">!</span>args ;
    var

  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">parse</span> <span style="color: #a0522d;">info</span> <span style="color: #a0522d;">validate</span> =
    <span style="color: #a020f0;">match</span> <span style="color: #228b22;">Term.</span>eval (<span style="color: #228b22;">Term.</span>(ret (const validate <span style="color: #a52a2a;">$</span> tuple <span style="color: #a52a2a;">!</span>args)), info) <span style="color: #a020f0;">with</span>
    | <span style="color: #000000; background-color: #ffffff;">`Ok</span> () -&gt; ()
    | <span style="color: #000000; background-color: #ffffff;">`Error</span> _ -&gt; <span style="color: #228b22;">Caml.</span><span style="color: #483d8b;">exit</span> 1
    | <span style="color: #000000; background-color: #ffffff;">`Help</span> | <span style="color: #000000; background-color: #ffffff;">`Version</span> -&gt; <span style="color: #228b22;">Caml.</span><span style="color: #483d8b;">exit</span> 0
<span style="color: #000000; font-weight: bold;">end</span>
</pre>
</div>
</div>
</div>
</div>




<div id="outline-container-org33f3ee0" class="outline-2">
<h2 id="5">Multicore OCaml: October 2020</h2>
<div class="outline-text-2" id="text-5">
<p>
Archive: <a href="https://discuss.ocaml.org/t/multicore-ocaml-october-2020/6729/1">https://discuss.ocaml.org/t/multicore-ocaml-october-2020/6729/1</a>
</p>
</div>

<div id="outline-container-org8ab02dd" class="outline-3">
<h3 id="org8ab02dd">Anil Madhavapeddy announced</h3>
<div class="outline-text-3" id="text-org8ab02dd">
<p>
Welcome to the October 2020 multicore OCaml report, compiled by @shakthimaan, @kayceesrk and of course
myself. The <a href="https://discuss.ocaml.org/tag/multicore-monthly">previous monthly</a> updates are also
available for your perusal.
</p>

<p>
<b>OCaml 4.12.0-dev:</b> The upstream OCaml tree has been branched for the 4.12 release, and the <a href="https://github.com/ocaml/opam-repository/issues/17530">OCaml
readiness team</a> is busy stabilising it with the
ecosystem. The 4.12.0 development stream has significant progress towards multicore support, especially
with the runtime handling of naked pointers. The release will ship with a dynamic checker for naked
pointers that you can use to verify that your own codebase is clean of them, as this will be a
prerequisite for OCaml 5.0 and multicore compatibility. This is activated via the
<code>--enable-naked-pointers-checker</code> configure option.
</p>

<p>
<b>Convergence with upstream and multicore trees:</b> The multicore OCaml trees have seen significant
robustness improvements as we've converged our trees with upstream OCaml (possible now that the
upstream architectural changes are synched with the requirements of multicore). In particular, the
handling of global C roots is much better in multicore now as it uses the upstream OCaml scheme, and
the GC colour scheme also exactly matches upstream OCaml's.  This means that community libraries from
<code>opam</code> work increasingly well when built with multicore OCaml (using the <code>no-effects-syntax</code> branch).
</p>

<p>
<b>Features:</b> Multicore OCaml is also using domain local allocation buffers now to simplify its
internals.  We are also now working on benchmarking the IO subsystem, and support for CPU parallelism
for the Lwt concurrency library has been added, as well as refreshing the new Asynchronous Effect-based
IO (<a href="https://github.com/kayceesrk/ocaml-aeio">aeio</a>) with Multicore OCaml, Lwt, and httpaf in an
<a href="https://github.com/sadiqj/http-effects">http-effects</a> library.
</p>

<p>
<b>Benchmarking:</b> The Sandmark benchmarking test suite has additional configuration options, and there
are new proposals in that project to leverage as much of the OCaml tools and ecosystem as much as
possible.
</p>

<p>
As with previous updates, the Multicore OCaml ongoing, and completed tasks are listed first, which are
followed by improvements to the Sandmark benchmarking test suite. Finally, the upstream OCaml related
work is mentioned for your reference.
</p>
</div>

<div id="outline-container-org2f9442c" class="outline-4">
<h4 id="org2f9442c">Multicore OCaml</h4>
<div class="outline-text-4" id="text-org2f9442c">
</div>
<ul class="org-ul">
<li><a id="orgf35ed95"></a>Ongoing<br />
<div class="outline-text-5" id="text-orgf35ed95">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/422">ocaml-multicore/ocaml-multicore#422</a>
Simplify minor heaps configuration logic and masking
</p>

<p>
The PR is a step towards using Domain local allocation buffers. A
<code>Minor_heap_max</code> size is used to reserve the minor heaps area, and
<code>Is_young</code> for relying on a boundary check. The <code>Minor_heap_max</code> can
be overridden using OCAMLRUNPARAM environment variable.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/426">ocaml-multicore/ocaml-multicore#426</a>
Replace global roots implementation
</p>

<p>
An effort to replace the existing global roots implementation to be
in line with OCaml's <code>globroots</code>. The objective is to also have a
per-domain skip list, and a global orphans when a domain is
terminated.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/427">ocaml-multicore/ocaml-multiore#427</a>
Garbage Collector colours change backport
</p>

<p>
The <a href="https://github.com/ocaml/ocaml/pull/9756">Garbage Collector colour scheme
changes</a> in the major
collector have now been backported to Multicore OCaml. The
<code>mark_entry</code> does not include <code>end</code>, <code>mark_stack_push</code> resembles
closer to trunk, and <code>caml_shrink_mark_stack</code> has been adapted from
trunk.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/429">ocaml-multicore/ocaml-multicore#429</a>
Fix a STW interrupt race
</p>

<p>
The STW interrupt race in
<code>caml_try_run_on_all_domains_with_spin_work</code> is fixed in this PR,
where the <code>enter_spin_callback</code> and <code>enter_spin_data</code> fields of
<code>stw_request</code> are initialized after we interrupt other domains.
</p></li>
</ul>
</div>
</li>

<li><a id="org2d343cb"></a>Completed<br />
<ul class="org-ul">
<li><a id="orgc2e7b9a"></a>Systhreads support<br />
<div class="outline-text-6" id="text-orgc2e7b9a">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/381">ocaml-multicore/ocaml-multicore#381</a>
Reimplementing Systhreads with pthreads (Domain execution contexts)
</p>

<p>
The re-implementation of Systhreads with pthreads has been completed
for Multicore OCaml. The Domain Execution Context (DEC) is
introduced which allows multiple threads to run atop a domain.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/410">ocaml-multicore/ocaml-multicore#410</a>
systhreads: <code>caml_c_thread_register</code> and <code>caml_c_thread_unregister</code>
</p>

<p>
The <code>caml_c_thread_register</code> and <code>caml_c_thread_unregister</code>
functions have been reimported to systhreads. In Multicore OCaml,
threads created by C code will be registered to domain 0 threads
chaining.
</p></li>
</ul>
</div>
</li>

<li><a id="org6b67cce"></a>Domain Local Storage<br />
<div class="outline-text-6" id="text-org6b67cce">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/404">ocaml-multicore/ocaml-multicore#404</a>
Domain.DLS.new_key takes an initialiser
</p>

<p>
The <code>Domain.DLS.new_key</code> now accepts an initialiser argument to
assign an associated value to a key, if not initialised
already. Also, <code>Domain.DLS.get</code> no longer returns an option value.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/405">ocaml-multicore/ocaml-multicore#405</a>
Rework Domain.DLS.get search function such that it no longer allocates
</p>

<p>
The <code>Domain.DLS.get</code> has been updated to remove any memory
allocation, if the key already exists in the domain local
storage. The PR also changes the <code>search</code> function to accept all
inputs as variables, instead of a closure from the environment.
</p></li>
</ul>
</div>
</li>

<li><a id="orgdc2223d"></a>Lwt<br />
<div class="outline-text-6" id="text-orgdc2223d">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/multicore-opam/pull/33">ocaml-multicore/multicore-opam#33</a>
Add lwt.5.3.0+multicore
</p>

<p>
The Lwt.5.3.0 concurrency library has been added to support CPU
parallelism with Multicore OCaml. A <a href="https://sudha247.github.io/2020/10/01/lwt-multicore/">blog
post</a>
introducing its installation and usage has been written by Sudha
Parimala.
</p></li>

<li>The <a href="https://github.com/kayceesrk/ocaml-aeio">Asynchronous Effect-based IO</a> builds with a recent
Lwt, and the HTTP effects demo has been updated to work with
Multicore OCaml, Lwt, and httpaf. The demo source code is available
at the <a href="https://github.com/sadiqj/http-effects">http-effects</a> repo.</li>
</ul>
</div>
</li>

<li><a id="org53b8d98"></a>Sundries<br />
<div class="outline-text-6" id="text-org53b8d98">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/406">ocaml-multicore/ocaml-multicore#406</a>
Remove ephemeron usage of RPC
</p>

<p>
The inter-domain mechanism is not required with the stop-the-world
minor GC, and hence the same has been removed in the ephemeron
implementation. The PR also does clean up and simplifies the
ephemeron data structure and code.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/411">ocaml-multicore/ocaml-multicore#411</a>
Fix typo for presume and presume_arg in <code>internal_variable_names</code>
</p>

<p>
A minor typo bug fix to rename <code>Presume</code> and <code>Presume_arg</code> in
<code>internal_variables_names.ml</code>.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/414">ocaml-multicore/ocaml-multicore#414</a>
Fix up <code>Ppoll</code> <code>semantics_of_primitives</code> entry
</p>

<p>
The <code>semantics_of_primitives</code> entry for <code>Ppoll</code> has been fixed which
was causing flambda builds to remove poll points.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/416">ocaml-multicore/ocaml-multicore#416</a>
Fix callback effect bug
</p>

<p>
The PR fixes a bug when the C-to-OCaml callback prevents effects
crossing a C callback boundary. The stack parent is cleared before a
callback, and restored afterwards. It also makes the stack parent a
local root, so that the GC can see it inside the callback.
</p></li>
</ul>
</div>
</li>
</ul>
</li>
</ul>
</div>

<div id="outline-container-org8b2a904" class="outline-4">
<h4 id="org8b2a904">Benchmarking</h4>
<div class="outline-text-4" id="text-org8b2a904">
</div>
<ul class="org-ul">
<li><a id="org962c3ac"></a>Ongoing<br />
<ul class="org-ul">
<li><a id="org092fbaa"></a>Configuration<br />
<div class="outline-text-6" id="text-org092fbaa">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-bench/ocaml_bench_scripts/pull/12">ocaml-bench/ocaml-bench-scripts#12</a>
Add support for parallel multibench targets and JSON input
</p>

<p>
The <code>RUN_CONFIG_JSON</code> and <code>BUILD_BENCH_TARGET</code> variables are now
added and passed during run-time for the execution of parallel
benchmarks. Default values are specified so that the serial
benchmarks can still run without explicitly requiring the same.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/issues/180">ocaml-bench/sandmark#180</a>
Notebook Refactoring and User changes
</p>

<p>
A refactoring effort is underway to make the parallel benchmark
interactive. The user accounts on The Littlest JupyterHub
installation have direct access to the benchmark results produced
from <code>ocaml-bench-scripts</code> on the system.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/189">ocaml-bench/sandmark#189</a>
Add environment support for wrapper in JSON configuration file
</p>

<p>
The OCAMLRUNPARAM is now passed as an environment variable to the
benchmarks during runtime, so that, different parameter values can
be used to obtain multiple results for comparison. The use case and
the discussion are available at <a href="https://github.com/ocaml-bench/sandmark/issues/184">Running benchmarks with varying
OCAMLRUNPARAM</a>
issue. The environment variables can be specified in the
<code>run_config.json</code> file, as shown below:
</p>

<div class="org-src-container">
<pre class="src src-json">{
   "name": "orun_2M",
   "environment": "OCAMLRUNPARAM='s=2M'",
   "command": "orun -o %{output} -- taskset --cpu-list 5 %{command}"
 }
</pre>
</div></li>
</ul>
</div>
</li>

<li><a id="org46f24e9"></a>Proposals<br />
<div class="outline-text-6" id="text-org46f24e9">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-bench/sandmark/issues/159">ocaml-bench/sandmark#159</a>
Implement a better way to describe tasklet cpulist
</p>

<p>
The discussion to implement a better way to obtain the taskset list
of cores for a benchmark run is still in progress. This is required
to be able to specify hyper-threaded cores, NUMA zones, and the
specific cores to use for the parallel benchmarks.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/issues/179">ocaml-bench/sandmark#179</a>
[RFC] Classifying benchmarks based on running time
</p>

<p>
A proposal to categorize the benchmarks based on their running time
has been provided. The following classification types have been
suggested:
</p>
<ul class="org-ul">
<li><code>lt_1s</code>: Benchmarks that run for less than 1 second.</li>
<li><code>lt_10s</code>: Benchmarks that run for at least 1 second, but, less than 10 seconds.</li>
<li><code>10s_100s</code>: Benchmarks that run for at least 10 seconds, but, less than 100 seconds.</li>
<li><code>gt_100s</code>: Benchmarks that run for at least 100 seconds.</li>
</ul>

<p>
The PR for the same is available at <a href="https://github.com/ocaml-bench/sandmark/pull/188">Classification of
benchmarks</a>.
</p></li>

<li>We are exploring the use of <code>opam-compiler</code> switch environment to
build the Sandmark benchmark test suite. The merge of <a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/407">systhreads
compatibility
support</a>
now enables us to install dune natively inside the switch
environment, along with the other benchmarks. With this approach, we
hope to modularize our benchmarking test suite, and converge to
fully using the OCaml tools and ecosystem.</li>
</ul>
</div>
</li>

<li><a id="orga05098e"></a>Sundries<br />
<div class="outline-text-6" id="text-orga05098e">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/181">ocaml-bench/sandmark#181</a>
Lock-free map bench
</p>

<p>
An implementation of a concurrent hash-array mapped trie that is
lock-free, and is based on Prokopec, A. et. al. (2011). This
cache-aware implementation benchmark is currently under review.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/183">ocaml-bench/sandmark#183</a>
Use crout_decomposition name for numerical analysis benchmark
</p>

<p>
A couple of LU decomposition benchmarks exist in the Sandmark
repository, and this PR renames the
<code>numerical-analysis/lu_decomposition.ml</code> benchmark to
<code>crout_decomposition.ml</code>. This is to address <a href="https://github.com/ocaml-bench/sandmark/issues/182">Rename
lu_decomposition benchmark in
numerical-analysis</a>
any naming confusion between the two benchmarks, as their
implementations are different.
</p></li>
</ul>
</div>
</li>
</ul>
</li>

<li><a id="orga1fc71b"></a>Completed<br />
<div class="outline-text-5" id="text-orga1fc71b">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/177">ocaml-bench/sandmark#177</a>
Display raw baseline numbers in normalized graphs
</p>

<p>
The raw baseline numbers are now included in the normalized graphs
in the sequential notebook output. The graph for <code>maxrsskb</code>, for
example, is shown below:
</p>


<div class="figure">
<p><img src="https://aws1.discourse-cdn.com/standard11/uploads/ocaml/optimized/2X/0/08df45ac1d5de2415b7735cf7b2006fb21a1365a_2_1380x516.png" alt="08df45ac1d5de2415b7735cf7b2006fb21a1365a_2_1380x516.png" />
</p>
</div></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/178">ocaml-bench/sandmark#178</a>
Change to new Domain.DLS API with Initializer
</p>

<p>
The <code>multicore-minilight</code> and <code>multicore-numerical</code> benchmarks have
now been updated to use the new Domain.DLS API with initializer.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/185">ocaml-bench/sandmark#185</a>
Clean up existing effect benchmarks
</p>

<p>
The PR ensures that the code compiles without any warnings, and adds
a <code>multicore_effects_run_config.json</code> configuration file, and a
<code>run_all_effect.sh</code> script to execute the same.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/186">ocaml-bench/sandmark#186</a>
Very simple effect microbenchmarks to cover code paths
</p>

<p>
A set of four microbenchmarks to test the throughput of our effects
system have now been added to the Sandmark test suite. These include
<code>effect_throughput_clone</code>, <code>effect_throughput_val</code>,
<code>effect_throughput_perform</code>, and <code>effect_throughput_perform_drop</code>.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/187">ocaml-bench/sandmark#187</a>
Implementation of 'recursion' benchmarks for effects
</p>

<p>
A collection of recursion benchmarks to measure the overhead of
effects are now included to Sandmark. This is inspired by the
(Manticore
benchmarks)[<a href="https://github.com/ManticoreProject/benchmark/">https://github.com/ManticoreProject/benchmark/</a>].
</p></li>
</ul>
</div>
</li>
</ul>
</div>

<div id="outline-container-orge898b35" class="outline-4">
<h4 id="orge898b35">OCaml</h4>
<div class="outline-text-4" id="text-orge898b35">
</div>
<ul class="org-ul">
<li><a id="org4f07e4f"></a>Ongoing<br />
<div class="outline-text-5" id="text-org4f07e4f">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml/ocaml/pull/9876">ocaml/ocaml#9876</a>
Do not cache young_limit in a processor register
</p>

<p>
The PR removes the caching of <code>young_limit</code> in a register for ARM64,
PowerPC and RISC-V ports. The Sandmark benchmarks are presently
being tested on the respective hardware.
</p></li>

<li><p>
<a href="https://github.com/ocaml/ocaml/pull/9934">ocaml/ocaml#9934</a>
Prefetching optimisations for sweeping
</p>

<p>
The Sandmark benchmarking tests were performed for analysing a
couple of patches that optimise <code>sweep_slice</code>, and for the use of
prefetching. The objective is to reduce cache misses during GC.
</p></li>
</ul>
</div>
</li>

<li><a id="org722f41e"></a>Completed<br />
<div class="outline-text-5" id="text-org722f41e">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml/ocaml/pull/9947">ocaml/ocaml#9947</a>
Add a naked pointers dynamic checker
</p>

<p>
The check for "naked pointers" (dangerous out-of-heap pointers) is
now done in run-time, and tests for the three modes: naked pointers,
naked pointers and dynamic checker, and no naked pointers have been
added in the PR.
</p></li>

<li><p>
<a href="https://github.com/ocaml/ocaml/pull/9951/">ocaml/ocaml#9951</a>
Ensure that the mark stack push optimisation handles naked pointers
</p>

<p>
The PR adds a precise check on whether to push an object into the
mark stack, to handle naked pointers.
</p></li>
</ul>

<p>
We would like to thank all the OCaml users and developers in the community for their continued support,
reviews and contribution to the project.
</p>
</div>
</li>
</ul>
</div>

<div id="outline-container-org7824746" class="outline-4">
<h4 id="org7824746">Acronyms</h4>
<div class="outline-text-4" id="text-org7824746">
<ul class="org-ul">
<li>AEIO: Asynchronous Effect-based IO</li>
<li>API: Application Programming Interface</li>
<li>ARM: Advanced RISC Machine</li>
<li>CPU: Central Processing Unit</li>
<li>DEC: Domain Execution Context</li>
<li>DLS: Domain Local Storage</li>
<li>GC: Garbage Collector</li>
<li>HTTP: Hypertext Transfer Protocol</li>
<li>JSON: JavaScript Object Notation</li>
<li>NUMA: Non-Uniform Memory Access</li>
<li>OPAM: OCaml Package Manager</li>
<li>OS: Operating System</li>
<li>PR: Pull Request</li>
<li>RISC-V: Reduced Instruction Set Computing - V</li>
<li>RPC: Remote Procedure Call</li>
<li>STW: Stop-The-World</li>
</ul>
</div>
</div>
</div>
</div>




<div id="outline-container-org9e54566" class="outline-2">
<h2 id="6">Other OCaml News</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-orgee6ab30" class="outline-3">
<h3 id="orgee6ab30">From the ocamlcore planet blog</h3>
<div class="outline-text-3" id="text-orgee6ab30">
<p>
Here are links from many OCaml blogs aggregated at <a href="http://ocaml.org/community/planet/">OCaml Planet</a>.
</p>

<ul class="org-ul">
<li><a href="https://mirage.io/blog/announcing-mirage-39-release">Announcing MirageOS 3.9.0</a></li>
<li><a href="https://seb.mondet.org/b/0007-ocaml-2020-making-of.html">SmartPy@OCaml2020: The Making Of</a></li>
<li><a href="https://erratique.ch/software/qrc">Qrc</a></li>
<li><a href="https://erratique.ch/software/brr">Brr</a></li>
<li><a href="https://examachine.net/blog/a-short-review-of-4th-generation-cryptocurrencies/">A Short Review of 4th Generation Cryptocurrencies</a></li>
<li><a href="https://blog.janestreet.com/finding-memory-leaks-with-memtrace/">Finding memory leaks with Memtrace</a></li>
<li><a href="https://www.ocamlpro.com/2020/09/30/rehabilitating-packs-using-functors-and-recursivity-part-2/">Rehabilitating packs using functors and recursivity, part 2.</a></li>
<li><a href="https://rescript-lang.org/blog/release-8-3-pt2">What's new in ReScript 8.3 (Part 2)</a></li>
<li><a href="https://www.ocamlpro.com/2020/09/24/rehabilitating-packs-using-functors-and-recursivity-part-1/">Rehabilitating Packs using Functors and Recursivity, part 1.</a></li>
<li><a href="https://tarides.com/blog/2020-09-24-building-portable-user-interfaces-with-nottui-and-lwd">Building portable user interfaces with Nottui and Lwd</a></li>
<li><a href="https://tarides.com/blog/2020-09-17-tarides-is-now-a-sponsor-of-the-ocaml-software-foundation">Tarides is now a sponsor of the OCaml Software Foundation</a></li>
<li><a href="https://blog.janestreet.com/memory-allocator-showdown/">Memory allocator showdown</a></li>
<li><a href="http://math.andrej.com/2020/09/14/a-general-definition-of-dependent-type-theories/">A general definition of dependent type theories</a></li>
<li><a href="http://math.andrej.com/2020/09/10/cubical-agda/">Every proof assistant: Cubical Agda – A Dependently Typed Programming Language with Univalence and Higher Inductive Types</a></li>
<li><a href="https://tarides.com/blog/2020-09-08-irmin-september-2020-update">Irmin: September 2020 update</a></li>
<li><a href="https://tarides.com/blog/2020-09-01-introducing-irmin-pack">Introducing irmin-pack</a></li>
</ul>
</div>
</div>
</div>




<div id="outline-container-org18fc434" class="outline-2">
<h2 id="org18fc434">Old CWN</h2>
<div class="outline-text-2" id="text-org18fc434">
<p>
If you happen to miss a CWN, you can <a href="mailto:alan.schmitt@polytechnique.org">send me a message</a> and I'll mail it to you, or go take a look at <a href="http://alan.petitepomme.net/cwn/">the archive</a> or the <a href="http://alan.petitepomme.net/cwn/cwn.rss">RSS feed of the archives</a>.
</p>

<p>
If you also wish to receive it every week by mail, you may subscribe <a href="http://lists.idyll.org/listinfo/caml-news-weekly/">online</a>.
</p>

<div class="authorname">
<p>
<a href="http://alan.petitepomme.net/">Alan Schmitt</a>
</p>

</div>
</div>
</div>
</div>
</body>
</html>
