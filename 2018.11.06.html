<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2018-11-06 Tue 11:43 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OCaml Weekly News</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<style type="text/css">#table-of-contents h2 { display: none } .title { display: none } .authorname { text-align: right }</style>
<style type="text/css">.outline-2 {border-top: 1px solid black;}</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">OCaml Weekly News</h1>
<p>
<a href="http://alan.petitepomme.net/cwn/2018.10.23.html">Previous Week</a> <a href="http://alan.petitepomme.net/cwn/index.html">Up</a> <a href="http://alan.petitepomme.net/cwn/2018.11.13.html">Next Week</a>
</p>

<p>
Hello
</p>

<p>
Here is the latest OCaml Weekly News, for the week of October 23 to November 06, 2018.
</p>

<p>
Sorry for the hiatus, I was offline last week.
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#1">(Non-protocol-specific) binary serialization library?</a></li>
<li><a href="#2">opam 2.0.1</a></li>
<li><a href="#3">Documentation about the ocaml compiler?</a></li>
<li><a href="#4">Packaging process</a></li>
<li><a href="#5">OCaml and LZMA - decompression based on xz-utils and 7zip</a></li>
<li><a href="#6">New release of odepack</a></li>
<li><a href="#7">NYC OCaml Meetup</a></li>
<li><a href="#8">Don't panic that your opam switches recompile from today!</a></li>
<li><a href="#9">Annoucement of an OCaml book in Chinese</a></li>
<li><a href="#10">Destructive module substitution: changed in 4.07</a></li>
<li><a href="#11">First release of bwrap</a></li>
<li><a href="#12">Ocaml Github Pull Requests</a></li>
<li><a href="#13">Other OCaml News</a></li>
<li><a href="#org22296d6">Old CWN</a></li>
</ul>
</div>
</div>


<div id="outline-container-org712913f" class="outline-2">
<h2 id="1"><a id="org712913f"></a>(Non-protocol-specific) binary serialization library?</h2>
<div class="outline-text-2" id="text-1">
<p>
Archive: <a href="https://discuss.ocaml.org/t/non-protocol-specific-binary-serialization-library/2768/1">https://discuss.ocaml.org/t/non-protocol-specific-binary-serialization-library/2768/1</a>
</p>
</div>

<div id="outline-container-org6e4f9b8" class="outline-3">
<h3 id="org6e4f9b8">Brendan Long asked</h3>
<div class="outline-text-3" id="text-org6e4f9b8">
<p>
I've been working on several libraries that need to send and receive packets in specific binary formats (<a href="https://github.com/arenadotio/pgx">PGX</a>, <a href="https://github.com/brendanlong/ocaml-tds">TDS</a>). Right now they both have extremely-low-level code to convert ints to bytes with the right endianness, but it seems excessively low level to put in every library I write that deals with a binary protocol.
</p>

<p>
I know there are a bunch of libraries for parsing text, or for working with defined protocols like msgpack, but is there anything for arbitrary binary encoding? I'm thinking something like <a href="https://docs.python.org/3/library/struct.html">struct</a> in Python, although I'm not married to that particular implementation.
</p>

<p>
(As a side note: Another reason I'd like something like this is that all of my current implementations handle one byte at a time, and it would be nice if we could do this more efficiently).
</p>
</div>
</div>


<div id="outline-container-org460848f" class="outline-3">
<h3 id="org460848f">Brendan Long then added</h3>
<div class="outline-text-3" id="text-org460848f">
<p>
My current implementation of this in TDS involves adding a <code>fold_bytes</code> function to every type, like:
</p>

<p>
<a href="https://github.com/brendanlong/ocaml-tds/blob/master/src/uint32.ml">https://github.com/brendanlong/ocaml-tds/blob/master/src/uint32.ml</a>
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">fold_bytes</span><span style="color: #a0522d;"> </span><span style="color: #a52a2a;">~</span><span style="color: #a0522d;">init </span><span style="color: #a52a2a;">~</span><span style="color: #a0522d;">f t order</span> <span style="color: #a52a2a;">=</span>
  order
  <span style="color: #a52a2a;">|&gt;</span> <span style="color: #228b22;">List.</span>fold_left <span style="color: #a52a2a;">~</span>init <span style="color: #008b8b;">~f</span><span style="color: #a52a2a;">:(</span><span style="color: #a020f0;">fun</span> <span style="color: #a0522d;">acc shift_bytes</span> <span style="color: #a52a2a;">-&gt;</span>
    shift_right t <span style="color: #a52a2a;">(</span>shift_bytes <span style="color: #a52a2a;">*</span> 8<span style="color: #a52a2a;">)</span>
    <span style="color: #a52a2a;">|&gt;</span> <span style="color: #228b22;">Uint8.</span>of_uint32
    <span style="color: #a52a2a;">|&gt;</span> <span style="color: #228b22;">Uint8.</span>fold_bytes <span style="color: #a52a2a;">~</span>f <span style="color: #008b8b;">~init</span><span style="color: #a52a2a;">:</span>acc<span style="color: #a52a2a;">)</span>

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">fold_bytes_be</span><span style="color: #a0522d;"> </span><span style="color: #a52a2a;">~</span><span style="color: #a0522d;">init </span><span style="color: #a52a2a;">~</span><span style="color: #a0522d;">f t</span> <span style="color: #a52a2a;">=</span>
  <span style="color: #a52a2a;">[</span> 3 <span style="color: #a52a2a;">;</span> 2 <span style="color: #a52a2a;">;</span> 1 <span style="color: #a52a2a;">;</span> 0 <span style="color: #a52a2a;">]</span>
  <span style="color: #a52a2a;">|&gt;</span> fold_bytes <span style="color: #a52a2a;">~</span>init <span style="color: #a52a2a;">~</span>f t

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">fold_bytes_le</span><span style="color: #a0522d;"> </span><span style="color: #a52a2a;">~</span><span style="color: #a0522d;">init </span><span style="color: #a52a2a;">~</span><span style="color: #a0522d;">f t</span> <span style="color: #a52a2a;">=</span>
  <span style="color: #a52a2a;">[</span> 0 <span style="color: #a52a2a;">;</span> 1 <span style="color: #a52a2a;">;</span> 2 <span style="color: #a52a2a;">;</span> 3 <span style="color: #a52a2a;">]</span>
  <span style="color: #a52a2a;">|&gt;</span> fold_bytes <span style="color: #a52a2a;">~</span>init <span style="color: #a52a2a;">~</span>f t
</pre>
</div>

<p>
Although this makes things readable at the expense of most-likely being even slower than the usual implementations. Having something somwhat readable and also not horribly slow would be nice.
</p>
</div>
</div>


<div id="outline-container-orgd945f7f" class="outline-3">
<h3 id="orgd945f7f">Matthieu Dubuget suggested</h3>
<div class="outline-text-3" id="text-orgd945f7f">
<p>
I used to use bitstring for such things. But it's a long time since i last had a look at it. I found it easy to use.
</p>
</div>
</div>


<div id="outline-container-org70a7fe5" class="outline-3">
<h3 id="org70a7fe5">Brendan Long then replied</h3>
<div class="outline-text-3" id="text-org70a7fe5">
<p>
Ooo nice. That looks like exactly what I was looking for:
</p>

<p>
<a href="https://bitstring.software/examples/">https://bitstring.software/examples/</a>
</p>
</div>
</div>


<div id="outline-container-orgd415e34" class="outline-3">
<h3 id="orgd415e34">Hezekiah Carty also suggested</h3>
<div class="outline-text-3" id="text-orgd415e34">
<p>
You can also check out <a href="https://github.com/inhabitedtype/angstrom">angstrom</a> which provides a nice parsing API  and <a href="https://github.com/mirage/ocaml-cstruct">cstruct</a> which includes a ppx somewhat similar to bitstring.
</p>
</div>
</div>


<div id="outline-container-orgfe24b03" class="outline-3">
<h3 id="orgfe24b03">James Woodyatt added</h3>
<div class="outline-text-3" id="text-orgfe24b03">
<p>
The usual companion to the <a href="https://opam.ocaml.org/packages/angstrom/">angstrom</a> parser combinator library is <a href="https://opam.ocaml.org/packages/faraday/">faraday</a> binary serialization library. These libraries are both fairly mature and they can work in combination or separately. Alas, we don't have anything quite as comprehensive as <a href="https://serde.rs">serde</a> in the Rust language world.
</p>
</div>
</div>
</div>




<div id="outline-container-org25cb117" class="outline-2">
<h2 id="2"><a id="org25cb117"></a>opam 2.0.1</h2>
<div class="outline-text-2" id="text-2">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-opam-2-0-1/2775/1">https://discuss.ocaml.org/t/ann-opam-2-0-1/2775/1</a>
</p>
</div>

<div id="outline-container-org194bdd1" class="outline-3">
<h3 id="org194bdd1">R. Boujbel announced</h3>
<div class="outline-text-3" id="text-org194bdd1">
<p>
We are pleased to announce the release of <a href="https://github.com/ocaml/opam/releases/tag/2.0.1">opam 2.0.1</a>.
</p>

<p>
This new version contains mainly backported fixes, some platform-specific and some opam specific. You can find more information in this <a href="https://opam.ocaml.org/blog/opam-2-0-1">blog post</a>.
</p>

<p>
opam is a source-based package manager for OCaml. It supports multiple simultaneous compiler installations, flexible package constraints, and a Git-friendly development workflow.
</p>
</div>
</div>


<div id="outline-container-org7206a54" class="outline-3">
<h3 id="org7206a54">Marek Kubica then said</h3>
<div class="outline-text-3" id="text-org7206a54">
<p>
FYI: <code>brew</code> users just have to <a href="https://github.com/Homebrew/homebrew-core/pull/33355">run upgrade</a>, it was added a few hours ago.
</p>
</div>
</div>


<div id="outline-container-orgbb82bf2" class="outline-3">
<h3 id="orgbb82bf2">Perry E. Metzger said</h3>
<div class="outline-text-3" id="text-orgbb82bf2">
<p>
Sadly, I haven't updated MacPorts yet because I'm getting a bizarre error with the result&#x2026;
</p>

<pre class="example">
$ opam --version
2.0.1
$ opam upgrade
opam(44003,0x112e675c0) malloc: can't allocate region
*** mach_vm_map(size=259407338536550400) failed (error code=3)
opam(44003,0x112e675c0) malloc: *** set a breakpoint in malloc_error_break to debug
Fatal error: out of memory.
</pre>

<p>
Help fixing this is actively solicited. I've never seen anything like it.
</p>
</div>
</div>


<div id="outline-container-org2cc5b78" class="outline-3">
<h3 id="org2cc5b78">Perry E. Metzger later added</h3>
<div class="outline-text-3" id="text-org2cc5b78">
<p>
The problem proves to be hard to reproduce, so for now, MacPorts has also been updated to supply opam 2.0.1; updating as usual will get you the new version.
</p>

<p>
If anyone else manages to reproduce the failure above, please get in touch!
</p>
</div>
</div>
</div>




<div id="outline-container-org4730763" class="outline-2">
<h2 id="3"><a id="org4730763"></a>Documentation about the ocaml compiler?</h2>
<div class="outline-text-2" id="text-3">
<p>
Archive: <a href="https://discuss.ocaml.org/t/documentation-about-the-ocaml-compiler/2777/1">https://discuss.ocaml.org/t/documentation-about-the-ocaml-compiler/2777/1</a>
</p>
</div>

<div id="outline-container-org213866b" class="outline-3">
<h3 id="org213866b">Sean Talts asked</h3>
<div class="outline-text-3" id="text-org213866b">
<p>
I'm looking to get to know the ocaml compiler a bit better and I was wondering if there's any documentation about it at a high level? I'm imagining something like <a href="https://rust-lang-nursery.github.io/rustc-guide/">Rust's guide to rustc</a>.
</p>
</div>
</div>


<div id="outline-container-org022f2c7" class="outline-3">
<h3 id="org022f2c7">Gabriel Radanne replied</h3>
<div class="outline-text-3" id="text-org022f2c7">
<p>
<a href="https://github.com/ocaml/ocaml/blob/trunk/HACKING.adoc">https://github.com/ocaml/ocaml/blob/trunk/HACKING.adoc</a>
</p>
</div>
</div>


<div id="outline-container-orgaec6911" class="outline-3">
<h3 id="orgaec6911">Yotam Barnoy also replied</h3>
<div class="outline-text-3" id="text-orgaec6911">
<p>
<a href="https://ocamlverse.github.io/">ocamlverse</a> also has a page on the <a href="https://ocamlverse.github.io/content/compiler.html">compiler</a>, though it's mostly incomplete.
</p>
</div>
</div>
</div>




<div id="outline-container-org89790cc" class="outline-2">
<h2 id="4"><a id="org89790cc"></a>Packaging process</h2>
<div class="outline-text-2" id="text-4">
<p>
Archive: <a href="https://discuss.ocaml.org/t/packaging-process/2782/1">https://discuss.ocaml.org/t/packaging-process/2782/1</a>
</p>
</div>

<div id="outline-container-org5a25900" class="outline-3">
<h3 id="org5a25900">David Chemouil asked</h3>
<div class="outline-text-3" id="text-org5a25900">
<p>
Although the state of build and release tools has contiuously improved over the years (and I deeply thank all people involved in this transition), in particular regarding the simplification of steps to perform, I still find myself having trouble releasing software in Opam. So I'd like to ask here what is the current suggested process for "basic" projects relying on Dune (like <a href="https://github.com/grayswandyr/electrod/">my own pet project</a>). I was even thinking a post that would permanently be updated would be cool. I know <a href="https://discuss.ocaml.org/t/experience-report-switching-to-jbuilder-and-topkg/993?u=grayswandyr">this post</a> by @mmottl but now we have dune-release (BTW can it work across a proxy?) so I'd love to see an update, gather hints&#x2026;
</p>
</div>
</div>


<div id="outline-container-orgf6bce54" class="outline-3">
<h3 id="orgf6bce54">Markus Mottl replied</h3>
<div class="outline-text-3" id="text-orgf6bce54">
<p>
Incidentally, I finished rewriting my packages using <code>dune</code>, <code>dune-release</code>, and OPAM 2.0 just yesterday.  <code>dune-release</code> behaves pretty much exactly like <code>topkg</code> on the command line.  You can thus follow the usual process as outlined in my mentioned post and replace every occurence of <code>topkg</code> with <code>dune-release</code>.  I did not need the <code>CONDUIT_TLS=native</code> environment setting anymore.
</p>

<p>
The only problem right now is that documentation generation does not work due to an apparent bug in <code>dune-release</code>, which will hopefully be fixed soon.  This means that for the while being you can't just execute <code>dune-release bistro</code>.  You should instead follow the individual steps as outlined in the previous post and skip the <code>dune-release publish doc</code> step.
</p>

<p>
Another small difference is that <code>dune-release</code> is more picky about your OPAM files and may fail during lint steps.  The best way to fix this is by addressing any problems raised by <code>dune-release lint</code>.  It seems like a small bug, but this linting process does not currently account for <code>*.descr</code> files.  Though this may likely be fixed soon, just remove the file and put its contents into the <code>synopsis</code> and <code>description</code> fields in the OPAM file instead.  I actually prefer having one less file in the source tree anyway.  Note that the current OPAM repository does not have any <code>descr</code> files anymore.  I'm not sure whether they are discouraged now, but OPAM, too, obviously prefers the package documentation inside the specification file.
</p>

<p>
OPAM 2.0 also introduced some specification changes, e.g. when it comes to external dependencies.  You may need to update your package specifications if this affects you.  Other than that the package release process should work fine.
</p>

<p>
I'd suggest you just grab one of my recently updated and merged packages to have a template to follow.  E.g. <a href="https://github.com/mmottl/lacaml">Lacaml</a> is one of the more complex ones that have been through the process.  If you need an example for how to specify external library dependencies with OPAM 2.0, you may also take a look at the still unmerged <a href="https://github.com/mmottl/postgresql-ocaml">Postgresql</a>.
</p>

<p>
The above small bugs and kinks will probably be solved soon.  Specifying, building, and releasing new OCaml software is certainly substantially easier, safer, and more efficient now than ever before.  I doubt you can squeeze out much more goodness at this point for the vast majority of use cases.  The combination of <code>dune</code>, <code>dune-release</code>, and OPAM is at least on par if not superior to anything other languages can offer.
</p>
</div>
</div>


<div id="outline-container-org04b71bf" class="outline-3">
<h3 id="org04b71bf">Markus Mottl later added</h3>
<div class="outline-text-3" id="text-org04b71bf">
<p>
I've just been contacted by the Thomas Gazagnaire (the <code>dune-release</code> maintainer) to discuss the recent problems.  Strangely, when trying to replicate the problems to provide more details, it turned out that both the <code>*.descr</code> linting issue as well as the documentation publication issue have disappeared.  Since even older <code>dune-release</code> versions don't exhibit the issues anymore, I suspect that either used libraries or tools may have been responsible.
</p>

<p>
Anyway, the gist is that you can apparently follow the simpler release process outlined in <a href="https://discuss.ocaml.org/t/experience-report-switching-to-jbuilder-and-topkg/993">https://discuss.ocaml.org/t/experience-report-switching-to-jbuilder-and-topkg/993</a>, replacing <code>topkg</code> with <code>dune-release</code>.  Just keep the above hints in mind in case the mentioned problems still bubble up with your installation.
</p>
</div>
</div>


<div id="outline-container-orgafa34ea" class="outline-3">
<h3 id="orgafa34ea">Thomas Gazagnaire said</h3>
<div class="outline-text-3" id="text-orgafa34ea">
<p>
Also, the expected workflow is supposed to be:
</p>

<ol class="org-ol">
<li>add a tag in your Git repo. This should be done via <code>dune-release tag [tag-name]</code> and/or manually. If you don't supply a tag name, it will look into your change file to guess something.</li>

<li>run <code>dune-release</code>. This is very similar to <code>topkg bistro</code> but it should handle properly repositories with multiple packages.</li>
</ol>

<p>
There are still a few fragile things in the release process, and I would be very happy to review patches and contributions :-)  For instance, we start to have a few unit/regressions tests, but we definitely need more.
</p>
</div>
</div>
</div>




<div id="outline-container-org92e7c81" class="outline-2">
<h2 id="5"><a id="org92e7c81"></a>OCaml and LZMA - decompression based on xz-utils and 7zip</h2>
<div class="outline-text-2" id="text-5">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ocaml-and-lzma-decompression-based-on-xz-utils-and-7zip/2802/1">https://discuss.ocaml.org/t/ocaml-and-lzma-decompression-based-on-xz-utils-and-7zip/2802/1</a>
</p>
</div>

<div id="outline-container-org5a343f4" class="outline-3">
<h3 id="org5a343f4">Anton Kochkov announced</h3>
<div class="outline-text-3" id="text-org5a343f4">
<p>
Recently I needed to process a bunch of data that can be valid LZMA stream, can be invalid (e.g. damaged) LZMA stream, or just can look like it. I searched pure OCaml implementations and found none. Then I found <a href="https://forge.ocamlcore.org/projects/ocaml-lzma/">the old library</a>, but after a while decided to implement my own bindings. At first I tried to use liblzma from xz-utils, and created <a href="https://github.com/XVilka/ocaml-lzma/">Ctypes-based bindings</a>. But after working with them I found out that xz-utils implementation is not thread-safe, thus causing a heap corruption/segfaults when ran in many threads. So I switched to 7zip implementation of LZMA algorithm, and implemented bindings around them <a href="https://github.com/XVilka/ocaml-lzma_7z">ocaml-lzma_7z</a>.
</p>

<p>
Feel free to reuse the code any way you like, or complain in issues (or even send pull requests).
</p>
</div>
</div>
</div>




<div id="outline-container-org0ce8f02" class="outline-2">
<h2 id="6"><a id="org0ce8f02"></a>New release of odepack</h2>
<div class="outline-text-2" id="text-6">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-new-release-of-odepack/2799/1">https://discuss.ocaml.org/t/ann-new-release-of-odepack/2799/1</a>
</p>
</div>

<div id="outline-container-org03a357a" class="outline-3">
<h3 id="org03a357a">Christophe announced</h3>
<div class="outline-text-3" id="text-org03a357a">
<p>
I am happy to announce the release of version 0.6.9 of <a href="https://github.com/Chris00/ocaml-odepack">odepack</a>.  <code>Odepack</code> is a library to solve Cauchy problems, that is ordinary differential equations (ODE) of the form ∂ₜy(t) = f(t,y(t)) with initial conditions y(t₀) = y₀.  It has root searching capabilities for quantities depending on the solution t ↦ y(t).  The OCaml version is a binding to the <a href="http://netlib.sandia.gov/odepack/">FORTRAN code</a>.
</p>
</div>
</div>
</div>




<div id="outline-container-org8ff38fe" class="outline-2">
<h2 id="7"><a id="org8ff38fe"></a>NYC OCaml Meetup</h2>
<div class="outline-text-2" id="text-7">
<p>
Archive: <a href="https://discuss.ocaml.org/t/nyc-ocaml-meetup/2743/3">https://discuss.ocaml.org/t/nyc-ocaml-meetup/2743/3</a>
</p>
</div>

<div id="outline-container-org8115fbe" class="outline-3">
<h3 id="org8115fbe">Continuing this thread, Brendan Long announced</h3>
<div class="outline-text-3" id="text-org8115fbe">
<p>
Here's the video:
</p>

<p>
<a href="https://www.youtube.com/watch?v=pItUfo6Xjj0">https://www.youtube.com/watch?v=pItUfo6Xjj0</a>
</p>

<p>
And the slides (note: I stopped at the Questions slide):
</p>

<p>
<a href="https://drive.google.com/file/d/1ZKtkVUEaVTB857MniEPnaNgGgz9xf0iV/view?usp=sharing">https://drive.google.com/file/d/1ZKtkVUEaVTB857MniEPnaNgGgz9xf0iV/view?usp=sharing</a>
</p>
</div>
</div>
</div>




<div id="outline-container-orgaba8eb7" class="outline-2">
<h2 id="8"><a id="orgaba8eb7"></a>Don't panic that your opam switches recompile from today!</h2>
<div class="outline-text-2" id="text-8">
<p>
Archive: <a href="https://discuss.ocaml.org/t/dont-panic-that-your-opam-switches-recompile-from-today/2816/1">https://discuss.ocaml.org/t/dont-panic-that-your-opam-switches-recompile-from-today/2816/1</a>
</p>
</div>

<div id="outline-container-orgad55ac5" class="outline-3">
<h3 id="orgad55ac5">David Allsopp announced</h3>
<div class="outline-text-3" id="text-orgad55ac5">
<p>
The <code>ocaml</code> package has been updated in opam-repository in <a href="https://github.com/ocaml/opam-repository/pull/12832">PR12832</a>. Since all other packages depend on it, when you next run <code>opam update</code>, opam is going to want to rebuild all the packages in your switches. <span class="underline">The compiler itself will not be rebuilt as part of this, "just" packages.</span>
</p>

<p>
The <code>ocaml</code> package is a virtual package which probes the configuration of the underlying OCaml compiler (either a system compiler, an opam-compiled OCaml, or an opam-compiled patched compiler).
</p>

<p>
The reason for the change is to fix the creation of switches for compilers which don't support shared libraries. The problem was that a script in the <code>ocaml</code> package depended on the <code>Unix</code> library to probe the output of <code>ocamlc -where</code>.
</p>

<p>
Sorry for the CPU-hogging inconvenience this will cause - it's a package we aim to leave alone most of the time!
</p>
</div>
</div>
</div>




<div id="outline-container-orgc53119f" class="outline-2">
<h2 id="9"><a id="orgc53119f"></a>Annoucement of an OCaml book in Chinese</h2>
<div class="outline-text-2" id="text-9">
<p>
Archive: <a href="https://sympa.inria.fr/sympa/arc/caml-list/2018-11/msg00002.html">https://sympa.inria.fr/sympa/arc/caml-list/2018-11/msg00002.html</a>
</p>
</div>

<div id="outline-container-orga312873" class="outline-3">
<h3 id="orga312873">陈钢 announced</h3>
<div class="outline-text-3" id="text-orga312873">
<p>
I am happy to announce my book, "An Introduction to OCaml Language Programming" in Chinese "OCaml语言编程基础教程", published in June 1st, 2018. The amazon website for the book is
<a href="https://www.amazon.cn/dp/B07CXBXR67/ref=sr_1_1?ie=UTF8&amp;qid=1541156503&amp;sr=8-1&amp;keywords=ocaml">https://www.amazon.cn/dp/B07CXBXR67/ref=sr_1_1?ie=UTF8&amp;qid=1541156503&amp;sr=8-1&amp;keywords=ocaml</a>
</p>

<p>
ISBN: 9787115471215
The publisher:  人民邮电出版社 (Posts &amp; Telecom Press)
</p>

<p>
I would like to take this chance to given my sincere thanks to my OCaml language teachers : Guy Cousineau &amp; Micheal Mauny.
</p>
</div>
</div>
</div>




<div id="outline-container-org662be6c" class="outline-2">
<h2 id="10"><a id="org662be6c"></a>Destructive module substitution: changed in 4.07</h2>
<div class="outline-text-2" id="text-10">
<p>
Archive: <a href="https://discuss.ocaml.org/t/destructive-module-substitution-changed-in-4-07/2824/1">https://discuss.ocaml.org/t/destructive-module-substitution-changed-in-4-07/2824/1</a>
</p>
</div>

<div id="outline-container-org7f60a24" class="outline-3">
<h3 id="org7f60a24">Vincent Jacques asked</h3>
<div class="outline-text-3" id="text-org7f60a24">
<p>
The following code fragment compiles with OCaml 4.02.3 to 4.06.0 but not with 4.07:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">module</span> <span style="color: #228b22;">Original</span> <span style="color: #a52a2a;">=</span> <span style="color: #000000; font-weight: bold;">struct</span>
  <span style="color: #000000; font-weight: bold;">module</span> <span style="color: #228b22;">X</span> <span style="color: #a52a2a;">=</span> <span style="color: #000000; font-weight: bold;">struct</span>
    <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">x</span> <span style="color: #a52a2a;">=</span> 42
  <span style="color: #000000; font-weight: bold;">end</span>
<span style="color: #000000; font-weight: bold;">end</span>

<span style="color: #000000; font-weight: bold;">module</span> <span style="color: #228b22;">Intermediate</span> <span style="color: #a52a2a;">=</span> <span style="color: #000000; font-weight: bold;">struct</span>
  <span style="color: #000000; font-weight: bold;">include</span> <span style="color: #228b22;">Original</span>
<span style="color: #000000; font-weight: bold;">end</span>

<span style="color: #000000; font-weight: bold;">module</span> <span style="color: #228b22;">Final</span> <span style="color: #a52a2a;">=</span> <span style="color: #000000; font-weight: bold;">struct</span>
  <span style="color: #000000; font-weight: bold;">module</span> <span style="color: #228b22;">X</span> <span style="color: #a52a2a;">=</span> <span style="color: #000000; font-weight: bold;">struct</span>
    <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">x</span> <span style="color: #a52a2a;">=</span> 43
  <span style="color: #000000; font-weight: bold;">end</span>

  <span style="color: #000000; font-weight: bold;">include</span> <span style="color: #a52a2a;">(</span><span style="color: #228b22;">Intermediate</span><span style="color: #a52a2a;">:</span><span style="color: #228b22;"> </span><span style="color: #000000; font-weight: bold;">module type of</span><span style="color: #228b22;"> </span><span style="color: #228b22;">Intermediate</span><span style="color: #228b22;"> </span><span style="color: #000000; font-weight: bold;">with module</span><span style="color: #228b22;"> </span><span style="color: #228b22;">X</span><span style="color: #228b22;"> </span><span style="color: #a52a2a;">:=</span><span style="color: #228b22;"> X</span><span style="color: #a52a2a;">)</span>
<span style="color: #000000; font-weight: bold;">end</span>
</pre>
</div>

<p>
With 4.07, it fails with this error message:
</p>

<pre class="example">
Error: In this `with' constraint, the new definition of X
       does not match its original definition in the constrained signature:
       Modules do not match:
         (module X)
       is not included in
         (module Original.X)
</pre>

<p>
If you remove the <code>Intermediate</code> module (and <code>include (Original: module type of Original with module X := X)</code>, it does compile with all versions I tried.
</p>

<p>
Questions:
</p>
<ul class="org-ul">
<li>is it expected to compile? (i.e. was it a bug in previous versions or is it a regression in 4.07?)</li>
<li>is there a workaround to make it work with 4.07</li>
</ul>
</div>
</div>


<div id="outline-container-org2ba963a" class="outline-3">
<h3 id="org2ba963a">octachron replied</h3>
<div class="outline-text-3" id="text-org2ba963a">
<p>
This is an intended changes in 4.07, <code>module type of</code> does no longer remove module aliases information. You can get back the old behavior by adding a <code>[@remove_aliases]</code> attribute:
</p>
<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">module type of</span> <span style="color: #228b22;">Intermediate</span><span style="color: #483d8b;">[@remove_aliases]</span>
</pre>
</div>
</div>
</div>
</div>




<div id="outline-container-org4b995fa" class="outline-2">
<h2 id="11"><a id="org4b995fa"></a>First release of bwrap</h2>
<div class="outline-text-2" id="text-11">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-first-release-of-bwrap/2835/1">https://discuss.ocaml.org/t/ann-first-release-of-bwrap/2835/1</a>
</p>
</div>

<div id="outline-container-orge948078" class="outline-3">
<h3 id="orge948078">Christophe announced</h3>
<div class="outline-text-3" id="text-orge948078">
<p>
I'm pleased to announce the first release of <a href="https://github.com/Chris00/ocaml-bwrap">bwrap</a>, a simple library to fork executables in a sandboxed environment — with an interface similar to <code>Unix.open_process</code> — thanks to <a href="https://github.com/projectatomic/bubblewrap">bubblewrap</a> (Linux only).
</p>

<p>
Enjoy and do not hesitate to report issues!
</p>
</div>
</div>
</div>




<div id="outline-container-orgc981194" class="outline-2">
<h2 id="12"><a id="orgc981194"></a>Ocaml Github Pull Requests</h2>
<div class="outline-text-2" id="text-12">
</div>
<div id="outline-container-org875dc1f" class="outline-3">
<h3 id="org875dc1f">Gabriel Scherer and the editor compiled this list</h3>
<div class="outline-text-3" id="text-org875dc1f">
<p>
Here is a sneak peek at some potential future features of the Ocaml
compiler, discussed by their implementers in these Github Pull Requests.
</p>

<ul class="org-ul">
<li><a href="https://github.com/ocaml/ocaml/pull/2121">Deprecate the deprecated functions</a></li>
<li><a href="https://github.com/ocaml/ocaml/pull/2125">Filename.chop_suffix_opt</a></li>
<li><a href="https://github.com/ocaml/ocaml/pull/2122">Signature local bindings</a></li>
<li><a href="https://github.com/ocaml/ocaml/pull/2129">Stdlib: add Fun module</a></li>
</ul>
</div>
</div>
</div>




<div id="outline-container-org2cba343" class="outline-2">
<h2 id="13"><a id="org2cba343"></a>Other OCaml News</h2>
<div class="outline-text-2" id="text-13">
</div>
<div id="outline-container-orge6baf92" class="outline-3">
<h3 id="orge6baf92">From the ocamlcore planet blog</h3>
<div class="outline-text-3" id="text-orge6baf92">
<p>
Here are links from many OCaml blogs aggregated at <a href="http://ocaml.org/community/planet/">OCaml Planet</a>.
</p>

<ul class="org-ul">
<li><a href="http://forge.ocamlcore.org/forum/forum.php?forum_id=964">forge.ocamlcore.org expected downtime on 2018-11-01</a></li>
<li><a href="http://forge.ocamlcore.org/forum/forum.php?forum_id=963">forge.ocamlcore.org expected downtime on 2018-10-30</a></li>
<li><a href="http://jobs.github.com/positions/9e8ba450-e72e-11e7-926f-6ce07b7015c8">Full Time: Compiler Engineer at Jane Street in New York &amp; London</a></li>
<li><a href="http://jobs.github.com/positions/0a9333c4-71da-11e0-9ac7-692793c00b45">Full Time: Software Developer (Functional Programming) at Jane Street in New York, NY; London, UK; Hong Kong</a></li>
<li><a href="https://opam.ocaml.org/blog/opam-2-0-1/">opam 2.0.1 is out!</a></li>
</ul>
</div>
</div>
</div>




<div id="outline-container-org22296d6" class="outline-2">
<h2 id="org22296d6">Old CWN</h2>
<div class="outline-text-2" id="text-org22296d6">
<p>
If you happen to miss a CWN, you can <a href="mailto:alan.schmitt@polytechnique.org">send me a message</a> and I'll mail it to you, or go take a look at <a href="http://alan.petitepomme.net/cwn/">the archive</a> or the <a href="http://alan.petitepomme.net/cwn/cwn.rss">RSS feed of the archives</a>.
</p>

<p>
If you also wish to receive it every week by mail, you may subscribe <a href="http://lists.idyll.org/listinfo/caml-news-weekly/">online</a>.
</p>

<div class="authorname">
<p>
<a href="http://alan.petitepomme.net/">Alan Schmitt</a>
</p>

</div>
</div>
</div>
</div>
</body>
</html>
