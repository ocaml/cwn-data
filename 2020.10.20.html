<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-10-20 Tue 10:12 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OCaml Weekly News</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<style type="text/css">#table-of-contents h2 { display: none } .title { display: none } .authorname { text-align: right }</style>
<style type="text/css">.outline-2 {border-top: 1px solid black;}</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">OCaml Weekly News</h1>
<p>
<a href="http://alan.petitepomme.net/cwn/2020.10.13.html">Previous Week</a> <a href="http://alan.petitepomme.net/cwn/index.html">Up</a> <a href="http://alan.petitepomme.net/cwn/2020.10.27.html">Next Week</a>
</p>

<p>
Hello
</p>

<p>
Here is the latest OCaml Weekly News, for the week of October 13 to 20, 2020.
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#1">Dialo is hiring frontend and backend OCaml developers (Remote)</a></li>
<li><a href="#2">Progress 0.1.0</a></li>
<li><a href="#3">Brr 0.0.1, a toolkit for programming browsers</a></li>
<li><a href="#4">New release of Conduit</a></li>
<li><a href="#5">Easy cross compilation using esy</a></li>
<li><a href="#6">OCaml User Survey 2020</a></li>
<li><a href="#org191adec">Old CWN</a></li>
</ul>
</div>
</div>


<div id="outline-container-orgdeac1a3" class="outline-2">
<h2 id="1">Dialo is hiring frontend and backend OCaml developers (Remote)</h2>
<div class="outline-text-2" id="text-1">
<p>
Archive: <a href="https://discuss.ocaml.org/t/dialo-is-hiring-frontend-and-backend-ocaml-developers-remote/6604/1">https://discuss.ocaml.org/t/dialo-is-hiring-frontend-and-backend-ocaml-developers-remote/6604/1</a>
</p>
</div>

<div id="outline-container-org77505b6" class="outline-3">
<h3 id="org77505b6">Wojtek Czekalski announced</h3>
<div class="outline-text-3" id="text-org77505b6">
<p>
<a href="https://dialo.ai">Dialo</a> is an early stage company with an experienced founding team. Assembling a
team that consists of the best and brightest is our top priority. In the immediate term we are building
a visual programming language for conversational AI. Our long term vision is that personalized contact
we are enabling will cause deeper relationships between users and businesses and turn all interactions
into a unified long term customer journey.
</p>

<p>
The work is quite demanding when it comes to both ideation and implementation. We are aiming to provide
a room for growth both technically and/or as a leader. For current open source maintainers we are
willing to sponsor your work on OSS for 20% of time.
</p>

<p>
We use OCaml for frontend and backend (along with Python for machine learning, natural language
processing). We are hiring people for different positions. Both people with extensive experience and
newcomers are encouraged to apply. We try to find the sharpest people rather than checking boxes with
particular skills.
</p>

<p>
The official job posting:
<a href="https://dialo.recruitee.com/o/software-developer-ocamlreason">https://dialo.recruitee.com/o/software-developer-ocamlreason</a>
We are also hiring for two other (related) positions:
</p>
<ul class="org-ul">
<li><a href="https://dialo.recruitee.com/o/software-developer-frontend">https://dialo.recruitee.com/o/software-developer-frontend</a></li>
<li><a href="https://dialo.recruitee.com/o/software-developer-backend">https://dialo.recruitee.com/o/software-developer-backend</a></li>
</ul>
</div>
</div>
</div>




<div id="outline-container-org5954700" class="outline-2">
<h2 id="2">Progress 0.1.0</h2>
<div class="outline-text-2" id="text-2">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-progress-0-1-0/6607/1">https://discuss.ocaml.org/t/ann-progress-0-1-0/6607/1</a>
</p>
</div>

<div id="outline-container-org7f08ad5" class="outline-3">
<h3 id="org7f08ad5">Craig Ferguson announced</h3>
<div class="outline-text-3" id="text-org7f08ad5">
<p>
I'm pleased to announce the first release of <a href="https://github.com/CraigFe/progress/"><code>Progress</code></a>, now
available on Opam.
</p>


<div class="figure">
<p><object type="image/svg+xml" data="https://raw.githubusercontent.com/CraigFe/progress/main/.meta/example.svg" class="org-svg">
<img src="https://raw.githubusercontent.com/CraigFe/progress/main/.meta/example.svg" class="org-svg" /></object>
</p>
</div>

<p>
<code>Progress</code> is a small library for quickly defining and using progress bars in OCaml programs. It aims
to provide the following:
</p>

<ul class="org-ul">
<li>support for rendering multiple progress bars simultaneously;</li>
<li>responds dynamically to changes in terminal size;</li>
<li>allows user-defined progress bar layouts.</li>
</ul>
</div>

<div id="outline-container-org2427911" class="outline-4">
<h4 id="org2427911">Defining your own progress bars</h4>
<div class="outline-text-4" id="text-org2427911">
<p>
The example animation above uses a pre-provided progress bar layout that should meet many needs
(<a href="https://craigfe.github.io/progress/progress/Progress_unix/index.html#val-counter"><code>Progress_unix.counter</code></a>),
but it's fairly easy to re-define it ourselves using the low-level
<a href="https://craigfe.github.io/progress/progress/Progress/Segment/index.html"><code>Progress.Segment</code></a> API:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">counter</span> <span style="color: #a0522d;">filename</span> =
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">proportion</span> <span style="color: #a0522d;">i</span> = <span style="color: #228b22;">Int64.</span>to_float i /. 1_000_000. <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #000000; font-weight: bold;">open </span><span style="color: #228b22;">Progress</span> <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #228b22;">Segment.</span>(
    list
      [
        const filename;
        <span style="color: #228b22;">Units.</span>bytes of_pp;
        <span style="color: #228b22;">Progress_unix.</span>stopwatch ();
        bar <span style="color: #008b8b;">~mode</span>:<span style="color: #000000; background-color: #ffffff;">`ASCII</span> proportion;
        using proportion (<span style="color: #228b22;">Units.</span>percentage of_pp);
      ]
    <span style="color: #a52a2a;">|&gt;</span> box_winsize <span style="color: #008b8b;">~fallback</span>:80  <span style="color: #b22222;">(* </span><span style="color: #b22222;">Dynamically scale to window size </span><span style="color: #b22222;">*)</span>
    <span style="color: #a52a2a;">|&gt;</span> periodic 100              <span style="color: #b22222;">(* </span><span style="color: #b22222;">Re-render once every 100 updates </span><span style="color: #b22222;">*)</span>
    <span style="color: #a52a2a;">|&gt;</span> accumulator <span style="color: #228b22;">Int64.</span>add 0L  <span style="color: #b22222;">(* </span><span style="color: #b22222;">Accumulate progress updates </span><span style="color: #b22222;">*)</span>)
  <span style="color: #a52a2a;">|&gt;</span> make <span style="color: #008b8b;">~init</span>:0L
</pre>
</div>

<p>
The <code>Segment</code> combinators are similar to those of general-purpose pretty-printing libraries (e.g.
<a href="https://github.com/ocaml-dune/pp"><code>pp</code></a> and <a href="https://erratique.ch/software/fmt"><code>fmt</code></a>), but are
equipped with extra logic for "stateful" segments and segments that can have dynamic width. Together,
these make for a convenient way to express common patterns when pretty-printing progress bars. For
instance, the stateful segment <code>periodic</code> seen above can be used to ensure that very frequent updates
from a hot-loop do not result in too much time spent re-rendering the output.
</p>

<p>
The library is not yet feature-complete, but should still be reasonably useful :slightly_smiling_face:
Happy hacking!
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-org882a51f" class="outline-2">
<h2 id="3">Brr 0.0.1, a toolkit for programming browsers</h2>
<div class="outline-text-2" id="text-3">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-brr-0-0-1-a-toolkit-for-programming-browsers/6608/1">https://discuss.ocaml.org/t/ann-brr-0-0-1-a-toolkit-for-programming-browsers/6608/1</a>
</p>
</div>

<div id="outline-container-org77ebe1e" class="outline-3">
<h3 id="org77ebe1e">Daniel Bünzli announced</h3>
<div class="outline-text-3" id="text-org77ebe1e">
<p>
I'd like to announce the first release of Brr.
</p>

<p>
The TL; DR is:
</p>
<blockquote>
<p>
If you are looking for a productive way to program browsers with js_of_ocaml but without ppx and
ghost OCaml objects, give Brr a try.
</p>
</blockquote>

<p>
The details:
</p>

<blockquote>
<p>
Brr is a toolkit for programming browsers in OCaml with the <a href="https://ocsigen.org/js_of_ocaml"><code>js_of_ocaml</code></a> compiler. It provides:
</p>
<ul class="org-ul">
<li>Interfaces to a <a href="https://erratique.ch/software/brr/doc/index.html#supported_apis">selection</a> of browser APIs.</li>
<li>Note based reactive support (optional and experimental).</li>
<li>An <a href="https://erratique.ch/software/brr/doc/ocaml_console.html">OCaml console</a> developer tool for live interaction with programs running in web pages.</li>
<li>A JavaScript FFI for idiomatic OCaml programming.</li>
</ul>

<p>
Brr is distributed under the ISC license. It depends on <a href="https://erratique.ch/software/note">Note</a> and on the <code>js_of_ocaml</code>
compiler and runtime – but not on its libraries or syntax extension.
</p>
</blockquote>

<ul class="org-ul">
<li>Homepage: <a href="https://erratique.ch/software/brr">https://erratique.ch/software/brr</a></li>
<li>API Docs &amp; manuals: <a href="https://erratique.ch/software/brr/doc/">https://erratique.ch/software/brr/doc/</a> or <code>odig doc brr</code></li>
<li>Install: <code>opam install brr</code></li>
</ul>

<p>
Brr is essentially what I need to be productive for browser programming with js_of_ocaml: an obvious
FFI with JavaScript objects as abstract data types without OCaml object phantom types and binding
documentation precisely linking into MDN.
</p>

<p>
The OCaml console is the hack on the cake. In the past I often found it frustrating to  have OCaml
programs running in my webpages and be greeted with a JavaScript  prompt in the browser dev tools.
Quite a bit of polishing could be done on that  though. Some of which should likely directly be done
upstream in the toplevel  machinery (e.g. identifier completion, a better toploop API and support for
easy pretty printer installation). It would also be nice if we could cut down on <code>js_of_ocaml</code>'s
toplevel compilation times ;&#x2013;)
</p>

<p>
Parts of Brr have been seriously dogfooded in the past but that new incarnation is largely untested for
now and certain APIs might need adjustements. Early adopters should study actual binding coverage,
expect glitches and little breakages in the future.
</p>

<p>
The Note reactive functionality was also seriously used in the past but Note itself needs a new design
round and I don't have the ressources to do it right now, expect breakage, don't pay too much attention
to it for now.
</p>

<p>
My thanks to the <code>js_of_ocaml</code> developers for the nice ocaml to javascript compiler and a special
shootout to Hugo Heuzard for not getting mad at me when pinging him directly for questions.
</p>

<p>
Happy browser compatibility bug hunting,
</p>
</div>
</div>


<div id="outline-container-org00a1f68" class="outline-3">
<h3 id="org00a1f68">gasche asked</h3>
<div class="outline-text-3" id="text-org00a1f68">
<p>
It's not really released, but I'm curious about <a href="https://erratique.ch/software/note">Note</a> now: this is
a new FRP library from you, the author of <a href="https://erratique.ch/software/react">React</a> (the FRP library
for OCaml, not the Javascript framework of the same name).
</p>

<p>
Would you say a few words on why you went for a different library? My guess would be that React depends
on runtime mechanisms (weak pointers) that are not well-supported in Javascript-lang; but even if the
guess is right, I'm not sure what would be the impact on the API or properties of the library.
</p>
</div>
</div>


<div id="outline-container-orgadee36f" class="outline-3">
<h3 id="orgadee36f">Daniel Bünzli replied</h3>
<div class="outline-text-3" id="text-orgadee36f">
<blockquote>
<p>
Would you say a few words on why you went for a different library?
</p>
</blockquote>

<p>
<code>Note</code> is the result from seeing people (and myself) struggling to use ~React~/FRP "correctly" over the
years.
</p>

<p>
Some of this, I largely attribute to ergonomic problems with the API. It's my hope for <code>Note</code> to
address most of these points (one thing that still needs to be done is replace fix points by a simple
lazy infinitesimal delay combinator).
</p>

<p>
I don't think I could have made all these changes in <code>React</code> itself so I found it better to start a new
library. Also I lost the trademark on the name :&#x2013;)
</p>

<p>
<code>Note</code> also tries to provide a much simpler implementation. <code>React</code>'s implementation was based on the
<a href="http://cs.brown.edu/people/ghcooper/thesis.pdf">FrTime Phd thesis</a>. It's quite subtle and involved
and, as you suggested, uses weak pointer. <code>Note</code> tries to avoid them since those are not available in
the browser (but you have things like
<a href="https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver">MutationObservers</a> which I use as
gc in Brr's Note-based <a href="https://erratique.ch/software/brr/doc/Brr_note/Elr/index.html">reactive dom
support</a>).
</p>

<p>
However not using weak pointers has a semantic uncleanness cost whose impact I'm unsure yet – without
discipline from the programmer it may lead to subtle and hard to track bugs when the reactive graph
changes dynamically, which I'm a bit wary of.
</p>

<p>
When my brain dumped <code>Note</code> I wrote a few more technical points in the readme you can read them
<a href="https://github.com/dbuenzli/note#history">here</a>.
</p>
</div>
</div>
</div>




<div id="outline-container-org7d559f7" class="outline-2">
<h2 id="4">New release of Conduit</h2>
<div class="outline-text-2" id="text-4">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-new-release-of-conduit/6611/1">https://discuss.ocaml.org/t/ann-new-release-of-conduit/6611/1</a>
</p>
</div>

<div id="outline-container-orgc9ab668" class="outline-3">
<h3 id="orgc9ab668">Calascibetta Romain announced</h3>
<div class="outline-text-3" id="text-orgc9ab668">
<p>
<b>Conduit 3.0.0</b>
</p>

<p>
Hello everyone,
</p>

<p>
We're glad to announce the new release of <a href="https://github.com/mirage/ocaml-conduit"><code>conduit</code></a>, a framework  that allows to <span class="underline">abstract</span>
over transfer protocols. One of its main advantages  is allowing the implemententation of
<span class="underline">free-dependencies</span> protocols.
</p>
</div>

<div id="outline-container-orgb0535fb" class="outline-4">
<h4 id="orgb0535fb">Introduction</h4>
<div class="outline-text-4" id="text-orgb0535fb">
<p>
There are several ways to abstract over an implementation in OCaml. However, those solutions are often
lost deep in the stack of protocols and allowing the user to choose the implementations of the
sub-procotols implies growing complexity as we move up through the stack. (For example, allowing to
abstract over the implementation of the TLS protocol from the implementation of the HTTP protocol)
</p>

<p>
One of those solutions, the <span class="underline">functors</span>, can rapidly become a hellish nightmare for the end-user. This
is especially true in the case of MirageOS, which literally wants to abstract over everything!
</p>

<p>
This is why Conduit was implemented: it aims to provide to the user a cleaner abstraction mechanism
which would allow the protocol developers to get rid of most of the responsibilities concerning the
choice of sub-protocols (Like which TLS implementation use between OpenSSL or our great
<a href="https://github.com/mirleft/ocaml-tls">ocaml-tls</a> library), while giving the end-users an easy way to compose the protocols of
their choice and inject them in the stack via conduit.
</p>
</div>
</div>

<div id="outline-container-org7f738cb" class="outline-4">
<h4 id="org7f738cb">Usage of Conduit</h4>
<div class="outline-text-4" id="text-org7f738cb">
<p>
Such a framework allows us to separate the logic of a protocol from underlying implementation needed to
communicate with a peer. The distribution of Conduit comes with <a href="https://mirage.github.io/ocaml-conduit/conduit/howto.html">a simple tutorial</a> which
explains step by step how to implement a <span class="underline">ping-pong</span> client &amp; server and, most importantly, how to
upgrade them with TLS.
</p>

<p>
With Conduit, we ensure the compatibility with MirageOS (and specially <a href="https://github.com/mirage/mirage-tcpip">mirage-tcpip</a>)
while being useful for others. Of course, Conduit is not mandatory to ensure this compatibility, but it
helps us for <span class="underline">higher</span> libraries such as <a href="https://github.com/mirage/ocaml-git">ocaml-git</a>/<a href="https://github.com/mirage/irmin">Irmin</a> or <a href="https://github.com/mirage/ocaml-cohttp">Cohttp</a>.
</p>
</div>
</div>

<div id="outline-container-orgb059e21" class="outline-4">
<h4 id="orgb059e21">Specific improvements</h4>
<div class="outline-text-4" id="text-orgb059e21">
</div>
<ul class="org-ul">
<li><a id="org6bc4ef6"></a>Abstract and destruct it!<br />
<div class="outline-text-5" id="text-org6bc4ef6">
<p>
The most requested feature on the new version of Conduit is the ability to <span class="underline">destruct</span> the
[Conduit.flow][conduit-flow]. The ability to abstract the protocol comes with the <span class="underline">abstract</span> type
<code>Conduit.flow</code>. The new version permits to <span class="underline">destruct</span> it to a well-known value (such as an UNIX
socket):
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">handler</span> <span style="color: #a0522d;">flow</span> = <span style="color: #a020f0;">match</span> flow <span style="color: #a020f0;">with</span>
  | <span style="color: #228b22;">Conduit_lwt.TCP.</span><span style="color: #000000; background-color: #ffffff;">T</span> (<span style="color: #000000; background-color: #ffffff;">Value</span> file_descr) -&gt;
    <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">peer</span> = <span style="color: #228b22;">Lwt_unix.</span>getpeername file_descr <span style="color: #000000; font-weight: bold;">in</span>
    ...
  | flow -&gt; ... <span style="color: #b22222;">(* </span><span style="color: #b22222;">other kind of protocol </span><span style="color: #b22222;">*)</span>

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">run</span> =
  <span style="color: #228b22;">Cohttp_lwt_unix.</span>serve ~handler
    { sockaddr= <span style="color: #228b22;">Unix.</span>inet_addr_loopback }
</pre>
</div>
</div>
</li>

<li><a id="orgf4765f5"></a>The dispatch of the protocol<br />
<div class="outline-text-5" id="text-orgf4765f5">
<p>
The second most interesting feature of Conduit is the full control over the dispatch between protocols
by the end-user. From a concrete information such as an <code>Uri.t</code>, the end-user is able to describe how
Conduit should choose the protocol (and with which value it should try to initiate the connection):
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">my_tls_config</span> = <span style="color: #228b22;">Tls.Config.</span>client ...

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">connect</span> <span style="color: #a0522d;">uri</span> =
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">edn</span> = <span style="color: #228b22;">Conduit.Endpoint.</span>of_string
    (<span style="color: #228b22;">Uri.</span>host_with_default <span style="color: #008b8b;">~default</span>:<span style="color: #8b2252;">"localhost"</span> uri) <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">resolvers</span> = <span style="color: #a020f0;">match</span> <span style="color: #228b22;">Uri.</span>scheme uri <span style="color: #a020f0;">with</span>
    | <span style="color: #000000; background-color: #ffffff;">Some</span> <span style="color: #8b2252;">"https"</span> -&gt;
      <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">port</span> = <span style="color: #228b22;">Option.</span>value <span style="color: #008b8b;">~default</span>:443 (<span style="color: #228b22;">Uri.</span>port uri) <span style="color: #000000; font-weight: bold;">in</span>
      <span style="color: #228b22;">Conduit_lwt.</span>add
        <span style="color: #228b22;">Conduit_lwt_tls.TCP.</span>protocol
        (<span style="color: #228b22;">Conduit_lwt_tls.TCP.</span>resolve ~port <span style="color: #008b8b;">~config</span>:my_tls_config)
        <span style="color: #228b22;">Conduit.</span>empty
    | <span style="color: #000000; background-color: #ffffff;">Some</span> <span style="color: #8b2252;">"http"</span> | <span style="color: #000000; background-color: #ffffff;">None</span> -&gt;
      <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">port</span> = <span style="color: #228b22;">Option.</span>value <span style="color: #008b8b;">~default</span>:80 (<span style="color: #228b22;">Uri.</span>port uri) <span style="color: #000000; font-weight: bold;">in</span>
      <span style="color: #228b22;">Conduit_lwt.</span>add
        <span style="color: #228b22;">Conduit_lwt.TCP.</span>protocol
        (<span style="color: #228b22;">Conduit_lwt.TCP.</span>resolve ~port)
        <span style="color: #228b22;">Conduit.</span>empty <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #228b22;">Conduit_lwt.</span>resolve ~resolvers edn &gt;&gt;= <span style="color: #a020f0;">fun</span> <span style="color: #a0522d;">flow</span> -&gt;
  ...
</pre>
</div>
</div>
</li>

<li><a id="orgfa79af7"></a>An explicit way to launch a server<br />
<div class="outline-text-5" id="text-orgfa79af7">
<p>
Conduit comes with a new API for the server-side, where everything becomes explicit: no dispatch, no
hidden choice. It proposes now a simple function to start the usual server loop:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">run</span> <span style="color: #a0522d;">handler</span> =
  <span style="color: #228b22;">Conduit_lwt.</span>serve ~handler
    <span style="color: #228b22;">Conduit_lwt.TCP.</span>service
    { <span style="color: #228b22;">Conduit_lwt.TCP.</span>sockaddr= <span style="color: #228b22;">Unix.</span>(<span style="color: #000000; background-color: #ffffff;">ADDR_INET</span> (inet_addr_loopback, 8080)
    ; capacity= 40 }
</pre>
</div>
</div>
</li>
</ul>
</div>

<div id="outline-container-org1926429" class="outline-4">
<h4 id="org1926429">Reverse-dependencies</h4>
<div class="outline-text-4" id="text-org1926429">
<p>
Conduit is used by many libraries (~150 packages) and we spend 2 months to track this breaking-change.
Currently, it's mostly about <a href="https://github.com/mirage/ocaml-cohttp">Cohttp</a> and <a href="https://github.com/mirage/irmin">Irmin</a> and both have a PR according the new
version of Conduit. These packages will be released as soon as we can with the new version of Conduit.
</p>
</div>
</div>

<div id="outline-container-orgb59f4b1" class="outline-4">
<h4 id="orgb59f4b1">Conclusion</h4>
<div class="outline-text-4" id="text-orgb59f4b1">
<p>
Conduit is a piece required by many libraries but nobody really uses it. This new version wants to
replace and redefine more concretely what Conduit is. The update is <a href="https://github.com/mirage/ocaml-conduit/pull/311">huge</a> for us but small
for people where we tried to keep the same global idea of the abstraction.
</p>

<p>
I would like to thank many people (MirageOS core team, Cohttp peoples, some not so famous guys of the
Reason/OCaml eco-system) who followed us on this deep development (and tried and iterated on our
version). It does not change too much our world, but it paves the way for a better MirageOS/OCaml
eco-system.
</p>

<p>
As a french guy, I just would like to say: Conduit est mort, Vive Conduit!
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-org16b8edd" class="outline-2">
<h2 id="5">Easy cross compilation using esy</h2>
<div class="outline-text-2" id="text-5">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-easy-cross-compilation-using-esy/6612/1">https://discuss.ocaml.org/t/ann-easy-cross-compilation-using-esy/6612/1</a>
</p>
</div>

<div id="outline-container-org90125cf" class="outline-3">
<h3 id="org90125cf">EduardoRFS announced</h3>
<div class="outline-text-3" id="text-org90125cf">
<p>
I've been working on this for a couple of months now, and now it is ready for an initial announcement
of my tools to cross compiling OCaml and ReasonML Native.
</p>

<p>
<a href="https://github.com/EduardoRFS/reason-mobile">https://github.com/EduardoRFS/reason-mobile</a>
</p>
</div>

<div id="outline-container-orgc867de2" class="outline-4">
<h4 id="orgc867de2">What it can do</h4>
<div class="outline-text-4" id="text-orgc867de2">
<p>
Out of box it can cross compile most dune and topkg, packages available on opam for a couple of
platforms, there is also patches for popular packages.
</p>

<p>
You can also compile opam packages by making an wrapper, like
</p>

<p>
<a href="https://github.com/mirage/mirage-crypto/pull/84/files">https://github.com/mirage/mirage-crypto/pull/84/files</a>
</p>
</div>
</div>

<div id="outline-container-orgae87b9c" class="outline-4">
<h4 id="orgae87b9c">Limitations</h4>
<div class="outline-text-4" id="text-orgae87b9c">
<p>
Your package should build with OCaml 4.10, and all the packages that are built for the <code>host</code> will also
be build for the <code>target</code>, so sometimes you need to fix a package that you will not use directly.
</p>

<p>
Some packages you will need to pin to a <code>dune-universe</code> fork version
</p>
</div>
</div>

<div id="outline-container-org88d3eae" class="outline-4">
<h4 id="org88d3eae">How to use it</h4>
<div class="outline-text-4" id="text-org88d3eae">
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;">## </span><span style="color: #b22222;">compile your project</span>
esy

<span style="color: #b22222;">## </span><span style="color: #b22222;">generate the wrapper</span>
esy add -D generate@EduardoRFS/reason-mobile:generate.json
esy generate android.arm64

<span style="color: #b22222;">## </span><span style="color: #b22222;">build for android.arm64</span>
esy @android.arm64
</pre>
</div>
</div>
</div>

<div id="outline-container-org6f846d5" class="outline-4">
<h4 id="org6f846d5">Platforms</h4>
<div class="outline-text-4" id="text-org6f846d5">
<p>
All of the following are tested from Linux and macOS, but I would suppose that FreeBSD should be also
working as a build system.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Targets</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">android.arm64</td>
</tr>

<tr>
<td class="org-left">android.x86_64</td>
</tr>

<tr>
<td class="org-left">ios.arm64</td>
</tr>

<tr>
<td class="org-left">ios.simulator.x86_64</td>
</tr>

<tr>
<td class="org-left">linux.musl.arm64</td>
</tr>

<tr>
<td class="org-left">linux.musl.x86_64</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgf117785" class="outline-4">
<h4 id="orgf117785">What I tested</h4>
<div class="outline-text-4" id="text-orgf117785">
<p>
In the past I was able to build <code>Revery</code> the UI framework for <code>Android</code> and <code>iOS</code>
</p>

<p>
But recently I did compile <code>esy</code> the package manager itself for all of the following platforms above
from an <code>Arch Linux x86_64</code> and <code>macOS Catalina x86_64</code>. Including <code>iOS</code>, with the right version of
OCaml it will run inside of the new <code>macOS ARM64</code> and inside of a jailbroken iPhone.
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-orgedae14d" class="outline-2">
<h2 id="6">OCaml User Survey 2020</h2>
<div class="outline-text-2" id="text-6">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-ocaml-user-survey-2020/6624/1">https://discuss.ocaml.org/t/ann-ocaml-user-survey-2020/6624/1</a>
</p>
</div>

<div id="outline-container-org5f2a628" class="outline-3">
<h3 id="org5f2a628">gasche announced</h3>
<div class="outline-text-3" id="text-org5f2a628">
<p>
We are happy to announce the <a href="https://forms.gle/MAT7ZE7RtxTWuNgK7">OCaml User Survey 2020</a>. We are trying to get a better picture of the
OCaml community and its needs. It would be very useful if you could fill the survey (10-15 minutes),
and share it widely with other OCaml programmers!
</p>

<p>
The survey is run by the <a href="https://ocaml-sf.org/">OCaml Software Foundation</a>. Thanks in particular to
our sponsors OCamlPro (@MuSSF) for preparing many of the questions, Jane Street (@Yaron_Minsky) for
excellent feedback, and to Kim @K_N Nguyễn for his technical help.
</p>

<p>
This is our first year running the survey, we hope to continue in following years. There are many
things to improve; please feel free to give us feedback! (There is a feedback question at the end of
the survey, or you can post here, or send me a message/email.)
</p>

<p>
The survey was inspired by programming-language surveys ran by other communities. See for example past
survey results for <a href="https://blog.golang.org/survey2019-results">Go</a>, <a href="https://taylor.fausak.me/2019/11/16/haskell-survey-results/">Haskell</a>, <a href="https://blog.rust-lang.org/2020/04/17/Rust-survey-2019.html">Rust</a>, and <a href="https://scalacenter.github.io/scala-developer-survey-2019/">Scala</a>.
</p>
</div>
</div>
</div>




<div id="outline-container-org191adec" class="outline-2">
<h2 id="org191adec">Old CWN</h2>
<div class="outline-text-2" id="text-org191adec">
<p>
If you happen to miss a CWN, you can <a href="mailto:alan.schmitt@polytechnique.org">send me a message</a> and I'll mail it to you, or go take a look at <a href="http://alan.petitepomme.net/cwn/">the archive</a> or the <a href="http://alan.petitepomme.net/cwn/cwn.rss">RSS feed of the archives</a>.
</p>

<p>
If you also wish to receive it every week by mail, you may subscribe <a href="http://lists.idyll.org/listinfo/caml-news-weekly/">online</a>.
</p>

<div class="authorname">
<p>
<a href="http://alan.petitepomme.net/">Alan Schmitt</a>
</p>

</div>
</div>
</div>
</div>
</body>
</html>
