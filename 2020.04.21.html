<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-04-21 Tue 10:50 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OCaml Weekly News</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<style type="text/css">#table-of-contents h2 { display: none } .title { display: none } .authorname { text-align: right }</style>
<style type="text/css">.outline-2 {border-top: 1px solid black;}</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">OCaml Weekly News</h1>
<p>
<a href="http://alan.petitepomme.net/cwn/2020.04.14.html">Previous Week</a> <a href="http://alan.petitepomme.net/cwn/index.html">Up</a> <a href="http://alan.petitepomme.net/cwn/2020.04.28.html">Next Week</a>
</p>

<p>
Hello
</p>

<p>
Here is the latest OCaml Weekly News, for the week of April 14 to 21, 2020.
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#1">Current_incr: a small incremental library with no dependencies</a></li>
<li><a href="#2">Scikit-learn for OCaml</a></li>
<li><a href="#3">OCaml and opam container images updated: new Fedora/Alpine/Ubuntu images</a></li>
<li><a href="#4">OCamlformat 0.14.0</a></li>
<li><a href="#5">Hashconsing an AST via PPX</a></li>
<li><a href="#6">Genprint v0.4</a></li>
<li><a href="#7">Other OCaml News</a></li>
<li><a href="#org1f62c6f">Old CWN</a></li>
</ul>
</div>
</div>


<div id="outline-container-orge76f6bf" class="outline-2">
<h2 id="1">Current_incr: a small incremental library with no dependencies</h2>
<div class="outline-text-2" id="text-1">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-current-incr-a-small-incremental-library-with-no-dependencies/5531/1">https://discuss.ocaml.org/t/ann-current-incr-a-small-incremental-library-with-no-dependencies/5531/1</a>
</p>
</div>

<div id="outline-container-orgfee4510" class="outline-3">
<h3 id="orgfee4510">Thomas Leonard announced</h3>
<div class="outline-text-3" id="text-orgfee4510">
<p>
The recent <a href="https://github.com/ocurrent/ocurrent/releases/tag/v0.2">OCurrent 0.2</a> release included a little
incremental library which might be interesting to some people. It is useful for writing programs that need to keep
some computation up-to-date efficiently as the inputs change.
</p>

<p>
It is similar to the existing <a href="https://github.com/janestreet/incremental">incremental</a> and
<a href="https://erratique.ch/software/react">react</a> libraries already in opam. Unlike <code>incremental</code> (which pulls in the
whole of <code>core_kernel</code>), <code>current_incr</code> has no runtime dependencies (and build dependencies only on <code>ocaml</code> and
<code>dune</code>). Unlike <code>react</code>, <code>current_incr</code> immediately stops computations when they are no longer needed (rather than
relying on weak references and the garbage collector).
</p>

<p>
It is a fairly direct implementation of the <a href="https://www.cs.cmu.edu/~guyb/papers/popl02.pdf">Adaptive Functional
Programming</a> paper, and might be a good starting point for people
wanting to learn about that.
</p>

<p>
You can get the library using <code>opam</code>:
</p>

<div class="org-src-container">
<pre class="src src-shell">opam install current_incr
</pre>
</div>

<p>
Here's a simple example (in utop):
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #708090;">#require</span> <span style="color: #8b2252;">"current_incr"</span><span style="color: #ff4500;">;;</span>

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">total</span> = <span style="color: #228b22;">Current_incr.</span>var 10
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">complete</span> = <span style="color: #228b22;">Current_incr.</span>var 5

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">status</span> =
  <span style="color: #228b22;">Current_incr.</span>of_cc <span style="color: #000000; font-weight: bold;">begin</span>
    <span style="color: #228b22;">Current_incr.</span>read (<span style="color: #228b22;">Current_incr.</span>of_var total) <span style="color: #a52a2a;">@@</span> <span style="color: #a020f0;">function</span>
    | 0 -&gt; <span style="color: #228b22;">Current_incr.</span>write <span style="color: #8b2252;">"No jobs"</span>
    | total -&gt;
      <span style="color: #228b22;">Current_incr.</span>read (<span style="color: #228b22;">Current_incr.</span>of_var complete) <span style="color: #a52a2a;">@@</span> <span style="color: #a020f0;">fun</span> <span style="color: #a0522d;">complete</span> -&gt;
      <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">frac</span> = float_of_int complete /. float_of_int total <span style="color: #000000; font-weight: bold;">in</span>
      <span style="color: #228b22;">Printf.</span>sprintf <span style="color: #8b2252;">"%d/%d jobs complete (%.1f%%)"</span>
                     complete total (100. *. frac)
      <span style="color: #a52a2a;">|&gt;</span> <span style="color: #228b22;">Current_incr.</span>write
  <span style="color: #000000; font-weight: bold;">end</span>
</pre>
</div>

<p>
This defines two input variables (<code>total</code> and <code>complete</code>) and a "changeable computation" (<code>status</code>) whose output
depends on them. At the top-level, we can observe the initial state using <code>observe</code>:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"># print_endline <span style="color: #a52a2a;">@@</span> <span style="color: #228b22;">Current_incr.</span>observe status<span style="color: #ff4500;">;;</span>
5/10 jobs complete (50.0<span style="color: #a52a2a;">%</span>)
</pre>
</div>

<p>
Unlike a plain <code>ref</code> cell, a <code>Current_incr.var</code> keeps track of which computations depend on it. After changing them,
you must call <code>propagate</code> to update the results:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"># <span style="color: #228b22;">Current_incr.</span>change total 12<span style="color: #ff4500;">;;</span>
# <span style="color: #228b22;">Current_incr.</span>change complete 4<span style="color: #ff4500;">;;</span>
# print_endline <span style="color: #a52a2a;">@@</span> <span style="color: #228b22;">Current_incr.</span>observe status<span style="color: #ff4500;">;;</span>
5/10 jobs complete (50.0<span style="color: #a52a2a;">%</span>)      <span style="color: #b22222;">(* </span><span style="color: #b22222;">Not yet updated </span><span style="color: #b22222;">*)</span>

# <span style="color: #228b22;">Current_incr.</span>propagate ();
# print_endline <span style="color: #a52a2a;">@@</span> <span style="color: #228b22;">Current_incr.</span>observe status<span style="color: #ff4500;">;;</span>
4/12 jobs complete (33.3<span style="color: #a52a2a;">%</span>)
</pre>
</div>

<p>
Computations can have side-effects, and you can use <code>on_release</code> to run some compensating action if the computation
needs to be undone later. Here's a function that publishes a result, and also registers a compensation for it:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">publish</span> <span style="color: #a0522d;">msg</span> =
  <span style="color: #228b22;">Printf.</span>printf <span style="color: #8b2252;">"PUBLISH: %s\n%!"</span> msg;
  <span style="color: #228b22;">Current_incr.</span>on_release <span style="color: #a52a2a;">@@</span> <span style="color: #a020f0;">fun</span> () -&gt;
  <span style="color: #228b22;">Printf.</span>printf <span style="color: #8b2252;">"RETRACT: %s\n%!"</span> msg
</pre>
</div>

<p>
It can be used like this:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"># <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">display</span> = <span style="color: #228b22;">Current_incr.</span>map publish status<span style="color: #ff4500;">;;</span>
<span style="color: #000000; background-color: #ffffff;">PUBLISH</span>: 4/12 jobs complete (33.3<span style="color: #a52a2a;">%</span>)

# <span style="color: #228b22;">Current_incr.</span>change total 0;
# <span style="color: #228b22;">Current_incr.</span>propagate ()
<span style="color: #000000; background-color: #ffffff;">RETRACT</span>: 4/12 jobs complete (33.3<span style="color: #a52a2a;">%</span>)
<span style="color: #000000; background-color: #ffffff;">PUBLISH</span>: <span style="color: #000000; background-color: #ffffff;">No</span> jobs
</pre>
</div>

<p>
A major difference between this and the react library (which I've used in previously in <a href="https://stackoverflow.com/questions/19975140/how-to-stop-ocaml-garbage-collecting-my-reactive-event-handler">0install's progress
reporting</a>
and <a href="https://roscidus.com/blog/blog/2015/06/22/cuekeeper-internals-irmin/">CueKeeper</a>) is that <code>Current_incr</code> does
not depend on the garbage collector to decide when to stop a computation. In react, you'd have to be careful to make
sure that <code>display</code> didn't get GC'd (even though you don't need to refer to it again) because if it did then the
output would stop getting updated. Also, setting <code>total</code> to <code>0</code> in react might cause the program to crash with a
division-by-zero exception, because the <code>frac</code> computation will continue running until it gets GC'd, even though it
isn't needed for anything now.
</p>

<p>
<a href="https://ocurrent.github.io/ocurrent/current_incr/Current_incr/index.html"><code>Current_incr</code>'s API</a> is pretty small. You
might want to wrap it to provide extra features, e.g.
</p>

<ul class="org-ul">
<li>Use of a <code>result</code> type to propagate errors.</li>
<li>Integration with <code>Lwt</code> to allow asynchronous computations.</li>
<li>Static analysis to render your computation with graphviz.</li>
<li>Persistence of state to disk.</li>
</ul>

<p>
If you need that, consider using the main <a href="https://github.com/ocurrent/ocurrent">OCurrent</a> library, which extends
<code>current_incr</code> with these features.
</p>
</div>
</div>
</div>




<div id="outline-container-org6d0a461" class="outline-2">
<h2 id="2">Scikit-learn for OCaml</h2>
<div class="outline-text-2" id="text-2">
<p>
Archive: <a href="https://discuss.ocaml.org/t/scikit-learn-for-ocaml/5536/1">https://discuss.ocaml.org/t/scikit-learn-for-ocaml/5536/1</a>
</p>
</div>

<div id="outline-container-org670dfce" class="outline-3">
<h3 id="org670dfce">UnixJunkie announced</h3>
<div class="outline-text-3" id="text-org670dfce">
<p>
Ronan Lehy just hacked this:
</p>

<p>
<a href="https://github.com/lehy/ocaml-sklearn">https://github.com/lehy/ocaml-sklearn</a>
</p>

<p>
This might interest a significant number of people out there.
We are no more condemned to live in a world full of snakes
that will bite us at run-time. :smiley:
</p>
</div>
</div>


<div id="outline-container-orga72068d" class="outline-3">
<h3 id="orga72068d">Ronan Le Hy then said</h3>
<div class="outline-text-3" id="text-orga72068d">
<p>
So I came here to announce ocaml-sklearn as it just got published on Opam, but I see @UnixJunkie did it for me
(arigato gozai masu). Anyway:
</p>
<ul class="org-ul">
<li>this ambitions to cover the complete scikit-learn API</li>
<li>this ambition is currently not totally realized, but I wanted to release something initial that one can play with</li>
<li>it's all @UnixJunkie's fault with his funny R wrappers.</li>
</ul>

<p>
So:
</p>
<ul class="org-ul">
<li>opam install sklearn</li>
<li>go check out <a href="https://scikit-learn.org">scikit-learn and its awesome documentation</a> to know what it does</li>
<li>look at <a href="https://lehy.github.io/ocaml-sklearn/">ocaml-sklearn's documentation</a> to see what the current OCaml API looks like</li>
<li>have fun with it and tell me what you think of it.</li>
</ul>
</div>
</div>


<div id="outline-container-org687a844" class="outline-3">
<h3 id="org687a844">Anton Kochkov then added</h3>
<div class="outline-text-3" id="text-org687a844">
<p>
Probably worth to add here:
</p>
<ul class="org-ul">
<li><a href="https://github.com/ocaml-community/awesome-ocaml#machine-learning">https://github.com/ocaml-community/awesome-ocaml#machine-learning</a></li>
</ul>
</div>
</div>
</div>




<div id="outline-container-org89e18af" class="outline-2">
<h2 id="3">OCaml and opam container images updated: new Fedora/Alpine/Ubuntu images</h2>
<div class="outline-text-2" id="text-3">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ocaml-and-opam-container-images-updated-new-fedora-alpine-ubuntu-images/5539/1">https://discuss.ocaml.org/t/ocaml-and-opam-container-images-updated-new-fedora-alpine-ubuntu-images/5539/1</a>
</p>
</div>

<div id="outline-container-orgefe513d" class="outline-3">
<h3 id="orgefe513d">Anil Madhavapeddy announced</h3>
<div class="outline-text-3" id="text-orgefe513d">
<p>
The Docker <a href="https://hub.docker.com/r/ocaml/opam2">ocaml and opam container images</a> have been updated:
</p>

<ul class="org-ul">
<li>Alpine 3.11, Fedora 31 and Ubuntu 20.04 (beta) are now included.</li>
<li>Ubuntu 19.04 and Fedora 29 and 30 are now deprecated.</li>
<li>OCaml 4.09.1 and 4.11.0~dev have been refreshed.</li>
</ul>

<p>
You can find the full details of the container images available <a href="https://github.com/ocaml/infrastructure/wiki/Containers">on the OCaml infrastructure
wiki</a>.
</p>

<p>
The containers are generated from a set of scripts using
<a href="https://github.com/avsm/ocaml-dockerfile">ocaml-dockerfile</a>, and will be migrating over the next six months to use
an <a href="https://ocurrent.org">ocurrent</a>-based infrastructure. There will be an announcement on this forum about any
user-facing changes that involves, with plenty of time to transition your own CIs over.  Thanks go to @talex5 and
@XVilka for contributions to this round of updates.
</p>
</div>
</div>
</div>




<div id="outline-container-org47a4285" class="outline-2">
<h2 id="4">OCamlformat 0.14.0</h2>
<div class="outline-text-2" id="text-4">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-ocamlformat-0-14-0/5435/24">https://discuss.ocaml.org/t/ann-ocamlformat-0-14-0/5435/24</a>
</p>
</div>

<div id="outline-container-orgedbdf76" class="outline-3">
<h3 id="orgedbdf76">Jules announced</h3>
<div class="outline-text-3" id="text-orgedbdf76">
<p>
As Etienne mentioned, we have released OCamlformat 0.14.1, reverting the change to the defaults and our plans to
deprecate the <code>doc-comments</code> option.
</p>

<p>
For projects that already upgraded to 0.14.0 (eg. Coq), the <code>doc-comments</code> option will change its meaning again. It
is necessary to add <code>doc-comments=before</code> to have the documentation comments placed before.
Moreover, the new option <code>doc-comments-val</code> added in 0.14.0 has a higher precedence than <code>doc-comments</code>, even when
it's not set. It is thus necessary to set them both to <code>before</code> to have the old "before" behavior.
This will be improved in the next release (see <a href="https://github.com/ocaml-ppx/ocamlformat/pull/1340">https://github.com/ocaml-ppx/ocamlformat/pull/1340</a>).
</p>

<p>
Thank you to our early adopters to bear us. We are improving our release process to reduce confusion for the next
updates. As usual, if you have any feedback, please open an issue on <a href="https://github.com/ocaml-ppx/ocamlformat">https://github.com/ocaml-ppx/ocamlformat</a> to
discuss it with us.
</p>
</div>
</div>
</div>




<div id="outline-container-orgf2942e3" class="outline-2">
<h2 id="5">Hashconsing an AST via PPX</h2>
<div class="outline-text-2" id="text-5">
<p>
Archive: <a href="https://discuss.ocaml.org/t/hashconsing-an-ast-via-ppx/5558/1">https://discuss.ocaml.org/t/hashconsing-an-ast-via-ppx/5558/1</a>
</p>
</div>

<div id="outline-container-orgaec8e0e" class="outline-3">
<h3 id="orgaec8e0e">Chet Murthy announced</h3>
<div class="outline-text-3" id="text-orgaec8e0e">
<p>
[up-front (so nobody gets the wrong idea): I'm not pushing Camlp5.
Rather, I'm just noting that this sort of thing is really easy to do,
and I encourage someone to do something similar using the PPX
infrastructure.]
</p>

<p>
I didn't want to derail the "Future of PPX" thread, so I thought I'd
post separately to answer ivg@ 's issue about hashconsing of ASTs
using PPX.  It's actually [uh, I think] really, really easy to
implement hashconsing of ADTs, using a PPX extension.  On a lark, I
decided to do it <b>today</b>, and while the code I've got isn't sufficient
to use, I think it's not very far away, and I have the perfect
use-case already in-mind.  It took me two hours to implement the
rewriter and the testcase, on top of the other infrastructure, which
has no support for hashconsing of any sort.
</p>

<p>
Here are some examples of data-types and functions that are
automaticaly hash-consed.  The idea is that in the pattern-match the
pattern is annotated with a variable (in this example, "z"); the
expression that is supposed to be hash-consed against that pattern is
annotated with that same variable.  [The code that descends to the
expression is a little weak right now, but I think that's easily
fixable.]  The algorithm goes as follows:
</p>

<p>
(1) "decorate" the pattern with "as z_&lt;integer&gt;" variables everywhere
in constructors.  This allows us to refer to parts of the original
value.
</p>

<p>
(2) then find each expression that is marked with that same varable.
Structurally descend the pattern and the expression in parallel and
generate code to compare sub-structure and hashcons where appropriate.
</p>

<p>
And that's really it.  I'm sure this can be implemented using the PPX
tools.
</p>

<p>
Some comments: (1) what's nice, is that we can just take already-written
code like <code>List.map</code> and annotate it; that generates a hash-consed
version.  And since the generated code never uses deep structural
equality (only pointer-equality) it should be only marginally slower
than the original implementation.
</p>

<p>
(2) The variable in the annotation ("z") is used as the base for
generating a whole slew of fresh variables, and I don't bother (yet)
to check for clashes; this (again) is straightforward, but hey, I
started two hours ago.
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">type</span> <span style="color: #228b22;">t</span> = <span style="color: #000000; background-color: #ffffff;">Leaf</span> <span style="color: #a020f0;">of</span> int | <span style="color: #000000; background-color: #ffffff;">Node</span> <span style="color: #a020f0;">of</span> t * int * t

<span style="color: #000000; font-weight: bold;">module</span> <span style="color: #228b22;">HCList</span> = <span style="color: #000000; font-weight: bold;">struct</span>

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #000000; font-weight: bold;">rec</span> <span style="color: #0000ff;">map</span> <span style="color: #a0522d;">f</span> = <span style="color: #a020f0;">function</span>
    <span style="color: #000000; background-color: #ffffff;">[]</span><span style="color: #483d8b;">[@hashrecons z]</span> -&gt; <span style="color: #000000; background-color: #ffffff;">[]</span><span style="color: #483d8b;">[@hashrecons z]</span>
  | (a<span style="color: #000000; background-color: #ffffff;">::</span>l)<span style="color: #483d8b;">[@hashrecons z]</span> -&gt; <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">r</span> = f a <span style="color: #000000; font-weight: bold;">in</span> ((r <span style="color: #000000; background-color: #ffffff;">::</span> map f l)<span style="color: #483d8b;">[@hashrecons z]</span>)

<span style="color: #000000; font-weight: bold;">end</span>

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">deep</span> =
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #000000; font-weight: bold;">rec</span> <span style="color: #a0522d;">deep</span> = (<span style="color: #a020f0;">function</span>
  <span style="color: #000000; background-color: #ffffff;">Leaf</span> n<span style="color: #483d8b;">[@hashrecons z]</span> -&gt; <span style="color: #000000; background-color: #ffffff;">Leaf</span> n<span style="color: #483d8b;">[@hashrecons z]</span>
| <span style="color: #000000; background-color: #ffffff;">Node</span> (l, n, r) <span style="color: #483d8b;">[@hashrecons z]</span> -&gt;
  <span style="color: #000000; background-color: #ffffff;">Node</span> (deep l, n, deep r) <span style="color: #483d8b;">[@hashrecons z]</span>
  )
<span style="color: #483d8b;">[@@ocaml.warning </span><span style="color: #8b2252;">"-26"</span><span style="color: #483d8b;">]</span>
<span style="color: #000000; font-weight: bold;">in</span> deep

<span style="color: #000000; font-weight: bold;">type</span> <span style="color: #228b22;">sexp</span> =
  | <span style="color: #000000; background-color: #ffffff;">Atom</span> <span style="color: #a020f0;">of</span> string
  | <span style="color: #000000; background-color: #ffffff;">List</span> <span style="color: #a020f0;">of</span> sexp list

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">sexp_deep</span> =
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #000000; font-weight: bold;">rec</span> <span style="color: #0000ff;">deep</span> = <span style="color: #a020f0;">function</span>
      <span style="color: #000000; background-color: #ffffff;">Atom</span> s<span style="color: #483d8b;">[@hashrecons z]</span> -&gt; <span style="color: #000000; background-color: #ffffff;">Atom</span> s<span style="color: #483d8b;">[@hashrecons z]</span>
    | <span style="color: #000000; background-color: #ffffff;">List</span> l<span style="color: #483d8b;">[@hashrecons z]</span> -&gt; <span style="color: #000000; background-color: #ffffff;">List</span> (<span style="color: #228b22;">HCList.</span>map deep l)<span style="color: #483d8b;">[@hashrecons z]</span>
  <span style="color: #000000; font-weight: bold;">in</span> deep
</pre>
</div>

<p>
Links: First, at the commit, so they won't change
</p>

<p>
the testcase file:
<a href="https://github.com/chetmurthy/pa_ppx/commit/5dd6b2ef3ca3677e11a0ad696074200101bd661f#diff-e6dffe78fc6c27bdffa41970c4a7f1ca">https://github.com/chetmurthy/pa_ppx/commit/5dd6b2ef3ca3677e11a0ad696074200101bd661f#diff-e6dffe78fc6c27bdffa41970c4a7f1ca</a>
</p>

<p>
the "ppx rewriter":
<a href="https://github.com/chetmurthy/pa_ppx/commit/5dd6b2ef3ca3677e11a0ad696074200101bd661f#diff-24aeaf51366017948f5735727f001c85">https://github.com/chetmurthy/pa_ppx/commit/5dd6b2ef3ca3677e11a0ad696074200101bd661f#diff-24aeaf51366017948f5735727f001c85</a>
</p>

<p>
Second, the files with human-readable names, etc.:
</p>

<p>
the testcase: <a href="https://github.com/chetmurthy/pa_ppx/blob/master/tests/test_hashrecons.ml">https://github.com/chetmurthy/pa_ppx/blob/master/tests/test_hashrecons.ml</a>
</p>

<p>
the "ppx rewriter": <a href="https://github.com/chetmurthy/pa_ppx/blob/master/pa_hashrecons/pa_hashrecons.ml">https://github.com/chetmurthy/pa_ppx/blob/master/pa_hashrecons/pa_hashrecons.ml</a>
</p>

<p>
The projects:
</p>

<p>
chetmurthy/pa_ppx: A reimplementation of ppx_deriving, all its plugins, ppx_import, and a
few others.
</p>

<p>
<a href="https://github.com/chetmurthy/pa_ppx">https://github.com/chetmurthy/pa_ppx</a>
</p>

<p>
chetmurthy/camlp5: Camlp5, version pre-8.00 on which the above is based.  This is on the branch
26.attempt-pa-deriving .
</p>
</div>
</div>


<div id="outline-container-org410e82d" class="outline-3">
<h3 id="org410e82d">Kakadu said</h3>
<div class="outline-text-3" id="text-org410e82d">
<p>
I experimented with this some time ago for ML workshop.
The idea was to provide function: <code>t -&gt; htbl -&gt; htbl * t</code> which rewrites value of type <code>t</code> by removing equal
subtrees. Essentially it is just a fold over data type.
</p>

<p>
<a href="https://github.com/kakadu/GT/blob/master/regression/test816hash.ml#L74">https://github.com/kakadu/GT/blob/master/regression/test816hash.ml#L74</a>
</p>
</div>
</div>


<div id="outline-container-orgfd549b4" class="outline-3">
<h3 id="orgfd549b4">Chet Murthy asked and Josh Berdine replied</h3>
<div class="outline-text-3" id="text-orgfd549b4">
<blockquote>
<p>
If you wanna use a hashtable (and, I presume, Obj.magic) you can write a single function that does the trick for all immutable data-types, right?
</p>
</blockquote>

<p>
Yes, we have some magic @mbouaziz
<a href="https://github.com/facebook/infer/blob/master/infer/src/istd/MaximumSharing.ml">code</a> in Infer that does this to
create as much sharing as possible as values are Marshaled out.
</p>
</div>
</div>
</div>




<div id="outline-container-orgb191b83" class="outline-2">
<h2 id="6">Genprint v0.4</h2>
<div class="outline-text-2" id="text-6">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-genprint-v0-4/5575/1">https://discuss.ocaml.org/t/ann-genprint-v0-4/5575/1</a>
</p>
</div>

<div id="outline-container-org6d50325" class="outline-3">
<h3 id="org6d50325">progman announced</h3>
<div class="outline-text-3" id="text-org6d50325">
<p>
A re-announcement of Genprint, a general value printing library, that addresses prior limitations that made it none
too useful!
</p>

<ol class="org-ol">
<li>It didn't work correctly for 4.08.0, the latest compiler release as of first announcement (though fine for 4.02 .. 4.07.1)</li>
<li>There was an awkward need to specify a search path for .cmt files when working with the likes of Dune (which uses separate directories for source, .cmi and (for opt) .cmt files)</li>
<li>More often than not values of interest would display simply as <code>&lt;abstr&gt;</code> owing to the presence of signature abstraction of the module's type of interest.</li>
</ol>

<p>
These issues have been addressed:
</p>
<ol class="org-ol">
<li>Works with versions 4.04 .. 4.10.0  (earlier versions became invalid after a dependency change to ppxlib)</li>
<li>The location of .cmt files is captured automatically by the PPX preprocessor.</li>
<li><p>
Signatures at the implementation level (.mli files) and internally (functor application constraints) are removed to reveal the inner structure of otherwise abstract values.
For instance, the Ephemeron module:
</p>
<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">module</span> <span style="color: #228b22;">EM</span>=<span style="color: #228b22;">Ephemeron.K1.Make</span>(<span style="color: #000000; font-weight: bold;">struct</span> <span style="color: #000000; font-weight: bold;">type</span> <span style="color: #228b22;">t</span>=int <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">equal</span>=(<span style="color: #0000ff;">=</span>) <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">hash</span>=<span style="color: #228b22;">Hashtbl.</span>hash <span style="color: #000000; font-weight: bold;">end</span>)
<span style="color: #000000; font-weight: bold;">open </span><span style="color: #228b22;">EM</span>
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">_</span>=
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">v</span>=<span style="color: #228b22;">EM.</span>create 0 <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #228b22;">EM.</span>add v 12345678 <span style="color: #8b2252;">'X'</span>;
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">emprint</span> <span style="color: #a0522d;">ppf</span> (<span style="color: #a0522d;">v</span>:<span style="color: #228b22;"> Obj.Ephemeron.t</span>) =
    <span style="color: #228b22;">Format.</span>fprintf ppf <span style="color: #8b2252;">"&lt;C wrapper of key/data&gt;"</span> <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #483d8b; background-color: #ebebeb;">[%install_printer</span> emprint<span style="color: #483d8b; background-color: #ebebeb;">]</span>;
  <span style="color: #483d8b; background-color: #ebebeb;">[%pr</span> ephem v<span style="color: #483d8b; background-color: #ebebeb;">]</span>;
</pre>
</div>

<p>
Which prints:
</p>
<pre class="example">
ephem =&gt; {size = 1;
          data =
           [|Empty; Empty; Empty; Empty; Empty; Empty; Empty; Empty; Empty;
             Empty; Empty; Cons (922381915, &lt;C wrapper of key/data&gt;, Empty);
             Empty; Empty; Empty; Empty|];
          seed = 0; initial_size = 16}
</pre>
<p>
This also demos the [%install_printer] facility which mirrors the REPL's.
</p></li>
</ol>

<p>
Installation is via the Opam main repository.
</p>

<p>
Additionally, the project repository <a href="https://github.com/progman1/genprintlib/tree/master/debugger">contains</a> two
compiler versions of <span class="underline">ocamldebug</span> integrated with the Genprint library which thereby becomes its default printer.
</p>

<p>
All of which makes this library much more useful than previously.
See the <a href="https://github.com/progman1/genprintlib">project page</a> for the details.
</p>
</div>
</div>
</div>




<div id="outline-container-org831cee3" class="outline-2">
<h2 id="7">Other OCaml News</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-orgc518a3e" class="outline-3">
<h3 id="orgc518a3e">From the ocamlcore planet blog</h3>
<div class="outline-text-3" id="text-orgc518a3e">
<p>
Editor note: Thanks to <a href="https://github.com/c-cube/ezcurl">ezcurl</a>, I can restore this section. I'm putting all the links this week, I will prune to only put the new ones next week.
</p>

<p>
Here are links from many OCaml blogs aggregated at <a href="http://ocaml.org/community/planet/">OCaml Planet</a>.
</p>

<ul class="org-ul">
<li><a href="http://www.ocamlpro.com/2020/03/23/ocaml-new-best-fit-garbage-collector/">An in-depth Look at OCaml’s new “Best-fit” Garbage Collector Strategy</a></li>
<li><a href="http://psellos.com/2020/03/2020.03.how-i-wrote-elastic-man.html">Sliding Tile Puzzle, Self-Contained OCaml Webapp</a></li>
<li><a href="http://www.ocamlpro.com/2020/03/16/new-version-of-try-ocaml-in-beta/">New version of Try OCaml in beta!</a></li>
<li><a href="http://frama-c.com/index.html">Frama-Clang 0.0.8 is out. Download it here.</a></li>
<li><a href="https://drup.github.io/2020/03/06/tyxml440/">A reasonable TyXML release | Drup's thingies</a></li>
<li><a href="http://www.ocamlpro.com/2020/03/03/alt-ergo-userss-club-annual-meeting/">Alt-Ergo Users’ Club Annual Meeting</a></li>
<li><a href="http://psellos.com/2020/02/2020.02.kid-charlemagne.html">OCaml iOS Apps Ported to Browser</a></li>
<li><a href="https://blog.janestreet.com/watch-all-of-jane-streets-tech-talks/">Watch all of Jane Street's tech talks</a></li>
<li><a href="http://blog.0branch.com/posts/2020-02-15-prettyconfig-extension.html">Mercurial: prettyconfig extension</a></li>
<li><a href="http://blog.0branch.com/posts/2020-02-05-hg-extensions.html">Mercurial extensions (update)</a></li>
<li><a href="http://www.ocamlpro.com/2020/02/04/2019-at-ocamlpro/">2019 at OCamlPro</a></li>
<li><a href="http://blog.0branch.com/posts/2020-02-03-bitbucket-migration.html">Bitbucket repository migration</a></li>
<li><a href="https://blog.janestreet.com/troubleshooting-systemd-with-systemtap/">Troubleshooting systemd with SystemTap</a></li>
<li><a href="https://ocsigen.github.io/blog/2020/01/20/release/">Ocsigen Start updated</a></li>
<li><a href="https://ocsigen.github.io/blog/2020/01/20/release/">Ocsigen Start updated</a></li>
<li><a href="http://www.ocamlpro.com/2020/01/16/opam-2-0-6-release/">opam 2.0.6 release</a></li>
<li><a href="https://opam.ocaml.org/blog/opam-2-0-6/">opam 2.0.6 release</a></li>
<li><a href="https://mirage.io/blog/ccc-2019-leipzig">Hackers and climate activists join forces in Leipzig</a></li>
<li><a href="https://hannes.nqsb.io/Posts/DnsServer">Deploying authoritative OCaml-DNS servers as MirageOS unikernels</a></li>
<li><a href="https://hannes.nqsb.io/Posts/ReproducibleOPAM">Reproducible MirageOS unikernel builds</a></li>
<li><a href="https://blog.janestreet.com/using-python-and-ocaml-in-the-same-jupyter-notebook/">Using Python and OCaml in the same Jupyter notebook</a></li>
<li><a href="https://coq.inria.fr/news/coq-8-11beta1-is-out.html">Coq 8.11+beta1 is out</a></li>
<li><a href="https://blog.janestreet.com/deep-learning-the-hardest-go-problem-in-the-world/">Deep-Learning the Hardest Go Problem in the World</a></li>
<li><a href="http://frama-c.com/index.html">Frama-C 20.0 (Calcium) is out. Download it here.</a></li>
<li><a href="http://gallium.inria.fr/blog/an-ocaml-release-story-1">Testing OCaml releases with opamcheck</a></li>
<li><a href="https://coq.inria.fr/news/coq-8-10-2-is-out.html">Coq 8.10.2 is out</a></li>
<li><a href="https://mirage.io/blog/introducing-irmin-v2">Announcing Irmin 2.0.0</a></li>
<li><a href="http://binaryanalysisplatform.github.io/bap-2-release">BAP 2.0 is released</a></li>
<li><a href="https://roscidus.com/blog/blog/2019/11/14/cicd-pipelines/">CI/CD pipelines: Monad, Arrow or Dart?</a></li>
<li><a href="http://math.andrej.com/2019/11/07/on-fixed-point-theorems-in-synthetic-computability/">On fixed-point theorems in synthetic computability</a></li>
<li><a href="http://math.andrej.com/2019/10/28/runners-in-action/">Runners in action</a></li>
<li><a href="https://coq.inria.fr/news/coq-8-10-1-is-out.html">Coq 8.10.1 is out</a></li>
<li><a href="https://mirage.io/blog/announcing-mirage-36-release">Announcing MirageOS 3.6.0</a></li>
<li><a href="https://blog.janestreet.com/commas-in-big-numbers-everywhere/">Commas in big numbers everywhere: An OpenType adventure</a></li>
<li><a href="https://coq.inria.fr/news/coq-8-10-0-is-out.html">Coq 8.10.0 is out</a></li>
<li><a href="http://www.ocamlpro.com/2019/09/25/ocaml-expert-and-beginner-training-by-ocamlpro-in-french-nov-5-6-7-8/">OCaml expert and beginner training by OCamlPro (in French): Nov. 5-6 &amp; 7-8</a></li>
<li><a href="https://tarides.com/blog/2019-09-25-mr-mime-parse-and-generate-emails.html">Mr. MIME - Parse and generate emails</a></li>
<li><a href="http://www.ocamlpro.com/2019/09/20/a-look-back-on-ocaml/">A look back on OCaml since 2011</a></li>
<li><a href="http://frama-c.com/index.html">Frama-C 19.1 (Potassium) is out. Download ithere.</a></li>
<li><a href="https://coq.inria.fr/news/coq-8-10beta3-is-out.html">Coq 8.10+beta3 is out</a></li>
<li><a href="http://www.ocamlpro.com/2019/09/13/updated-cheat-sheets-ocaml-language-and-ocaml-standard-library/">Updated Cheat Sheets: OCaml Language and OCaml Standard Library</a></li>
<li><a href="http://frama-c.com/index.html">Frama-Clang 0.0.7 is out. Download ithere.</a></li>
<li><a href="https://tarides.com/blog/2019-09-13-decompress-experiences-with-ocaml-optimization.html">Decompress: Experiences with OCaml optimization</a></li>
<li><a href="http://math.andrej.com/2019/09/09/on-complete-ordered-fields/">On complete ordered fields</a></li>
<li><a href="https://tarides.com/blog/2019-09-04-an-introduction-to-fuzzing-ocaml-with-afl-crowbar-and-bun.html">An introduction to fuzzing OCaml with AFL, Crowbar and Bun</a></li>
<li><a href="http://math.andrej.com/2019/09/03/what-is-algebraic-about-algebraic-effects/">What is algebraic about algebraic effects?</a></li>
<li><a href="http://math.andrej.com/2019/09/03/the-blog-moved-from-wordpress-to-jekyll/">The blog moved from Wordpress to Jekyll</a></li>
<li><a href="http://www.ocamlpro.com/2019/08/30/ocamlpros-compiler-team-work-update/">OCamlPro’s compiler team work update</a></li>
<li><a href="https://blog.janestreet.com/what-the-interns-have-wrought-2019/">What the interns have wrought, 2019 edition</a></li>
<li><a href="https://tarides.com/blog/2019-08-26-decompress-the-new-decompress-api.html">Decompress: The New Decompress API</a></li>
</ul>
</div>
</div>
</div>




<div id="outline-container-org1f62c6f" class="outline-2">
<h2 id="org1f62c6f">Old CWN</h2>
<div class="outline-text-2" id="text-org1f62c6f">
<p>
If you happen to miss a CWN, you can <a href="mailto:alan.schmitt@polytechnique.org">send me a message</a> and I'll mail it to you, or go take a look at <a href="http://alan.petitepomme.net/cwn/">the archive</a> or the <a href="http://alan.petitepomme.net/cwn/cwn.rss">RSS feed of the archives</a>.
</p>

<p>
If you also wish to receive it every week by mail, you may subscribe <a href="http://lists.idyll.org/listinfo/caml-news-weekly/">online</a>.
</p>

<div class="authorname">
<p>
<a href="http://alan.petitepomme.net/">Alan Schmitt</a>
</p>

</div>
</div>
</div>
</div>
</body>
</html>
