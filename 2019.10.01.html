<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2019-10-01 Tue 15:43 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OCaml Weekly News</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<style type="text/css">#table-of-contents h2 { display: none } .title { display: none } .authorname { text-align: right }</style>
<style type="text/css">.outline-2 {border-top: 1px solid black;}</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">OCaml Weekly News</h1>
<p>
<a href="http://alan.petitepomme.net/cwn/2019.09.24.html">Previous Week</a> <a href="http://alan.petitepomme.net/cwn/index.html">Up</a> <a href="http://alan.petitepomme.net/cwn/2019.10.08.html">Next Week</a>
</p>

<p>
Hello
</p>

<p>
Here is the latest OCaml Weekly News, for the week of September 24 to October 01, 2019.
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#1">How does one print any type?</a></li>
<li><a href="#2">Category theory for Programmers book - OCaml flavor</a></li>
<li><a href="#3">Today's trick : memory limits with Gc alarms</a></li>
<li><a href="#4">Arch Linux installer written in OCaml</a></li>
<li><a href="#5">First release of mrmime, parser and generator of emails</a></li>
<li><a href="#6">First release of data-encoding, JSON and binary serialisation</a></li>
<li><a href="#7">Release of Easy_logging v0.6</a></li>
<li><a href="#8">soupault: a static website generator based on HTML rewriting</a></li>
<li><a href="#9">Update on the big ppx refactoring project</a></li>
<li><a href="#10">Simplify roman utf8</a></li>
<li><a href="#11">Rfsm 1.6.0</a></li>
<li><a href="#12">Ocaml-protoc-plugin 0.9: A protobuf compiler</a></li>
<li><a href="#org61b0c0f">Old CWN</a></li>
</ul>
</div>
</div>


<div id="outline-container-orga88e779" class="outline-2">
<h2 id="1">How does one print any type?</h2>
<div class="outline-text-2" id="text-1">
<p>
Archive: <a href="https://discuss.ocaml.org/t/how-does-one-print-any-type/4362/9">https://discuss.ocaml.org/t/how-does-one-print-any-type/4362/9</a>
</p>
</div>

<div id="outline-container-orgc01763a" class="outline-3">
<h3 id="orgc01763a">Continuing this thread, Rwmjones announced</h3>
<div class="outline-text-3" id="text-orgc01763a">
<p>
One way to do this is to iterate over the runtime structure. You can get quite
good information out of this, although it's not a complete view of the compile
time types by any means. I wrote a utility to do this called Dumper:
<a href="https://web.archive.org/web/20101101234304/http://merjis.com/developers/dumper">https://web.archive.org/web/20101101234304/http://merjis.com/developers/dumper</a>
</p>

<p>
It's pure OCaml and doesn't require any libraries, weird syntax, modifications
to your source code or anything like that.
</p>
</div>
</div>
</div>




<div id="outline-container-org20211f2" class="outline-2">
<h2 id="2">Category theory for Programmers book - OCaml flavor</h2>
<div class="outline-text-2" id="text-2">
<p>
Archive: <a href="https://discuss.ocaml.org/t/category-theory-for-programmers-book-ocaml-flavor/3905/2">https://discuss.ocaml.org/t/category-theory-for-programmers-book-ocaml-flavor/3905/2</a>
</p>
</div>

<div id="outline-container-org4d5b39e" class="outline-3">
<h3 id="org4d5b39e">Continuing this thread, Anton Kochkov said</h3>
<div class="outline-text-3" id="text-org4d5b39e">
<p>
<b>Update</b> : work-in-progress <a href="https://github.com/hmemcpy/milewski-ctfp-pdf/pull/201">pull request - #201</a> to the main repository - completely translated Parts 1 and 2. Only one, last, part remained.
</p>
</div>
</div>
</div>




<div id="outline-container-org9ae8293" class="outline-2">
<h2 id="3">Today's trick : memory limits with Gc alarms</h2>
<div class="outline-text-2" id="text-3">
<p>
Archive: <a href="https://discuss.ocaml.org/t/todays-trick-memory-limits-with-gc-alarms/4431/1">https://discuss.ocaml.org/t/todays-trick-memory-limits-with-gc-alarms/4431/1</a>
</p>
</div>

<div id="outline-container-org711c0f3" class="outline-3">
<h3 id="org711c0f3">Guillaume Munch-Maccagnoni announced</h3>
<div class="outline-text-3" id="text-org711c0f3">
<p>
Hello, today's little known OCaml feature we will learn about are memory limits using Gc alarms.
</p>

<p>
Imagine you want to perform a memory-heavy computation, whose size of data set is not known in advance. (This post is inspired by the implementation of the SAT/SMT solver <a href="https://github.com/Gbury/mSAT">mSAT</a>.) You would like this computation to fail gracefully if memory becomes insufficient. How can you do it?
</p>
</div>

<div id="outline-container-orge41384f" class="outline-4">
<h4 id="orge41384f">The <code>Out_of_memory</code> exception</h4>
<div class="outline-text-4" id="text-orge41384f">
<p>
The first thing you might think about is the <code>Out_of_memory</code> exception. You simply run the computation inside an exception handler, expecting to receive this exception if memory ever becomes exhausted. However, for several reasons this is not reliable. First, the program is not always notified of failing allocations and gets killed instead much after, when it tries to access the memory for the first time (this behaviour of the operating system is called overcommitting). But this is the least problem, because you quickly figure out how to get rid of overcommitting, for instance by setting a hard memory limit to your process using <code>ulimit</code>.
</p>

<p>
However, you then encounter the second issue: in OCaml, if a minor allocation fails, then the program will issue a fatal error instead of raising <code>Out_of_memory</code>. That's it: <code>Out_of_memory</code> is only reliable for allocations that are guaranteed to go directly on the major heap (by default those bigger than 256 words, or those performed for bigarrays or unmarshalling). Not for repeated small allocations on the minor heap, which would represent most allocations in a functional program. (There are bug reports about this, but making <code>Out_of_memory</code> reliable is reported to be non-trivial.)
</p>
</div>
</div>

<div id="outline-container-org481bcba" class="outline-4">
<h4 id="org481bcba">GC alarms</h4>
<div class="outline-text-4" id="text-org481bcba">
<p>
GC alarms are callbacks which run at the end of major GC cycles. They are registered with <code>Gc.create_alarm</code>. Now observe this cool trick:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">run_with_memory_limit</span> <span style="color: #a0522d;">limit</span> <span style="color: #a0522d;">f</span> =
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">limit_memory</span> () =
    <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">mem</span> = <span style="color: #228b22;">Gc.</span>(quick_stat ()).heap_words <span style="color: #000000; font-weight: bold;">in</span>
    <span style="color: #a020f0;">if</span> mem &gt; limit / (<span style="color: #228b22;">Sys.</span>word_size / 8) <span style="color: #a020f0;">then</span> <span style="color: #483d8b;">raise</span> <span style="color: #483d8b;">Out_of_memory</span>
  <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">alarm</span> = <span style="color: #228b22;">Gc.</span>create_alarm limit_memory <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #228b22;">Fun.</span>protect f <span style="color: #008b8b;">~finally</span>:(<span style="color: #a020f0;">fun</span> () -&gt; <span style="color: #228b22;">Gc.</span>delete_alarm alarm ; <span style="color: #228b22;">Gc.</span>compact ())
</pre>
</div>
<p>
That's it, we simply raise <code>Out_of_memory</code> from the Gc alarm. You can try it in the toplevel on a memory-hungry function:
</p>
<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">f</span> () =
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">x</span> = <span style="color: #483d8b;">ref</span> <span style="color: #000000; background-color: #ffffff;">[]</span> <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #000000; font-weight: bold;">rec</span> <span style="color: #0000ff;">f</span> () = x := ()::<span style="color: #a52a2a;">!</span>x ; f () <span style="color: #000000; font-weight: bold;">in</span>
  f ()<span style="color: #ff4500;">;;</span>
run_with_memory_limit 1000000000 f<span style="color: #ff4500;">;;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd866495" class="outline-4">
<h4 id="orgd866495">Caveat</h4>
<div class="outline-text-4" id="text-orgd866495">
<p>
This is not reliable with multi-threaded programs, because we do not know in which thread the exception must be raised. This is fine for programs like mSAT and many logic/language tools, because such tools are rarely limited by blocking IO, so they do not lose much by remaining single-threaded in the absence of true parallelism. (Haskell proposes per-thread allocation limits as a built-in feature, which manifests itself likewise as an asynchronous exception.)
</p>
</div>
</div>

<div id="outline-container-org5681749" class="outline-4">
<h4 id="org5681749">Implementation</h4>
<div class="outline-text-4" id="text-org5681749">
<p>
Behind each Gc alarm, there is a finalised block. The finaliser calls the callback, and sets itself to run again at the next cycle. Thus, the memory limit (thus implemented) is an example of asynchronous exception usefully arising from a finaliser. Was such a use of Gc alarms expected when they were conceived? History did not tell.
</p>
</div>
</div>
</div>


<div id="outline-container-org01e57c5" class="outline-3">
<h3 id="org01e57c5">Guillaume Bury then said</h3>
<div class="outline-text-3" id="text-org01e57c5">
<p>
As the author of mSAT, I'd just like to say the trick of using gc alarms to implement a memory limit in mSAT was actually taken from the theorem prover <a href="http://zenon.inria.fr/">zenon</a>, where if I remember correctly it was written by @damiendoligez , which might explain the subtle use of alarms/finalisers ^^
</p>

<p>
Also, as a side note, for people who would like to implement a similar limit but for computation time, I'd advise against using alarms (as is done in the code of zenon iirc) as they have proven to be somewhat not reliable, and I've found using Unix timers to raise an <code>Out_of_time</code> exception much better:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">run_with_time_limit</span> <span style="color: #a0522d;">limit</span> <span style="color: #a0522d;">f</span> =
  <span style="color: #b22222;">(* </span><span style="color: #b22222;">create a Unix timer timer </span><span style="color: #b22222;">*)</span>
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">_</span> = <span style="color: #228b22;">Unix.</span>setitimer <span style="color: #228b22;">Unix.</span><span style="color: #000000; background-color: #ffffff;">ITIMER_REAL</span> <span style="color: #228b22;">Unix.</span>{it_value = limit; it_interval = 0.01 } <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #b22222;">(* </span><span style="color: #b22222;">The Unix.timer works by sending a Sys.sigalrm, so in order to use it,</span>
<span style="color: #b22222;">     we catch it and raise the Out_of_time exception. </span><span style="color: #b22222;">*)</span>
  <span style="color: #000000; font-weight: bold;">let</span> () =
    <span style="color: #228b22;">Sys.</span>set_signal <span style="color: #228b22;">Sys.</span>sigalrm (
      <span style="color: #228b22;">Sys.</span><span style="color: #000000; background-color: #ffffff;">Signal_handle</span> (<span style="color: #a020f0;">fun</span> <span style="color: #a0522d;">_</span> -&gt;
          <span style="color: #483d8b;">raise</span> <span style="color: #000000; background-color: #ffffff;">Out_of_time</span>)
      ) <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #228b22;">Fun.</span>protect f <span style="color: #008b8b;">~finally</span>:(<span style="color: #a020f0;">fun</span> () -&gt;
    <span style="color: #228b22;">Unix.</span>setitimer <span style="color: #228b22;">Unix.</span><span style="color: #000000; background-color: #ffffff;">ITIMER_REAL</span> <span style="color: #228b22;">Unix.</span>{it_value = 0.; it_interval = 0. }
  )
</pre>
</div>
</div>
</div>
</div>




<div id="outline-container-org9fb675f" class="outline-2">
<h2 id="4">Arch Linux installer written in OCaml</h2>
<div class="outline-text-2" id="text-4">
<p>
Archive: <a href="https://discuss.ocaml.org/t/arch-linux-installer-written-in-ocaml/4388/11">https://discuss.ocaml.org/t/arch-linux-installer-written-in-ocaml/4388/11</a>
</p>
</div>

<div id="outline-container-orgf51e557" class="outline-3">
<h3 id="orgf51e557">Darren announced</h3>
<div class="outline-text-3" id="text-orgf51e557">
<p>
Static binary builds are now available <a href="https://github.com/darrenldl/ocaml-linux-installer/releases">here</a> (renamed repo as well).
</p>

<p>
They are built via Travis CI using the <code>ocaml/opam2:alpine</code> docker image, so the binary should be fully static and run fine on the live CD.
</p>

<p>
Added other stuff
</p>
<ul class="org-ul">
<li>Added disk layout for system partition + USB key</li>
<li>Code for installing hardened kernel</li>
</ul>

<p>
Note that it's not well tested at all, so don't use it for anything too serious yet.
</p>
</div>
</div>
</div>




<div id="outline-container-org02db49f" class="outline-2">
<h2 id="5">First release of mrmime, parser and generator of emails</h2>
<div class="outline-text-2" id="text-5">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-first-release-of-mrmime-parser-and-generator-of-emails/4436/1">https://discuss.ocaml.org/t/ann-first-release-of-mrmime-parser-and-generator-of-emails/4436/1</a>
</p>
</div>

<div id="outline-container-orge3ec565" class="outline-3">
<h3 id="orge3ec565">Calascibetta Romain announced</h3>
<div class="outline-text-3" id="text-orge3ec565">
<p>
We're glad to announce the first release of <a href="https://github.com/mirage/mrmime.git"><code>mrmime</code></a>, a parser and a generator of emails. This library provides an <span class="underline">OCaml way</span> to analyze and craft an email. The eventual goal is to build an entire <span class="underline">unikernel-compatible</span> stack for email (such as SMTP or IMAP).
</p>

<p>
In this article, we will show what is currently possible with <code>mrmime</code> and present a few of the useful libraries that we developed along the way.
</p>
</div>

<div id="outline-container-org740d484" class="outline-4">
<h4 id="org740d484">An email parser</h4>
<div class="outline-text-4" id="text-org740d484">
<p>
Some years ago, Romain gave <a href="https://www.youtube.com/watch?v=kQkRsNEo25k">a talk</a> about what an email really <span class="underline">is</span>. Behind the human-comprehensible format (or <span class="underline">rich-document</span> as we said a long time ago), there are several details of emails which complicate the process of analyzing them (and can be prone to security lapses). These details are mostly described by three RFCs:
</p>

<ul class="org-ul">
<li><a href="https://tools.ietf.org/html/rfc822">RFC822</a></li>
<li><a href="https://tools.ietf.org/html/rfc2822">RFC2822</a></li>
<li><a href="https://tools.ietf.org/html/rfc5322">RFC5322</a></li>
</ul>

<p>
Even though they are cross-compatible, providing full legacy email parsing is an archaeological exercise: each RFC retains support for the older design decisions (which were not recognized as bad or ugly in 1970 when they were first standardized).
</p>

<p>
The latest email-related RFC (RFC5322) tried to fix the issue and provide a better <a href="https://tools.ietf.org/html/rfc5234">formal specification</a> of the email format – but of course, it comes with plenty of <span class="underline">obsolete</span> rules which need to be implemented. In the standard, you find both the current grammar rule and its obsolete equivalent.
</p>
</div>

<ul class="org-ul">
<li><a id="org1ed77dd"></a>An extended email parser<br />
<div class="outline-text-5" id="text-org1ed77dd">
<p>
Even if the email format can defined by "only" 3 RFCs, you will miss email internationalization (<a href="https://tools.ietf.org/html/rfc6532">RFC6532</a>), the MIME format (<a href="https://tools.ietf.org/html/rfc2045">RFC2045</a>, <a href="https://tools.ietf.org/html/rfc2046">RFC2046</a>, <a href="https://tools.ietf.org/html/rfc2047">RFC2047</a>, <a href="https://tools.ietf.org/html/rfc2049">RFC2049</a>), or certain details needed to be interoperable with SMTP (<a href="https://tools.ietf.org/html/rfc5321">RFC5321</a>). There are still more RFCs which add extra features to the email format such as S/MIME or the Content-Disposition field.
</p>

<p>
Given this complexity, we took the most general RFCs and tried to provide an easy way to deal with them. The main difficulty is the <span class="underline">multipart</span> parser, which deals with email attachments (anyone who has tried to make an HTTP 1.1 parser knows about this).
</p>
</div>
</li>

<li><a id="org08ad6a5"></a>A realistic email parser<br />
<div class="outline-text-5" id="text-org08ad6a5">
<p>
Respecting the rules described by RFCs is not enough to be able to analyze any email from the real world: existing email generators can, and do, produce <span class="underline">non-compliant</span> email. We stress-tested <code>mrmime</code> by feeding it a batch of 2 billion emails taken from the wild, to see if it could parse everything (even if it does not produce the expected result). Whenever we noticed a recurring formatting mistake, we updated the details of the <a href="https://tools.ietf.org/html/rfc5234">ABNF</a> to enable <code>mrmime</code> to parse it anyway.
</p>
</div>
</li>

<li><a id="orgee7c939"></a>A parser usable by others<br />
<div class="outline-text-5" id="text-orgee7c939">
<p>
One demonstration of the usability of <code>mrmime</code> is <a href="https://github.com/dinosaure/ocaml-dkim.git"><code>ocaml-dkim</code></a>, which wants to extract a specific field from your mail and then verify that the hash and signature are as expected.
</p>

<p>
<code>ocaml-dkim</code> is used by the latest implementation of <a href="https://github.com/mirage/ocaml-dns.git"><code>ocaml-dns</code></a> to request public keys in order to verify email.
</p>

<p>
The most important question about <code>ocaml-dkim</code> is: is it able to verify your email in one pass? Indeed, currently some implementations of DKIM need 2 passes to verify your email (one to extract the DKIM signature, the other to digest some fields and bodies). We focused on verifying in a <span class="underline">single</span> pass in order to provide a unikernel SMTP <span class="underline">relay</span> with no need to store your email between verification passes.
</p>
</div>
</li>
</ul>
</div>

<div id="outline-container-org19c980d" class="outline-4">
<h4 id="org19c980d">An email generator</h4>
<div class="outline-text-4" id="text-org19c980d">
<p>
OCaml is a good language for making little DSLs for specialized use-cases. In this case, we took advantage of OCaml to allow the user to easily craft an email from nothing.
</p>

<p>
The idea is to build an OCaml value describing the desired email header, and then let the Mr. MIME generator transform this into a stream of characters that can be consumed by, for example, an SMTP implementation. The description step is quite simple:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #708090;">#require</span> <span style="color: #8b2252;">"mrmime"</span> <span style="color: #ff4500;">;;</span>
<span style="color: #708090;">#require</span> <span style="color: #8b2252;">"ptime.clock.os"</span> <span style="color: #ff4500;">;;</span>

<span style="color: #000000; font-weight: bold;">open </span><span style="color: #228b22;">Mrmime</span>

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">romain_calascibetta</span> =
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #000000; font-weight: bold;">open </span><span style="color: #228b22;">Mailbox</span> <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #228b22;">Local.</span>[ w <span style="color: #8b2252;">"romain"</span>; w <span style="color: #8b2252;">"calascibetta"</span> ] <span style="color: #a52a2a;">@</span> <span style="color: #228b22;">Domain.</span>(domain, [ a <span style="color: #8b2252;">"gmail"</span>; a <span style="color: #8b2252;">"com"</span> ])

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">john_doe</span> =
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #000000; font-weight: bold;">open </span><span style="color: #228b22;">Mailbox</span> <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #228b22;">Local.</span>[ w <span style="color: #8b2252;">"john"</span> ] <span style="color: #a52a2a;">@</span> <span style="color: #228b22;">Domain.</span>(domain, [ a <span style="color: #8b2252;">"doe"</span>; a <span style="color: #8b2252;">"org"</span> ])
  <span style="color: #a52a2a;">|&gt;</span> with_name <span style="color: #228b22;">Phrase.</span>(v [ w <span style="color: #8b2252;">"John"</span>; w <span style="color: #8b2252;">"D."</span> ])

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">now</span> () =
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #000000; font-weight: bold;">open </span><span style="color: #228b22;">Date</span> <span style="color: #000000; font-weight: bold;">in</span>
  of_ptime <span style="color: #008b8b;">~zone</span>:<span style="color: #228b22;">Zone.</span><span style="color: #000000; background-color: #ffffff;">GMT</span> (<span style="color: #228b22;">Ptime_clock.</span>now ())

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">subject</span> =
  <span style="color: #228b22;">Unstructured.</span>[ v <span style="color: #8b2252;">"A"</span>; sp 1; v <span style="color: #8b2252;">"Simple"</span>; sp 1; v <span style="color: #8b2252;">"Mail"</span> ]

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">header</span> =
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #000000; font-weight: bold;">open </span><span style="color: #228b22;">Header</span> <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #228b22;">Field.</span>(<span style="color: #000000; background-color: #ffffff;">Subject</span> <span style="color: #a52a2a;">$</span> subject)
  <span style="color: #a52a2a;">&amp;</span> <span style="color: #228b22;">Field.</span>(<span style="color: #000000; background-color: #ffffff;">Sender</span> <span style="color: #a52a2a;">$</span> romain_calascibetta)
  <span style="color: #a52a2a;">&amp;</span> <span style="color: #228b22;">Field.</span>(<span style="color: #000000; background-color: #ffffff;">To</span> <span style="color: #a52a2a;">$</span> <span style="color: #228b22;">Address.</span>[ mailbox john_doe ])
  <span style="color: #a52a2a;">&amp;</span> <span style="color: #228b22;">Field.</span>(<span style="color: #000000; background-color: #ffffff;">Date</span> <span style="color: #a52a2a;">$</span> now ())
  <span style="color: #a52a2a;">&amp;</span> empty

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">stream</span> = <span style="color: #228b22;">Header.</span>to_stream header

<span style="color: #000000; font-weight: bold;">let</span> () =
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #000000; font-weight: bold;">rec</span> <span style="color: #0000ff;">go</span> () =
    <span style="color: #a020f0;">match</span> stream () <span style="color: #a020f0;">with</span>
    | <span style="color: #000000; background-color: #ffffff;">Some</span> buf -&gt; print_string buf; go ()
    | <span style="color: #000000; background-color: #ffffff;">None</span> -&gt; ()
  <span style="color: #000000; font-weight: bold;">in</span>
  go ()
</pre>
</div>

<p>
This code produces the following header:
</p>

<div class="org-src-container">
<pre class="src src-mail">Date: 2 Aug 2019 14:10:10 GMT
<span style="color: #0000ff;">To:</span> John "D." <a href="mailto:john%40doe.org">&lt;john@doe.org&gt;</a>
Sender: romain.calascibetta@gmail.com
<span style="color: #b22222;">Subject:</span> A Simple Mail
</pre>
</div>
</div>

<ul class="org-ul">
<li><a id="org4d80ce2"></a>78-character rule<br />
<div class="outline-text-5" id="text-org4d80ce2">
<p>
One aspect about email and SMTP is about some historical rules of how to generate them. One of them is about the limitation of bytes per line. Indeed, a generator of mail should emit at most 80 bytes per line - and, of course, it should emits entirely the email line per line.
</p>

<p>
So <code>mrmime</code> has his own encoder which tries to wrap your mail into this limit. It was mostly inspired by <a href="https://github.com/inhabitedtype/faraday">Faraday</a> and <a href="https://caml.inria.fr/pub/docs/manual-ocaml/libref/Format.html">Format</a> powered with GADT to easily describe how to encode/generate parts of an email.
</p>
</div>
</li>

<li><a id="org7e1d601"></a>A multipart email generator<br />
<div class="outline-text-5" id="text-org7e1d601">
<p>
Of course, the main point about email is to be able to generate a multipart email - just to be able to send file attachments. And, of course, a deep work was done about that to make parts, compose them into specific <code>Content-Type</code> fields and merge them into one email.
</p>

<p>
Eventually, you can easily make a stream from it, which respects rules (78 bytes per line, stream line per line) and use it directly into an SMTP implementation.
</p>

<p>
This is what we did with the project <a href="https://github.com/dinosaure/facteur"><code>facteur</code></a>. It's a little command-line tool to send with file attachement mails in pure OCaml - but it works only on an UNIX operating system for instance.
</p>
</div>
</li>
</ul>
</div>

<div id="outline-container-orgba21303" class="outline-4">
<h4 id="orgba21303">Behind the forest</h4>
<div class="outline-text-4" id="text-orgba21303">
<p>
Even if you are able to parse and generate an email, more work is needed to get the expected results.
</p>

<p>
Indeed, email is a exchange unit between people and the biggest deal on that is to find a common way to ensure a understable communication each others. About that, encoding is probably the most important piece and when a French person wants to communicate with a <span class="underline">latin1</span> encoding, an American person can still use ASCII.
</p>
</div>

<ul class="org-ul">
<li><a id="org0a94688"></a>Rosetta<br />
<div class="outline-text-5" id="text-org0a94688">
<p>
So about this problem, the choice was made to unify any contents to UTF-8 as the most general encoding of the world. So, we did some libraries which map an encoding flow to Unicode code-point, and we use <a href="https://github.com/dbuenzli/uutf"><code>uutf</code></a> (thanks to <a href="https://github.com/dbuenzli">dbuenzli</a>) to normalize it to UTF-8.
</p>

<p>
The main goal is to avoid a headache to the user about that and even if contents of the mail is encoded with <span class="underline">latin1</span> we ensure to translate it correctly (and according RFCs) to UTF-8.
</p>

<p>
This project is <a href="https://github.com/mirage/rosetta"><code>rosetta</code></a> and it comes with:
</p>
<ul class="org-ul">
<li><a href="https://github.com/mirage/uuuu"><code>uuuu</code></a> for ISO-8859 encoding</li>
<li><a href="https://github.com/mirage/coin"><code>coin</code></a> for KOI8-{R,U} encoding</li>
<li><a href="https://github.com/mirage/yuscii"><code>yuscii</code></a> for UTF-7 encoding</li>
</ul>
</div>
</li>

<li><a id="org9a68ab6"></a>Pecu and Base64<br />
<div class="outline-text-5" id="text-org9a68ab6">
<p>
Then, bodies can be encoded in some ways, 2 precisely (if we took the main standard):
</p>
<ul class="org-ul">
<li>A base64 encoding, used to store your file</li>
<li>A quoted-printable encoding</li>
</ul>

<p>
So, about the <code>base64</code> package, it comes with a sub-package <code>base64.rfc2045</code> which respects the special case to encode a body according RFC2045 and SMTP limitation.
</p>

<p>
Then, <code>pecu</code> was made to encode and decode <span class="underline">quoted-printable</span> contents. It was tested and fuzzed of course like any others MirageOS's libraries.
</p>

<p>
These libraries are needed for an other historical reason which is: bytes used to store mail should use only 7 bits instead of 8 bits. This is the purpose of the base64 and the <span class="underline">quoted-printable</span> encoding which uses only 127 possibilities of a byte. Again, this limitation comes with SMTP protocol.
</p>
</div>
</li>
</ul>
</div>

<div id="outline-container-orgb84f307" class="outline-4">
<h4 id="orgb84f307">Conclusion</h4>
<div class="outline-text-4" id="text-orgb84f307">
<p>
<code>mrmime</code> is tackling the difficult task to parse and generate emails according to 50 years of usability, several RFCs and legacy rules. So, it still is an experimental project. We reach the first version of it because we are currently able to parse many mails and then generate them correctly.
</p>

<p>
Of course, a <span class="underline">bug</span> (a malformed mail, a server which does not respect standards or a bad use of our API) can appear easily where we did not test everything. But we have the feeling it it was the time to release it and let people to use it.
</p>

<p>
The best feedback about <code>mrmime</code> and the best improvement is yours. So don't be afraid to use it and start to hack your emails with it.
</p>

<p>
<b>cross-post to <a href="https://tarides.com/blog/2019-09-25-mr-mime-parse-and-generate-emails.html">Tarides's blog</a></b>
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-orgaa162e8" class="outline-2">
<h2 id="6">First release of data-encoding, JSON and binary serialisation</h2>
<div class="outline-text-2" id="text-6">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-first-release-of-data-encoding-json-and-binary-serialisation/4444/1">https://discuss.ocaml.org/t/ann-first-release-of-data-encoding-json-and-binary-serialisation/4444/1</a>
</p>
</div>

<div id="outline-container-org15d704b" class="outline-3">
<h3 id="org15d704b">Raphaël Proust announced</h3>
<div class="outline-text-3" id="text-org15d704b">
<p>
On behalf of Nomadic Labs, I'm pleased to announce the first public release of <code>data-encoding</code>: a library to encode and decode values to JSON or binary format. <code>data-encoding</code> provides fine grained control over the representation of the data, documentation generation, and detailed encoding/decoding errors.
</p>

<p>
In the <a href="https://gitlab.com/tezos/tezos">Tezos</a> project, we use <code>data-encoding</code> for binary serialisation and deserialisation of data transported via the P2P layer and for JSON serialisation and deserialisation of configuration values stored on disk.
</p>

<p>
The library is available through opam (<code>opam install data-encoding</code>), hosted on Gitlab (<a href="https://gitlab.com/nomadic-labs/data-encoding">https://gitlab.com/nomadic-labs/data-encoding</a>), and distributed under MIT license.
</p>

<p>
This release was only possible following an effort to refactor our internal tools and libraries. Most of the credit for this effort goes to Pietro Abate and Pierre Boutillier. Additional thanks to Gabriel Scherer who discovered multiple bugs and contributed the original crowbar tests.
</p>

<p>
Planned future improvements of the library include:
</p>
<ul class="org-ul">
<li>splitting the library into smaller components (to minimise dependencies when using only a part of the library), and</li>
<li>providing multiple endianness (currently the library only provides big-endian binary encodings).</li>
</ul>
</div>
</div>
</div>




<div id="outline-container-org655c4ad" class="outline-2">
<h2 id="7">Release of Easy_logging v0.6</h2>
<div class="outline-text-2" id="text-7">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-release-of-easy-logging-v0-6/4461/1">https://discuss.ocaml.org/t/ann-release-of-easy-logging-v0-6/4461/1</a>
</p>
</div>

<div id="outline-container-org7d88259" class="outline-3">
<h3 id="org7d88259">Sapristi announced</h3>
<div class="outline-text-3" id="text-org7d88259">
<p>
I'm glad to announce the release of Easy_logging v0.6.
</p>

<p>
<a href="https://github.com/sapristi/easy_logging">Easy_logging</a> is a logging library inspired from the python logging module, which allows fine grained tuning of log levels and log output, with relatively low configuration, and simple logger declaration and usage.
</p>

<p>
The most important new features are
</p>

<ul class="org-ul">
<li>auto-timestamp and/or versioning of file names when logging to a file</li>
<li>redefined handler type, so that custom handlers can easily be defined.</li>
<li>handlers support custom filters</li>
<li>loggers have tag generators (tags generated from callback functions)</li>
<li>log items now contain a timestamp</li>
</ul>

<p>
I also cleaned the API, so that the only exposed objects from opening <code>Easy_logging</code> are the <code>Logging</code>, <code>Handlers</code> and <code>Logging_internals</code> modules.
</p>

<p>
The documentation is still lagging a bit behind, and will be updated [insert a random date here].
</p>

<p>
<b>What comes next</b>
</p>
<ul class="org-ul">
<li>I plan to drop entirely the support for the MakeLogging functor (that creates  a Logging module from a Handlers module), so if anyone depends on it please tell me.</li>
<li>Some still lacking options are file-rotation when logging to a file. I guess the saner way to do so would be using Lwt, so I might implement a Lwt version of the module.</li>
</ul>

<p>
PS: I try to maintain a relatively stable external API, but the internals might (and will) change whenever I feel like it.
</p>
</div>
</div>
</div>




<div id="outline-container-org2fa0338" class="outline-2">
<h2 id="8">soupault: a static website generator based on HTML rewriting</h2>
<div class="outline-text-2" id="text-8">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-soupault-a-static-website-generator-based-on-html-rewriting/4126/9">https://discuss.ocaml.org/t/ann-soupault-a-static-website-generator-based-on-html-rewriting/4126/9</a>
</p>
</div>

<div id="outline-container-org7c0642d" class="outline-3">
<h3 id="org7c0642d">Daniil Baturin announced</h3>
<div class="outline-text-3" id="text-org7c0642d">
<p>
<a href="https://github.com/dmbaturin/soupault/releases/tag/1.3">1.3</a> release with some improvements.
</p>

<ul class="org-ul">
<li>Invalid config options cause warnings now. There are also "did you mean" suggestions for mistyped options, thanks to @c-cube's spelll library.</li>
<li>Footnotes now keep original id's for handy hotlinking, and you can add suffix/prefix to footnote ids to make a separate "namespace" for them.</li>
<li>Some minor bugfixes.</li>
</ul>
</div>
</div>
</div>




<div id="outline-container-orgb6c62b3" class="outline-2">
<h2 id="9">Update on the big ppx refactoring project</h2>
<div class="outline-text-2" id="text-9">
<p>
Archive: <a href="https://discuss.ocaml.org/t/update-on-the-big-ppx-refactoring-project/4428/1">https://discuss.ocaml.org/t/update-on-the-big-ppx-refactoring-project/4428/1</a>
</p>
</div>

<div id="outline-container-org5038cf8" class="outline-3">
<h3 id="org5038cf8">Jérémie Dimino announced</h3>
<div class="outline-text-3" id="text-org5038cf8">
<p>
We wanted to give an update on the status of the big ppx refactoring project. At this point, we have settled on a technical solution and are working towards implementing it. In this post I'll describe briefly how it works and what the plan is. This post directly follows <a href="https://discuss.ocaml.org/t/the-future-of-ppx/3766">https://discuss.ocaml.org/t/the-future-of-ppx/3766</a> which gives an overview of the ppx history and the issues we want to solve.
</p>

<p>
We also gave a presentation explaining all this at the OCaml Users and Developers workshop at ICFP this year with @NathanReb, so if you'd like to see a live version of this post watch out for the video on youtube! :)
</p>

<p>
And before diving in the technicalities, on the social side we welcome @rgrinberg who joined the team! :dizzy:
</p>
</div>

<div id="outline-container-orgb26fd7f" class="outline-4">
<h4 id="orgb26fd7f">The solution</h4>
<div class="outline-text-4" id="text-orgb26fd7f">
<p>
It wasn't easy to came up with this solution, but now that we have it it is actually quite simple, which means that we can be confident it will work.
</p>
</div>

<ul class="org-ul">
<li><a id="org42eac46"></a>Abstracting the AST<br />
<div class="outline-text-5" id="text-org42eac46">
<p>
To solve the stability problem, we are not re-inventing the wheel. We are simply making use of a very well established method in the functional programming world: abstraction.
</p>

<p>
Instead of exposing the raw data-types of the OCaml AST to authors of ppx rewriters, we are simply going to expose an API where all the types are abstract. Authors of ppx rewriters will need to use construction functions in order to construct the AST and one-level deconstruction functions to deconstruct it.
</p>

<p>
Moreover, this API will follow closely the layout of the underlying AST so that we can mechanically follow its evolution. More precisely, there will be one module for every version of the AST with an API that matches the AST at this version.
</p>

<p>
This is all still very fresh and experimental, but here is a sneaky peak of what this will look like: <a href="https://github.com/ocaml-ppx/ppx/blob/70c0bfd3b7a3e8a27e5ad890801d7c93f7dc69a7/astlib/src/stable.mli">https://github.com/ocaml-ppx/ppx/blob/70c0bfd3b7a3e8a27e5ad890801d7c93f7dc69a7/astlib/src/stable.mli</a>
</p>

<p>
One important detail that will ensure good interoperability between ppx rewriters is that the types will be equal between versions. i.e. <code>V4_07.Expression.t</code> will be exposed as equal to <code>V4_08.Expression.t</code>.
</p>

<p>
The deconstruction API will be a bit raw and in particular won't allow nested patterns. To help with this, we will provide view patterns implemented via a ppx rewriter shipped with the <code>ppx</code> package. And of course, meta-quotations will still be available.
</p>
</div>
</li>

<li><a id="org92bdc05"></a>Using dynamic types under the hood<br />
<div class="outline-text-5" id="text-org92bdc05">
<p>
The stable APIs are one thing, but we also want to keep the good composition semantic of ppxlib. Trying to compose things using the static types under these multiple APIs would be a bit of a nightmare. So instead we are going full dynamic. During the single-pass rewriting phase, the AST will be represented using dynamic types. Downgrades/upgrades will happen lazily and only at the edges as requested by individual ppx rewriters using a <b>history</b> of conversion functions provided by the compiler. In essence, these conversion functions will be very similar to the one we have in ocaml-migrate-parsetree, except that since they operate on the dynamic types they will be much smaller and focus on the interesting changes.
</p>

<p>
And because the conversions will happen only when needed, in many cases we will be able to use new language features even if the various ppx rewriters in use are written against older versions of the AST.
</p>
</div>
</li>
</ul>
</div>

<div id="outline-container-org3ac9d13" class="outline-4">
<h4 id="org3ac9d13">The plan</h4>
<div class="outline-text-4" id="text-org3ac9d13">
<p>
The plan is to get all of this implemented, proof test it against a bunch of existing older version of the AST and finally eat our own dog food by porting a bunch of ppx rewriters to the new world, making sure that the port is as smooth as possible.
</p>

<p>
Once this is all done, we will release the 1.0.0 version of the <code>ppx</code> project for public consumption.
</p>

<p>
It will be possible to use ppx rewriter baseds on <code>ppx</code> in conjunction with ppx rewriters based on <code>ppxlib</code> or <code>ocaml-migrate-parsetree</code>, just so that we don't need to port everything at once.
</p>

<p>
Our expectation is that the next time the parsetree changes and authors of ppx rewriters need to update their code, they'll choose to migrate to <code>ppx</code> at the same time given that it will give them long term stability guarantees.
</p>
</div>
</div>
</div>


<div id="outline-container-orge38a492" class="outline-3">
<h3 id="orge38a492">Replying to some questions, Jérémie Dimino said</h3>
<div class="outline-text-3" id="text-orge38a492">
<p>
What we call astlib won't be a user facing library. It will live in the compiler itself and be the smallest possible API that ensure that the ppx world keeps working with new compilers and even trunk. It will only contain:
</p>
<ul class="org-ul">
<li>the definition of the dynamic AST</li>
<li>functions to convert between the static and dynamic ASTs</li>
<li>the history of upgrade/downgrade functions</li>
</ul>

<p>
The user facing package will be <code>ppx</code>, which will be composed of
</p>
<ul class="org-ul">
<li>the <code>ppx</code> library, which in particular will expose the versioned AST interfaces, the view patterns, the driver and various modules ported from <code>ppxlib</code>. It will be approximately the same size as <code>ppxlib</code> except that it will have no dependency</li>
<li><code>ppx.metaquot</code> for metaquotations</li>
<li><code>ppx.view</code> for view patterns</li>
</ul>

<p>
If there is a need to have just the versioned AST interfaces on their own without the rest, we could certainly imagine distributing them as a separate library of even a separate package.
</p>

<p>
Regarding the driver, it will be similar to the ppxlib driver. i.e. the standard way to register a transformation will be by registering extension point expanders or derivers rather than whole AST mappers, though the latter will still be allowed for special cases. This is simply because such precise transformers have a better composition semantic and lead to faster rewriting, so we want to encourage ppx authors to use that.
</p>
</div>
</div>
</div>




<div id="outline-container-org4cd7d6d" class="outline-2">
<h2 id="10">Simplify roman utf8</h2>
<div class="outline-text-2" id="text-10">
<p>
Archive: <a href="https://discuss.ocaml.org/t/simplify-roman-utf8/4398/15">https://discuss.ocaml.org/t/simplify-roman-utf8/4398/15</a>
</p>
</div>

<div id="outline-container-org7f2274d" class="outline-3">
<h3 id="org7f2274d">sanette announced</h3>
<div class="outline-text-3" id="text-org7f2274d">
<p>
If you are interested, I have released the library on github:
</p>

<p>
<a href="https://github.com/sanette/basechar">https://github.com/sanette/basechar</a>
</p>

<p>
PR welcome!
</p>
</div>
</div>
</div>




<div id="outline-container-org9bdade6" class="outline-2">
<h2 id="11">Rfsm 1.6.0</h2>
<div class="outline-text-2" id="text-11">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-rfsm-1-6-0/4430/1">https://discuss.ocaml.org/t/ann-rfsm-1-6-0/4430/1</a>
</p>
</div>

<div id="outline-container-org8804a12" class="outline-3">
<h3 id="org8804a12">jserot announced</h3>
<div class="outline-text-3" id="text-org8804a12">
<p>
This is to announce the 1.6.0 release of <code>Rfsm</code>, a package dedicated to the description, simulation and synthesis of StateChart-like state diagrams.
</p>

<p>
The <code>Rfsm</code> package includes both an OCaml library and a command-line compiler.
Both take
</p>

<ul class="org-ul">
<li>a description of a system as a set of StateChart-like state diagrams</li>
<li>a description of stimuli to be used as input for this system</li>
</ul>

<p>
and can generate
</p>

<ul class="org-ul">
<li>graphical representations of the system</li>
<li>execution traces as  <code>.vcd</code>  files</li>
</ul>

<p>
Additionnaly, dedicated backends can generate system descriptions and testbenches in
</p>

<ul class="org-ul">
<li><code>CTask</code>  (a C dialect with primitives for describing tasks and event-based synchronisation)</li>
<li><code>SystemC</code></li>
<li><code>VHDL</code></li>
</ul>

<p>
More informations are available on the <a href="https://github.com/jserot/rfsm">github page</a>.
</p>

<p>
<code>Rfsm</code> is provided as a an <a href="https://opam.ocaml.org/packages/rfsm">opam package</a>.
</p>

<p>
Graphical User interfaces to the command line compiler are provided separately.
</p>

<p>
Comments, feedback and bug reports welcome.
</p>
</div>
</div>
</div>




<div id="outline-container-org9a7d521" class="outline-2">
<h2 id="12">Ocaml-protoc-plugin 0.9: A protobuf compiler</h2>
<div class="outline-text-2" id="text-12">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ocaml-protoc-plugin-0-9-a-protobuf-compiler/4456/1">https://discuss.ocaml.org/t/ocaml-protoc-plugin-0-9-a-protobuf-compiler/4456/1</a>
</p>
</div>

<div id="outline-container-org9c8e551" class="outline-3">
<h3 id="org9c8e551">Anders Fugmann announced</h3>
<div class="outline-text-3" id="text-org9c8e551">
<p>
I am happy to announce the first release of ocaml-protoc-plugin.
</p>

<p>
The library implements the full proto3 specification, and aims to generate ocaml idiomatic bindings to protobuf types/mesages defined in <code>.protoc</code> files:
</p>
<ul class="org-ul">
<li>Messages are mapped to modules, with a type <code>t</code></li>
<li>Enums are mapped to ADT's</li>
<li>Oneof types are mapped to polymorphic variants</li>
</ul>

<p>
All types are serialized using the proto3 specification (i.e. all repeated scalar types are packed).
</p>

<p>
All parts (package, service definitions, includes etc.) are supported.
</p>

<p>
The library is available through opam:
<code>opam install ocaml-protoc-plugin</code>.
</p>

<p>
For more information, please visit the homepage of ocaml-protoc-plugin at: <a href="https://github.com/issuu/ocaml-protoc-plugin/">https://github.com/issuu/ocaml-protoc-plugin/</a>
</p>

<p>
Comments and suggestions are more than welcome.
</p>
</div>
</div>
</div>




<div id="outline-container-org61b0c0f" class="outline-2">
<h2 id="org61b0c0f">Old CWN</h2>
<div class="outline-text-2" id="text-org61b0c0f">
<p>
If you happen to miss a CWN, you can <a href="mailto:alan.schmitt@polytechnique.org">send me a message</a> and I'll mail it to you, or go take a look at <a href="http://alan.petitepomme.net/cwn/">the archive</a> or the <a href="http://alan.petitepomme.net/cwn/cwn.rss">RSS feed of the archives</a>.
</p>

<p>
If you also wish to receive it every week by mail, you may subscribe <a href="http://lists.idyll.org/listinfo/caml-news-weekly/">online</a>.
</p>

<div class="authorname">
<p>
<a href="http://alan.petitepomme.net/">Alan Schmitt</a>
</p>

</div>
</div>
</div>
</div>
</body>
</html>
