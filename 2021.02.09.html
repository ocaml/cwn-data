<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-02-09 Tue 16:25 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OCaml Weekly News</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<style type="text/css">#table-of-contents h2 { display: none } .title { display: none } .authorname { text-align: right }</style>
<style type="text/css">.outline-2 {border-top: 1px solid black;}</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">OCaml Weekly News</h1>
<p>
<a href="https://alan.petitepomme.net/cwn/2021.02.02.html">Previous Week</a> <a href="https://alan.petitepomme.net/cwn/index.html">Up</a> <a href="https://alan.petitepomme.net/cwn/2021.02.16.html">Next Week</a>
</p>

<p>
Hello
</p>

<p>
Here is the latest OCaml Weekly News, for the week of February 02 to 09, 2021.
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#1">data-encoding.0.3: performances and streaming</a></li>
<li><a href="#2">2020 at OCamlPro</a></li>
<li><a href="#3">A short history of ReScript (BuckleScript)</a></li>
<li><a href="#4">Multicore OCaml: Dec 2020 / Jan 2021</a></li>
<li><a href="#5">Resto 0.6 and 0.6.1</a></li>
<li><a href="#6">First release of <code>paf</code>, a simple MirageOS layer for HTTP/AF</a></li>
<li><a href="#7">I'm building a mailing list platform with Ocsigen</a></li>
<li><a href="#orgb6ae35b">Old CWN</a></li>
</ul>
</div>
</div>


<div id="outline-container-orgcea4a00" class="outline-2">
<h2 id="1">data-encoding.0.3: performances and streaming</h2>
<div class="outline-text-2" id="text-1">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-data-encoding-0-3-performances-and-streaming/7205/1">https://discuss.ocaml.org/t/ann-data-encoding-0-3-performances-and-streaming/7205/1</a>
</p>
</div>

<div id="outline-container-org849ebe0" class="outline-3">
<h3 id="org849ebe0">Raphaël Proust announced</h3>
<div class="outline-text-3" id="text-org849ebe0">
<p>
Guess what?! Version 0.3 of data-encoding is now available!
</p>

<p>
Data-encoding is a library for defining encodings, which can then be used to
serialise and deserialise values to-and-from a binary or JSON representation.
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">e</span> :<span style="color: #228b22;"> (string * int list) t </span>=
  obj2 (req <span style="color: #8b2252;">"name"</span> string) (list uint8)
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">v</span> :<span style="color: #228b22;"> (string * int list) </span>=
  (<span style="color: #8b2252;">"low"</span>, [0;1;2;3;4])
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">s</span> :<span style="color: #228b22;"> string </span>= <span style="color: #228b22;">Binary.</span>to_string_exn e v
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">j</span> :<span style="color: #228b22;"> </span><span style="color: #228b22;">Ezjson.</span><span style="color: #228b22;">t </span>= <span style="color: #228b22;">Json.</span>construct e v
</pre>
</div>

<p>
Version 0.3 of the library is now available on opam.
The code is distributed under MIT license and hosted on Gitlab: <a href="https://gitlab.com/nomadic-labs/data-encoding/">https://gitlab.com/nomadic-labs/data-encoding/</a>.
The documentation is available online:
<a href="https://nomadic-labs.gitlab.io/data-encoding/data-encoding/Data_encoding/index.html">https://nomadic-labs.gitlab.io/data-encoding/data-encoding/Data_encoding/index.html</a>
</p>

<p>
In addition to numerous miscellaneous improvements, this version brings two
major changes.
</p>

<ol class="org-ol">
<li><p>
Support for streamed JSON serialisation.
</p>

<p>
JSON serialisation for large values can be expensive. And in some context,
prohibitively so. One such context is cooperative concurrency where
serialising very large JSON values can block other on-going tasks.
</p>

<p>
Data-encoding provides the necessary functions to serialise values as
sequences of strings which can be consumed with appropriate yielding.
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #000000; font-weight: bold;">rec</span> <span style="color: #0000ff;">write</span> <span style="color: #a0522d;">seq</span> = <span style="color: #a020f0;">match</span> seq () <span style="color: #a020f0;">with</span>
  | <span style="color: #228b22;">Seq.</span><span style="color: #000000; background-color: #ffffff;">Nil</span> -&gt;
      <span style="color: #228b22;">Lwt.</span>return_unit
  | <span style="color: #228b22;">Seq.</span><span style="color: #000000; background-color: #ffffff;">Cons</span> (chunk, seq) -&gt;
      <span style="color: #228b22;">Lwt_io.</span>write oc chunk &gt;&gt;= <span style="color: #a020f0;">fun</span> () -&gt;
      <span style="color: #228b22;">Lwt.</span>pause () &gt;&gt;= <span style="color: #a020f0;">fun</span> () -&gt;
      write seq
<span style="color: #000000; font-weight: bold;">in</span>
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">j</span> = <span style="color: #228b22;">Json.</span>construct_seq e v <span style="color: #000000; font-weight: bold;">in</span>
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">s</span> = <span style="color: #228b22;">Json.</span>string_seq_of_jsonm_lexeme_seq <span style="color: #008b8b;">~chunk_size_hint</span>:512 j <span style="color: #000000; font-weight: bold;">in</span>
write s
</pre>
</div></li>

<li><p>
Performance improvements.
</p>

<p>
The serialisation and deserialisation of some encodings has been optimised a
lot. On some encodings the performances have gotten competitive with Marshal.
</p>

<p>
More details below.
</p></li>
</ol>

<p>
According to the micro-benchmark below data-encoding.0.3 gets close to <code>Marshal</code> performances on the serialising and
deserialising of Micheline values (S-EXP-like values used to represent smart-contracts on the Tezos blockchain).
</p>

<p>
<a href="https://gitlab.com/nomadic-labs/data-encoding/-/snippets/2060331">https://gitlab.com/nomadic-labs/data-encoding/-/snippets/2060331</a>
</p>

<p>
The results are printed below. Notice the speed up:
</p>
<ul class="org-ul">
<li>for serialising it progressed from a 13.40× slow-down over Marshal to a 1.01× slow-down,</li>
<li>for deserialising it progressed from a 18.72× slow-down over Marshal to a 1.02× slow-down.</li>
</ul>
</div>

<div id="outline-container-org1c89db4" class="outline-4">
<h4 id="org1c89db4">data-encoding 0.2</h4>
<div class="outline-text-4" id="text-org1c89db4">
<p>
Estimated testing time 20s (2 benchmarks x 10s). Change using '-quota'.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Name</th>
<th scope="col" class="org-right">Time R^2</th>
<th scope="col" class="org-left">Time/Run</th>
<th scope="col" class="org-left">95ci</th>
<th scope="col" class="org-left">mWd/Run</th>
<th scope="col" class="org-left">mjWd/Run</th>
<th scope="col" class="org-left">Prom/Run</th>
<th scope="col" class="org-right">Percentage</th>
<th scope="col" class="org-right">Speedup</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">marshal_encode</td>
<td class="org-right">1.00</td>
<td class="org-left">102.89us</td>
<td class="org-left">-0.05us +0.06us</td>
<td class="org-left">5.74kw</td>
<td class="org-left">0.11w</td>
<td class="org-left">0.11w</td>
<td class="org-right">7.46%</td>
<td class="org-right">1.00</td>
</tr>

<tr>
<td class="org-left">binary_encode</td>
<td class="org-right">1.00</td>
<td class="org-left">1_378.70us</td>
<td class="org-left">-7.47us +8.73us</td>
<td class="org-left">953.58kw</td>
<td class="org-left">1_489.94w</td>
<td class="org-left">1_489.94w</td>
<td class="org-right">100.00%</td>
<td class="org-right">13.40</td>
</tr>
</tbody>
</table>

<p>
Estimated testing time 20s (2 benchmarks x 10s). Change using '-quota'.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Name</th>
<th scope="col" class="org-right">Time R^2</th>
<th scope="col" class="org-left">Time/Run</th>
<th scope="col" class="org-left">95ci</th>
<th scope="col" class="org-left">mWd/Run</th>
<th scope="col" class="org-left">mjWd/Run</th>
<th scope="col" class="org-left">Prom/Run</th>
<th scope="col" class="org-right">Percentage</th>
<th scope="col" class="org-right">Speedup</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">marshal_decode</td>
<td class="org-right">1.00</td>
<td class="org-left">73.58us</td>
<td class="org-left">-0.62us +0.59us</td>
<td class="org-left">7.59kw</td>
<td class="org-left">0.16w</td>
<td class="org-left">0.16w</td>
<td class="org-right">5.34%</td>
<td class="org-right">1.00</td>
</tr>

<tr>
<td class="org-left">binary_decode</td>
<td class="org-right">1.00</td>
<td class="org-left">1_377.68us</td>
<td class="org-left">-4.26us +4.35us</td>
<td class="org-left">951.99kw</td>
<td class="org-left">1_464.25w</td>
<td class="org-left">1_464.25w</td>
<td class="org-right">100.00%</td>
<td class="org-right">18.72</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org04082a5" class="outline-4">
<h4 id="org04082a5">data-encoding 0.3</h4>
<div class="outline-text-4" id="text-org04082a5">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Name</th>
<th scope="col" class="org-right">Time R^2</th>
<th scope="col" class="org-left">Time/Run</th>
<th scope="col" class="org-left">95ci</th>
<th scope="col" class="org-left">mWd/Run</th>
<th scope="col" class="org-left">mjWd/Run</th>
<th scope="col" class="org-left">Prom/Run</th>
<th scope="col" class="org-right">Percentage</th>
<th scope="col" class="org-right">Speedup</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">marshal_encode</td>
<td class="org-right">1.00</td>
<td class="org-left">102.05us</td>
<td class="org-left">-0.15us +0.18us</td>
<td class="org-left">5.74kw</td>
<td class="org-left">0.11w</td>
<td class="org-left">0.11w</td>
<td class="org-right">99.40%</td>
<td class="org-right">1.00</td>
</tr>

<tr>
<td class="org-left">binary_encode</td>
<td class="org-right">1.00</td>
<td class="org-left">102.67us</td>
<td class="org-left">-0.39us +0.44us</td>
<td class="org-left">37.55kw</td>
<td class="org-left">2.55w</td>
<td class="org-left">2.55w</td>
<td class="org-right">100.00%</td>
<td class="org-right">1.01</td>
</tr>
</tbody>
</table>

<p>
Estimated testing time 20s (2 benchmarks x 10s). Change using '-quota'.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Name</th>
<th scope="col" class="org-right">Time R^2</th>
<th scope="col" class="org-left">Time/Run</th>
<th scope="col" class="org-left">95ci</th>
<th scope="col" class="org-left">mWd/Run</th>
<th scope="col" class="org-left">mjWd/Run</th>
<th scope="col" class="org-left">Prom/Run</th>
<th scope="col" class="org-right">Percentage</th>
<th scope="col" class="org-right">Speedup</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">marshal_decode</td>
<td class="org-right">1.00</td>
<td class="org-left">72.21us</td>
<td class="org-left">-0.29us +0.33us</td>
<td class="org-left">7.59kw</td>
<td class="org-left">0.16w</td>
<td class="org-left">0.16w</td>
<td class="org-right">97.57%</td>
<td class="org-right">1.00</td>
</tr>

<tr>
<td class="org-left">binary_decode</td>
<td class="org-right">1.00</td>
<td class="org-left">74.00us</td>
<td class="org-left">-0.29us +0.31us</td>
<td class="org-left">36.48kw</td>
<td class="org-left">2.89w</td>
<td class="org-left">2.89w</td>
<td class="org-right">100.00%</td>
<td class="org-right">1.02</td>
</tr>
</tbody>
</table>

<p>
Do not hesitate to open an issue on <a href="https://gitlab.com/nomadic-labs/data-encoding/-/issues">the project's issue
tracker</a> to let us know about encodings that are still too
slow.
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-org6217087" class="outline-2">
<h2 id="2">2020 at OCamlPro</h2>
<div class="outline-text-2" id="text-2">
<p>
Archive: <a href="https://discuss.ocaml.org/t/2020-at-ocamlpro/7207/1">https://discuss.ocaml.org/t/2020-at-ocamlpro/7207/1</a>
</p>
</div>

<div id="outline-container-orgfe326ff" class="outline-3">
<h3 id="orgfe326ff">OCamlPro announced</h3>
<div class="outline-text-3" id="text-orgfe326ff">
<p>
We've published a short review of our 2020 activities. It's available on our
<a href="https://www.ocamlpro.com/2021/02/02/2020-at-ocamlpro/">blog</a>!
</p>
</div>
</div>
</div>




<div id="outline-container-orgea8d9bd" class="outline-2">
<h2 id="3">A short history of ReScript (BuckleScript)</h2>
<div class="outline-text-2" id="text-3">
<p>
Archive: <a href="https://discuss.ocaml.org/t/a-short-history-of-rescript-bucklescript/7222/1">https://discuss.ocaml.org/t/a-short-history-of-rescript-bucklescript/7222/1</a>
</p>
</div>

<div id="outline-container-org852bb4f" class="outline-3">
<h3 id="org852bb4f">Hongbo Zhang told</h3>
<div class="outline-text-3" id="text-org852bb4f">
<p>
It takes time to write such a post for a non-native speaker like me, but I appreciate what the OCaml gives me and
believe I am <b>doing good</b> for the community, so I decide to write a short history of ReScript and explain the
motivations behind this project.
</p>

<p>
I like OCaml, that’s why I decided to go to PlClub@UPenn for further study after undergraduate (2011). I wrote lots
of tutorials around <a href="https://github.com/bobzhang/ocaml-book">OCaml</a> and used to be one of the maintainers of camlp4,
I was even honored to be listed as core maintaines of OCaml once.
</p>

<p>
However, the reality is brutal that it’s very difficult to find a decent job using OCaml if you are not interested in
Finance or get unlucky with a Jane Street interview. Here a decent job, I mean you get paid as good as those Silicon
Valley companies while using your favorite programming language.
</p>

<p>
JSOO started growing mature back in 2013, it is the first compiler which gets bootstrapped in the browser, truly
impressive. However, even for OCaml experts like me, it is really hard to get started with JSOO. It is a black box to
me that I can not read the generated JS code under the hood. If your code works under the bytecode but stops working
in the browser. You have to do a random guess to do the debugging. These are the impressions I have back then.
</p>

<p>
Another story happened on my side is that I started to have lots of experience in JavaScript in daily jobs and love
it. It’s the most beautiful dynamic language I have used &#x2013; you have a decent IDE everywhere as long as it ships a
browser. So the idea comes to my mind that why not make a compiler which compiles OCaml to idiomatic JS for the
convenience of JS users?
</p>

<p>
The beauty of this idea is that OCaml will share the same runtime as JS so that interop is really easy and you can
use your favorite language in your daily jobs. I also shared my ideas with JSOO devs: <a href="https://github.com/ocsigen/js_of_ocaml/issues/338">discuss: compiling rawlambda output to javascript · Issue #338 · ocsigen/js_of_ocaml (github.com)</a>
</p>

<p>
The project was originally named OCamlScript but it has a name conflict with an existing package so that it is
renamed into BuckleScript.
</p>

<p>
At a similar time, ReasonML syntax was released, it is a JS friendly syntax for people to take advantage of OCaml.
The combination of ReasonML and BuckleScript is very natural. To avoid confusion to users, we call it ReasonML or
projects under the ReasonML umbrella &#x2013; but the heavy lifting is mostly done by BuckleScript.
</p>

<p>
The development of ReasonML syntax has slowed down since 2018. What worries me is that the remaining commits keep
adding stuff that we don’t want. To maintain the compatibility with OCaml for each release, the ReasonML syntax keeps
a snapshot for all versions of OCaml AST, the code gets bloated quickly that the parser is even larger than the
compiler itself &#x2013; this is hard to believe, it means that all my hard work to squeeze the performance will be wasted
in the parser.
</p>

<p>
I wish the very few resources could be put into bug fixes instead. We communicated and realized that the top priority
for ReasonML syntax is the compatibility for OCaml ecosystem while our top priority is providing the best dev
experience for JS users.
</p>

<p>
It is open source projects and people can have different visions so that we decide a peaceful separation.
</p>

<p>
At a similar time, Iwan &#x2013; one of the major contributors of ReasonML syntax, shows us a POC of a handwritten parser
which supports the whole language. This is something I want but do not have time to do &#x2013; a hand written parser for
the best error message and better dev experience.
</p>

<p>
The original goal is to have the hand written parser 100% compatible with ReasonML syntax so that we can finish the
transition, but it ends up being slightly different.
</p>
</div>

<div id="outline-container-org70abe5f" class="outline-4">
<h4 id="org70abe5f">The current status of ReScript</h4>
<div class="outline-text-4" id="text-org70abe5f">
<p>
Despite the changes of the syntax, the core gets improved day by day. It has over 11,000 commits in the last few
years.
</p>

<p>
We are going to make a release of version 9, we believe it is currently the fastest compiler on the JS market which
generates the most readable JS code and yields the smallest JS output size.
</p>

<p>
I do wish it could be a useful language for people who like OCaml but can use it in their daily JS work. It is a
fierce competition in such a market. We have to compete with languages of huge successes: TypeScript. That’s why
given a small team with very few resources, we are very focused and don't want to get distracted by anything else.
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-orgb4ac83e" class="outline-2">
<h2 id="4">Multicore OCaml: Dec 2020 / Jan 2021</h2>
<div class="outline-text-2" id="text-4">
<p>
Archive: <a href="https://discuss.ocaml.org/t/multicore-ocaml-dec-2020-jan-2021/7225/1">https://discuss.ocaml.org/t/multicore-ocaml-dec-2020-jan-2021/7225/1</a>
</p>
</div>

<div id="outline-container-org22a16db" class="outline-3">
<h3 id="org22a16db">Anil Madhavapeddy announced</h3>
<div class="outline-text-3" id="text-org22a16db">
<p>
Welcome to a double helping of the multicore monthlies, with December 2020 and January 2021 bundled together (the
team collectively collapsed into the end of year break for a well deserved rest). We encourage you to review all the
<a href="https://discuss.ocaml.org/tag/multicore-monthly">previous monthly </a> updates for 2020 which have been compiled by
@shakthimaan, @kayceesrk, and me.
</p>

<p>
Looking back over 2020, we achieved a number of major milestones towards upstreaming multicore OCaml. The major
highlights include the implementation of the eventlog tracing system to make debugging complex parallelism practical,
the enormous rebasing of from OCaml 4.06 to 4.11, a chapter on parallel programming, the publication of "Retrofitting
Parallelism onto OCaml" at ICFP 2020, the production use of the Sandmark benchmark, and the implementation of system
threading integration.  While all this was happening in the multicore code trees, the upstreaming efforts into
mainline OCaml also went into full gear, with @xavierleroy leading the efforts from the core team to ensure that the
right pieces went into various releases of OCaml with the same extensive code review as any other features get.
</p>

<p>
The end of 2020 saw  enhancements and updates to the ecosystem libraries, with more tooling becoming available. In
particular, we would like to thank:
</p>

<ul class="org-ul">
<li>@mattpallissard for getting <code>merlin</code> and <code>dot-merlin-reader</code> working with Multicore OCaml 4.10.  This makes programming using OCaml Platform tools like the VSCode plugin much more pleasant.</li>
<li>@eduardorfs for testing the <code>no-effect-syntax</code> Multicore OCaml branch with a ReasonML project.</li>
</ul>

<p>
@kayceesrk also gave a couple of public talks online:
</p>

<ul class="org-ul">
<li><a href="https://www.youtube.com/watch?v=mel76DFerL0">Multicore OCaml - What's coming in 2021</a>, hosted by Nomadic Labs.</li>
<li><a href="https://kcsrk.info/slides/nus_effects.pdf">Effect handlers in Multicore OCaml</a>. NUS PLV Research Seminar.</li>
</ul>

<p>
We're really grateful to the OCaml core developers for giving this effort so much of their time and focus in 2020!
We're working on a broader plan for 2021's exciting multicore roadmap which will be included in the next monthly
after a core OCaml developer's meeting ratifies it soon.  The broad strategy remains consistent: putting pieces of
functionality steadily into each upcoming OCaml release so that each can be reviewed and tested in isolation, ahead
of the OCaml 5.0 release which will include domains parallelism.
</p>

<p>
With <a href="https://discuss.ocaml.org/t/ocaml-4-12-0-second-beta-release/7171">OCaml 4.12 out in beta</a>, our January has
mainly been spent tackling some of the big pieces needed for OCaml 4.13.  In particular, the <a href="https://github.com/ocaml/ocaml/pull/10039">safe points
PR</a> has seen a big update (and corresponding performance improvements),
and we have been working on the design and implementation of Domain-Local Allocation Buffers (DLAB).  We've also
started the process of figuring out how to merge the awesome sequential best-fit allocator with our multicore major
GC, to get the best of both worlds in OCaml 5.0.  The multicore IO stack has also restarted development, with focus
on Linux's new <code>io_uring</code> kernel interface before retrofitting the old stalwart <code>epoll</code> and <code>kqueue</code> interfaces.
</p>

<p>
Tooling-wise, the multicore Merlin support began in December is now merged, thanks to @mattpallissard and
@eduardorfs. We continue to work on the enhancements for Sandmark 2.0 benchmarking suite for an upcoming alpha
release &#x2013; @shakthimaan gave an online seminar about these improvements to the multicore team which has been recorded
and will be available in the next monthly for anyone interested in contributing to our benchmarking efforts.
</p>

<p>
As with previous reports, the Multicore OCaml updates are listed first for the month of December 2020 and then
January 2021. The upstream OCaml ongoing work is finally mentioned for your reference after the multicore-tree
specific pieces..
</p>
</div>

<div id="outline-container-orgfb75388" class="outline-4">
<h4 id="orgfb75388">December 2020</h4>
<div class="outline-text-4" id="text-orgfb75388">
</div>
<div id="outline-container-orged6ebd8" class="outline-5">
<h5 id="orged6ebd8">Multicore OCaml</h5>
<div class="outline-text-5" id="text-orged6ebd8">
</div>
<div id="outline-container-org302964b" class="outline-6">
<h6 id="org302964b">Ongoing</h6>
<div class="outline-text-6" id="text-org302964b">
</div>
<ul class="org-ul">
<li><a id="org9a578ed"></a>Ecosystem<br />
<div class="outline-text-7" id="text-org9a578ed">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/lockfree/issues/6">ocaml-multicore/lockfree#6</a>
Current status and potential improvements
</p>

<p>
An RFC that lists the current status of the <code>lockfree</code> library, and
possible performance improvements for the Kcas dependency, test
suite and benchmarks.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/lockfree/issues/7">ocaml-multicore/lockfree#7</a>
Setup travis CI build
</p>

<p>
A .travis.yml file, similar to the one in
<a href="https://github.com/ocaml-multicore/domainslib/">https://github.com/ocaml-multicore/domainslib/</a> needs to be created
for the CI build system.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/effects-examples/issues/20">ocaml-multicore/effects-examples#20</a>
Add WebServer example
</p>

<p>
An open task to add the <code>httpaf</code> based webserver implementation to
the effects-examples repository.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/effects-examples/issues/21">ocaml-multicore/effects-examples#21</a>
Investigate CI failure
</p>

<p>
The CI build fails on MacOS with a time out, but, it runs fine on
Linux. An on-going investigation is pending.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/multicore-opam/issues/39">ocaml-multicore/multicore-opam#39</a>
Multicore Merlin
</p>

<p>
Thanks to @mattpallissard (Matt Pallissard) and @eduardorfs
(Eduardo Rafael) for testing <code>merlin</code> and <code>dot-merlin-reader</code>, and
to get it working with Multicore OCaml 4.10! The same has been
tested with VSCode and Atom, and a screenshot of the UI is shown
below.
</p>


<div class="figure">
<p><img src="https://aws1.discourse-cdn.com/standard11/uploads/ocaml/original/2X/7/7b9008f6fbef3e148350fade05b8b6c73377e713.png" alt="7b9008f6fbef3e148350fade05b8b6c73377e713.png" />
</p>
</div></li>
</ul>
</div>
</li>

<li><a id="orgdb6a6f6"></a>API<br />
<div class="outline-text-7" id="text-orgdb6a6f6">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/issues/448">ocaml-multicore/ocaml-multicore#448</a>
Reintroduce caml_stat_accessors in the C API
</p>

<p>
The <code>caml_stat_minor_words</code>, <code>caml_stat_promoted_words</code>,
<code>caml_allocated_words</code> <code>caml_stat_minor_collections</code> fields are not
exposed in Multicore OCaml. This is a discussion to address possible
solutions for the same.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/459">ocaml-multicore/ocaml-multicore#459</a>
Replace caml_root API with global roots
</p>

<p>
A work-in-progress to convert variables of type <code>caml_root</code> to
<code>value</code>, and to register them as global root or generational global
root, in order to remove the caml_root API entirely.
</p></li>
</ul>
</div>
</li>

<li><a id="orgfc4de8a"></a>Sundries<br />
<div class="outline-text-7" id="text-orgfc4de8a">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/issues/450">ocaml-multicore/ocaml-multicore#450</a>
"rogue" systhreads and domain termination
</p>

<p>
An RFC to discuss on the semantics of domain termination for
non-empty thread chaining. In Multicore OCaml, a domain termination
does not mean the end of a program, and slot reuse adds complexity
to the implementation.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/issues/451">ocaml-multicore/ocaml-multicore#451</a>
Note for OCaml 5.0: Get rid of compatibility.h
</p>

<p>
OCaml Multicore removed <code>modify</code> and <code>initialize</code> from
<code>compatibility.h</code>, and this is a tracking issue to remove
compatibility.h for OCaml 5.0.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/458">ocaml-multicore/ocaml-multicore#458</a>
no-effect-syntax: Remove effects from typedtree
</p>

<p>
The PR removes the the effect syntax use from <code>typedtree.ml</code>, and
enables external applications that use the AST to work with
domains-only Multicore OCaml.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/461">ocaml-multicore/ocaml-multicore#461</a>
Remove stw/leader_collision events from eventlog
</p>

<p>
A patch to make viewing and analyzing the logs better by removing
the <code>stw/leader_collision</code> log messages.
</p></li>
</ul>
</div>
</li>
</ul>
</div>

<div id="outline-container-orgab53e2d" class="outline-6">
<h6 id="orgab53e2d">Completed</h6>
<div class="outline-text-6" id="text-orgab53e2d">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/effects-examples/pull/23">ocaml-multicore/effects-examples#23</a>
Migrate to dune
</p>

<p>
The build scripts were using OCamlbuild, and they have been ported
to now use dune.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/402">ocaml-multicore/ocaml-multicore#402</a>
Split handle_gc_interrupt into handling remote and polling sections
</p>

<p>
The PR includes the addition of <code>caml_poll_gc_work</code> that contains
the polling of GC work done in <code>caml_handle_gc_interrupt</code>. This
facilitates handling of interrupts recursively without introducing
new state.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/439">ocaml-multicore/ocaml-multicore#439</a>
Systhread lifecycle work
</p>

<p>
The improvement fixes a race condition in <code>caml_thread_scan_roots</code>
when two domains are initializing, and rework has been done for
improving general resource handling and freeing of descriptors and
stacks.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/446">ocaml-multicore/ocaml-multicore#446</a>
Collect GC stats at the end of minor collection
</p>

<p>
The GC statistics is collected at the end of a minor collection, and
the double buffering of GC sampled statistics has been removed. The
change does not have an impact on the existing benchmark runs as
observed against stock OCaml from the following illustration:
</p>


<div class="figure">
<p><img src="https://aws1.discourse-cdn.com/standard11/uploads/ocaml/optimized/2X/7/7ea3f6d4aed319353e711ad8d75acb5093a087ad_2_1380x634.png" alt="7ea3f6d4aed319353e711ad8d75acb5093a087ad_2_1380x634.png" />
</p>
</div></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/454">ocaml-multicore/ocaml-multicore#454</a>
Respect ASM_CFI_SUPPORTED flag in amd64
</p>

<p>
The CFI directives in <code>amd64.S</code> are now guarded by
<code>ASM_CFI_SUPPORTED</code>, and thus compilation with <code>--disable-cfi</code> will
now provide a clean build.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/455">ocaml-multicore/ocaml-multicore#455</a>
No blocking section on fork
</p>

<p>
A patch to handle the case when a rogue thread attempts to take over
the thread <code>masterlock</code> and to prevent a child thread from moving to
an invalid state. Dune can now be used safely with Multicore OCaml.
</p></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orga65d129" class="outline-5">
<h5 id="orga65d129">Benchmarking</h5>
<div class="outline-text-5" id="text-orga65d129">
</div>
<div id="outline-container-orgbcf7ee6" class="outline-6">
<h6 id="orgbcf7ee6">Ongoing</h6>
<div class="outline-text-6" id="text-orgbcf7ee6">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-bench/rungen/pull/1">ocaml-bench/rungen#1</a>
Fix compiler warnings and errors for clean build
</p>

<p>
The patch provides minor fixes for a clean build of <code>rungen</code> with dune
to be used with Sandmark 2.0.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/orun/pull/2">ocaml-bench/orun#2</a>
Fix compiler warnings and errors for clean build
</p>

<p>
The unused variables and functions have been removed to remove all
the warnings and errors produced when building <code>orun</code> with dune.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/issues/198">ocaml-bench/sandmark#198</a>
Noise in Sandmark
</p>

<p>
An RFC to measure the noise between multiple execution runs of the
benchmarks to better understand the performance with various
hardware configuration settings, and with ASLR turned on and off.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/200">ocaml-bench/sandmark#200</a>
Global roots microbenchmark
</p>

<p>
The patch includes <code>globroots_seq.ml</code>, <code>globroots_sp.ml</code>, and
<code>globroots_mp.ml</code> that adds microbenchmarks to measure the
efficiency of global root scanning.
</p></li>

<li>We are continuing to integrate the existing Sandmark benchmark test
suite with a Sandmark 2.0 native dune build environment for use with
opam compiler switch environment. The existing benchmarks have been
ported to the same to use their respective dune files. The <code>orun</code>
and <code>rungen</code> packages now live in separate GitHub repositories.</li>
</ul>
</div>
</div>

<div id="outline-container-orga9537f7" class="outline-6">
<h6 id="orga9537f7">Completed</h6>
<div class="outline-text-6" id="text-orga9537f7">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/196">ocaml-bench/sandmark#196</a>
Filter benchmarks based on tag
</p>

<p>
The benchmarks can now be filtered based on <code>tags</code> instead of custom
target .json files. You can now build the benchmarks using the
following commands:
</p>

<pre class="example">
$ TAG='"run_in_ci"' make run_config_filtered.json
$ RUN_CONFIG_JSON=run_config_filtered.json make ocaml-versions/4.10.0+multicore.bench
</pre></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/201">ocaml-bench/sandmark#201</a>
Fix compiler version in CI
</p>

<p>
A minor update in .drone.yml to use
<code>ocaml-versions/4.10.0+multicore.bench</code> in the CI for
4.10.0+multicore+serial.
</p></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orge9be206" class="outline-5">
<h5 id="orge9be206">OCaml</h5>
<div class="outline-text-5" id="text-orge9be206">
</div>
<div id="outline-container-orgdb4a23a" class="outline-6">
<h6 id="orgdb4a23a">Ongoing</h6>
<div class="outline-text-6" id="text-orgdb4a23a">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml/ocaml/pull/9876">ocaml/ocaml#9876</a>
Do not cache young_limit in a processor register
</p>

<p>
This PR for the removal of <code>young_limit</code> caching in a register for
ARM64, PowerPC and RISC-V ports hardware is currently under review.
</p></li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-orgac81249" class="outline-4">
<h4 id="orgac81249">January 2021</h4>
<div class="outline-text-4" id="text-orgac81249">
</div>
<div id="outline-container-orgc745c24" class="outline-5">
<h5 id="orgc745c24">Multicore OCaml</h5>
<div class="outline-text-5" id="text-orgc745c24">
</div>
<div id="outline-container-orgfe5d1c6" class="outline-6">
<h6 id="orgfe5d1c6">Ongoing</h6>
<div class="outline-text-6" id="text-orgfe5d1c6">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/464">ocaml-multicore/ocaml-multicore#464</a>
Replace Field_imm with Field
</p>

<p>
The patch replaces the Field immediate use with Field from the
concurrent minor collector.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/issues/468">ocaml-multicore/ocaml-multicore#468</a>
Finalisers causing segfault with multiple domains
</p>

<p>
An on-going test case where Finalisers cause segmentation faults
with multiple domains.
</p></li>

<li>The design and implementation of Domain-Local Allocation Buffers
(DLAB) is underway, and the relevant notes on the same are available
in the following <a href="https://github.com/ocaml-multicore/ocaml-multicore/wiki/Domain-Local-Allocation-Buffers">DLAB
Wiki</a>.</li>
</ul>
</div>
</div>

<div id="outline-container-org1980fd8" class="outline-6">
<h6 id="org1980fd8">Completed</h6>
<div class="outline-text-6" id="text-org1980fd8">
</div>
<ul class="org-ul">
<li><a id="org9d59df9"></a>Ecosystem<br />
<div class="outline-text-7" id="text-org9d59df9">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-bench/rungen/pull/1">ocaml-bench/rungen#1</a>
Fix compiler warnings and errors for clean build
</p>

<p>
Minor fixes for a clean build of <code>rungen</code> with dune to be used with
Sandmark 2.0.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/orun/pull/2">ocaml-bench/orun#2</a>
Fix compiler warnings and errors for clean build
</p>

<p>
A patch to remove unused variables and functions without any
warnings and errors when building <code>orun</code> with dune.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/rungen/pull/2">ocaml-bench/rungen#2</a>
Added meta files for dune-release lint
</p>

<p>
The <code>dune-release lint</code> checks for rungen now pass with the
inclusion of CHANGES, LICENSE and updates to rungen.opam files.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/orun/pull/3">ocaml-bench/orun#3</a>
Add meta files for dune-release lint
</p>

<p>
The CHANGES, LICENSE, README.md and orun.opam files have been added
to prepare the sources for an opam.ocaml.org release.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/multicore-opam/issues/39">ocaml-multicore/multicore-opam#39</a>
Multicore Merlin
</p>

<p>
Thanks to @mattpallissard (Matt Pallissard) and @eduardorfs (Eduardo
Rafael) for testing <code>merlin</code> and <code>dot-merlin-reader</code>, and to get it
working with Multicore OCaml 4.10! The changes work fine with VSCode
and Atom. The corresponding
<a href="https://github.com/ocaml-multicore/multicore-opam/pull/40">PR#40</a>
is now merged.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/multicore-opam/pull/45">ocaml-multicore/ocaml-multicore#45</a>
Merlin and OCaml-LSP installation instructions
</p>

<p>
The README.md file has been updated to include installation
instructions to use Merlin and OCaml LSP Server.
</p></li>
</ul>
</div>
</li>

<li><a id="org33c26c3"></a>Sundries<br />
<div class="outline-text-7" id="text-org33c26c3">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/458">ocaml-multicore/ocaml-multicore#458</a>
no-effect-syntax: Remove effects from typedtree
</p>

<p>
The PR enables external applications that use the AST to work with
domains-only Multicore OCaml, and removes the effect syntax use from
<code>typedtree.ml</code>.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/461">ocaml-multicore/ocaml-multicore#461</a>
Remove stw/leader_collision events from eventlog
</p>

<p>
The <code>stw/leader_collision</code> log messages have been cleaned up to make
it easier to view and analyze the logs.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/462">ocaml-multicore/ocaml-multicore#462</a>
Move from Travis to GitHub Actions
</p>

<p>
The continuous integration builds are now updated to use GitHub
Actions instead of Travis CI, in order to be similar to that of
upstream CI.
</p></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/463">ocaml-multicore/ocaml-multicore#463</a>
Minor GC: Restrict global roots scanning to one domain
</p>

<p>
The live domains scan all the global roots during a minor
collection, and the patch restricts the global root scanning to just
one domain. The sequential and parallel macro benchmark results are
given below:
</p>


<div class="figure">
<p><img src="https://aws1.discourse-cdn.com/standard11/uploads/ocaml/optimized/2X/9/91c042694b6bc0831be2468a6660c36138601c65_2_1380x636.jpeg" alt="91c042694b6bc0831be2468a6660c36138601c65_2_1380x636.jpeg" />
</p>
</div>


<div class="figure">
<p><img src="https://aws1.discourse-cdn.com/standard11/uploads/ocaml/optimized/2X/3/34809463a2400067035a5bcd7a20da53aa14d225_2_1380x916.jpeg" alt="34809463a2400067035a5bcd7a20da53aa14d225_2_1380x916.jpeg" />
</p>
</div></li>

<li><p>
<a href="https://github.com/ocaml-multicore/ocaml-multicore/pull/467">ocaml-multicore/ocaml-multicore#467</a>
Disable the pruning of the mark stack
</p>

<p>
A PR to disable the mark stack overflow for a concurrency bug that
occurs when remarking a pool in another domain when that domain also
does allocations.
</p></li>
</ul>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-org2744496" class="outline-5">
<h5 id="org2744496">Benchmarking</h5>
<div class="outline-text-5" id="text-org2744496">
</div>
<div id="outline-container-org876cddc" class="outline-6">
<h6 id="org876cddc">Ongoing</h6>
<div class="outline-text-6" id="text-org876cddc">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/202">ocaml-bench/sandmark#202</a>
Add bench clean target in the Makefile
</p>

<p>
A <code>benchclean</code> target has been added to the Makefile to only remove
<code>_build</code> and <code>_results</code>. The <code>_opam</code> folder is retained with the
required packages and dependencies installed, so that the benchmarks
can be quickly re-built and executed.
</p></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/203">ocaml-bench/sandmark#203</a>
Implement ITER support
</p>

<p>
The use of ITER has been correctly implemented with multiple
instances of the benchmarks being built, and to repeat the
executions of the benchmarks. This helps to take averages from
multiple runs for metrics. For example, using ITER=2 produces two
<code>.summary.bench</code> files as shown below:
</p>

<pre class="example">
$ ls _build/
  4.10.0+multicore_1  4.10.0+multicore_2  log

$ ls _results/
  4.10.0+multicore_1.orun.summary.bench  4.10.0+multicore_2.orun.summary.bench
</pre></li>

<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/204">ocaml-bench/sandmark#204</a>
Adding layers.ml as a benchmark to Sandmark
</p>

<p>
Th inclusion of Irmin layers benchmark and its dependencies into
Sandmark. This is a work-in-progress.
</p></li>

<li>We are continuing the enhancements for Sandmark 2.0 that uses a
native dune to build and execute the benchmarks, and also port and
test with the current Sandmark configuration files. The <code>orun</code> and
<code>rungen</code> packages have been moved to their respective
repositories. The use of a meta header entry to the .summary.bench
file, ITER support, and package override features have been
implemented.</li>
</ul>
</div>
</div>

<div id="outline-container-org7d84c41" class="outline-6">
<h6 id="org7d84c41">Completed</h6>
<div class="outline-text-6" id="text-org7d84c41">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml-bench/sandmark/pull/200">ocaml-bench/sandmark#200</a>
Global roots microbenchmark
</p>

<p>
The implementation of <code>globroots_seq.ml</code>, <code>globroots_sp.ml</code>, and
<code>globroots_mp.ml</code> to measure the efficiency of global root scanning
has been added to the microbenchmarks.
</p></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org401e9a8" class="outline-5">
<h5 id="org401e9a8">OCaml</h5>
<div class="outline-text-5" id="text-org401e9a8">
</div>
<div id="outline-container-orgd1617a2" class="outline-6">
<h6 id="orgd1617a2">Ongoing</h6>
<div class="outline-text-6" id="text-orgd1617a2">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml/ocaml/pull/10039">ocaml/ocaml#10039</a>
Safepoints
</p>

<p>
An update to the draft Safepoints implementation that uses the
prologue eliding algorithm and is now rebased to trunk.The runtime
benchmark results on sherwood (an AMD EPYC 7702) and thunderx (a
Cavium ThunderX CN8890) are shown below:
</p>


<div class="figure">
<p><img src="https://aws1.discourse-cdn.com/standard11/uploads/ocaml/original/2X/b/b01d3b192ba27930e9b00fcbb7f98ac216d474d5.png" alt="b01d3b192ba27930e9b00fcbb7f98ac216d474d5.png" />
</p>
</div>


<div class="figure">
<p><img src="https://aws1.discourse-cdn.com/standard11/uploads/ocaml/original/2X/3/3ac97ce23cf6dadd744f46feab4d923586d479df.png" alt="3ac97ce23cf6dadd744f46feab4d923586d479df.png" />
</p>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org0bf933a" class="outline-6">
<h6 id="org0bf933a">Completed</h6>
<div class="outline-text-6" id="text-org0bf933a">
<ul class="org-ul">
<li><p>
<a href="https://github.com/ocaml/ocaml/pull/9876">ocaml/ocaml#9876</a>
Do not cache young_limit in a processor register
</p>

<p>
The PR removes the caching of <code>young_limit</code> in a register for ARM64,
PowerPC and RISC-V ports hardware.
</p></li>
</ul>

<p>
Our thanks to all the OCaml users and developers in the community for their continued support and contribution to the
project, and we look forward to working with you in 2021!
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org8ffec03" class="outline-4">
<h4 id="org8ffec03">Acronyms</h4>
<div class="outline-text-4" id="text-org8ffec03">
<ul class="org-ul">
<li>API: Application Programming Interface</li>
<li>ARM: Advanced RISC Machine</li>
<li>ASLR: Address Space Layout Randomization</li>
<li>AST: Abstract Syntax Tree</li>
<li>CFI: Call Frame Information</li>
<li>CI: Continuous Integration</li>
<li>GC: Garbage Collector</li>
<li>ICFP: International Conference on Functional Programming</li>
<li>JSON: JavaScript Object Notation</li>
<li>OPAM: OCaml Package Manager</li>
<li>PR: Pull Request</li>
<li>RFC: Request For Comments</li>
<li>RISC-V: Reduced Instruction Set Computing - V</li>
<li>UI: User Interface</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-org3f6ff03" class="outline-3">
<h3 id="org3f6ff03">Bikal Lem asked and Anil Madhavapeddy replied</h3>
<div class="outline-text-3" id="text-org3f6ff03">
<blockquote>
<p>
Does this mean ocaml 5.0 will have a concurrency baked right in to the default ocaml? If so, this is an excellent
news also how does this fit in to the mirage stack? i.e. will ocaml 5.0 concurrency work with mirage too?
</p>
</blockquote>

<p>
OCaml 5.0 is slated to have domains-only parallelism and no fibres, but stay tuned for more news on our plans for
fibres shortly.  The Mirage prototype is looking very good so far, but I'm not quite ready to talk about it in more
detail until it's a bit more baked :slight_smile:
</p>
</div>
</div>


<div id="outline-container-org60641fc" class="outline-3">
<h3 id="org60641fc">Simon Cruanes and Anurag Soni asked, and Anil Madhavapeddy replied</h3>
<div class="outline-text-3" id="text-org60641fc">
<p>
Simon Cruanes:
</p>
<blockquote>
<p>
Will there be only one runtime in 5.0? As in, multicore will be the
default, not an opt-in switch as happened with flambda1?
</p>
</blockquote>

<p>
The intention is to have a single runtime, yes.  A huge amount of the work on the multicore project to date (see
<a href="https://arxiv.org/abs/2004.11663">Retrofitting Parallelism onto OCaml</a>) has been focussed on reducing the
performance hit to sequential code when running on a parallel-capable runtime.  If we end up with multiple runtimes
in OCaml 5.0 after all this work, you'll find me sobbing quietly in a corner of the developer meeting.
</p>

<p>
Anurag Soni:
</p>
<blockquote>
<p>
This is exciting to hear. Is the project public? I’ve spent some time over the past couple of months working on
wrappers around the various polling interfaces (I started with <code>kqueue</code> and <code>select</code> ), and I’ve been working on
io-uring bindings as well. After reading this months’s multicore report I think i’d rather work on
testing/contributing to an effort maintained by the multicore team (There are gaps in my ctypes/ocaml runtime
knowledge) instead of duplicating some effort
</p>
</blockquote>

<p>
I've just pushed the non-multicore bits of the uring bindings over to
<a href="https://github.com/ocaml-multicore/ocaml-uring">https://github.com/ocaml-multicore/ocaml-uring</a>. I'm still iterating on them, as there's a very specific design that
minimises heap pressure that we're aiming towards. So not quite ready for contributions yet, but should be soon. The
bindings there should be perfectly usable for pre-OCaml 5.0 use once that design settles (and in fact, I'll probably
add it to Lwt in order to give us experience using io_uring in production ahead of any default use in multicore
OCaml).
</p>

<p>
I've got to say though &#x2013; so far, io_uring has absolutely exceeded my expectations. I never want to look at <code>epoll</code>
again now. And a side worry is that the BSDs are steadily getting left behind in terms of post-POSIX IO standards.
Between io_uring in Linux, Grand Central Dispatch in macOS, and iocp in Windows, we're spoilt for async choice in the
"mainstream" operating systems.
</p>
</div>
</div>


<div id="outline-container-org6a536d5" class="outline-3">
<h3 id="org6a536d5">EduardoRFS then added</h3>
<div class="outline-text-3" id="text-org6a536d5">
<p>
if anyone is playing with multicore, I made this Lwt engine which is capable of running things like opium partially
in parallel, 2x gains when running with 4 domains, it doesn't scale a lot, but 2x is quite nice.
</p>

<p>
Just drop this in a file and setup Lwt with it.
</p>

<p>
<a href="https://gist.github.com/EduardoRFS/0000a193a5a7b964651ef532b412ce5f">https://gist.github.com/EduardoRFS/0000a193a5a7b964651ef532b412ce5f</a>
</p>
</div>
</div>
</div>




<div id="outline-container-org72e1bfc" class="outline-2">
<h2 id="5">Resto 0.6 and 0.6.1</h2>
<div class="outline-text-2" id="text-5">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-resto-0-6-and-0-6-1/7226/1">https://discuss.ocaml.org/t/ann-resto-0-6-and-0-6-1/7226/1</a>
</p>
</div>

<div id="outline-container-org77088af" class="outline-3">
<h3 id="org77088af">Raphaël Proust announced</h3>
<div class="outline-text-3" id="text-org77088af">
<p>
On behalf of <a href="https://nomadic-labs.com/">Nomadic Labs</a>, it is my pleasure to announce the release of resto v0.6 and
v0.6.1. Resto is set of packages to build REST RPC directories and to serve and call the built directories. It is
split into different packages (<code>resto</code>, <code>resto-directory</code>, <code>resto-cohttp-server</code>, <code>resto-cohttp-client</code>, etc.) so as
to minimise dependencies (e.g., you can call a directory without pulling in the server dependencies).
</p>

<p>
Both versions share the same code (see change log below), but the licensing on the code had been mixed up. This is
the reason for the two releases: the version 0.6 is distributed under LGPL with linking exception and the version
0.6.1 is distributed under MIT. Future releases will be under MIT only.
</p>

<p>
The library can be installed from opam.
The code is hosted on Gitlab: <a href="https://gitlab.com/nomadic-labs/resto">https://gitlab.com/nomadic-labs/resto</a>
The documentation is available online: <a href="https://nomadic-labs.gitlab.io/resto/">https://nomadic-labs.gitlab.io/resto/</a>
</p>

<p>
Other than the above packaging/licence fixes, the new versions:
</p>
<ul class="org-ul">
<li>Fix a URL percent-decoding bug in the server</li>
<li>Provide access-control capability to selectively allow/forbid some services</li>
<li>Provide a self-serving client that acts as its own server</li>
<li>Provide support for chunk transfer encoding for large values</li>
<li>Improves the logging and the logging levels</li>
</ul>
</div>
</div>
</div>




<div id="outline-container-org4a3956f" class="outline-2">
<h2 id="6">First release of <code>paf</code>, a simple MirageOS layer for HTTP/AF</h2>
<div class="outline-text-2" id="text-6">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-first-release-of-paf-a-simple-mirageos-layer-for-http-af/7229/1">https://discuss.ocaml.org/t/ann-first-release-of-paf-a-simple-mirageos-layer-for-http-af/7229/1</a>
</p>
</div>

<div id="outline-container-orgb12cb78" class="outline-3">
<h3 id="orgb12cb78">Calascibetta Romain announced</h3>
<div class="outline-text-3" id="text-orgb12cb78">
<p>
I'm glad to announce the first release of <a href="https://github.com/dinosaure/paf-le-chien"><code>paf</code></a>, a simple <a href="https://mirage.io/">MirageOS</a> layer for <a href="https://github.com/inhabitedtype/httpaf"><code>http/af</code></a>
with a <a href="https://github.com/mirleft/ocaml-tls">TLS support</a>. Two simple <span class="underline">unikernels</span> exist into the distribution to show how to use <code>paf</code> with
MirageOS.
</p>

<div class="org-src-container">
<pre class="src src-shell">$ cd unikernel/client
$ mirage configure
$ make depends
$ mirage build
$ ./minipaf -u https://discuss.ocaml.org/
</pre>
</div>
</div>

<div id="outline-container-org98dfb9c" class="outline-4">
<h4 id="org98dfb9c">Unikernel, abstraction, HTTP &amp; TLS</h4>
<div class="outline-text-4" id="text-org98dfb9c">
<p>
About MirageOS, the main problem about the building of an <span class="underline">unikernel</span> is the constraint about the full abstraction.
Indeed, the same piece of code should work for UNIX (as a simple executable) and for <a href="https://github.com/solo5/Solo5">Solo5</a> (to be able to
virtualize the operating system with <a href="https://en.wikipedia.org/wiki/Kernel-based_Virtual_Machine">KVM</a> or <a href="https://xenproject.org/">Xen</a>). MirageOS did the choice to use <span class="underline">functors</span> to abstract
underlying pieces of the operating system such as the TCP/IP stack, the DNS resolver or the TLS stack.
</p>

<p>
HTTP is a good example as a mix of several stacks where the choice of them depends on:
</p>
<ul class="org-ul">
<li>static values such as the target (UNIX or Solo5)</li>
<li>dynamic values such as <code>http</code> or <code>https</code> (depends on the given <code>Uri.t</code>)</li>
</ul>

<p>
<code>paf</code> is a little library which focus on the possibility to use <a href="https://github.com/inhabitedtype/httpaf"><code>http/af</code></a> on MirageOS in the easiest way as
a server and a client for any targets. Static choices are handled by <a href="https://github.com/mirage/functoria"><code>functoria</code></a> which does the
resolution about the implementation of the underlying TCP/IP according to your target:
</p>
<ul class="org-ul">
<li>for Unix, we will use the host's TCP/IP stack</li>
<li>for Solo5, we will use the <a href="https://github.com/mirage/mirage-tcpip">mirage-tcpip</a> implementation</li>
</ul>

<p>
Dynamic choices are handled by <code>mimic</code> which invokes the TLS stack (with <a href="https://github.com/mirleft/ocaml-tls"><code>ocaml-tls</code></a>) or not - depending
on the given <code>Uri.t</code>.
</p>
</div>
</div>

<div id="outline-container-orgf1bcb3c" class="outline-4">
<h4 id="orgf1bcb3c">Let's encrypt challenge</h4>
<div class="outline-text-4" id="text-orgf1bcb3c">
<p>
With all of that and some side improvements about <a href="https://github.com/mirleft/ocaml-tls"><code>ocaml-tls</code></a>/<a href="https://github.com/mirage/ca-certs"><code>ca-certs</code></a> and
<a href="https://github.com/mmaker/ocaml-letsencrypt"><code>letsencrypt</code></a>, we are able to provide a simple <span class="underline">unikernel</span> which does the let's encrypt challenge at
the boot and initiate then an HTTP (with TLS) server (and your valid own certificate).
</p>

<p>
The distribution provides a simple <span class="underline">unikernel</span> which does this job if the user wants to provide an HTTPS service
(with <code>rock</code>, a sub-library of <a href="https://github.com/rgrinberg/opium"><code>opium</code></a>):
</p>
<div class="org-src-container">
<pre class="src src-shell">$ cd unikernel/server
$ mirage configure
$ make depends
$ mirage build
$ ./minipaf --production=false --hostname www.x25519.net --https
</pre>
</div>
</div>
</div>

<div id="outline-container-org8f7c92a" class="outline-4">
<h4 id="org8f7c92a">CoHTTP layer (client part)</h4>
<div class="outline-text-4" id="text-org8f7c92a">
<p>
For a better use, <code>paf</code> provides a not fully-implemented compatible layer with CoHTTP (with another definition of the
<code>ctx</code>, the <code>Mimic.ctx</code>).
</p>
</div>
</div>

<div id="outline-container-orgc8b9021" class="outline-4">
<h4 id="orgc8b9021">Production ready</h4>
<div class="outline-text-4" id="text-orgc8b9021">
<p>
Even if the release still is a beta, I used such implementation for a long time about my <span class="underline">unikernels</span> (which are down
but for some others reasons&#x2026;) and I did not get any errors (for ~ 1 year). The distribution comes with a test which
stress-test the implementation with parallel and concurrent processes.
</p>

<p>
I hope that will help people to play a bit with MirageOS!
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-orgb758ba3" class="outline-2">
<h2 id="7">I'm building a mailing list platform with Ocsigen</h2>
<div class="outline-text-2" id="text-7">
<p>
Archive: <a href="https://discuss.ocaml.org/t/show-im-building-a-mailing-list-platform-with-ocsigen/7236/1">https://discuss.ocaml.org/t/show-im-building-a-mailing-list-platform-with-ocsigen/7236/1</a>
</p>
</div>

<div id="outline-container-orgffa3917" class="outline-3">
<h3 id="orgffa3917">Tom announced</h3>
<div class="outline-text-3" id="text-orgffa3917">
<p>
I've been working on a mailing list platform for the past few months in my spare time, and I thought I would share it
here since I'm building the project using Ocsigen.
</p>

<p>
The project is still in early stages, but I hope the community finds this interesting.
</p>

<p>
<a href="https://postheat.com">postheat.com</a>
</p>
</div>
</div>
</div>




<div id="outline-container-orgb6ae35b" class="outline-2">
<h2 id="orgb6ae35b">Old CWN</h2>
<div class="outline-text-2" id="text-orgb6ae35b">
<p>
If you happen to miss a CWN, you can <a href="mailto:alan.schmitt@polytechnique.org">send me a message</a> and I'll mail it to you, or go take a look at <a href="https://alan.petitepomme.net/cwn/">the archive</a> or the <a href="https://alan.petitepomme.net/cwn/cwn.rss">RSS feed of the archives</a>.
</p>

<p>
If you also wish to receive it every week by mail, you may subscribe <a href="http://lists.idyll.org/listinfo/caml-news-weekly/">online</a>.
</p>

<div class="authorname">
<p>
<a href="https://alan.petitepomme.net/">Alan Schmitt</a>
</p>

</div>
</div>
</div>
</div>
</body>
</html>
