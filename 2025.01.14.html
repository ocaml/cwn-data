<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-01-14 Tue 09:18 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OCaml Weekly News</title>
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<style type="text/css">#table-of-contents h2 { display: none } .title { display: none } .authorname { text-align: right }</style>
<style type="text/css">.outline-2 {border-top: 1px solid black;}</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">OCaml Weekly News</h1>
<p>
<a href="https://alan.petitepomme.net/cwn/2025.01.07.html">Previous Week</a> <a href="https://alan.petitepomme.net/cwn/index.html">Up</a> <a href="https://alan.petitepomme.net/cwn/2025.01.21.html">Next Week</a>
</p>

<p>
Hello
</p>

<p>
Here is the latest OCaml Weekly News, for the week of January 07 to 14, 2025.
</p>

<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#1">On concurrency models</a></li>
<li><a href="#2">OCaml 5.3.0 released</a></li>
<li><a href="#3">dream-html and pure-html 3.9.5</a></li>
<li><a href="#4">Building an OCaml cross compiler with OCaml 5.3</a></li>
<li><a href="#5">Ppx deriving decoders</a></li>
<li><a href="#6">Ortac 0.5.0 testing higher order functions</a></li>
<li><a href="#7">Other OCaml News</a></li>
<li><a href="#org42fa9d3">Old CWN</a></li>
</ul>
</div>
</div>
<div id="outline-container-1" class="outline-2">
<h2 id="1">On concurrency models</h2>
<div class="outline-text-2" id="text-1">
<p>
Archive: <a href="https://discuss.ocaml.org/t/on-concurrency-models/15899/24">https://discuss.ocaml.org/t/on-concurrency-models/15899/24</a>
</p>
</div>
<div id="outline-container-orgf4557b9" class="outline-3">
<h3 id="orgf4557b9">Deep in this thread, Calascibetta Romain announced</h3>
<div class="outline-text-3" id="text-orgf4557b9">
<p>
For those interested, we've spent some time writing <a href="https://robur-coop.github.io/miou/introduction.html">a book</a> on how to use Miou and asynchronous programming with Miou — basically, it introduces Miou's design. In addition, resources that may be of interest are:
</p>
<ul class="org-ul">
<li><a href="https://robur-coop.github.io/miou/retrospective.html">a retrospective</a> of a handheld scheduler implementation compared to what Miou offers</li>
<li><a href="https://robur-coop.github.io/miou/manifesto.html">a manifesto</a> that says the same thing as what I said above</li>
</ul>

<p>
A next release of Miou is in preparation and additions to this ‘little book’ will be made. In particular, there will be an explanation of how we implemented <a href="https://github.com/robur-coop/happy-eyeballs">happy-eyeballs</a>, which remains a good example.
</p>
</div>
</div>
</div>
<div id="outline-container-2" class="outline-2">
<h2 id="2">OCaml 5.3.0 released</h2>
<div class="outline-text-2" id="text-2">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ocaml-5-3-0-released/15916/1">https://discuss.ocaml.org/t/ocaml-5-3-0-released/15916/1</a>
</p>
</div>
<div id="outline-container-org5ac7244" class="outline-3">
<h3 id="org5ac7244">octachron announced</h3>
<div class="outline-text-3" id="text-org5ac7244">
<p>
We have the pleasure of announcing the release of OCaml version 5.3.0. dedicated
to the memory of John William Mauchly and Paul Verlaine on the anniversary of
their death.
</p>

<p class="verse">
De la musique avant toute chose,<br />
Et pour cela préfère l’Impair<br />
</p>

<p class="verse">
(Music first and foremost of all!<br />
Choose your measure of odd not even)<br />
</p>

<p>
Some of the highlights in OCaml 5.3.0 are:
</p>

<ul class="org-ul">
<li><p>
Syntax for deep effect handlers
</p>

<p>
There is now a dedicated syntax for installing deep effect handler
</p>
<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #006f00; font-weight: bold;">match</span> f () <span style="color: #006f00; font-weight: bold;">with</span>
| x -&gt; x
| effect <span style="color: #242521; background-color: #fcf7ef;">Random_float</span>, k -&gt; <span style="color: #444fcf;">Effect.Deep.</span>continue k (<span style="color: #444fcf;">Random.</span>float 1.0)
</pre>
</div>
<p>
This new syntax adds a new <code>effect</code> keyword, which may break existing code.
To improve backward compatibility, this new keyword can be disabled with
the new <code>-keywords</code> flags if needed for backward compatibility.
</p></li>

<li><p>
Restored MSVC port
</p>

<p>
It is now possible to use the MSVC toolchain on Windows, restoring the last
missing port from OCaml 4 (except for the native compiler support for 32-bit
architectures which is not planned)
</p></li>

<li><p>
Re-introduced statistical memory profiling (statmemprof)
</p>

<p>
The submodule <code>Gc.memprof</code> is restored with a slightly different API. This
submodule can be used to monitor memory allocation statistics inside a
program. In OCaml 5, each domain can be monitored independently while child
domains inherit the parent domain profiling profile (if there is one active).
</p></li>

<li><p>
utf-8 encoded Unicode source files and modest support of Unicode identifiers
</p>
<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">type</span> <span style="color: #444fcf;">saison</span> = <span style="color: #242521; background-color: #fcf7ef;">Hiver</span> | &#201;t&#233; | <span style="color: #242521; background-color: #fcf7ef;">Printemps</span> | <span style="color: #242521; background-color: #fcf7ef;">Automne</span> 
</pre>
</div>
<p>
The OCaml lexer has been extended to support a modest subset of Unicode
characters in identifiers. This is mostly intended for pedagogical use. This
extended support requires source files to be utf-8 encoded Unicode text.
</p></li>

<li><p>
More space-efficient implementation of Dynarray
</p>

<p>
The internal implementation of <code>Dynarray</code> now uses an unboxed representation
which avoids the need of storing items wrapped in a <code>Some x</code> block and thus
save some spaces and indirections.
</p></li>

<li><p>
Improved metadata on the pairs of declarations and definitions for merlin.
</p>

<p>
The metadata stored inside cmt files has been improved to better distinguish the provenance of identifiers (previous versions could confuse an interface and implementation identifier).
Similarly, the metadata now tracks more precisely the association between declarations and definitions. For instance, in
</p>
<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">module</span> <span style="color: #444fcf;">X</span> = <span style="color: #000000; font-weight: bold;">struct</span> <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #007a9f;">x</span> = 0 <span style="color: #000000; font-weight: bold;">end</span>
<span style="color: #000000; font-weight: bold;">module</span> <span style="color: #444fcf;">M</span>: <span style="color: #000000; font-weight: bold;">sig</span>
  <span style="color: #000000; font-weight: bold;">val</span> <span style="color: #a7601f;">x</span>: int
<span style="color: #000000; font-weight: bold;">end</span> = <span style="color: #000000; font-weight: bold;">struct</span>
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #007a9f;">x</span> = 1
  <span style="color: #000000; font-weight: bold;">include</span> <span style="color: #444fcf;">X</span>
<span style="color: #000000; font-weight: bold;">end</span>
</pre>
</div>
<p>
Merlin can now determine that the definition of the <code>M.x</code> value lies inside the module <code>X</code>.
</p></li>
</ul>

<p>
And a lot of incremental changes:
</p>

<ul class="org-ul">
<li>Around 20 new functions in the standard library (in the <code>Domain</code>, <code>Dynarray</code>, <code>Format</code>, <code>List</code>, <code>Queue</code>, <code>Sys</code>, and <code>Uchar</code> modules).</li>
<li>Many fixes and improvements in the runtime</li>
<li>Improved error messages for first-class modules, functors, labelled arguments,
and type clashes.</li>
<li>Numerous bug fixes</li>
</ul>

<p>
Please report any unexpected behaviours on the <a href="https://github.com/ocaml/ocaml/issues">OCaml issue tracker</a>.
</p>

<p>
The full list of changes can be found in the changelog below.
</p>

<p>
<i>editor note: please visit <a href="https://discuss.ocaml.org/t/ocaml-5-3-0-released/15916">https://discuss.ocaml.org/t/ocaml-5-3-0-released/15916</a> for the changelog</i>
</p>

<p>
Happy hacking,
Florian Angeletti for the OCaml team.
</p>
</div>
</div>
</div>
<div id="outline-container-3" class="outline-2">
<h2 id="3">dream-html and pure-html 3.9.5</h2>
<div class="outline-text-2" id="text-3">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-dream-html-pure-html-3-9-5/15917/1">https://discuss.ocaml.org/t/ann-dream-html-pure-html-3-9-5/15917/1</a>
</p>
</div>
<div id="outline-container-orgae7e708" class="outline-3">
<h3 id="orgae7e708">Yawar Amin announced</h3>
<div class="outline-text-3" id="text-orgae7e708">
<p>
Happy to announce that dream-html and pure-html 3.9.5 are now available on opam. This is a significant release with three main new things:
</p>

<ol class="org-ol">
<li>Type-safe paths and routing</li>
<li>Support for static asset caching</li>
<li>HTML improvements</li>
</ol>
</div>
<div id="outline-container-org61bab4d" class="outline-4">
<h4 id="org61bab4d">Type-safe paths and routing</h4>
<div class="outline-text-4" id="text-org61bab4d">
<p>
Allows defining paths as values that can be handled by a router and <span class="underline">also</span> rendered by the HTML markup generator, so that the actual routed paths are in sync with the rendered paths in the application. These paths use OCaml's built-in format strings rather than a new DSL: eg <code>/orders/%s/versions/%d</code>. This makes it possible to extract type-safe values from path segments and pass them to the handler; render markup with guaranteed correct paths; and refactor the app's paths without having to hunt for hard-coded strings.
</p>

<p>
See <a href="https://yawaramin.github.io/dream-html/dream-html/Dream_html/#type-safe-routing">the docs</a> for details.
</p>
</div>
</div>
<div id="outline-container-org1386e7a" class="outline-4">
<h4 id="org1386e7a">Static assets support</h4>
<div class="outline-text-4" id="text-org1386e7a">
<p>
Automates the handling of static assets in the application so that they can easily be served by the router with an immutable cache policy and their paths can be rendered in markup with a content-based revision hash, for easy cache-busting.
</p>

<p>
Added a new CLI tool <code>dreamwork</code> which helps with scaffolding this static assets setup. The intention is to use it for more scaffolding tasks in the future–stay tuned.
</p>

<p>
See <a href="https://yawaramin.github.io/dream-html/dream-html/Dream_html/#dreamwork">the docs</a> for details, and <a href="https://x.com/yawaramin/status/1873091198380065132">this screen recording</a> for a short demo.
</p>
</div>
</div>
<div id="outline-container-orgd8a1c9b" class="outline-4">
<h4 id="orgd8a1c9b">HTML improvements</h4>
<div class="outline-text-4" id="text-orgd8a1c9b">
<p>
Thanks to <a href="https://github.com/RezwanArefin01">RezwanArefin01</a> for prettifying the generated HTML. It is now formatted and much easier to read. See the <a href="https://github.com/yawaramin/dream-html/blob/e2a66cc199a28fd3d4a5440a124c90f578b8ae90/test/pure_html_test.expected.txt">snapshots</a> for some examples.
</p>

<p>
Lastly, added <code>HTML.as_</code> which is the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/link#as">as attribute</a>.
</p>

<p>
Enjoy!
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-4" class="outline-2">
<h2 id="4">Building an OCaml cross compiler with OCaml 5.3</h2>
<div class="outline-text-2" id="text-4">
<p>
Archive: <a href="https://discuss.ocaml.org/t/building-an-ocaml-cross-compiler-with-ocaml-5-3/15918/1">https://discuss.ocaml.org/t/building-an-ocaml-cross-compiler-with-ocaml-5-3/15918/1</a>
</p>
</div>
<div id="outline-container-orgc003293" class="outline-3">
<h3 id="orgc003293">shym announced</h3>
<div class="outline-text-3" id="text-orgc003293">
<p>
A cross compiler is a compiler that runs on some <span class="underline">host</span> machine, for instance one running Linux on a 64-bit ARM processor, and generates code for a different <span class="underline">target</span> machine, for instance one running Windows with a 64-bit x86 processor.
Building OCaml cross compilers used to be quite tricky and hackish but many incremental changes to the build system over the last years have improved radically the situation. So much so that, with the most recent changes (<a href="https://github.com/ocaml/ocaml/pull/13526">1</a>, <a href="https://github.com/ocaml/ocaml/pull/13674">2</a>) in the development branch of the compiler, it should be possible to build many cross compilers without extra changes :crossed_fingers:
</p>

<p>
This is all well and good, you might say, but you would rather play with the brand new <a href="https://discuss.ocaml.org/t/ocaml-5-3-0-released/15916">5.3</a> instead of a development branch! So I’ve backported the necessary changes to 5.3.
</p>
</div>
<div id="outline-container-org4390ffc" class="outline-4">
<h4 id="org4390ffc">How to build and use a OCaml 5.3 cross compiler</h4>
<div class="outline-text-4" id="text-org4390ffc">
<p>
To make it easy to test, I’ve written an example OPAM file that can be customised to suit your goal. It takes the example of building a cross compiler to 64-bit x86 Windows MinGW, in particular because that always reveals unexpected issues :-)
</p>

<ol class="org-ol">
<li>Start by creating a 5.3.0 OPAM switch if you haven’t already.</li>

<li>Choose the target you want to create a cross compiler for and find its <a href="https://www.gnu.org/software/autoconf/manual/autoconf-2.71/html_node/Specifying-Target-Triplets.html">target triplet</a>. The GCC C cross compilers and the GNU cross binutils use target triplets as prefixes for the commands, so an easy way to find your triplet is to install the tools. So:</li>

<li>Install the C cross compiler and toolchain for your target. Many Linux distributions package some cross compilers. For instance, the <a href="https://github.com/ocaml/ocaml/blob/trunk/.github/workflows/build-cross.yml">CI tests for cross compilers</a> installs on Ubuntu:

<ul class="org-ul">
<li>the <code>gcc-mingw-w64-x86-64</code> package (which depends on the matching binutils) to cross compile to 64-bit x86 Windows MinGW; in that case, that target machine is identified by the <code>x86_64-w64-mingw32</code> triplet, so it calls <code>configure</code> with the argument <code>--target=x86_64-w64-mingw32</code>,</li>
<li>the <code>gcc-aarch64-linux-gnu</code> package to cross compile to 64-bit arm Linux; in that case, the target machine is identified by the <code>aarch64-linux-gnu</code> triplet.</li>
</ul></li>

<li><p>
Create a new OPAM package interactively for instance by choosing the name of the package (<code>ocaml-xyz</code> or even <code>ocaml-cross-xyz</code> are good choices I’d say; my <a href="https://gist.github.com/shym/44da1daaefe11c74e6c4363b14ae7ee0#file-ocaml-cross-windows-opam">example</a> uses <code>ocaml-cross-windows</code>, for instance) and run:
</p>
<pre class="example" id="org643a6bb">
opam pin add --edit ocaml-cross-xyz -
</pre>

<p>
This will open an editor so that you can fill in the instructions on how to build your cross compiler. Use my <a href="https://gist.github.com/shym/44da1daaefe11c74e6c4363b14ae7ee0#file-ocaml-cross-windows-opam">example</a> to get you started. In particular you’ll want to configure the <code>--target</code> parameter with the triplet for your target (that could be the only change!). If your toolchain and C compiler use that triplet as a prefix for all the commands, <code>configure</code> will find them automatically. Otherwise you’ll need to explicitly set them, by adding arguments such as <code>CC=...</code> to <code>configure</code>. The <a href="https://github.com/ocaml/ocaml/blob/trunk/.github/workflows/build-cross.yml">CI tests for cross compilers</a> contains such an example to cross compile to Android where <code>CC</code>, <code>AR</code>, <code>PARTIALLD</code>, <code>RANLIB</code> and <code>STRIP</code> are explicitly set&#x2026; In other words, I suggest to experiment first with an example with automatic configuration!
</p></li>
</ol>

<p>
You should now have a cross compiler! Let’s use it on a simple sanity check <code>test.ml</code>:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #8f6f4a; font-style: italic;">(* </span><span style="color: #8f6f4a; font-style: italic;">Is the proper (target) OS identified?</span><span style="color: #8f6f4a; font-style: italic;"> *)</span>
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #007a9f;">_</span> =
  <span style="color: #444fcf;">Printf.</span>printf <span style="color: #ca3400;">"Version: %s\nOS: %s\nUnix: %b\nWin: %b\nCygwin: %b\n"</span>
    <span style="color: #444fcf;">Sys.</span>ocaml_version <span style="color: #444fcf;">Sys.</span>os_type <span style="color: #444fcf;">Sys.</span>unix <span style="color: #444fcf;">Sys.</span>win32 <span style="color: #444fcf;">Sys.</span>cygwin

<span style="color: #8f6f4a; font-style: italic;">(* </span><span style="color: #8f6f4a; font-style: italic;">Do the compiler libs work?</span><span style="color: #8f6f4a; font-style: italic;"> *)</span>
<span style="color: #8f6f4a; font-style: italic;">(* </span><span style="color: #8f6f4a; font-style: italic;">The interface for [Arch] is not the same across processor architectures, the</span>
<span style="color: #8f6f4a; font-style: italic;">   following assumes your target is 64-bit x86</span><span style="color: #8f6f4a; font-style: italic;"> *)</span>
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #007a9f;">_</span> =
  <span style="color: #444fcf;">Printf.</span>printf <span style="color: #ca3400;">"allow_unaligned_access = %b\n"</span> <span style="color: #444fcf;">Arch.</span>allow_unaligned_access;
  <span style="color: #444fcf;">Printf.</span>printf <span style="color: #ca3400;">"win64 = %b\n"</span> <span style="color: #444fcf;">Arch.</span>win64
</pre>
</div>

<p>
The package <code>ocaml-cross-xyz</code> will install an <code>ocamlfind</code> toolchain called <code>xyz</code>. So we can compile <code>test.ml</code> thus:
</p>

<pre class="example" id="org17dc8e0">
ocamlfind -toolchain xyz opt -package compiler-libs.optcomp -linkpkg test.ml -verbose
</pre>

<p>
where <code>-verbose</code> let you check what is actually being run. If your target is Windows MinGW (so cross compiling from some unix), you probably need an extra step before this compilation can go through: the tool <code>flexlink.exe</code> which is used to link the final Windows binary has been built as part of the package but <code>ocamlopt</code> will expect to find a command <code>flexlink</code> (note in particular the absence of <code>.exe</code>) so I suggest to <code>ln -s</code> the <code>flexlink</code> binary somewhere in your <code>PATH</code>. For instance, it could be:
</p>

<pre class="example" id="org8b97846">
ln -s "$(opam show --list-files ocaml-cross-xyz | grep flexlink.opt.exe)" ~/bin/flexlink
</pre>

<p>
and then you will be able to run the <code>ocamlfind -toolchain ...</code> command to compile your program.
</p>
</div>
</div>
<div id="outline-container-org1403c3a" class="outline-4">
<h4 id="org1403c3a">Gotchas and details</h4>
<div class="outline-text-4" id="text-org1403c3a">
<ol class="org-ol">
<li>Beware that having a <code>flexlink</code> command in <code>PATH</code> breaks OCaml (5.3 and before)’s <code>configure</code> if you’re not on Windows; this will be fixed in 5.4.</li>

<li>The <a href="https://gist.github.com/shym/44da1daaefe11c74e6c4363b14ae7ee0#file-ocaml-cross-windows-opam">example</a> OPAM package contains SHA256 sums for <code>.patch</code> files generated on the fly from the corresponding commits but they might change without notice (to add an extra digit to the SHA1 they contain, for instance). If you notice that, ping me so that I can update the SHA256 sums in the gist.</li>

<li><p>
The <a href="https://gist.github.com/shym/44da1daaefe11c74e6c4363b14ae7ee0#file-ocaml-cross-windows-opam">example</a> OPAM package pulls the official OCaml 5.3.0 archive along with two patches:
</p>
<ul class="org-ul">
<li>the first one is a large commit that squashes all the commits that I backported from upstream,</li>
<li>the second one is a small commit that adds the generation of the <code>ocamlfind</code> toolchain configuration.</li>
</ul>

<p>
You can find the detailed backport on my <a href="https://github.com/shym/ocaml/tree/5.3+ocross/"><code>5.3+ocross</code></a> branch and its <a href="https://github.com/ocaml/ocaml/compare/5.3.0...shym:ocaml:5.3+ocross">comparison</a> with the official release. The squashed commit lives on its <a href="https://github.com/shym/ocaml/tree/5.3.0+ocross-squashed/">own branch</a>.
</p></li>
</ol>
</div>
</div>
</div>
</div>
<div id="outline-container-5" class="outline-2">
<h2 id="5">Ppx deriving decoders</h2>
<div class="outline-text-2" id="text-5">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-ppx-deriving-decoders/15921/1">https://discuss.ocaml.org/t/ann-ppx-deriving-decoders/15921/1</a>
</p>
</div>
<div id="outline-container-orgbb152dd" class="outline-3">
<h3 id="orgbb152dd">Ben Bellick announced</h3>
<div class="outline-text-3" id="text-orgbb152dd">
<p>
A little late but wanted to share a package I have released!
</p>

<p>
For those familiar with the excellent <a href="https://github.com/mattjbray/ocaml-decoders">ocaml-decoders</a> package, I have written <a href="http://github.com/benbellick/ppx_deriving_decoders">ppx_deriving_decoders</a> to automatically generate the corresponding decoders (and encoders) based off of type definitions. 
</p>

<p>
In my view, this gives the best of both worlds in terms of:
</p>
<ol class="org-ol">
<li>automatically generating (e.g. JSON) serialization and deserialization based off of a type definition, and</li>
<li>having a readable and expressive language for handwriting encoders and decoders when necessary by using combinators.</li>
</ol>

<p>
The instructions in the README demonstrate how you can use the generated decoder as a base point from which to hand tweak and get your own custom decoder.
</p>

<p>
Please let me know if you find it useful or have any feedback. Thanks!
</p>
</div>
</div>
</div>
<div id="outline-container-6" class="outline-2">
<h2 id="6">Ortac 0.5.0 testing higher order functions</h2>
<div class="outline-text-2" id="text-6">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-ortac-0-5-0-testing-higher-order-functions/15945/1">https://discuss.ocaml.org/t/ann-ortac-0-5-0-testing-higher-order-functions/15945/1</a>
</p>
</div>
<div id="outline-container-org3c6b3cb" class="outline-3">
<h3 id="org3c6b3cb">Nicolas Osborne announced</h3>
<div class="outline-text-3" id="text-org3c6b3cb">
<p>
Hi everyone!
</p>

<p>
I'm very pleased to announce the release of the Ortac-0.5.0 packages for specification-driven testing!
</p>

<p>
Ortac/QCheck-STM is a test generator based on the <a href="https://github.com/ocaml-multicore/multicoretests">QCheck-STM</a> model-based testing framework and the <a href="https://github.com/ocaml-gospel/gospel">Gospel</a> specification language for OCaml.
</p>

<p>
This new release brings three new features.
</p>

<p>
In the effort to increase the coverage of the generated tests and thanks to Jan Midtgaard, we now support testing higher order functions. Thanks Jan!
</p>

<p>
It is also now possible to test a module exposed as a sub-module by Dune, specifying the module's prefix in a CLI optional argument. A feature that we've been asked to add.
</p>

<p>
And to test an actual sub-module defined inside an OCaml file, specifying the sub-module in a CLI optional argument as well.
</p>

<p>
Ortac/Dune generates the Dune boilerplate for you. It has been updated to support the two new optional arguments.
</p>

<p>
You can install those packages via opam:
</p>

<pre class="example" id="org877cd4d">
$ opam install ortac-qcheck-stm ortac-dune
</pre>

<p>
Then you write some Gospel specifications in your library's interface file <code>foo.mli</code>:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">type</span> <span style="color: #444fcf;">'a t</span>
<span style="color: #8f6f4a; font-style: italic;">(*</span><span style="color: #8f6f4a; font-style: italic;">@ mutable model contents : 'a sequence</span><span style="color: #8f6f4a; font-style: italic;"> *)</span>

<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #a7601f;">make</span> : int -&gt; 'a -&gt; 'a t
<span style="color: #8f6f4a; font-style: italic;">(*</span><span style="color: #8f6f4a; font-style: italic;">@ t = make i a</span>
<span style="color: #8f6f4a; font-style: italic;">    ensures t.contents = Sequence.init i (fun _ -&gt; a)</span><span style="color: #8f6f4a; font-style: italic;"> *)</span>

<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #a7601f;">for_all</span> : ('a -&gt; bool) -&gt; 'a t -&gt; bool
<span style="color: #8f6f4a; font-style: italic;">(*</span><span style="color: #8f6f4a; font-style: italic;">@ b = for_all p t</span>
<span style="color: #8f6f4a; font-style: italic;">    ensures b = Sequence.fold_left (fun acc a -&gt; acc &amp;&amp; p a) true t.contents</span><span style="color: #8f6f4a; font-style: italic;"> *)</span>
</pre>
</div>

<p>
Then a simple configuration file <code>foo_config.ml</code>:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">type</span> <span style="color: #444fcf;">sut</span> = char t

<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #007a9f;">init_sut</span> = make 42 <span style="color: #ca3400;">'a'</span>
</pre>
</div>

<p>
And you can generate some specification-driven model-based tests for your library just by running:
</p>

<pre class="example" id="orga0cee8e">
$ ortac qcheck-stm foo.mli foo_config.ml
</pre>

<p>
If you want to integrate the generation and the running of the tests to your dune setup (which is highly recommended), just add the following stanza to your dune file in your test directory:
</p>

<div class="org-src-container">
<pre class="src src-dune">(rule
 (alias runtest)
 (mode promote)
 (action
  (with-stdout-to
   dune.inc
   (run ortac dune qcheck-stm foo.mli))))

(include dune.inc)
</pre>
</div>

<p>
You'll find more information in the <a href="https://ocaml-gospel.github.io/ortac/ortac-qcheck-stm/index.html">Ortac/QCheck-STM documentation</a>, the <a href="https://github.com/ocaml-gospel/ortac/blob/main/plugins/dune-rules/README.md">Ortac/Dune README</a> and the <a href="https://github.com/ocaml-gospel/ortac/tree/main/examples"><code>examples</code> folder</a>. I'm also happy to answer questions.
</p>

<p>
Happy testing!
</p>
</div>
</div>
</div>
<div id="outline-container-7" class="outline-2">
<h2 id="7">Other OCaml News</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-orga029df6" class="outline-3">
<h3 id="orga029df6">From the ocaml.org blog</h3>
<div class="outline-text-3" id="text-orga029df6">
<p>
Here are links from many OCaml blogs aggregated at <a href="https://ocaml.org/blog/">the ocaml.org blog</a>.
</p>

<ul class="org-ul">
<li><a href="https://chshersh.com/blog/2025-01-06-the-most-elegant-configuration-language.html">The Most Elegant Configuration Language</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org42fa9d3" class="outline-2">
<h2 id="org42fa9d3">Old CWN</h2>
<div class="outline-text-2" id="text-org42fa9d3">
<p>
If you happen to miss a CWN, you can <a href="mailto:alan.schmitt@polytechnique.org">send me a message</a> and I'll mail it to you, or go take a look at <a href="https://alan.petitepomme.net/cwn/">the archive</a> or the <a href="https://alan.petitepomme.net/cwn/cwn.rss">RSS feed of the archives</a>.
</p>

<p>
If you also wish to receive it every week by mail, you may subscribe to the <a href="https://sympa.inria.fr/sympa/info/caml-list">caml-list</a>.
</p>

<div class="authorname" id="org14b29fa">
<p>
<a href="https://alan.petitepomme.net/">Alan Schmitt</a>
</p>

</div>
</div>
</div>
</div>
</body>
</html>
