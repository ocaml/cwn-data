<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2018-11-06 Tue 11:17 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OCaml Weekly News</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<style type="text/css">#table-of-contents h2 { display: none } .title { display: none } .authorname { text-align: right }</style>
<style type="text/css">.outline-2 {border-top: 1px solid black;}</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">OCaml Weekly News</h1>
<p>
<a href="http://alan.petitepomme.net/cwn/2018.10.16.html">Previous Week</a> <a href="http://alan.petitepomme.net/cwn/index.html">Up</a> <a href="http://alan.petitepomme.net/cwn/2018.11.06.html">Next Week</a>
</p>

<p>
Hello
</p>

<p>
Here is the latest OCaml Weekly News, for the week of October 16 to 23, 2018.
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#1">NYC OCaml Meetup</a></li>
<li><a href="#2">Structured-concurrency libraries</a></li>
<li><a href="#3">ocaml-git 2.0</a></li>
<li><a href="#4">Tutorial for Cohttp-lwt as API client</a></li>
<li><a href="#5">Ocaml Github Pull Requests</a></li>
<li><a href="#6">Other OCaml News</a></li>
<li><a href="#org2a095f5">Old CWN</a></li>
</ul>
</div>
</div>


<div id="outline-container-orgb8e09db" class="outline-2">
<h2 id="1"><a id="orgb8e09db"></a>NYC OCaml Meetup</h2>
<div class="outline-text-2" id="text-1">
<p>
Archive: <a href="https://discuss.ocaml.org/t/nyc-ocaml-meetup/2743/1">https://discuss.ocaml.org/t/nyc-ocaml-meetup/2743/1</a>
</p>
</div>

<div id="outline-container-orgbd6af56" class="outline-3">
<h3 id="orgbd6af56">Perry E. Metzger announced</h3>
<div class="outline-text-3" id="text-orgbd6af56">
<p>
For those that live in New York City and aren't aware, there's an NYC OCaml meetup: <a href="https://www.meetup.com/NYC-OCaml/">https://www.meetup.com/NYC-OCaml/</a>
</p>

<p>
We had a fun informal gathering last week, there's a tech talk next week, and the announcements for Jane Street's tech talks also go (semi-indirectly) to the meetup.
</p>
</div>
</div>
</div>




<div id="outline-container-org5d94046" class="outline-2">
<h2 id="2"><a id="org5d94046"></a>Structured-concurrency libraries</h2>
<div class="outline-text-2" id="text-2">
<p>
Archive: <a href="https://discuss.ocaml.org/t/structured-concurrency-libraries/2742/1">https://discuss.ocaml.org/t/structured-concurrency-libraries/2742/1</a>
</p>
</div>

<div id="outline-container-org44b78d0" class="outline-3">
<h3 id="org44b78d0">Alex Coventry asked</h3>
<div class="outline-text-3" id="text-org44b78d0">
<p>
Are there any mature structured-concurrency libraries for OCaml, similar to <a href="http://libdill.org/">dill</a> or <a href="https://trio.readthedocs.io/en/latest/">trio</a>?
</p>
</div>
</div>


<div id="outline-container-org063f943" class="outline-3">
<h3 id="org063f943">Freyr666 replied</h3>
<div class="outline-text-3" id="text-org063f943">
<p>
If you want concurrency with OCaml, you'd better stick to monadic concurrency, aka <a href="https://ocsigen.org/lwt/4.1.0/manual/manual">lwt</a> or <a href="https://opensource.janestreet.com/async/">async</a>. Both are mature and battle-tested.
</p>
</div>
</div>


<div id="outline-container-orgf7f8396" class="outline-3">
<h3 id="orgf7f8396">Alex Coventry then said</h3>
<div class="outline-text-3" id="text-orgf7f8396">
<p>
I'm aware of lwt and async. I mean <a href="http://libdill.org/structured-concurrency.html#what-is-structured-concurrency">something like this</a>.
</p>
</div>
</div>
</div>




<div id="outline-container-orgf21b6f8" class="outline-2">
<h2 id="3"><a id="orgf21b6f8"></a>ocaml-git 2.0</h2>
<div class="outline-text-2" id="text-3">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-ocaml-git-2-0/2740/1">https://discuss.ocaml.org/t/ann-ocaml-git-2-0/2740/1</a>
</p>
</div>

<div id="outline-container-org17b9f4f" class="outline-3">
<h3 id="org17b9f4f">Calascibetta Romain announced</h3>
<div class="outline-text-3" id="text-org17b9f4f">
<p>
I'm very happy to announce a new major release of <code>ocaml-git</code> (2.0). This release is a 2-year effort to get a revamped streaming API offering a full control over memory allocation. This new version also adds production-ready implementations of the wire protocol: <code>git push</code> and <code>git pull</code> now work very reliably using the raw Git and smart HTTP protocol (SSH support will come soon). <code>git gc</code> is also implemented, and all of the basic bricks are now available to create Git servers. MirageOS support is available out-of-the-box.
</p>

<p>
Two years ago, we decided to rewrite <code>ocaml-git</code> and split it into standalone libraries. More details about these new libraries are also given below.
</p>

<p>
But first, let's focus on <code>ocaml-git</code>'s new design. The primary goal was to fix memory consumption issues that our users noticed with the previous version, and to make <code>git push</code> work reliably. We also took care about not breaking the API too much, to ease the transition for current users.
</p>
</div>

<div id="outline-container-org184a6af" class="outline-4">
<h4 id="org184a6af">Controlled allocations</h4>
<div class="outline-text-4" id="text-org184a6af">
<p>
There is a big difference in the way <code>ocaml-git</code> and <code>git</code> are designed: <code>git</code> is a short-lived command-line tool which does not care that much about allocation policies, whereas we wanted to build a library that can be linked with long-lived Git client and/or server applications. We had to make some (performance) compromises to support that use-case, at the benefit of tighter allocation policies — and hence more predictable memory consumption patterns. Other Git libraries such as <a href="https://libgit2.org/">libgit2</a> also have to <a href="https://libgit2.org/security/">deal</a> with similar concerns.
</p>

<p>
In order to keep a tight control on the allocated memory, we decided to use <a href="https://github.com/mirage/decompress">decompress</a> instead of <code>camlzip</code>. <code>decompress</code> allows the users to provide their own buffer instead of allocating dynamically. This allowed us to keep a better control on memory consumption. See below for more details on <code>decompress</code>.
</p>

<p>
We also used <a href="https://github.com/inhabitedtype/angstrom">angstrom</a> and <a href="https://github.com/mirage/encore">encore</a> to provide a streaming interface to encode and decode Git objects. The streaming API is currently hidden to the end-user, but it helped us a lot to build abstraction and, again, on managing the allocation policy of the library.
</p>
</div>
</div>

<div id="outline-container-org5b19a54" class="outline-4">
<h4 id="org5b19a54">Complete PACK file support (including GC)</h4>
<div class="outline-text-4" id="text-org5b19a54">
<p>
In order to find the right abstraction for manipulating pack files in a long-lived application, we experimented with <a href="https://github.com/dinosaure/sirodepac">various</a> <a href="https://github.com/dinosaure/carton">prototypes</a>. We haven't found the right abstractions just yet, but we believe the PACK format could be useful to store any kind of data in the future (and not especially Git objects).
</p>

<p>
We implemented <code>git gc</code> by following the same heuristics as <a href="https://github.com/git/git/blob/master/Documentation/technical/pack-heuristics.txt">Git</a> to compress pack files and we produce something similar in size — <code>decompress</code> has a good ratio about compression — and we are using <code>duff</code>, our own implementation of <code>xdiff</code>, the binary diff algorithm used by Git (more details on <code>duff</code> below). We also had to re-implement the streaming algorithm to reconstruct <code>idx</code> files on the fly, when receiving pack file on the network.
</p>

<p>
One notable feature of our compression algorithms is they work without the assumption that the underlying system implements POSIX: hence, they can work fully in-memory, in a browser using web storage or inside a MirageOS unikernel with <a href="https://github.com/g2p/wodan">wodan</a>.
</p>
</div>
</div>

<div id="outline-container-org0e8cd14" class="outline-4">
<h4 id="org0e8cd14">Production-ready push and pull</h4>
<div class="outline-text-4" id="text-org0e8cd14">
<p>
We re-implemented and abstracted the <a href="https://github.com/git/git/blob/master/Documentation/technical/http-protocol.txt">Git Smart protocol</a>, and used that abstraction to make <code>git push</code> and <code>git pull</code> work over HTTP.  By default we provide a <a href="https://github.com/mirage/cohttp">cohttp</a> implementation but users can use their own — for instance based on <code>httpaf</code>.  As proof-of-concept, the <a href="https://github.com/mirage/ocaml-git/pull/227">initial pull-request</a> was created using this new implementation; moreover, we wrote a prototype of a Git client compiled with <code>js_of_ocaml</code>, which were able to run <code>git pull</code> over HTTP inside a browser!
</p>

<p>
Finally, that implementation will allow MirageOS unikernels to synchronize their internal state with external Git stores (hosted for instance on GitHub) using push/pull mechanisms. We also expect to release a server-side implementation of the smart HTTP protocol, so that the state of any unikernel can be inspected via <code>git pull</code>. Stay tuned for more updates on that topic!
</p>
</div>
</div>


<div id="outline-container-orga332ab7" class="outline-4">
<h4 id="orga332ab7">Standalone Dependencies</h4>
<div class="outline-text-4" id="text-orga332ab7">
<p>
Below you can find the details of the new stable releases of libraries that are used by <code>ocaml-git</code> 2.0.
</p>
</div>

<ul class="org-ul">
<li><a id="org69e2bad"></a><code>optint</code> and <code>checkseum</code><br />
<div class="outline-text-5" id="text-org69e2bad">
<p>
In some parts of <code>ocaml-git</code>, we need to compute a Circular Redundancy Check value. It is 32-bit integer value. <code>optint</code> provides an abstraction of it but structurally uses an unboxed integer or a boxed <code>int32</code> value depending on target (32 bit or 64 bit architecture).
</p>

<p>
<code>checkseum</code> relies on <code>optint</code> and provides 3 implementations of CRC:
</p>
<ul class="org-ul">
<li>Adler32 (used by <code>zlib</code> format)</li>
<li>CRC32 (used by <code>gzip</code> format and <code>git</code>)</li>
<li>CRC32-C (used by <code>wodan</code>)</li>
</ul>

<p>
<code>checkseum</code> uses the <span class="underline">linking trick</span>: this means that users of the library program against an abstract API (only the <code>cmi</code> is provided); at link-time, users have to select which implementation to use: <code>checkseum.c</code> (the C implementation) or <code>checkseum.ocaml</code> (the OCaml implementation). The process is currently a bit cumbersome but upcoming <code>dune</code> release will make that process much more transparent to the users.
</p>
</div>
</li>

<li><a id="org7d970c9"></a><code>encore</code> (<i><span class="underline">angkor</span></i>)<br />
<div class="outline-text-5" id="text-org7d970c9">
<p>
In <code>git</code>, we work with Git <span class="underline">objects</span> (_tree_, <span class="underline">blob</span> or <span class="underline">commit</span>). These objects are encoded in a specific format. Then, the hash of these objects are computed from the encoded result to get a unique identifier. For example, the hash of your last commit is: <code>sha1(encode(commit))</code>.
</p>

<p>
A common operation in <code>git</code> is to decode Git objects from an encoded representation of them (especially in <code>.git/objects/*</code> as a <span class="underline">loose</span> file) and restore them in another part of your Git repository (like in a PACK file or on the command-line).
</p>

<p>
Hence, we need to ensure that encoding is always deterministic, and that decoding an encoded Git object is always the identity, e.g. there is an <span class="underline">isomorphism</span> between the decoder and the encoder.
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">decoder</span> <span style="color: #a52a2a;">&lt;.&gt;</span> encoder <span style="color: #a52a2a;">:</span> value <span style="color: #a52a2a;">-&gt;</span> value <span style="color: #a52a2a;">=</span> id
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">encoder</span> <span style="color: #a52a2a;">&lt;.&gt;</span> decoder <span style="color: #a52a2a;">:</span> string <span style="color: #a52a2a;">-&gt;</span> string <span style="color: #a52a2a;">=</span> id
</pre>
</div>

<p>
<a href="https://github.com/mirage/encore">encore</a> is a library in which you can describe a format (like Git format) and from it, we can derive a streaming decoder <span class="underline"><span class="underline">and</span></span> encoder that are isomorphic by construction.
</p>
</div>
</li>

<li><a id="org7f71cd6"></a><code>duff</code><br />
<div class="outline-text-5" id="text-org7f71cd6">
<p>
<code>duff</code> is a pure implementation in OCaml of the <code>xdiff</code> algorithm. Git has an optimized representation of your Git repository. It's a PACK file. This format uses a binary diff algorithm called <code>xdiff</code> to compress binary data. <code>xdiff</code> takes a source A and a target B and try to find common sub-strings between A and B.
</p>

<p>
This is done by a Rabin's fingerprint of the source A applied to the target B. The fingerprint can then be used to produce a lightweight representation of B in terms of sub-strings of A.
</p>

<p>
<code>duff</code> implements this algorithm (with additional Git's constraints, regarding the size of the sliding windows) in OCaml. It provides a small binary <code>xduff</code> that complies with the format of Git without the <code>zlib</code> layer.
</p>

<div class="org-src-container">
<pre class="src src-shell">$ xduff diff source target &gt; target.xduff
$ xduff patch source &lt; target.xduff &gt; target.new
$ diff target target.new
$ echo $<span style="color: #a0522d;">?</span>
0
</pre>
</div>
</div>
</li>

<li><a id="org90076fe"></a><code>decompress</code><br />
<div class="outline-text-5" id="text-org90076fe">
<p>
<code>decompress</code> is a pure implementation in OCaml of <code>zlib</code> and <code>rfc1951</code>. You can compress and decompress data flows and, obviously, Git does this compression in <span class="underline">loose</span> files and PACK files.
</p>

<p>
It provides a non-blocking interface and is easily usable in a server context. Indeed, the implementation never allocates and only relies on what the user provides (<code>window</code>, input and output buffer). Then, the distribution provides an easy example of how to use <code>decompress</code>:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">inflate</span><span style="color: #a52a2a;">:</span> <span style="color: #008b8b;">?level</span><span style="color: #a52a2a;">:</span>int <span style="color: #a52a2a;">-&gt;</span> string <span style="color: #a52a2a;">-&gt;</span> string
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">deflate</span><span style="color: #a52a2a;">:</span> string <span style="color: #a52a2a;">-&gt;</span> string
</pre>
</div>
</div>
</li>

<li><a id="orgbf3b5ee"></a><code>digestif</code><br />
<div class="outline-text-5" id="text-orgbf3b5ee">
<p>
<code>digestif</code> is a toolbox providing many implementations of hash algorithms such as:
</p>

<ul class="org-ul">
<li>MD5</li>
<li>SHA1</li>
<li>SHA224</li>
<li>SHA256</li>
<li>SHA384</li>
<li>SHA512</li>
<li>BLAKE2B</li>
<li>BLAKE2S</li>
<li>RIPEMD160</li>
</ul>

<p>
Like <code>checkseum</code>, <code>digestif</code> uses the linking trick too: from a shared interface, it provides 2 implementations, in C (<code>digestif.c</code>) and OCaml (<code>digestif.ocaml</code>).
</p>

<p>
Regarding Git, we use the SHA1 implementation and we are ready to migrate <code>ocaml-git</code> to BLAKE2{B,S} as the Git core team expects - and, in the OCaml world, it is just a <span class="underline">functor</span> application with another implementation.
</p>
</div>
</li>

<li><a id="org22ca6ae"></a><code>eqaf</code><br />
<div class="outline-text-5" id="text-org22ca6ae">
<p>
Some applications require that secret values are compared in constant time. Functions like <code>String.equal</code> do not have this property, so we have decided to provide a small package — <a href="https://github.com/mirage/eqaf">eqaf</a> — providing a <span class="underline">constant-time</span> <code>equal</code> function. <code>digestif</code> uses it to check equality of hashes — it also exposes <code>unsafe_compare</code> if you don't care about timing attacks in your application.
</p>

<p>
Of course, the biggest work on this package is not about the implementation of the <code>equal</code> function but a way to check the constant-time assumption on this function. Using this, we did a <a href="https://github.com/mirage/eqaf/tree/master/test">benchmark</a> on Linux, Windows and Mac to check it.
</p>

<p>
An interesting fact is that after various experiments, we replaced the initial implementation in C (extracted from OpenBSD's <a href="https://man.openbsd.org/timingsafe_bcmp.3">timingsafe_memcmp</a>) with an OCaml implementation behaving in a much more predictable way on all the tested platforms.
</p>
</div>
</li>
</ul>
</div>

<div id="outline-container-org83fb9dc" class="outline-4">
<h4 id="org83fb9dc">Conclusion</h4>
<div class="outline-text-4" id="text-org83fb9dc">
<p>
The upcoming version 2.0 of Irmin is using ocaml-git to create small applications that <a href="https://github.com/mirage/irmin/blob/master/examples/push.ml">push and pull their state to GitHub</a>. We think that Git offers a very nice model to persist data for distributed applications and we hope that more people will use ocaml-git to experiment and manipulate application data in Git. Please <a href="https://github.com/mirage/ocaml-git">send us</a> your feedback!
</p>
</div>
</div>
</div>


<div id="outline-container-orgc0b9a65" class="outline-3">
<h3 id="orgc0b9a65">Bozhidar Hristov asked and Perry E. Metzger replied</h3>
<div class="outline-text-3" id="text-orgc0b9a65">
<p>
&gt; When is it usefult to use ocaml-git over standard git? Why is is it called a long lived git client?
</p>

<p>
The usual git is a set of command line tools for use by humans. <code>ocaml-git</code> is a set of libraries for building git repository manipulating and managing software in ocaml. If you're trying to write software in ocaml that manipulates a git repo at more than a trivial level or even has intimate knowledge of git internals, this is your library of choice.
</p>
</div>
</div>


<div id="outline-container-org1aa0501" class="outline-3">
<h3 id="org1aa0501">Bozhidar Hristov asked and Calascibetta Romain replied</h3>
<div class="outline-text-3" id="text-org1aa0501">
<p>
&gt; Thanks for the answer, do you also know of a practical use case of such a program?
</p>

<p>
<code>ocaml-git</code> was initialy developped for <a href="https://github.com/mirage/irmin"><code>irmin</code></a>. The idea behind it is to provide a way to have a persistant store for an unikernel/MirageOS. By this way, we need to apply on some assumptions:
</p>

<ul class="org-ul">
<li>make a library to be able to link it (static link) with the rest of the OS</li>
<li>use OCaml</li>
</ul>

<p>
<code>ocaml-git</code> provides some binaries (like <code>ogit-write-tree</code>, etc.) but it's only as little example of how to use this library. The goal is definitely not (at this stage) to provide a new CLI tool. Then, as a library, <code>ocaml-git</code> wants to be used in a server-context to be synchronized with differents endpoints (GitHub, MirageOS, local Git repository, etc.).
</p>

<p>
Finally, a practical example could be done with <code>irmin</code> when you want to have an access to the store of your unikernel without any access on it (SSH for example). You just need to <code>push</code> to a Git repository which is synchronized with your unikernel and then, your unikernel will load what you push (safely).
</p>

<p>
A good example is <a href="https://github.com/Engil/Canopy">Canopy</a> with is a static blog (unikernel). When you want to add a new unikernel, instead to remake your unikernel, you tell him to be synchronized with a GitHub repository which contains your articles - a real world example is <a href="https://hannes.nqsb.io/">the blog</a> of @hannesm. Of course, we have others examples (like DNS server synchronized with a <code>zonefile</code> available on a Git repository).
</p>
</div>
</div>


<div id="outline-container-org753710d" class="outline-3">
<h3 id="org753710d">Marek Kubica asked and Thomas Gazagnaire replied</h3>
<div class="outline-text-3" id="text-org753710d">
<p>
&gt; How complete is it? Can it determine the status of a working directory, which branch is checked out, how many files are added, deleted and unknown or is it more like an implementation of the data structures used within git?
</p>

<p>
&gt; In particular I have this shell prompt script which is very slow and I would like to replace it without shelling out to a number of git commands while avoiding to also implement half of git itself.
</p>

<p>
We have full coverage for the on-disk and wire protocol, so reading the current branch is easy.
</p>

<p>
We also have support for <a href="https://github.com/mirage/ocaml-git/blob/master/src/git-unix/index.mli">working tree</a> but this is not as well tested (and documented&#x2026;) than the rest of the code, so you might hit performance and usability issues. We would be happy to support that better, so please feel free to report any issues!
</p>
</div>
</div>
</div>




<div id="outline-container-org055cbed" class="outline-2">
<h2 id="4"><a id="org055cbed"></a>Tutorial for Cohttp-lwt as API client</h2>
<div class="outline-text-2" id="text-4">
<p>
Archive: <a href="https://discuss.ocaml.org/t/tutorial-for-cohttp-lwt-as-api-client/2746/1">https://discuss.ocaml.org/t/tutorial-for-cohttp-lwt-as-api-client/2746/1</a>
</p>
</div>

<div id="outline-container-orgb0dc82a" class="outline-3">
<h3 id="orgb0dc82a">Abhinav Sharma asked</h3>
<div class="outline-text-3" id="text-orgb0dc82a">
<p>
I was trying to get started with practical <code>OCaml</code> via writing API clients and decided to experiment with <a href="https://deckofcardsapi.com/">https://deckofcardsapi.com/</a> as a starting point to discover the libraries.
</p>

<p>
However, the only pieces of documentation I've come across for these are the following
</p>
<ul class="org-ul">
<li><a href="https://discuss.ocaml.org/t/how-to-write-a-simple-web-client/1756">https://discuss.ocaml.org/t/how-to-write-a-simple-web-client/1756</a></li>
<li>The <code>client_lwt.ml</code> example in the <code>cohttp</code> github repo</li>
</ul>

<p>
But unfortunately, I haven't quite been able to make my way through these. So, I decided to ask for help from the <code>OCaml</code> community regarding the same.
</p>

<p>
Could you guide me a bit here ?
</p>
</div>
</div>


<div id="outline-container-org1c5b518" class="outline-3">
<h3 id="org1c5b518">Marcello Seri replied</h3>
<div class="outline-text-3" id="text-org1c5b518">
<p>
I hope the following will help, it's just a rough example. You can actually copy and paste it in <code>utop</code>. You will need <code>cohttp-lwt-unix</code> and <code>yojson</code> installed. For <code>yojson</code> refer to <a href="http://dev.realworldocaml.org/json.html#handling-json-data">RWO</a>, it is fine even if you don't use <code>core</code>.
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #708090;">#require</span> <span style="color: #8b2252;">"cohttp-lwt-unix"</span><span style="color: #ff4500;">;;</span>
<span style="color: #708090;">#require</span> <span style="color: #8b2252;">"yojson"</span><span style="color: #ff4500;">;;</span>

<span style="color: #b22222;">(* </span><span style="color: #b22222;">A bit overkill to open everything </span><span style="color: #b22222;">*)</span>
<span style="color: #000000; font-weight: bold;">open </span><span style="color: #228b22;">Cohttp</span>
<span style="color: #000000; font-weight: bold;">open </span><span style="color: #228b22;">Cohttp_lwt_unix</span>
<span style="color: #000000; font-weight: bold;">open </span><span style="color: #228b22;">Lwt.Infix</span>
<span style="color: #000000; font-weight: bold;">open </span><span style="color: #228b22;">Yojson</span>
<span style="color: #ff4500;">;;</span>

<span style="color: #b22222;">(* </span><span style="color: #b22222;">Make a get call and return the body parsed as json.</span>
<span style="color: #b22222;"> * You could use atdgen to produce the right marshalling</span>
<span style="color: #b22222;"> * functions into nice records, but for such small data</span>
<span style="color: #b22222;"> * structures you might as well do it by hands.</span>
<span style="color: #b22222;"> *</span>
<span style="color: #b22222;"> * val json_body : string -&gt; Basic.json Lwt.t</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*)</span>
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">json_body</span><span style="color: #a0522d;"> uri</span> <span style="color: #a52a2a;">=</span>
  <span style="color: #228b22;">Client.</span>get <span style="color: #a52a2a;">(</span><span style="color: #228b22;">Uri.</span>of_string uri<span style="color: #a52a2a;">)</span>  <span style="color: #a52a2a;">&gt;&gt;=</span> <span style="color: #a020f0;">fun</span> <span style="color: #a52a2a;">(</span><span style="color: #a0522d;">_resp</span><span style="color: #a52a2a;">,</span><span style="color: #a0522d;"> body</span><span style="color: #a52a2a;">)</span> <span style="color: #a52a2a;">-&gt;</span>
  <span style="color: #b22222;">(* </span><span style="color: #b22222;">here you could check the headers or the response status</span>
<span style="color: #b22222;">   * and deal with errors, see the example on cohttp repo README </span><span style="color: #b22222;">*)</span>
  body <span style="color: #a52a2a;">|&gt;</span> <span style="color: #228b22;">Cohttp_lwt.Body.</span>to_string <span style="color: #a52a2a;">&gt;|=</span> <span style="color: #228b22;">Yojson.Basic.</span>from_string
<span style="color: #ff4500;">;;</span>

<span style="color: #b22222;">(* </span><span style="color: #b22222;">In utop the promise is realised immediately, so if you run the</span>
<span style="color: #b22222;"> * function above, you'll get the result immediately </span><span style="color: #b22222;">*)</span>
json_body <span style="color: #8b2252;">"http://deckofcardsapi.com/api/deck/new/shuffle/?deck_count=1"</span>
<span style="color: #ff4500;">;;</span>
<span style="color: #b22222;">(*</span><span style="color: #b22222;">Output:</span>
<span style="color: #b22222;">- : Basic.json =</span>
<span style="color: #b22222;">`Assoc</span>
<span style="color: #b22222;">  [("shuffled", `Bool true); ("success", `Bool true); ("remaining", `Int 52);</span>
<span style="color: #b22222;">   ("deck_id", `String "2svxenasd9qj")]</span>
<span style="color: #b22222;">*)</span>

<span style="color: #b22222;">(* </span><span style="color: #b22222;">In the code you will have more likely something like the following. </span><span style="color: #b22222;">*)</span>
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">shuffled_deck</span> <span style="color: #a52a2a;">=</span>
  json_body <span style="color: #8b2252;">"http://deckofcardsapi.com/api/deck/new/shuffle/?deck_count=1"</span>
<span style="color: #ff4500;">;;</span>
<span style="color: #b22222;">(* </span><span style="color: #b22222;">val shuffled_deck : Basic.json Lwt.t </span><span style="color: #b22222;">*)</span>

<span style="color: #b22222;">(* </span><span style="color: #b22222;">To use it you just have to get use to the monadic bind, and once you</span>
<span style="color: #b22222;"> * are ready, call `Lwt_main.run`. e.g. the kind of useless example below </span><span style="color: #b22222;">*)</span>

<span style="color: #b22222;">(* </span><span style="color: #b22222;">val get_cards : Basic.json -&gt; int -&gt; Basic.json Lwt.t </span><span style="color: #b22222;">*)</span>
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">get_cards</span><span style="color: #a0522d;"> sdeck n</span> <span style="color: #a52a2a;">=</span>
  <span style="color: #b22222;">(* </span><span style="color: #b22222;">The use of Yojson is well explained in RWO </span><span style="color: #b22222;">*)</span>
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #000000; font-weight: bold;">module</span> <span style="color: #228b22;">YBU</span> <span style="color: #a52a2a;">=</span> <span style="color: #228b22;">Yojson.Basic.Util</span> <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">success</span> <span style="color: #a52a2a;">=</span> sdeck <span style="color: #a52a2a;">|&gt;</span> <span style="color: #228b22;">YBU.</span>member <span style="color: #8b2252;">"success"</span> <span style="color: #a52a2a;">|&gt;</span> <span style="color: #228b22;">YBU.</span>to_bool <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #a020f0;">if</span> <span style="color: #a52a2a;">not</span> success <span style="color: #a020f0;">then</span> <span style="color: #228b22;">Lwt.</span>fail_with <span style="color: #8b2252;">"Error while shuffling"</span> <span style="color: #a020f0;">else</span>
    <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">deck_id</span> <span style="color: #a52a2a;">=</span> sdeck <span style="color: #a52a2a;">|&gt;</span> <span style="color: #228b22;">YBU.</span>member <span style="color: #8b2252;">"deck_id"</span> <span style="color: #a52a2a;">|&gt;</span> <span style="color: #228b22;">YBU.</span>to_string <span style="color: #000000; font-weight: bold;">in</span>
    <span style="color: #228b22;">Printf.</span>sprintf <span style="color: #8b2252;">"http://deckofcardsapi.com/api/deck/%s/draw/?count=%d"</span> deck_id n
    <span style="color: #a52a2a;">|&gt;</span> json_body <span style="color: #a52a2a;">&gt;&gt;=</span> <span style="color: #a020f0;">fun</span> <span style="color: #a0522d;">cards</span> <span style="color: #a52a2a;">-&gt;</span>
    <span style="color: #228b22;">Lwt.</span>return cards

<span style="color: #b22222;">(* </span><span style="color: #b22222;">val do_something : unit -&gt; string list Lwt.t </span><span style="color: #b22222;">*)</span>
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">do_something</span><span style="color: #a0522d;"> </span><span style="color: #a52a2a;">()</span> <span style="color: #a52a2a;">=</span>
  json_body <span style="color: #8b2252;">"http://deckofcardsapi.com/api/deck/new/shuffle/?deck_count=1"</span> <span style="color: #a52a2a;">&gt;&gt;=</span> <span style="color: #a020f0;">fun</span> <span style="color: #a0522d;">sdeck</span> <span style="color: #a52a2a;">-&gt;</span>
  get_cards sdeck 3 <span style="color: #a52a2a;">&gt;&gt;=</span> <span style="color: #a020f0;">fun</span> <span style="color: #a0522d;">jcards</span> <span style="color: #a52a2a;">-&gt;</span>
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #000000; font-weight: bold;">module</span> <span style="color: #228b22;">YBU</span> <span style="color: #a52a2a;">=</span> <span style="color: #228b22;">Yojson.Basic.Util</span> <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">cards</span> <span style="color: #a52a2a;">=</span> jcards <span style="color: #a52a2a;">|&gt;</span> <span style="color: #228b22;">YBU.</span>member <span style="color: #8b2252;">"cards"</span> <span style="color: #a52a2a;">|&gt;</span> <span style="color: #228b22;">YBU.</span>to_list <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #228b22;">List.</span>map <span style="color: #a52a2a;">(</span><span style="color: #a020f0;">fun</span> <span style="color: #a0522d;">c</span> <span style="color: #a52a2a;">-&gt;</span> c <span style="color: #a52a2a;">|&gt;</span> <span style="color: #228b22;">YBU.</span>member <span style="color: #8b2252;">"code"</span> <span style="color: #a52a2a;">|&gt;</span> <span style="color: #228b22;">YBU.</span>to_string<span style="color: #a52a2a;">)</span> cards
  <span style="color: #a52a2a;">|&gt;</span> <span style="color: #228b22;">Lwt.</span>return

<span style="color: #b22222;">(* </span><span style="color: #b22222;">val do_something_else : unit -&gt; unit Lwt.t </span><span style="color: #b22222;">*)</span>
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">do_something_else</span><span style="color: #a0522d;"> </span><span style="color: #a52a2a;">()</span> <span style="color: #a52a2a;">=</span>
  do_something <span style="color: #a52a2a;">()</span> <span style="color: #a52a2a;">&gt;&gt;=</span> <span style="color: #a020f0;">fun</span> <span style="color: #a0522d;">cards</span> <span style="color: #a52a2a;">-&gt;</span>
  <span style="color: #228b22;">List.</span>iter <span style="color: #a52a2a;">(</span><span style="color: #228b22;">Printf.</span>printf <span style="color: #8b2252;">"%s\n"</span><span style="color: #a52a2a;">)</span> cards <span style="color: #a52a2a;">|&gt;</span> <span style="color: #228b22;">Lwt.</span>return<span style="color: #ff4500;">;;</span>
<span style="color: #ff4500;">;;</span>

<span style="color: #228b22;">Lwt_main.</span>run <span style="color: #a52a2a;">(</span>do_something_else <span style="color: #a52a2a;">());</span> print_endline <span style="color: #8b2252;">"Done!"</span>
<span style="color: #ff4500;">;;</span>

<span style="color: #b22222;">(* </span><span style="color: #b22222;">Be careful with the signatures, the example above can be re-run multiple</span>
<span style="color: #b22222;"> * times, while the one below does nothing after the first run </span><span style="color: #b22222;">*)</span>

<span style="color: #b22222;">(* </span><span style="color: #b22222;">val do_something_1 : string list Lwt.t </span><span style="color: #b22222;">*)</span>
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">do_something_1</span> <span style="color: #a52a2a;">=</span>
  json_body <span style="color: #8b2252;">"http://deckofcardsapi.com/api/deck/new/shuffle/?deck_count=1"</span> <span style="color: #a52a2a;">&gt;&gt;=</span> <span style="color: #a020f0;">fun</span> <span style="color: #a0522d;">sdeck</span> <span style="color: #a52a2a;">-&gt;</span>
  get_cards sdeck 3 <span style="color: #a52a2a;">&gt;&gt;=</span> <span style="color: #a020f0;">fun</span> <span style="color: #a0522d;">jcards</span> <span style="color: #a52a2a;">-&gt;</span>
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #000000; font-weight: bold;">module</span> <span style="color: #228b22;">YBU</span> <span style="color: #a52a2a;">=</span> <span style="color: #228b22;">Yojson.Basic.Util</span> <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">cards</span> <span style="color: #a52a2a;">=</span> jcards <span style="color: #a52a2a;">|&gt;</span> <span style="color: #228b22;">YBU.</span>member <span style="color: #8b2252;">"cards"</span> <span style="color: #a52a2a;">|&gt;</span> <span style="color: #228b22;">YBU.</span>to_list <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #228b22;">List.</span>map <span style="color: #a52a2a;">(</span><span style="color: #a020f0;">fun</span> <span style="color: #a0522d;">c</span> <span style="color: #a52a2a;">-&gt;</span> c <span style="color: #a52a2a;">|&gt;</span> <span style="color: #228b22;">YBU.</span>member <span style="color: #8b2252;">"code"</span> <span style="color: #a52a2a;">|&gt;</span> <span style="color: #228b22;">YBU.</span>to_string<span style="color: #a52a2a;">)</span> cards
  <span style="color: #a52a2a;">|&gt;</span> <span style="color: #228b22;">Lwt.</span>return

<span style="color: #b22222;">(* </span><span style="color: #b22222;">val do_something_else_1 : unit Lwt.t </span><span style="color: #b22222;">*)</span>
<span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">do_something_else_1</span> <span style="color: #a52a2a;">=</span>
  do_something_1  <span style="color: #a52a2a;">&gt;&gt;=</span> <span style="color: #a020f0;">fun</span> <span style="color: #a0522d;">cards</span> <span style="color: #a52a2a;">-&gt;</span>
  <span style="color: #228b22;">List.</span>iter <span style="color: #a52a2a;">(</span><span style="color: #228b22;">Printf.</span>printf <span style="color: #8b2252;">"%s\n"</span><span style="color: #a52a2a;">)</span> cards <span style="color: #a52a2a;">|&gt;</span> <span style="color: #228b22;">Lwt.</span>return<span style="color: #ff4500;">;;</span>
<span style="color: #ff4500;">;;</span>

<span style="color: #228b22;">Lwt_main.</span>run do_something_else_1<span style="color: #a52a2a;">;</span> print_endline <span style="color: #8b2252;">"Done_1!"</span>
<span style="color: #ff4500;">;;</span>
<span style="color: #228b22;">Lwt_main.</span>run do_something_else_1<span style="color: #a52a2a;">;</span> print_endline <span style="color: #8b2252;">"Done_1!"</span>
<span style="color: #ff4500;">;;</span>
<span style="color: #228b22;">Lwt_main.</span>run do_something_else_1<span style="color: #a52a2a;">;</span> print_endline <span style="color: #8b2252;">"Done_1!"</span>
<span style="color: #ff4500;">;;</span>
<span style="color: #228b22;">Lwt_main.</span>run <span style="color: #a52a2a;">(</span>do_something_else <span style="color: #a52a2a;">());</span> print_endline <span style="color: #8b2252;">"Done!"</span>
<span style="color: #ff4500;">;;</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orgf109dc7" class="outline-3">
<h3 id="orgf109dc7">Marcello Seri then added</h3>
<div class="outline-text-3" id="text-orgf109dc7">
<p>
I forgot to mention that you can reduce the conversions boilerplate easily with <code>ppx_deriving_yojson</code>
</p>
</div>
</div>


<div id="outline-container-org2e7d186" class="outline-3">
<h3 id="org2e7d186">Marcello Seri also added</h3>
<div class="outline-text-3" id="text-org2e7d186">
<p>
There is also the <a href="http://dev.realworldocaml.org/concurrent-programming.html#example-searching-definitions-with-duckduckgo">example in Real world ocaml</a>, althouh that uses <code>cohttp-async</code>. It should be relatively straightforward to translate.
</p>

<p>
Having a nice tutorial to add to the repo and the community documentation would be good. I am not a power user, but I can try to help. What you would loke to know?
</p>
</div>
</div>


<div id="outline-container-orgfc34a61" class="outline-3">
<h3 id="orgfc34a61">Abhinav Sharma replied</h3>
<div class="outline-text-3" id="text-orgfc34a61">
<p>
Thanks @mseri for the link!
</p>

<p>
However, I'd really love to get started with <code>lwt</code> as I'm more inclined towards the <code>mirageOS</code> that relies on <code>lwt</code>  .
</p>

<p>
For now, what I'd like to do is to just wrap the deckofcards API in a utop session as the starting point. If possible, could you please share the snippets that could help me accomplish these tasks ?
</p>

<p>
Here are the libraries I've identified so far
</p>

<ul class="org-ul">
<li><code>yojson</code></li>
<li><code>lwt</code></li>
<li><code>cohttp-lwt</code></li>
</ul>

<p>
Are there any good resources to learn <code>lwt</code> apart from the main <code>ocsigen</code> docs ?
</p>
</div>
</div>


<div id="outline-container-orgd05fa55" class="outline-3">
<h3 id="orgd05fa55">Etienne Millon then said</h3>
<div class="outline-text-3" id="text-orgd05fa55">
<p>
I recently published <a href="https://github.com/emillon/ocaml-zeit">zeit</a> which is client library for a JSON REST API using  cohttp-lwt, yojson and ppx_deriving_yojson. You might be interested by <a href="https://github.com/emillon/ocaml-zeit/blob/cdcdd0b155d406d1b8c8947e3c620527c3c9ecf7/lib/client.ml">the Client module</a>.
</p>
</div>
</div>


<div id="outline-container-org7bda9cf" class="outline-3">
<h3 id="org7bda9cf">Martin Jambon also replied</h3>
<div class="outline-text-3" id="text-org7bda9cf">
<p>
Managing json APIs is what <a href="https://atd.readthedocs.io/en/latest/">atdgen</a> was designed for. You write your types and <code>atdgen</code> derives the OCaml code to convert your data from/to json safely. It also provides ways to deal with APIs that don't fit the OCaml type system perfectly (json adapters being the most flexible but last-resort method).
</p>
</div>
</div>


<div id="outline-container-org6b46cb6" class="outline-3">
<h3 id="org6b46cb6">Martin Jambon then added</h3>
<div class="outline-text-3" id="text-org6b46cb6">
<p>
These are the type definitions that we used at my previous company for using the Google Calendar API: <a href="https://github.com/esperco/esper-gcal-api">https://github.com/esperco/esper-gcal-api</a>
</p>
</div>
</div>
</div>




<div id="outline-container-orgda98566" class="outline-2">
<h2 id="5"><a id="orgda98566"></a>Ocaml Github Pull Requests</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-orge47f085" class="outline-3">
<h3 id="orge47f085">Gabriel Scherer and the editor compiled this list</h3>
<div class="outline-text-3" id="text-orge47f085">
<p>
Here is a sneak peek at some potential future features of the Ocaml
compiler, discussed by their implementers in these Github Pull Requests.
</p>

<ul class="org-ul">
<li><a href="https://github.com/ocaml/ocaml/pull/2002">Format.pp_print_custom_break, a more general break hint</a></li>
<li><a href="https://github.com/ocaml/ocaml/pull/2047">A type for unification traces</a></li>
<li><a href="https://github.com/ocaml/ocaml/pull/2058">Full explanation for unsafe cycles in recursive modules</a></li>
<li><a href="https://github.com/ocaml/ocaml/pull/2091">Add a warning on type declarations "type t = ()"</a></li>
<li><a href="https://github.com/ocaml/ocaml/pull/2096">In error messages, print the source fragment responsible for the error</a></li>
<li><a href="https://github.com/ocaml/ocaml/pull/2102">Syntactic redirection of identifiers as a way to move libraries forward</a></li>
<li><a href="https://github.com/ocaml/ocaml/pull/2106">Disallow .~ in extended indexing operators</a></li>
<li><a href="https://github.com/ocaml/ocaml/pull/2111">Explicit stdlib design choices</a></li>
</ul>
</div>
</div>
</div>




<div id="outline-container-orge73167c" class="outline-2">
<h2 id="6"><a id="orge73167c"></a>Other OCaml News</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-org8f65a1e" class="outline-3">
<h3 id="org8f65a1e">From the ocamlcore planet blog</h3>
<div class="outline-text-3" id="text-org8f65a1e">
<p>
Here are links from many OCaml blogs aggregated at <a href="http://ocaml.org/community/planet/">OCaml Planet</a>.
</p>

<ul class="org-ul">
<li><a href="https://tarides.com/blog/2018-10-19-ocaml-git-2-0.html">ocaml-git 2.0</a></li>
<li><a href="http://www.ocamlpro.com/2018/10/17/ocamlpros-tzscan-grant-proposal-accepted-by-the-tezos-foundation-joint-press-release/">OCamlPro’s TZScan grant proposal accepted by the Tezos Foundation – joint press release</a></li>
<li><a href="https://tarides.com/blog/2018-10-17-ocamlformat-0-8.html">OCamlFormat 0.8</a></li>
<li><a href="https://tarides.com/blog.html#2018-09-27-ocaml-workshop-2018">OCaml Workshop 2018</a></li>
</ul>
</div>
</div>
</div>




<div id="outline-container-org2a095f5" class="outline-2">
<h2 id="org2a095f5">Old CWN</h2>
<div class="outline-text-2" id="text-org2a095f5">
<p>
If you happen to miss a CWN, you can <a href="mailto:alan.schmitt@polytechnique.org">send me a message</a> and I'll mail it to you, or go take a look at <a href="http://alan.petitepomme.net/cwn/">the archive</a> or the <a href="http://alan.petitepomme.net/cwn/cwn.rss">RSS feed of the archives</a>.
</p>

<p>
If you also wish to receive it every week by mail, you may subscribe <a href="http://lists.idyll.org/listinfo/caml-news-weekly/">online</a>.
</p>

<div class="authorname">
<p>
<a href="http://alan.petitepomme.net/">Alan Schmitt</a>
</p>

</div>
</div>
</div>
</div>
</body>
</html>
