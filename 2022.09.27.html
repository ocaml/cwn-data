<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-09-27 Tue 09:14 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OCaml Weekly News</title>
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<style type="text/css">#table-of-contents h2 { display: none } .title { display: none } .authorname { text-align: right }</style>
<style type="text/css">.outline-2 {border-top: 1px solid black;}</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">OCaml Weekly News</h1>
<p>
<a href="https://alan.petitepomme.net/cwn/2022.09.20.html">Previous Week</a> <a href="https://alan.petitepomme.net/cwn/index.html">Up</a> <a href="https://alan.petitepomme.net/cwn/2022.10.04.html">Next Week</a>
</p>

<p>
Hello
</p>

<p>
Here is the latest OCaml Weekly News, for the week of September 20 to 27, 2022.
</p>

<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#1">Esperanto, when OCaml meets Cosmopolitan</a></li>
<li><a href="#2">OBazl Toolsuite - tools for building OCaml with Bazel</a></li>
<li><a href="#3">Orsetto: structured data interchange languages (release 1.1.2)</a></li>
<li><a href="#4">Interest in a Http_sig library?</a></li>
<li><a href="#5">Outreachy summer &rsquo;22 closing commemoration session on 23rd Sept</a></li>
<li><a href="#6">findlib-1.9.6</a></li>
<li><a href="#7">Interesting OCaml Articles</a></li>
<li><a href="#8">Other OCaml News</a></li>
<li><a href="#org90444f6">Old CWN</a></li>
</ul>
</div>
</div>


<div id="outline-container-1" class="outline-2">
<h2 id="1">Esperanto, when OCaml meets Cosmopolitan</h2>
<div class="outline-text-2" id="text-1">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-esperanto-when-ocaml-meets-cosmopolitan/10501/1">https://discuss.ocaml.org/t/ann-esperanto-when-ocaml-meets-cosmopolitan/10501/1</a>
</p>
</div>

<div id="outline-container-org5fced17" class="outline-3">
<h3 id="org5fced17">Calascibetta Romain announced</h3>
<div class="outline-text-3" id="text-org5fced17">
<p>
I am delighted to present the first <b>experimental</b> release of Esperanto. This project is a new OCaml <span class="underline">toolchain</span>
that creates binaries compiled with the <a href="https://justine.lol/cosmopolitan/">Cosmopolitan C library</a> and linked with the <a href="https://justine.lol/ape.html">αcτµαlly
pδrταblε εxεcµταblε</a> link script. The binary produced is then portable to different platforms:
</p>

<p>
<img src="https://worker.jart.workers.dev/redbean/linux.png" alt="linux.png" />
<img src="https://worker.jart.workers.dev/redbean/windows10.png" alt="windows10.png" />
<img src="https://worker.jart.workers.dev/redbean/msdos60.png" alt="msdos60.png" />
<img src="https://worker.jart.workers.dev/redbean/macos.png" alt="macos.png" />
<img src="https://worker.jart.workers.dev/redbean/freebsd64.png" alt="freebsd64.png" />
<img src="https://worker.jart.workers.dev/redbean/openbsd.png" alt="openbsd.png" />
<img src="https://worker.jart.workers.dev/redbean/netbsd2.png" alt="netbsd2.png" />
</p>

<p>
The main objective of Esperanto is to provide a toolchain capable of producing a portable binary from an existing
project. This would allow to finally be able to distribute software for all these platforms without having to:
</p>
<ol class="org-ol">
<li>manage multiple platforms orthogonally, the Cosmopolitan C library offers you the POSIX API for all platforms (including Windows)</li>
<li>Produce several versions of the same software for each platform. Only the binary is needed to run on all platforms</li>
</ol>

<p>
Cosmopolitan <b>does not</b> however produce a binary with a multi-platform assembler. At this stage, our distribution
only supports the <code>x86_64</code> assembler (the most common one) but we are working on the possibility to produce a binary
with different assemblers.
</p>

<p>
I would like to give special thanks to Justine, the author of the Cosmopolitan project (to develop
<a href="https://redbean.dev/">redbean</a>, a small portable HTTP server) for her excellent work.
</p>
</div>

<div id="outline-container-orga41dc25" class="outline-4">
<h4 id="orga41dc25">A <span class="underline">toolchain</span></h4>
<div class="outline-text-4" id="text-orga41dc25">
<p>
In OCaml, the &ldquo;toolchain&rdquo; principle allows the existence of several compilers within an OPAM switch and to choose
one of them when it comes to cross-compiling a project. This principle, even though it is not clearly defined and
even though its use remains very limited, exists through the `ocamlfind` tool.
</p>

<p>
You can find these toolchains in your switch:
</p>
<div class="org-src-container">
<pre class="src src-shell">$ <span style="color: #065fff;">ls</span> $<span style="color: #375cd8;">(</span>opam var lib<span style="color: #375cd8;">)</span>/findlib.conf.d/
esperanto.conf solo5.conf
</pre>
</div>

<p>
From our experience with Mirage as well as the work done in <code>dune</code> regarding cross-compilation, the choice to
propose a new <span class="underline">toolchain</span> in order to allow cross-compilation of projects with OPAM is both a historical choice but
also the most relevant one in our opinion [1].
</p>
</div>

<ul class="org-ul">
<li><a id="org9ecc665"></a>Why we need to cross-compile?<br />
<div class="outline-text-5" id="text-org9ecc665">
<p>
The term cross-compilation can be misunderstood if we only consider the question of the assembler issued by the
compiler (does it match the host assembler or not). In our case, cross-compilation is a broader term that implies
the use of external artefacts to the compiler that are different from the default and the use of compiler options
that must be used throughout the production of the final binary.
</p>

<p>
In other words, even though we are emitting the same assembler, we are doing so in a different &ldquo;context&rdquo; which
requires the definition of a new <span class="underline">toolchain</span> which includes our artefacts and compiler options.
</p>

<p>
One of these artefacts is of course the C library used by the compiler which will then be systematically used by the
<span class="underline">runtime caml</span>, the well named <code>libasmrun.a</code>. This is why, for example, there is a version of OCaml with
<a href="https://musl.libc.org/">musl</a>. So there must be a version of OCaml with Cosmopolitan.
</p>

<p>
This new <span class="underline">toolchain</span> also allows you to include the necessary options for compiling C files because, yes, you can
compile a C file with <code>ocamlopt</code>.
</p>

<p>
In order to provide a coherent <span class="underline">workflow</span> for a project, we need to provide not only a <code>libasmrun.a</code> compiled with
our Cosmopolitan C library but also an OCaml compiler capable of invoking the C compiler with the right options
required by Cosmopolitan.
</p>

<p>
Finally, we also need to describe in this <span class="underline">toolchain</span> how to link the object files together to actually produce a
portable binary using the APE script.
</p>
</div>
</li>

<li><a id="org86c798e"></a>A simple example with this new <span class="underline">toolchain</span><br />
<div class="outline-text-5" id="text-org86c798e">
<p>
Installing Esperanto is very easy with OPAM. It will install the cross-compiler and the necessary files so that
<code>ocamlfind~/~dune</code> can recognise this new <span class="underline">toolchain</span>:
</p>
<div class="org-src-container">
<pre class="src src-shell">$ opam install esperanto
</pre>
</div>

<p>
Finally, let&rsquo;s try to produce a simple binary that displays &ldquo;Hello World!&rdquo;:
</p>
<div class="org-src-container">
<pre class="src src-shell">$ <span style="color: #065fff;">cat</span> &gt;main.ml &lt;&lt;EOF
<span style="color: #406f90; font-style: italic;">let () = print_endline "Hello World!"</span>
<span style="color: #406f90; font-style: italic;">EOF</span>
$ ocamlfind -toolchain opt main.ml
$ objcopy -S -O binary a.out
$ file a.out
a.out: DOS/MBR boot sector
</pre>
</div>

<p>
The binary produced can already be executed. However, there are still some issues that have been fixed since then
but which are probably not yet integrated in your system. They concern <code>zsh</code> and <code>binfmt_misc</code> in particular.
</p>

<p>
The first problem with <code>zsh</code> is that it does not recognise the binary correctly. This problem has been fixed in the
latest version of <code>zsh.5.9.0</code>.
</p>
<div class="org-src-container">
<pre class="src src-shell">$ zsh --version
zsh 5.8.1
$ zsh
$ ./a.out
zsh: exec format error: ./a.out
</pre>
</div>

<p>
The second problem concerns <code>binfmt_misc</code> which intervenes upstream at the execution of your programs in order to
choose how to execute them. In this case, <code>binfmt_misc</code> recognises Cosmopolitan binaries as Windows software by
default.
</p>

<p>
Here too, a solution is available and described by the author of Cosmopolitan here: <a href="https://justine.lol/apeloader/#binfmt_misc">APE loader</a>
</p>
</div>

<ul class="org-ul">
<li><a id="org3ad916b"></a>Execution &amp; Assimilation<br />
<div class="outline-text-6" id="text-org3ad916b">
<p>
If you are not concerned by the above problems, you can simply run the program:
</p>
<div class="org-src-container">
<pre class="src src-shell">$ ./a.out
Hello World!
</pre>
</div>

<p>
There is a final solution that requires a little explanation of what αcτµαlly pδrταblε εxεcµταblε is. Indeed, the
latter makes it possible to create a polyglot binary whose first point of entry is not your program but a small
program which tries to recognize on which platform the binary tries to run.
</p>

<p>
After this recognition, this little program will &ldquo;inject&rdquo; values corresponding to the platform in which you try to
run your program in order to finally let Cosmopolitan manage the translation between its interface and the real
POSIX interface that your system offers.
</p>

<p>
Of course, this step has a cost as it adds an indirection between what your program wants to do and what is
available on the system running your program. However, APE offers a very special option that allows the program to
be assimilated to the platform in which it wants to run.
</p>
<div class="org-src-container">
<pre class="src src-shell">$ file a.out
a.out: DOS/MBR boot sector
$ sh -c <span style="color: #9f4a00;">"./a.out --assimilate"</span>
$ file a.out
a.out: ELF 64-bit LSB executable, x86-64
$ ./a.out
Hello World!
</pre>
</div>

<p>
This option makes your application truly native to the platform in which you run it. This means above all that the
program is <b>no longer</b> portable.
</p>
</div>
</li>

<li><a id="orgf3788aa"></a>Esperanto, <code>dune</code> &amp; <code>opam monorepo</code><br />
<div class="outline-text-6" id="text-orgf3788aa">
<p>
The <code>dune</code> software also incorporates this toolchain idea using the <code>-x</code> option. More pragmatically, it is possible
to define a new dune context to use Esperanto as a compilation toolchain.
</p>

<p>
However, the original aim of Esperanto is to produce a portable binary. This implies, among other things, that it
should not depend on remaining artefacts in order to run and, in this sense, the compilation of your project should
be a static compilation. This means that all dependencies of your project must be available to compile in the same
context as your project.
</p>

<p>
Again, this is particularly necessary if any of your dependencies include C files, so they need to be compiled in
some way.
</p>

<p>
This is where <code>opam monorepo</code> comes in, it will simply &ldquo;vendor&rdquo; your dependencies into a &ldquo;duniverse&rdquo; folder. Here
are the steps needed to compile a project with Esperanto. We&rsquo;ll take <a href="https://github.com/mirage/decompress"><code>decompress</code></a> as an example which
produces a binary that can compress/decompress documents:
</p>
<div class="org-src-container">
<pre class="src src-shell">$ <span style="color: #065fff;">git</span> clone https://github.com/mirage/decompress
$ <span style="color: #065fff;">cd</span> decompress
$ <span style="color: #065fff;">cat</span> &gt;&gt;bin/dune &lt;&lt;EOF
<span style="color: #406f90; font-style: italic;">(rule</span>
<span style="color: #406f90; font-style: italic;"> (target decompress.com)</span>
<span style="color: #406f90; font-style: italic;"> (enabled_if</span>
<span style="color: #406f90; font-style: italic;">  (= %{context_name} esperanto))</span>
<span style="color: #406f90; font-style: italic;"> (mode promote)</span>
<span style="color: #406f90; font-style: italic;"> (deps decompress.exe)</span>
<span style="color: #406f90; font-style: italic;"> (action (run objcopy -S -O binary %{deps} %{target})))</span>
<span style="color: #406f90; font-style: italic;">EOF</span>
$ <span style="color: #065fff;">cat</span> &gt;dune-workspace &lt;&lt;EOF
<span style="color: #406f90; font-style: italic;">(lang dune 2.0)</span>
<span style="color: #406f90; font-style: italic;">(context (default))</span>
<span style="color: #406f90; font-style: italic;">(context</span>
<span style="color: #406f90; font-style: italic;"> (default</span>
<span style="color: #406f90; font-style: italic;">  (name esperanto)</span>
<span style="color: #406f90; font-style: italic;">  (toolchain esperanto)</span>
<span style="color: #406f90; font-style: italic;">  (merlin)</span>
<span style="color: #406f90; font-style: italic;">  (host default)))</span>
<span style="color: #406f90; font-style: italic;">$ opam monorepo lock --build-only</span>
<span style="color: #406f90; font-style: italic;">$ opam monorepo pull</span>
<span style="color: #406f90; font-style: italic;">$ dune build bin/decompress.com</span>
<span style="color: #406f90; font-style: italic;">$ sh -c "</span><span style="color: #406f90; font-style: italic;">echo</span><span style="color: #406f90; font-style: italic;"> 'Hello World' | ./bin/decompress.com -d | ./bin/decompress.com"</span>
<span style="color: #406f90; font-style: italic;">Hello World</span>
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</div>

<div id="outline-container-orged9def3" class="outline-4">
<h4 id="orged9def3">Issues</h4>
<div class="outline-text-4" id="text-orged9def3">
<p>
Apart from the outcomes described above, however, the Esperanto toolchain is not complete. Indeed, the OCaml
distribution gives several libraries such as <code>unix.cmxa</code> and <code>threads.cmxa</code>. A little work has been done to make the
former available. The second one is however unavailable for the moment since Cosmopolitan only partially implements
<code>pthread</code>.
</p>

<p>
However, it seems that the author of Cosmopolotian wants to implement the rest of the <code>pthread</code> API which will then
allow us to provide support for <code>threads.cmxa</code> and OCaml 5.
</p>

<p>
This of course makes support for the projects more limited than we imagined (and that&rsquo;s why this release is
experimental) however, an effort has already been made to lwt into Cosmopolitan&rsquo;s hypothetical future support for
<code>pthread</code>.
</p>
</div>
</div>

<div id="outline-container-orgeba37a9" class="outline-4">
<h4 id="orgeba37a9">Future</h4>
<div class="outline-text-4" id="text-orgeba37a9">
<p>
As explained above, support for <code>threads.cmxa</code> and OCaml 5 remains the priority. however, an effort has already been
made to support <a href="https://github.com/ocsigen/lwt/">Lwt</a> via Cosmopolitan&rsquo;s hypothetical future support for <code>pthread</code>.
</p>

<p>
However, it is possible that Cosmopolitan could become a target for the MirageOS project in the same way as Solo5
(or our recent experiment on Raspberry Pi 4).
</p>

<p>
In this sense, we will surely propose an integration in MirageOS so that projects can both produce unikernels with
Solo5 or portable binaries with Cosmopolitan.
</p>

<p>
[1] However, the question remains open at several levels, that of the compiler, that of OPAM and of course that of <code>dune</code>. It is clear that the current situation is not the best in terms of what we need to do to produce such a cross-compiler. Only the feedback from Solo5 (which requires cross-compilation) allows us to say that it is surely the right choice for what we want to offer.
</p>
</div>
</div>

<div id="outline-container-org19ef74e" class="outline-4">
<h4 id="org19ef74e">Conclusion</h4>
<div class="outline-text-4" id="text-org19ef74e">
<p>
We hope that this project will facilitate the distribution of software. You can read a more technical article about
our work <a href="https://blog.osau.re/articles/esperanto.html">here</a>. Finally, I would like to thank <a href="https://robur.io/">robur.io</a> (an association you <a href="https://robur.io/Donate">can help</a>) for allowing me to do this project.
</p>

<p>
<b>EDIT</b>: The author of Cosmopolitan just released Cosmopolitan with <code>pthread</code> support. So we will definitely try to
improve our distribution to include OCaml with <code>threads.cmxa</code> support and move forward with OCaml 5!
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-2" class="outline-2">
<h2 id="2">OBazl Toolsuite - tools for building OCaml with Bazel</h2>
<div class="outline-text-2" id="text-2">
<p>
Archive: <a href="https://discuss.ocaml.org/t/obazl-toolsuite-tools-for-building-ocaml-with-bazel/10021/15">https://discuss.ocaml.org/t/obazl-toolsuite-tools-for-building-ocaml-with-bazel/10021/15</a>
</p>
</div>

<div id="outline-container-org11afc08" class="outline-3">
<h3 id="org11afc08">Deep into this thread, Yawar Amin asked and Gregg Reynolds replied</h3>
<div class="outline-text-3" id="text-org11afc08">
<blockquote>
<p>
Doesn’t dune get advertised as being able to handle multiple programming languages, including C/C++?
</p>
</blockquote>

<p>
There&rsquo;s really no comparison. Dune evidently can use the (C ABI) outputs of a &ldquo;foreign&rdquo; build (if you write the glue
code needed to make this work) but there&rsquo;s no real <i>build</i> integration, and no hermeticity guarantees.  Under Bazel
different languages use different rulesets but they&rsquo;re all Bazel rulesets, so you get one dependency graph across
all languages, and if the rulesets are hermetic you get a hermetic build.  Without ABI restrictions. For example if
your build needs to run a Python (or Javascript, Ruby, whatever) tool, Bazel will build the tool and run it for you.
</p>

<p>
Even for C I think Bazel has much better integration.  The rules in rules_cc (e.g. cc_library producing a .a file)
deliver a CcInfo provider (a provider is a kind of struct whose fields contain the artifacts delivered by a build
action).  The rules in rules_ocaml (e.g. ocaml_module) understand CcInfo dependencies and pass them around using
OcamlProvider (a provider specific to the ocaml rules). Bazel supports a merge operation for CcInfo, and the ocaml
rules always merge their CcInfo deps and pass them on. So every build target delivers the merge of all its CcInfo
deps. The ocaml_binary rule that links its dependencies into an executable merges its CcInfo deps (which include
merged CcInfo from their deps, recursively) and ends up with a single CcInfo containing every cc dependency in the
dep graph, in the right order, with no duplicates. Then its simply a matter of constructing the link command with
the appropriate &#x2013;ccopt options. More succinctly: you can add a C dep directly to the module that needs it, and
Bazel it pass it up the dependency chain, ensuring that it ends up on the command line when needed - building
archives or executables.  You don&rsquo;t need to add a C dep to an archive target when only one of n modules in the
archive actually depends on it.
</p>

<p>
I&rsquo;ve just started working on rules_jsoo, which I think will nicely demonstrate the virtues of Bazel integration.
The Bazel ecosystem includes a bunch of tools for working with Javascript; for example rules_js and rules_nodejs
make it easy to control which node toolchain version to use, integrate npm stuff, etc. Wouldn&rsquo;t it be nice to be
able to use such tools directly, without writing a bunch of glue code?  Now a key element of Bazel integration is
the use of providers.  Rules deliver providers, and since providers act as a kind of rudimentary type system, I can
use the JsInfo provider (defined by rules_js) to integrate rules_jsoo with the larger Bazel js ecoystem.  For
example, the jsoo_library rule takes the OcamlProvider provider delivered by ocaml_module rules, which contains the
.cmo file.  So jsoo_library runs those .cmo files through the jsoo compiler and delivers the resulting js files in a
JsInfo provider. That provider is suitable as input to the rules in rules_js, which gives us seamless integration.
So we can use the js_binary rule of rules_js to run code produced by jsoo_library under node. All that&rsquo;s needed is
to list the latter as a dependency of the former.  That&rsquo;s the plan, anyway. Isn&rsquo;t that nice?
</p>
</div>
</div>


<div id="outline-container-orgcf10218" class="outline-3">
<h3 id="orgcf10218">Gregg Reynolds said and Daniel Bünzli replied</h3>
<div class="outline-text-3" id="text-orgcf10218">
<blockquote>
<p>
Ideally somebody learning a new language should not need to spend any time (at first) dealing with a build language
too.
</p>
</blockquote>

<p>
This doesn&rsquo;t only apply to learning. It also applies to prototyping, hypothesis generation and testing.
</p>

<p>
That&rsquo;s the reason why I built <a href="https://erratique.ch/software/brzo"><code>brzo</code></a> which I hope I&rsquo;ll be able to release at
some point (still needs a good design review and changes to the OCaml strategy since it assumed we were moving
towards a model that didn&rsquo;t happen in the end – namely the <a href="https://github.com/ocaml/RFCs/pull/17">library linking
proposal</a>, I&rsquo;d also like to add more languages to the mix but that could
wait).
</p>

<p>
None of my projects do not start with ~brzo~ing these days and the hassle free build experience is exhilarating.
</p>

<blockquote>
<p>
Build systems often are “complex and confusing”, but that’s largely because the problem space itself is complex and
confusing. There’s no getting around that.
</p>
</blockquote>

<p>
Note however that this is largely <i>accidental</i> complexity due to the fact that compilers work in idiosyncratic ways
for what build systems need in order to do their incremental and parallelization business.
</p>

<p>
They are still stuck in a world where people would invoke their compiler manually at the cli level or specify the
invocations themselves in a <code>Makefile</code>.
</p>

<p>
In fact if it were not for the actual tools and the (lack) of information they give us, build is in fact an
excessively simple problem.
</p>

<p>
More specific to OCaml, the compiler clis have an insane amount of quirks and the whole system greatly suffers from
an underspecified linking model. Basically it was not a good idea to let that be defined by a third party tool, if
only so that you can actually talk about libraries in error messages from the compiler.
</p>
</div>
</div>
</div>




<div id="outline-container-3" class="outline-2">
<h2 id="3">Orsetto: structured data interchange languages (release 1.1.2)</h2>
<div class="outline-text-2" id="text-3">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-orsetto-structured-data-interchange-languages-release-1-1-2/10506/1">https://discuss.ocaml.org/t/ann-orsetto-structured-data-interchange-languages-release-1-1-2/10506/1</a>
</p>
</div>

<div id="outline-container-orgb1d3f4c" class="outline-3">
<h3 id="orgb1d3f4c">james woodyatt announced</h3>
<div class="outline-text-3" id="text-orgb1d3f4c">
<p>
Announcing the release to OPAM of <a href="http://opam.ocaml.org/packages/orsetto/">Orsetto 1.1.2</a>, an update to a personal
project of mine not sponsored by my employer. Licensed with BSD 2-Clause.
</p>

<p>
<b>Q. What is Orsetto?</b>
</p>

<p>
Aspires to do eventually for OCaml more or less what <a href="https://serde.rs">Serde</a> has done for Rust, i.e. to be a
curated and self-contained collection of structured data interchange languages with a cohesive and unified model of
serialization and deserialization.
</p>

<p>
Two interchange languages are currently supported: <a href="https://json.org">JSON </a> and <a href="https://cbor.io">CBOR </a>.
</p>

<p>
<b>Q. What is new in this release?</b>
</p>

<p>
Mostly error corrections, particularly in the CBOR library, produced by improving test coverage.
</p>

<p>
The change log for the release is here: <a href="https://bitbucket.org/jhw/orsetto/src/r1.1.2/CHANGES.md">CHANGES.md </a>
</p>

<p>
Highlights:
</p>

<ul class="org-ul">
<li>Major improvements in test coverage.</li>
<li>Many corrections for logic errors.</li>
<li>A few minor usability improvements.</li>
</ul>

<p>
Some things have not changed:
</p>

<ul class="org-ul">
<li>Still has no Programmer Guide or Tutorial, or really any introduction at all.</li>
<li>Still requires <b>ocamlfind</b> and builds with <b>omake</b>, which is currently not compatible with OCaml 5.0.</li>
<li>Still only supports JSON and CBOR.</li>
</ul>

<p>
<b>Q. It looks incomplete. What are your plans for future development?</b>
</p>

<p>
Yes, it’s a personal project, and yes, I&rsquo;m aware there are no reverse dependencies on it currently in the public
OPAM repository. Still, I’d welcome opportunities to collaborate with others who share my vision for the project. As
long as it’s just me working on this, development will continue to be somewhat slow, as I&rsquo;m prone to over-engineer
things I care about. I have a lot of projects, and this is the only open source one.
</p>

<ul class="org-ul">
<li><b>Orsetto 1.0.3</b> is the previous release. It offered parsers and emitter combinators for JSON and CBOR for OCaml &gt;= 4.06.1 (including 4.13~alpha1). The quality of its JSON support is adequate, and it scores well on the &gt;<a href="https://github.com/nst/JSONTestSuite">nst/JSONTestSuite</a> tests. The quality of its CBOR support is provisional, &gt;and not recommended.</li>
<li><b>Orsetto 1.1.2</b> is the current release. It adds generalized and extensible structured data interchange models with specializations for producing emitters and parsers for JSON and CBOR. The quality of the CBOR support is much improved, and I&rsquo;m using it with good results in other projects. Supported on OCaml &gt;= 4.08.</li>
<li><b>Orsetto 1.2</b> is the next planned release. It will drop interfaces marked `@caml.deprecated` in the 1.1 release. It will also drop support for OCaml &lt; 4.10, and it will stop depending on <b><b>ocamlfind</b></b>. I hope to add a PPX for deriving parsers and emitters from OCaml data type definitions. I might also consider one or more new interchange languages— suggestions are heartily encouraged.</li>
</ul>
</div>
</div>
</div>




<div id="outline-container-4" class="outline-2">
<h2 id="4">Interest in a Http_sig library?</h2>
<div class="outline-text-2" id="text-4">
<p>
Archive: <a href="https://discuss.ocaml.org/t/interest-in-a-http-sig-library/10518/1">https://discuss.ocaml.org/t/interest-in-a-http-sig-library/10518/1</a>
</p>
</div>

<div id="outline-container-orgbbecab6" class="outline-3">
<h3 id="orgbbecab6">Kiran Gopinathan announced</h3>
<div class="outline-text-3" id="text-orgbbecab6">
<p>
Heyo all! I&rsquo;ve been working on an activitypub server for a while now, and while it&rsquo;s still not yet complete,
recently I&rsquo;ve reached a point where I realised that I&rsquo;ve actually been sitting on some libraries that the community
might benefit from, as the current ecosystem doesn&rsquo;t seem to handle these things.
</p>

<p>
One such component that seemed to be in a state that was suitable to split off from was a small helper module to
implement a particular http signature scheme that seems to be rather common in the activitypub scene.
</p>

<p>
In particular, the scheme I&rsquo;m referring to is defined here:
<a href="https://datatracker.ietf.org/doc/html/draft-cavage-http-signatures-12">https://datatracker.ietf.org/doc/html/draft-cavage-http-signatures-12</a>
</p>

<pre class="example" id="orgda1b7b1">
                         Signing HTTP Messages
                    draft-cavage-http-signatures-12

Abstract
   When communicating over the Internet using the HTTP protocol, it can
   be desirable for a server or client to authenticate the sender of a
   particular message.  It can also be desirable to ensure that the
   message was not tampered with during transit.  This document
   describes a way for servers and clients to simultaneously add
   authentication and message integrity to HTTP messages by using a
   digital signature.
</pre>

<p>
I&rsquo;ve written a small library that glues together some components in the OCaml ecosystem to somewhat handle the
signing (I have been mainly working off an &ldquo;implement-enough-to-make-the-system-work&rdquo; process rather than directly
transcribing the specification above):
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #406f90; font-style: italic;">(** </span><span style="color: #375cd8;">[</span>verify ~signed_string ~signature key<span style="color: #375cd8;">]</span><span style="color: #406f90; font-style: italic;"> returns true iff</span>
<span style="color: #406f90; font-style: italic;">   </span><span style="color: #375cd8;">[</span>signature<span style="color: #375cd8;">]</span><span style="color: #406f90; font-style: italic;"> over </span><span style="color: #375cd8;">[</span>signed_string<span style="color: #375cd8;">]</span><span style="color: #406f90; font-style: italic;"> is valid according to </span><span style="color: #375cd8;">[</span>key<span style="color: #375cd8;">]</span><span style="color: #406f90; font-style: italic;">. *)</span>
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #1f6fbf;">verify</span>: <span style="color: #375cd8;">signed_string</span>:string -&gt; <span style="color: #375cd8;">signature</span>:string -&gt; <span style="color: #065fff;">X509.Public_key.</span>t -&gt; bool

<span style="color: #406f90; font-style: italic;">(** </span><span style="color: #375cd8;">[</span>verify_request ~resolve_public_key req<span style="color: #375cd8;">]</span><span style="color: #406f90; font-style: italic;"> verifies that a dream</span>
<span style="color: #406f90; font-style: italic;">   request has been signed according to the HTTP signature scheme *)</span>
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #1f6fbf;">verify_request</span>:
  <span style="color: #375cd8;">resolve_public_key</span>:(string -&gt; (<span style="color: #065fff;">X509.Public_key.</span>t, 'a) <span style="color: #065fff;">Lwt_result.</span>t) -&gt;
  <span style="color: #065fff;">Dream.</span>request -&gt; (bool, 'a) result <span style="color: #065fff;">Lwt.</span>t

<span style="color: #406f90; font-style: italic;">(** </span><span style="color: #375cd8;">[</span>build_signed_headers ~priv_key ~key_id ~headers ~body_str
   ~current_time ~method_ ~uri<span style="color: #375cd8;">]</span><span style="color: #406f90; font-style: italic;"> returns a list of signed headers using</span>
<span style="color: #406f90; font-style: italic;">   </span><span style="color: #375cd8;">[</span>priv_key<span style="color: #375cd8;">]</span><span style="color: #406f90; font-style: italic;"> according to the HTTP signature scheme. </span><span style="color: #375cd8;">[</span>key_id<span style="color: #375cd8;">]</span><span style="color: #406f90; font-style: italic;"> should</span>
<span style="color: #406f90; font-style: italic;">   be a string that can be used to look up the public key associated</span>
<span style="color: #406f90; font-style: italic;">   with </span><span style="color: #375cd8;">[</span>priv_key<span style="color: #375cd8;">]</span><span style="color: #406f90; font-style: italic;">. *)</span>
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #1f6fbf;">build_signed_headers</span>:
  <span style="color: #375cd8;">priv_key</span>:<span style="color: #065fff;">X509.Private_key.</span>t -&gt;
  <span style="color: #375cd8;">key_id</span>:string -&gt;
  <span style="color: #375cd8;">headers</span>:string <span style="color: #065fff;">StringMap.</span>t -&gt;
  <span style="color: #375cd8;">body_str</span>:string -&gt;
  <span style="color: #375cd8;">current_time</span>:<span style="color: #065fff;">Ptime.</span>t -&gt; <span style="color: #375cd8;">method_</span>:string -&gt; <span style="color: #375cd8;">uri</span>:<span style="color: #065fff;">Uri.</span>t -&gt; (string * string) list
</pre>
</div>

<p>
The library is currently published at <a href="https://github.com/Gopiandcode/http_sig_ocaml">https://github.com/Gopiandcode/http_sig_ocaml</a> under the LGPL, but I haven&rsquo;t
released it on opam.
</p>

<p>
Anyway, I was wondering if anyone else had interest in this kind of package, and whether it would be a good
candidate for submission to opam - or if there are actually already existing libraries in the OCaml ecosystem that
would actually already do this.
</p>
</div>
</div>
</div>




<div id="outline-container-5" class="outline-2">
<h2 id="5">Outreachy summer &rsquo;22 closing commemoration session on 23rd Sept</h2>
<div class="outline-text-2" id="text-5">
<p>
Archive: <a href="https://discuss.ocaml.org/t/outreachy-summer-22-closing-commemoration-session-on-23rd-sept/10450/5">https://discuss.ocaml.org/t/outreachy-summer-22-closing-commemoration-session-on-23rd-sept/10450/5</a>
</p>
</div>

<div id="outline-container-org0406959" class="outline-3">
<h3 id="org0406959">Patrick Ferris announced</h3>
<div class="outline-text-3" id="text-org0406959">
<p>
Thank you to everyone that could make it to the presentation today. The presentation is now live:
<a href="https://watch.ocaml.org/videos/watch/dc5bbf5b-3dd9-4c8d-b26a-71e730a67788">https://watch.ocaml.org/videos/watch/dc5bbf5b-3dd9-4c8d-b26a-71e730a67788</a> :camel:
</p>

<p>
In particular a massive congratulations and thank you to @moazzammoriani and @IIITM-Jay. Thank you also to @sudha
for being the driving force behind making the presentation happen again this round! See you all for the next round!
</p>

<p>
Aside: if anybody has any issues with the live video please do reach out here either publicly or privately, we gave
prior warning of our intentions to record and put the video on watch.ocaml.org, but I appreciate some people joined
a little later/might have some reservations etc.
</p>
</div>
</div>
</div>




<div id="outline-container-6" class="outline-2">
<h2 id="6">findlib-1.9.6</h2>
<div class="outline-text-2" id="text-6">
<p>
Archive: <a href="https://sympa.inria.fr/sympa/arc/caml-list/2022-09/msg00007.html">https://sympa.inria.fr/sympa/arc/caml-list/2022-09/msg00007.html</a>
</p>
</div>

<div id="outline-container-orga12e775" class="outline-3">
<h3 id="orga12e775">Gerd Stolpmann announced</h3>
<div class="outline-text-3" id="text-orga12e775">
<p>
findlib-1.9.6 is out, now supporting OCaml-5.00 (as far as we know it).
There are also a few other install-related fixes in it.
</p>

<p>
For manual, download, manuals, etc. see here:
</p>

<p>
<a href="http://projects.camlcity.org/projects/findlib.html">http://projects.camlcity.org/projects/findlib.html</a>
</p>

<p>
An updated OPAM package will follow soon.
</p>
</div>
</div>
</div>




<div id="outline-container-7" class="outline-2">
<h2 id="7">Interesting OCaml Articles</h2>
<div class="outline-text-2" id="text-7">
<p>
Archive: <a href="https://discuss.ocaml.org/t/interesting-ocaml-articles/1867/100">https://discuss.ocaml.org/t/interesting-ocaml-articles/1867/100</a>
</p>
</div>

<div id="outline-container-orga7b0792" class="outline-3">
<h3 id="orga7b0792">Deep in this thread, alan said</h3>
<div class="outline-text-3" id="text-orga7b0792">
<p>
An interesting paper that uses OCaml is <a href="http://gallium.inria.fr/~fpottier/publis/fpottier-elaboration.pdf">http://gallium.inria.fr/~fpottier/publis/fpottier-elaboration.pdf</a> by
Francois Pottier, which gives a declarative DSL for implementing type rules with applicative functors. It has an
associated library, <a href="https://opam.ocaml.org/packages/inferno/">https://opam.ocaml.org/packages/inferno/</a>.
</p>
</div>
</div>
</div>




<div id="outline-container-8" class="outline-2">
<h2 id="8">Other OCaml News</h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-orgd7c4e1c" class="outline-3">
<h3 id="orgd7c4e1c">From the ocaml.org blog</h3>
<div class="outline-text-3" id="text-orgd7c4e1c">
<p>
Here are links from many OCaml blogs aggregated at <a href="https://ocaml.org/blog/">the ocaml.org blog</a>.
</p>

<ul class="org-ul">
<li><a href="https://tarides.com/blog/2022-09-23-tarides-sponsors-high-school-hackers">Tarides Sponsors High School Hackers</a></li>
</ul>
</div>
</div>
</div>




<div id="outline-container-org90444f6" class="outline-2">
<h2 id="org90444f6">Old CWN</h2>
<div class="outline-text-2" id="text-org90444f6">
<p>
If you happen to miss a CWN, you can <a href="mailto:alan.schmitt@polytechnique.org">send me a message</a> and I&rsquo;ll mail it to you, or go take a look at <a href="https://alan.petitepomme.net/cwn/">the archive</a> or the <a href="https://alan.petitepomme.net/cwn/cwn.rss">RSS feed of the archives</a>.
</p>

<p>
If you also wish to receive it every week by mail, you may subscribe <a href="http://lists.idyll.org/listinfo/caml-news-weekly/">online</a>.
</p>

<div class="authorname" id="orge7fa016">
<p>
<a href="https://alan.petitepomme.net/">Alan Schmitt</a>
</p>

</div>
</div>
</div>
</div>
</body>
</html>
