<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-03-14 Tue 10:50 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OCaml Weekly News</title>
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<style type="text/css">#table-of-contents h2 { display: none } .title { display: none } .authorname { text-align: right }</style>
<style type="text/css">.outline-2 {border-top: 1px solid black;}</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">OCaml Weekly News</h1>
<p>
<a href="https://alan.petitepomme.net/cwn/2023.03.07.html">Previous Week</a> <a href="https://alan.petitepomme.net/cwn/index.html">Up</a> <a href="https://alan.petitepomme.net/cwn/2023.03.21.html">Next Week</a>
</p>

<p>
Hello
</p>

<p>
Here is the latest OCaml Weekly News, for the week of March 07 to 14, 2023.
</p>

<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#1">My experience contributing to the LLVM bindings</a></li>
<li><a href="#2">Which binding should i use for sqlite , for mariadb and for postgresql</a></li>
<li><a href="#3">Monday, 6th March - Outreachy Intern Presentation (Dec &rsquo;22 Round)</a></li>
<li><a href="#4">First release of ppx_subliner, a ppx deriver and rewriter for Cmldliner sub-command</a></li>
<li><a href="#5">Cross-compiling for Embedded arm32 Target (RP2040 / Cortex-M0+)</a></li>
<li><a href="#6">VOCaml: add and remove type annotations in VS Code</a></li>
<li><a href="#7">Sunsetting opam-repository-mingw</a></li>
<li><a href="#8">Outreachy Summer 2023</a></li>
<li><a href="#9">VS Code extension Alcotest Test Explorer 0.4.0</a></li>
<li><a href="#org8da4b5a">Old CWN</a></li>
</ul>
</div>
</div>


<div id="outline-container-1" class="outline-2">
<h2 id="1">My experience contributing to the LLVM bindings</h2>
<div class="outline-text-2" id="text-1">
<p>
Archive: <a href="https://discuss.ocaml.org/t/my-experience-contributing-to-the-llvm-bindings/11599/1">https://discuss.ocaml.org/t/my-experience-contributing-to-the-llvm-bindings/11599/1</a>
</p>
</div>

<div id="outline-container-orgf504720" class="outline-3">
<h3 id="orgf504720">alan announced</h3>
<div class="outline-text-3" id="text-orgf504720">
<p>
Over the past few months, I&rsquo;ve been contributing patches to the LLVM bindings. In particular, I ported the bindings
to OCaml 5, which involved removing naked pointers. I wrote about what I learned
<a href="https://alan-j-hu.github.io/writing/llvm-ocaml.html">here</a>.
</p>
</div>
</div>
</div>




<div id="outline-container-2" class="outline-2">
<h2 id="2">Which binding should i use for sqlite , for mariadb and for postgresql</h2>
<div class="outline-text-2" id="text-2">
<p>
Archive: <a href="https://discuss.ocaml.org/t/which-binding-should-i-use-for-sqlite-for-mariadb-for-postgresql/11605/2">https://discuss.ocaml.org/t/which-binding-should-i-use-for-sqlite-for-mariadb-for-postgresql/11605/2</a>
</p>
</div>

<div id="outline-container-org5209ec0" class="outline-3">
<h3 id="org5209ec0">Alain De Vos asked and Nicolas Ojeda Bar replied</h3>
<div class="outline-text-3" id="text-org5209ec0">
<blockquote>
<p>
Which binding should i use for sqlite , for mariadb &amp; for postgresql ?
</p>
</blockquote>

<p>
At LexiFi we have used <a href="https://github.com/mmottl/postgresql-ocaml">https://github.com/mmottl/postgresql-ocaml</a> for PostgreSQL and
<a href="https://github.com/mmottl/sqlite3-ocaml">https://github.com/mmottl/sqlite3-ocaml</a> for SQLite for a long time and found them solid.
</p>
</div>
</div>


<div id="outline-container-orgd1bf0a1" class="outline-3">
<h3 id="orgd1bf0a1">Kim Nguyễn also replied</h3>
<div class="outline-text-3" id="text-orgd1bf0a1">
<p>
If you are looking for a unified API, there is <a href="https://github.com/paurkedal/ocaml-caqti">Caqti</a>. It uses the lower
level bindings mentioned by @nojb (and also supports MariaDB using
<a href="https://github.com/andrenth/ocaml-mariadb">mariadb-ocaml</a>. It feels like the &ldquo;jdbc for OCaml&rdquo; but with much more!
</p>

<p>
It provides three high-level API, either a standard blocking interface, or asynchronous with Lwt or asynchronous
with Janestreet&rsquo;s Async).
</p>
</div>
</div>


<div id="outline-container-org74c37cd" class="outline-3">
<h3 id="org74c37cd">Frédéric Loyer then added</h3>
<div class="outline-text-3" id="text-org74c37cd">
<p>
Caqti is nice and can be completed nicely with ppx_rapper which transforms a commented SQL string into a typed
wrapper.
</p>

<p>
See <a href="https://github.com/roddyyaga/ppx_rapper">https://github.com/roddyyaga/ppx_rapper</a>
</p>
</div>
</div>
</div>




<div id="outline-container-3" class="outline-2">
<h2 id="3">Monday, 6th March - Outreachy Intern Presentation (Dec &rsquo;22 Round)</h2>
<div class="outline-text-2" id="text-3">
<p>
Archive: <a href="https://discuss.ocaml.org/t/monday-6th-march-outreachy-intern-presentation-dec-22-round/11564/5">https://discuss.ocaml.org/t/monday-6th-march-outreachy-intern-presentation-dec-22-round/11564/5</a>
</p>
</div>

<div id="outline-container-org96f14a4" class="outline-3">
<h3 id="org96f14a4">Patrick Ferris announced</h3>
<div class="outline-text-3" id="text-org96f14a4">
<p>
The presentation is now online: <a href="https://watch.ocaml.org/w/pQSAfZ9kDSsSnr8Bxzocn3">https://watch.ocaml.org/w/pQSAfZ9kDSsSnr8Bxzocn3</a>
</p>

<p>
Thank you @Prisca for the talk and everybody for joining live. We took this opportunity to reupload everything to
the OCaml Outreachy channel under the <code>bactrian</code> user: <a href="https://watch.ocaml.org/c/outreachy_ocaml/videos">https://watch.ocaml.org/c/outreachy_ocaml/videos</a>
</p>
</div>
</div>


<div id="outline-container-orge55120e" class="outline-3">
<h3 id="orge55120e">Anil Madhavapeddy asked and Prisca replied</h3>
<div class="outline-text-3" id="text-orge55120e">
<blockquote>
<p>
Your slides look great, with lots of nice OCaml/TopoJSON code fragments; might you consider making them available
online somewhere? Making yourself a homepage, or using something like Speakerdeck are both good options.
</p>
</blockquote>

<p>
@avsm Thank you very much for the kind words. I just did. This is the link
<a href="https://speakerdeck.com/priceless/presentation">https://speakerdeck.com/priceless/presentation</a>
</p>

<blockquote>
<p>
I noticed you published a release of the library to opam – you should add yourself to the authors list in
<code>dune-project</code>, so that you are credited in <a href="https://ocaml.org/p/topojson/latest">the documentation page for TopoJSON
</a>.
</p>
</blockquote>

<p>
Thank you for pointing that out as well. @patrickferris and I will correct it.
</p>
</div>
</div>
</div>




<div id="outline-container-4" class="outline-2">
<h2 id="4">First release of ppx_subliner, a ppx deriver and rewriter for Cmldliner sub-command</h2>
<div class="outline-text-2" id="text-4">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-first-release-of-ppx-subliner-a-ppx-deriver-and-rewriter-for-cmldliner-sub-command/11610/1">https://discuss.ocaml.org/t/ann-first-release-of-ppx-subliner-a-ppx-deriver-and-rewriter-for-cmldliner-sub-command/11610/1</a>
</p>
</div>

<div id="outline-container-orgebfc184" class="outline-3">
<h3 id="orgebfc184">Boning announced</h3>
<div class="outline-text-3" id="text-orgebfc184">
<p>
I am very pleased to announce the first release of <a href="https://github.com/bn-d/ppx_subliner"><code>ppx_subliner</code></a>! The
package is now available through <a href="https://opam.ocaml.org/packages/ppx_subliner/">OPAM</a>.
</p>

<p>
I am always a big fan of <a href="https://github.com/hammerlab/ppx_deriving_cmdliner"><code>ppx_deriving_cmdliner</code></a>. It helps
you construct <code>Cmdliner.Term.t</code> from record types and makes writing cli parsing intuitive and painless. But it
lacks the ability to generate values for sub-command groups and the final <code>Cmdliner</code> evaluations. Therefore,
<code>ppx_subliner</code> comes to life.
</p>

<p>
<code>ppx_subliner</code> can work with <code>ppx_deriving_cmdliner</code> to generate sub-command groups. You can do so by simply
tagging the extension to a variant type.
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">type</span> <span style="color: #444fcf;">foo</span> = { my_arg : string } <span style="color: #a2604f;">[@@deriving cmdliner]</span>

<span style="color: #000000; font-weight: bold;">type</span> <span style="color: #444fcf;">params</span> =
  | <span style="color: #242521; background-color: #fcf7ef;">Foo</span> <span style="color: #006f00; font-weight: bold;">of</span> foo
  | <span style="color: #242521; background-color: #fcf7ef;">Bar</span>
<span style="color: #a2604f;">[@@deriving_inline subliner]</span>
<span style="color: #000000; font-weight: bold;">include</span>
  <span style="color: #000000; font-weight: bold;">sig</span>
    <span style="color: #a2604f;">[@@@ocaml.warning </span><span style="color: #ca3400;">"-32"</span><span style="color: #a2604f;">]</span>
    <span style="color: #000000; font-weight: bold;">val</span> <span style="color: #a7601f;">params_cmdliner_group_cmds</span> : (params -&gt; 'a) -&gt; 'a <span style="color: #444fcf;">Cmdliner.Cmd.</span>t list
  <span style="color: #000000; font-weight: bold;">end</span><span style="color: #a2604f;">[@@ocaml.doc </span><span style="color: #ca3400;">"@inline"</span><span style="color: #a2604f;">]</span>
<span style="color: #a2604f;">[@@@end]</span>
</pre>
</div>

<p>
It will generate a function which takes in a handle function and return the sub-command list. Here is a simple
handle function.
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a7601f;">handle</span> = <span style="color: #006f00; font-weight: bold;">function</span>
  | <span style="color: #242521; background-color: #fcf7ef;">Foo</span> { my_arg } -&gt; print_endline (<span style="color: #ca3400;">"Foo "</span> <span style="color: #a52a2a;">^</span> my_arg)
  | <span style="color: #242521; background-color: #fcf7ef;">Bar</span> -&gt; print_endline <span style="color: #ca3400;">"Bar"</span>
</pre>
</div>

<p>
From here, you either construct the final evaluation manually:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #007a9f;">cmd</span> =
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #000000; font-weight: bold;">open </span><span style="color: #444fcf;">Cmdliner</span> <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #007a9f;">doc</span> = <span style="color: #ca3400;">"Some docs"</span> <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #007a9f;">info</span> = <span style="color: #444fcf;">Cmd.</span>info ~doc <span style="color: #ca3400;">"foobar"</span> <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #444fcf;">Cmd.</span>group info (params_cmdliner_group_cmds handle)

<span style="color: #000000; font-weight: bold;">let</span> () = <span style="color: #557400; font-weight: bold;">exit</span> (<span style="color: #444fcf;">Cmdliner.</span>eval cmd)
</pre>
</div>

<p>
or use the <code>[%%subliner.cmds]</code> rewriter, which reuses the setfield syntax:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #8f6f4a; font-style: italic;">(* </span><span style="color: #8f6f4a; font-style: italic;">{eval function}.{type name} &lt;- {function expression&gt;</span><span style="color: #8f6f4a; font-style: italic;"> *)</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #a2604f; background-color: #ebebeb;">[%%subliner.cmds</span> eval.params &lt;- handle<span style="color: #a2604f; background-color: #ebebeb;">]</span>
<span style="color: #a2604f;">[@@name </span><span style="color: #ca3400;">"foobar"</span><span style="color: #a2604f;">]</span> <span style="color: #a2604f;">[@@version </span><span style="color: #ca3400;">"3.14"</span><span style="color: #a2604f;">]</span>
<span style="color: #4f677f; font-style: italic;">(** Some docs *)</span>
</pre>
</div>

<pre class="example" id="org079f65b">
$ foobar.exe foo --my-arg 123
Foo 123
</pre>

<p>
Both the deriver and rewriter will respect the OCaml docstring. You can also use <code>[@name]</code>, <code>[@man]</code>, <code>[@envs]</code> etc
to configure all aspects of the underlying <code>Cmdliner.Cmd.info</code> value.
</p>

<p>
You can also use different evaluation function and set optional arguments:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #a2604f; background-color: #ebebeb;">[%%subliner.cmds</span> (eval_result <span style="color: #00824f;">~catch</span>:<span style="color: #00824f;">false</span>).params &lt;-
  (<span style="color: #006f00; font-weight: bold;">function</span>
    | <span style="color: #242521; background-color: #fcf7ef;">Foo</span> { my_arg } -&gt; print_endline (<span style="color: #ca3400;">"Foo "</span> <span style="color: #a52a2a;">^</span> my_arg) <span style="color: #a52a2a;">|&gt;</span> <span style="color: #444fcf;">Result.</span>ok
    | <span style="color: #242521; background-color: #fcf7ef;">Bar</span> -&gt; print_endline <span style="color: #ca3400;">"Bar"</span> <span style="color: #a52a2a;">|&gt;</span> <span style="color: #444fcf;">Result.</span>ok)<span style="color: #a2604f; background-color: #ebebeb;">]</span>
</pre>
</div>

<p>
Please see more details in the <a href="https://boni.ng/ppx_subliner/ppx_subliner/index.html">documentation</a>.
</p>
</div>

<div id="outline-container-org342c5e1" class="outline-4">
<h4 id="org342c5e1">What&rsquo;s next</h4>
<div class="outline-text-4" id="text-org342c5e1">
<p>
I want to support inline record and enum as arg in the future, and maybe replicate some of
<code>ppx_deriving_cmdliner</code>&rsquo;s functionality, but better support for <code>deriving_inline</code>, lists (ie. <code>-I liba -I libb</code>
instead of <code>-I liba,libb</code>), positional arguments and more compile time validation. We shall see.
</p>

<p>
Hope this is helpful. Happy hacking!
</p>

<p>
<a href="https://github.com/bn-d/ppx_subliner">https://github.com/bn-d/ppx_subliner</a>
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-5" class="outline-2">
<h2 id="5">Cross-compiling for Embedded arm32 Target (RP2040 / Cortex-M0+)</h2>
<div class="outline-text-2" id="text-5">
<p>
Archive: <a href="https://discuss.ocaml.org/t/cross-compiling-for-embedded-arm32-target-rp2040-cortex-m0/11585/8">https://discuss.ocaml.org/t/cross-compiling-for-embedded-arm32-target-rp2040-cortex-m0/11585/8</a>
</p>
</div>

<div id="outline-container-org927fd43" class="outline-3">
<h3 id="org927fd43">Deep in this thread, Calascibetta Romain said</h3>
<div class="outline-text-3" id="text-org927fd43">
<p>
Note that you probably should take a look on <a href="https://github.com/dinosaure/gilbraltar">gilbraltar</a> which is a full
OCaml runtime for Rasperry Pi 4 (arm64).  We already did several works on this <span class="underline">ocaml toolchain</span>, a <a href="https://twitter.com/Dinoosaure/status/1471128595154231300">&ldquo;guirlande
OS&rdquo;</a> or a <a href="https://tarides.com/blog/2022-10-28-the-mirageos-retreat-a-journey-of-food-cats-and-unikernels#implementing-a-jack-port-driver-or-how-to-make-a-unikernel-sing-bare-metal">music player OS via Jack</a>.
</p>
</div>
</div>
</div>




<div id="outline-container-6" class="outline-2">
<h2 id="6">VOCaml: add and remove type annotations in VS Code</h2>
<div class="outline-text-2" id="text-6">
<p>
Archive: <a href="https://discuss.ocaml.org/t/vocaml-add-and-remove-type-annotations-in-vs-code/11618/1">https://discuss.ocaml.org/t/vocaml-add-and-remove-type-annotations-in-vs-code/11618/1</a>
</p>
</div>

<div id="outline-container-orga6115e0" class="outline-3">
<h3 id="orga6115e0">Lukasz Stafiniak announced</h3>
<div class="outline-text-3" id="text-orga6115e0">
<p>
I&rsquo;m happy to announce <a href="https://marketplace.visualstudio.com/items?itemName=lukstafi.vocaml">a VS Code extension
VOCaml</a> (<a href="https://github.com/lukstafi/vocaml/releases/tag/1.0.0">GitHub
release</a>) where I&rsquo;ll be putting my OCaml coding helpers.
Currently, it has three commands:
</p>

<ul class="org-ul">
<li><i>VOCaml: Add Type Annotations</i> inserts type annotations around let bindings.</li>
<li><i>VOCaml: Remove Type Annotations</i> removes type annotations from let bindings.</li>
<li><i>VOCaml: Visit File from Current Line</i> triggers a <b>Quick Open</b> dialog populated with a file and line number retrieved from the line at cursor position.</li>
</ul>

<p>
VOCaml is a companion to <a href="https://github.com/lukstafi/ppx_minidebug"><code>ppx_minidebug</code></a>, but it can be used for its
own merits. It has some limitations, report issues if you try it!
</p>
</div>
</div>
</div>




<div id="outline-container-7" class="outline-2">
<h2 id="7">Sunsetting opam-repository-mingw</h2>
<div class="outline-text-2" id="text-7">
<p>
Archive: <a href="https://discuss.ocaml.org/t/sunsetting-opam-repository-mingw/11632/1">https://discuss.ocaml.org/t/sunsetting-opam-repository-mingw/11632/1</a>
</p>
</div>

<div id="outline-container-orge888637" class="outline-3">
<h3 id="orge888637">David Allsopp announced</h3>
<div class="outline-text-3" id="text-orge888637">
<p>
As <a href="https://fdopen.github.io/opam-repository-mingw/2021/02/26/repo-discontinued">previously announced</a>,
&ldquo;opam-repository-mingw&rdquo; is no longer receiving updates.
</p>

<p>
We&rsquo;re actively working on getting the Windows compiler packages into
<a href="https://github.com/ocaml/opam-repository">ocaml/opam-repository</a>. There are two issues which are taking (me) a
little while to finish solving, but more on that further below.
</p>

<p>
In the gap - of hopefully only a month or so - for this being ready, there&rsquo;s is an issue that new releases are of
course not available when opam-repository-mingw is being used with
<a href="https://github.com/ocaml/setup-ocaml"><code>ocaml/setup-ocaml@v2</code></a> GitHub actions workflows. I&rsquo;m hoping here to set out
what&rsquo;s happening, and what steps you may need to take to keep your GitHub Actions Windows workflows running
smoothly over the next few months.
</p>
</div>

<div id="outline-container-orgc1b8374" class="outline-4">
<h4 id="orgc1b8374">What&rsquo;s happening right now?</h4>
<div class="outline-text-4" id="text-orgc1b8374">
<p>
We&rsquo;ve updated setup-ocaml to use
<a href="https://github.com/ocaml-opam/opam-repository-mingw">ocaml-opam/opam-repository-mingw</a> instead of
<a href="https://github.com/fdopen/opam-repository-mingw">fdopen/opam-repository-mingw</a> (see
<a href="https://github.com/ocaml/setup-ocaml/pull/651">ocaml/setup-ocaml#651</a>). This clone has been augmented with:
</p>
<ul class="org-ul">
<li>OCaml 4.14.1 packages, in the same style as the 4.14.0 forked packages (the &ldquo;pre-compiled&rdquo; package variants exist, but they&rsquo;re not pre-compiled)</li>
<li>Changes to the constraints for <span class="underline">existing</span> packages only</li>
</ul>

<p>
If you&rsquo;re using setup-ocaml in its default configuration, you should notice no change except that <code>4.14.x</code> builds
should now use 4.14.1 and the initial build will be a little slower as it builds from sources (GitHub Actions
caching will then take over for subsequent runs).
</p>

<p>
For new releases of packages, it&rsquo;s necessary to <span class="underline">add</span> opam-repository to the repositories selections for the
switches. It&rsquo;s important that opam-repository is at a <span class="underline">lower priority</span> than opam-repository-mingw for existing
packages, so it&rsquo;s better to use these lines in your <code>ocaml/setup-ocaml@v2</code> step than to issue <code>opam repo add
--rank=1000</code> later:
</p>

<pre class="example" id="org6796d09">
uses: ocaml/setup-ocaml@v2
with:
  opam-repositories: |
    opam-repository-mingw: https://github.com/ocaml-opam/opam-repository-mingw.git#sunset
    default: https://github.com/ocaml/opam-repository.git
</pre>
</div>
</div>

<div id="outline-container-org27b9544" class="outline-4">
<h4 id="org27b9544">What do I do when things are broken?</h4>
<div class="outline-text-4" id="text-org27b9544">
<p>
There&rsquo;s an issue tracker on
<a href="https://github.com/ocaml-opam/opam-repository-mingw/issues">ocaml-opam/opam-repository-mingw</a>, and this is a very
good place to start.
</p>

<p>
If a version of a package isn&rsquo;t building, there are three possible remedies:
</p>

<ul class="org-ul">
<li>Previous versions of the package may have carried non-upstreamed patches in opam-repository-mingw.</li>
</ul>
<p>
opam-repository&rsquo;s policy is not to carry such patches. In this case, the package actually doesn&rsquo;t work on Windows.
</p>
<ul class="org-ul">
<li>opam-repository should be updated to have <code>os != "win32"</code> added to the <code>available</code> field for the package</li>
<li>An issue on the package&rsquo;s upstream repo should be opened highlighting the need to upstream patches (or even a pull request with them!)</li>
<li>The patches in opam-repository-mingw make changes which may not necessarily be accepted/acceptable upstream in their current form, so the issue may be a better starting point than simply taking a patch and opening a pull request for it (for example, the <code>utop</code> package contains patches which may require further work and review)</li>
</ul>
<ul class="org-ul">
<li>The package relies on environment changes in &ldquo;OCaml for Windows&rdquo;. For example, the Zarith package works in &ldquo;OCaml for Windows&rdquo; because the compiler packages unconditionally set the <code>CC</code> environment variable. This change is both not particularly desirable change to upstream (it is <span class="underline">very</span> confusing, for example, when working on the compiler itself) and also extremely difficult to upstream, so the fix here is instead to change the package&rsquo;s availability with <code>(os != "win32" | os-distribution = "cygwinports")</code> and constrain away OCaml 5 on Windows (<code>"ocaml" {&lt; "5.0" | os != "win32"}</code>)</li>
<li>Package constraints on <span class="underline">existing packages</span> need updating in ocaml-opam/opam-repository-mingw. For example, the release of ppxlib 0.29 required some existing packages to have upperbounds added.</li>
</ul>
</div>
</div>

<div id="outline-container-org43e9f7b" class="outline-4">
<h4 id="org43e9f7b">What about OCaml 5.0.0?</h4>
<div class="outline-text-4" id="text-org43e9f7b">
<p>
OCaml 5.0.0 was released with support for the mingw-w64 port only, however, there&rsquo;s a quite major bug which wasn&rsquo;t
caught by OCaml&rsquo;s testsuite, but is relatively easily triggered by opam packages. I&rsquo;ve <a href="https://discuss.ocaml.org/t/pre-ann-installing-windows-ocaml-5-0-0-in-opam/11150">previously
announced</a> how to add OCaml 5 to
a workflow. For the time being, the packages for OCaml 5 aren&rsquo;t automatically made available.
</p>
</div>
</div>

<div id="outline-container-orgc2865ac" class="outline-4">
<h4 id="orgc2865ac">What&rsquo;s next?</h4>
<div class="outline-text-4" id="text-orgc2865ac">
<p>
The ultimate goal is to be using an upstream build of <code>opam.exe</code> with ocaml/opam-repository, just as on Unix. Once
opam 2.2 is generally available (we&rsquo;re aiming for an alpha release at the end of March) and the compiler packages
in opam-repository support the Windows builds, we will recommend stopping use of opam-repository-mingw completely.
The default in setup-ocaml won&rsquo;t change straight away, since that risks breaking existing workflows.
</p>

<p>
With upstream compiler support, we&rsquo;ll be able to extend some of the existing bulk build support already being done
for Linux to Windows and start to close the gap of patches in opam-repository-mingw.
</p>
</div>
</div>

<div id="outline-container-orgfd8ba92" class="outline-4">
<h4 id="orgfd8ba92">Windows compiler packages</h4>
<div class="outline-text-4" id="text-orgfd8ba92">
<p>
I mentioned earlier the problems with moving the compiler packages into opam-repository, and just for general
interest this elaborates on them.
</p>

<p>
The first issue affects the use of the Visual Studio port (&ldquo;MSVC&rdquo;) and is a consequence of the somewhat strange way
that the C compiler is added to the environment when using the Visual Studio C compiler. &ldquo;OCaml for Windows&rdquo; (as
well as Diskuv) use a wrapper command (it&rsquo;s <code>ocaml-env</code> in &ldquo;OCaml for Windows&rdquo; and <code>with-dkml</code> in Diskuv). Those
commands are Windows-specific, which is an issue for upstream opam. There&rsquo;s an alternate way which sets the
environment variables in a more opam-like way. Doing it that way, though, requires an improvement to opam&rsquo;s
environment handling which is in opam 2.2, otherwise there&rsquo;s an easy risk of &ldquo;blowing&rdquo; the environment.
</p>

<p>
The second issue is selecting the C compiler. On Unix, this is easy
with <code>ocaml-base-compiler</code> because there is only one &ldquo;system&rdquo; C compiler. Windows has two ports of OCaml, and the
configuration requires it to be explicitly selected. That requires input from the user on switch creation for a
Windows switch.
</p>

<p>
&ldquo;OCaml for Windows&rdquo; solves this by packaging the Windows compilers with the variant name appended, just as
opam-repository used to, so <code>ocaml-variants.4.14.1+mingw64</code> selects the the mingw-w64 port and
<code>ocaml-variants.4.14.1+msvc64</code> selects the MSVC64 port. The problem, as we already had in opam-repository, is that
this adds 4 packages for each release of OCaml in <code>ocaml-variants</code>, and leads to a combinatorial explosion when we
start considering flambda and other relevant compiler options.
</p>

<p>
opam-repository switched to using the <code>ocaml-option-</code> packages to solve the combinatorial explosion which was
already present in opam-repository. The demonstration repo for OCaml 5 on Windows is already using an adapted
version of this so that <code>ocaml-option-mingw</code> selects the mingw-w64 port (by default 64-bit, with
<code>ocaml-option-32bit</code> then selecting the 32-bit port).
</p>

<p>
This work is all in progress and being tested alongside changes in  opam 2.2 to support the <span class="underline">depext</span> experience on
Windows. The only reason that&rsquo;s not being upstreamed piecemeal is that changes to the compiler packages in
opam-repository trigger switch rebuilds all over the world, so we don&rsquo;t want to that until we&rsquo;re sure that the
packages are correct. The intention is to do this around the time of the alpha release of opam 2.2, once the work
in opam itself has settled down.
</p>

<p>
Thanks for getting to the end, and happy Windows CI testing!
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-8" class="outline-2">
<h2 id="8">Outreachy Summer 2023</h2>
<div class="outline-text-2" id="text-8">
<p>
Archive: <a href="https://discuss.ocaml.org/t/outreachy-summer-2023/11159/10">https://discuss.ocaml.org/t/outreachy-summer-2023/11159/10</a>
</p>
</div>

<div id="outline-container-org3bbb344" class="outline-3">
<h3 id="org3bbb344">Paul-Elliot announced</h3>
<div class="outline-text-3" id="text-org3bbb344">
<p>
Just wanted to say that I also submitted an OCaml Outreachy project!
</p>

<p>
The goal of the project is to improve the error reporting in the PPXs ecosystem. This includes both modifying
ppxlib&rsquo;s behavior when catching an exception raised by a rewriter; and modify existing PPXs to better report error
(by embedding them inside the AST when relevant, allowing for both multiple error reporting, and creation of a
partial AST that contains all information that could be created).
</p>
</div>
</div>
</div>




<div id="outline-container-9" class="outline-2">
<h2 id="9">VS Code extension Alcotest Test Explorer 0.4.0</h2>
<div class="outline-text-2" id="text-9">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-vs-code-extension-alcotest-test-explorer-0-4-0/11636/1">https://discuss.ocaml.org/t/ann-vs-code-extension-alcotest-test-explorer-0-4-0/11636/1</a>
</p>
</div>

<div id="outline-container-org5a43c3b" class="outline-3">
<h3 id="org5a43c3b">Roland Csaszar announced</h3>
<div class="outline-text-3" id="text-org5a43c3b">
<p>
Thanks to @Muqiu-Han a severe bug has been fixed: an exception
raised by <code>failwith</code> wasn&rsquo;t recognized as failure and the test result had been set to  &rsquo;passed&rsquo;.
</p>

<p>
Changelog:
</p>
</div>
<div id="outline-container-orgecf5ff8" class="outline-4">
<h4 id="orgecf5ff8">Version 0.4.0 (2023-03-10)</h4>
<div class="outline-text-4" id="text-orgecf5ff8">
<ul class="org-ul">
<li>Mark a test case as failed if a <code>[FAIL]</code> tag is present, even if the actual error message can&rsquo;t be parsed.</li>
</ul>
</div>
</div>

<div id="outline-container-org1939c88" class="outline-4">
<h4 id="org1939c88">Bugfixes</h4>
<div class="outline-text-4" id="text-org1939c88">
<ul class="org-ul">
<li>Make the error parser recognize the exception generated by <code>failwith</code>. (Fix <a href="https://github.com/Release-Candidate/vscode-ocaml-alcotest-test-adapter/issues/1">#1</a>)</li>
</ul>
</div>
</div>

<div id="outline-container-orge8b4fb4" class="outline-4">
<h4 id="orge8b4fb4">Internal Changes</h4>
<div class="outline-text-4" id="text-orge8b4fb4">
<ul class="org-ul">
<li>Add test cases to check that the changes actually work.</li>
<li>Fix typo in issue template.</li>
<li>Correct the job name in the <code>release</code> GitHub workflow.</li>
</ul>
</div>
</div>
</div>
</div>




<div id="outline-container-org8da4b5a" class="outline-2">
<h2 id="org8da4b5a">Old CWN</h2>
<div class="outline-text-2" id="text-org8da4b5a">
<p>
If you happen to miss a CWN, you can <a href="mailto:alan.schmitt@polytechnique.org">send me a message</a> and I&rsquo;ll mail it to you, or go take a look at <a href="https://alan.petitepomme.net/cwn/">the archive</a> or the <a href="https://alan.petitepomme.net/cwn/cwn.rss">RSS feed of the archives</a>.
</p>

<p>
If you also wish to receive it every week by mail, you may subscribe <a href="http://lists.idyll.org/listinfo/caml-news-weekly/">online</a>.
</p>

<div class="authorname" id="orgdd98b28">
<p>
<a href="https://alan.petitepomme.net/">Alan Schmitt</a>
</p>

</div>
</div>
</div>
</div>
</body>
</html>