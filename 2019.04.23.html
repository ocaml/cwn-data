<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2019-04-23 Tue 09:55 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OCaml Weekly News</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<style type="text/css">#table-of-contents h2 { display: none } .title { display: none } .authorname { text-align: right }</style>
<style type="text/css">.outline-2 {border-top: 1px solid black;}</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">OCaml Weekly News</h1>
<p>
<a href="http://alan.petitepomme.net/cwn/2019.04.16.html">Previous Week</a> <a href="http://alan.petitepomme.net/cwn/index.html">Up</a> <a href="http://alan.petitepomme.net/cwn/2019.04.30.html">Next Week</a>
</p>

<p>
Hello
</p>

<p>
Here is the latest OCaml Weekly News, for the week of April 16 to 23, 2019.
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#1">Wrapping C++ std::shared_ptr and similar smart pointers</a></li>
<li><a href="#2">OCaml 4.08.0+beta3</a></li>
<li><a href="#3">Menhir and preserving comments from source</a></li>
<li><a href="#4">ppx_protocol_conv 5.0.0</a></li>
<li><a href="#5">Orsetto: structured data interchange languages (preview release)</a></li>
<li><a href="#6">Searching for functions</a></li>
<li><a href="#7">Other OCaml News</a></li>
<li><a href="#orgdd8fca2">Old CWN</a></li>
</ul>
</div>
</div>


<div id="outline-container-orge4c681e" class="outline-2">
<h2 id="1">Wrapping C++ std::shared_ptr and similar smart pointers</h2>
<div class="outline-text-2" id="text-1">
<p>
Archive: <a href="https://discuss.ocaml.org/t/wrapping-c-std-shared-ptr-and-similar-smart-pointers/3582/1">https://discuss.ocaml.org/t/wrapping-c-std-shared-ptr-and-similar-smart-pointers/3582/1</a>
</p>
</div>

<div id="outline-container-org95c7d3f" class="outline-3">
<h3 id="org95c7d3f">Manuel Hornung asked</h3>
<div class="outline-text-3" id="text-org95c7d3f">
<p>
I'm trying to create Reason/OCaml bindings for the Skia 2D graphics library. The library makes heavy use of smart pointers similar to `std::shared_ptr`s, but they called them `sk_sp`.
</p>

<p>
Now my first idea for wrapping these was using a regular pointer that points to a shared pointer. That would trigger the release of the memory behind the shared pointer as soon as the local variable containing the shared pointer goes out of scope though.
</p>

<p>
I found a solution that looked promising to me in <a href="https://github.com/ygrek/scraps/blob/master/cxx_wrapped.h">https://github.com/ygrek/scraps/blob/master/cxx_wrapped.h</a> but now I heard that reducing the refcount in the finalizer is also not a good idea. Unfortunately I don't know why that is not a good idea and I also don't have a better one.
</p>

<p>
Can anyone help me understand this better and point me towards a better approach?
</p>
</div>
</div>


<div id="outline-container-orgece1e36" class="outline-3">
<h3 id="orgece1e36">Guillaume Munch-Maccagnoni replied</h3>
<div class="outline-text-3" id="text-orgece1e36">
<p>
(Sorry for the delay as I have been busy.)
</p>

<p>
It all comes down to the fact that tracing and reference counting have different advantages and drawbacks, and the main difference for this question is that RC reclaims promptly, whereas tracing does not reclaim predictably; in addition OCaml is currently poor in terms of predictable resource management.
</p>

<p>
Smart pointers can be used to manage resources other than memory. (I mean smart pointers that implement deterministic reclamation of resources such as unique or reference-counted pointers; in principle smart pointers are not restricted in what they implement: delayed evaluation, <a href="http://manishearth.github.io/blog/2015/09/01/designing-a-gc-in-rust/">roots for tracing GCs</a>&#x2026; such exotic pointers are out of the scope of my answer.)
</p>

<p>
First, you need to determine whether the pointer manages non-memory resources (the destruction closes a file, releases a lock, rolls back some state&#x2026;). If so, using finalizers is a no-go, because you cannot predict when and in which order finalizers run, and in practice it can be way too late. When that is the case, skip 1). For instance I see that your library has some functions that return RAII guards; quite obviously these cannot be handled with finalizers.
</p>
</div>

<div id="outline-container-org6a99924" class="outline-4">
<h4 id="org6a99924">1) Custom blocks with finalizer</h4>
<div class="outline-text-4" id="text-org6a99924">
<p>
If the smart pointer only manages memory, then it is possible to represent it with a custom block with a finalizer attached to it. The GC needs to know the size of what it manages, otherwise it will not work hard enough to reclaim memory and you can end up with a memory leak. This has occasionally been called “<a href="https://github.com/ocaml/ocaml/issues/7676">the familiar "allocation of custom objects mess up the speed of the major GC" problem</a>”.
</p>

<p>
The situation is supposed to improve in OCaml 4.08, which introduces <a href="https://github.com/ocaml/ocaml/pull/1738">a new function <code>caml_alloc_custom_mem</code></a>  that lets you specify the size of the memory managed by the custom block, which the GC's heuristics will take into account. (<code>caml_alloc_custom</code> also has parameters to tweak the GC speed but presumably this was not good enough as witnessed by the multiple bug reports referenced in that PR.)
</p>

<p>
So you can use as a source of inspiration @ygrek's <code>wrapped</code> pointer you have linked to above, but you must adapt it to tell the OCaml GC the size of the data your custom block contains.
</p>

<p>
Pros:
</p>

<ul class="org-ul">
<li>Expressive: the foreign data is abstracted as an OCaml value that can be passed around, inserted into data structures, etc.</li>
</ul>

<p>
Cons:
</p>

<ul class="org-ul">
<li>No-go for non-memory resources.</li>

<li>You need to know the size of what you are managing—there is no universal smart pointer wrapper!</li>

<li>Not so good for performance/scale or interoperability. Mixing tracing and RC cumulates the drawbacks of both; in particular you inherit the possible unbounded latency due to the upfront deallocation cost of RC (depending on your use-case), and you are even at a risk of creating cycles that are never collected if you mix this method with <a href="https://discuss.ocaml.org/t/storing-an-ocaml-value-in-a-c-structure/3521">that one</a> to store OCaml values on the foreign side.</li>
</ul>

<p>
These are some guaranteed theoretical drawbacks, but I imagine that there can be more practical implementation-specific issues (as witnessed by <code>caml_alloc_custom</code> vs <code>caml_alloc_custom_mem</code>). I do not have hands-on experience with custom blocks, and while researching for this answer, I found this usage not very well documented, so I hope that experts can fill-in the gaps and/or correct the above if needed.
</p>
</div>
</div>


<div id="outline-container-org7f26125" class="outline-4">
<h4 id="org7f26125">2) Deterministic resource management</h4>
<div class="outline-text-4" id="text-org7f26125">
<p>
To avoid the impedance mismatch between smart pointers and the GC, you can rely on deterministic resource management. In OCaml, the idiomatic expression of it is to use “~with_~” wrappers based on <code>unwind-protect</code> [see the <a href="https://dev.realworldocaml.org/error-handling.html">example of files</a>]. OCaml 4.08 introduces <code>Fun.protect</code>, an implementation of <code>unwind-protect</code> suitable for OCaml.
</p>

<p>
Pros:
</p>

<ul class="org-ul">
<li>Predictable: can be used for non-memory resources.</li>
</ul>

<p>
Cons:
</p>

<ul class="org-ul">
<li>Lacks expressiveness: resources live for the exact duration of their defining scope, and are reclaimed in LIFO order.</li>

<li>Allows “use after free”: the resource can be referenced outside of its scope, if not careful.</li>

<li>Currently incompatible with asynchronous exceptions: OCaml does not currently allow an implementation of unwind-protect that protects from asynchronous exceptions being raised inside the finally clause.</li>
</ul>
</div>
</div>

<div id="outline-container-org9213a07" class="outline-4">
<h4 id="org9213a07">3) Manual resource management</h4>
<div class="outline-text-4" id="text-org9213a07">
<p>
If neither 1) nor 2) fit the bill, you have to resort to manual resource management, in which the user has to call some <code>free</code> function explicitly (and gets an exception if they use it after <code>free</code>). It is “hard” to program correctly with manual resource management, moreso in the presence of exceptions. For this reason, people mix it with 1) and/or 2); for instance they use unwind-protect in a non-systematic manner, or they attach finalizers to act as a fallback, or both. While with 1) and 2) you are still within the realm of structured programming, with manual resource management you enter the realm of debugging-oriented programming—think programming in a weird dialect of old C++.
</p>

<p>
Pros:
</p>

<ul class="org-ul">
<li>Last resort solution</li>
</ul>

<p>
Cons:
</p>

<ul class="org-ul">
<li>Non-idiomatic code</li>

<li>Hard to program</li>

<li>Hard to reason about the code</li>
</ul>

<p>
Discussions with Serious Industrial OCaml Users a while ago (starting around POPL 2017 in Paris) have let appear OCaml's current issues with resource management. These discussion prompted <a href="https://discuss.ocaml.org/t/a-proposal-for-a-resource-management-model-for-ocaml/1680">a proposal for a resource management model for OCaml</a>, inspired by RAII and move semantics from modern C++/Rust. In a nutshell, it aims to lift the expressiveness limitations of 2).  Interoperability is probably its most important application.
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-orgd9d6783" class="outline-2">
<h2 id="2">OCaml 4.08.0+beta3</h2>
<div class="outline-text-2" id="text-2">
<p>
Archive: <a href="https://sympa.inria.fr/sympa/arc/caml-list/2019-04/msg00048.html">https://sympa.inria.fr/sympa/arc/caml-list/2019-04/msg00048.html</a>
</p>
</div>

<div id="outline-container-orgc5457ea" class="outline-3">
<h3 id="orgc5457ea">Damien Doligez announced</h3>
<div class="outline-text-3" id="text-orgc5457ea">
<p>
Dear OCaml users,
</p>

<p>
The release of OCaml 4.08.0 is approaching. We have created
a third beta version to help you adapt your software to the new features
ahead of the release.
</p>

<p>
The source code is available at these addresses:
</p>

<p>
<a href="https://github.com/ocaml/ocaml/archive/4.08.0+beta3.tar.gz">https://github.com/ocaml/ocaml/archive/4.08.0+beta3.tar.gz</a><br />
<a href="https://caml.inria.fr/pub/distrib/ocaml-4.08/ocaml-4.08.0+beta3.tar.gz">https://caml.inria.fr/pub/distrib/ocaml-4.08/ocaml-4.08.0+beta3.tar.gz</a>
</p>

<p>
The compiler is (or will soon be) also available in OPAM with one of
the following commands.
</p>

<p>
opam switch create ocaml-variants.4.08.0+beta3 &#x2013;repositories=default,beta=git+<a href="https://github.com/ocaml/ocaml-beta-repository.git">https://github.com/ocaml/ocaml-beta-repository.git</a>
</p>

<p>
or
</p>

<p>
opam switch create ocaml-variants.4.08.0+beta3+&lt;VARIANT&gt; &#x2013;repositories=default,beta=git+<a href="https://github.com/ocaml/ocaml-beta-repository.git">https://github.com/ocaml/ocaml-beta-repository.git</a>
</p>

<p>
where you replace &lt;VARIANT&gt; with one of these:<br />
  afl<br />
  default_unsafe_string<br />
  flambda<br />
  fp<br />
  fp+flambda<br />
</p>

<p>
We want to know about all bugs. Please report them here:
 <a href="https://github.com/ocaml/ocaml/issues">https://github.com/ocaml/ocaml/issues</a>
</p>

<p>
Happy hacking,
</p>

<p>
&#x2013; Damien Doligez for the OCaml team.
</p>


<p>
The changes from beta2 are the following:
</p>

<ul class="org-ul">
<li>GPR#1942, GPR#2244: simplification of the static check for recursive definitions (Alban Reynaud and Gabriel Scherer, review by Jeremy Yallop, Armaël Guéneau and Damien Doligez)</li>

<li>GPR#1354, GPR#2177: Add fma support to Float module. (Laurent Thévenoux, review by Alain Frisch, Jacques-Henri Jourdan, Xavier Leroy)</li>

<li>GPR#2202: Correct Hashtbl.MakeSeeded.{add_seq,replace_seq,of_seq} to use functor hash function instead of default hash function. Hashtbl.Make.of_seq shouldn't create randomized hash tables. (David Allsopp, review by Alain Frisch)</li>

<li>* PR#4208, PR#4229, PR#4839, PR#6462, PR#6957, PR#6950, GPR#1063, GPR#2176, GPR#2297: Make (nat)dynlink sound. (Mark Shinwell, Leo White, Nicolás Ojeda Bär, Pierre Chambart)</li>

<li>GPR#2317: type_let: be more careful generalizing parts of the pattern (Thomas Refis and Leo White, review by Jacques Garrigue)</li>

<li>MPR#6242, GPR#2143, MPR#8558, GPR#8559: optimize some local functions (Alain Frisch, review by Gabriel Scherer)</li>

<li>#7829, #8585: Fix pointer comparisons in freelist.c (for 32-bit platforms) (David Allsopp and Damien Doligez)</li>

<li>#8567, #8569: on ARM64, use 32-bit loads to access caml_backtrace_active (Xavier Leroy, review by Mark Shinwell and Greta Yorsh)</li>

<li>#8568: Fix a memory leak in mmapped bigarrays (Damien Doligez, review by Xavier Leroy and Jérémie Dimino)</li>

<li>MPR#7548: printf example in the tutorial part of the manual (Kostikova Oxana, rewiew by Gabriel Scherer, Florian Angeletti, Marcello Seri and Armaël Guéneau)</li>

<li>MPR#7547, GPR#2273: Tutorial on Lazy expressions and patterns in OCaml Manual (Ulugbek Abdullaev, review by Florian Angeletti and Gabriel Scherer)</li>

<li>GPR#8508: refresh \moduleref macro (Florian Angeletti, review by Gabriel Scherer)</li>

<li>MPR#7919, GPR#2311: Fix assembler detection in configure (Sébastien Hinderer, review by David Allsopp)</li>

<li>GPR#2295: Restore support for bytecode target XLC/AIX/Power (Konstantin Romanov, review by Sébastien Hinderer and David Allsopp)</li>

<li>GPR#8528: get rid of the direct call to the C preprocessor in the testsuite (Sébastien Hinderer, review by David Allsopp)</li>

<li>Issue #7938, GPR #8532: Fix alignment detection for ints on 32-bits platforms (Sébastien Hinderer, review by Xavier Leroy)</li>

<li>* GPR#8533: Remove some unused configure tests (Stephen Dolan, review by David Allsopp and Sébastien Hinderer)</li>

<li>GPR#2207,#8604: Add opam files to allow pinning (Leo White, Greta Yorsh, review by Gabriel Radanne)</li>

<li>MPR#7835, GPR#1980, GPR#8548, GPR#8586: separate scope from stamp in idents and explicitly rescope idents when substituting signatures. (Thomas Refis, review by Jacques Garrigue and Leo White)</li>

<li>#8550, #8552: Soundness issue with class generalization (Jacques Garrigue, review by Leo White and Thomas Refis, report by Jeremy Yallop)</li>
</ul>
</div>
</div>
</div>




<div id="outline-container-org6e3cb71" class="outline-2">
<h2 id="3">Menhir and preserving comments from source</h2>
<div class="outline-text-2" id="text-3">
<p>
Archive: <a href="https://discuss.ocaml.org/t/menhir-and-preserving-comments-from-source/3686/1">https://discuss.ocaml.org/t/menhir-and-preserving-comments-from-source/3686/1</a>
</p>
</div>

<div id="outline-container-orgec497cb" class="outline-3">
<h3 id="orgec497cb">Chet Murthy asked</h3>
<div class="outline-text-3" id="text-orgec497cb">
<p>
I've used ocamlyacc over the years a lot, and menhir in a couple of projects (including a big one I'm working on right now).  I've also used camlp4/camlp5's stream-parsers in a <b>ton</b> of projects.  And of course, with ocamllex and sedlexing.  I find that with stream-parsers, it's easy to arrange for preserving lexical positions in tokens, and then carrying that across to the parse-tree.  To wit,
</p>
<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #a52a2a;">...</span>
<span style="color: #000000; font-weight: bold;">type</span> <span style="color: #228b22;">basic_token</span> <span style="color: #a52a2a;">=</span> <span style="color: #a52a2a;">......</span> <span style="color: #ff4500;">;;</span>
<span style="color: #000000; font-weight: bold;">type</span> <span style="color: #228b22;">token</span> <span style="color: #a52a2a;">=</span> basic_token <span style="color: #a52a2a;">*</span> lexical_position_info_t <span style="color: #ff4500;">;;</span>
<span style="color: #a52a2a;">...</span>
</pre>
</div>

<p>
and then in your stream parser, you pattern-match on the first component, e.g.
</p>
<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #a52a2a;">...</span>
<span style="color: #483d8b;">parser</span> <span style="color: #a52a2a;">[&lt;</span> <span style="color: #a52a2a;">....</span> <span style="color: #a52a2a;">;</span> '<span style="color: #a52a2a;">(</span><span style="color: #000000; background-color: #ffffff;">Tstring</span> s<span style="color: #a52a2a;">,</span> _<span style="color: #a52a2a;">)</span> <span style="color: #a52a2a;">;</span> <span style="color: #a52a2a;">...</span> <span style="color: #a52a2a;">&gt;]</span> <span style="color: #a52a2a;">-&gt;</span> yadda yadda
<span style="color: #a52a2a;">...</span>
</pre>
</div>

<p>
But with menhir (and ocamlyacc) it seems like, you need to embed the lexical position info in the token, e.g.
</p>
<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #a52a2a;">...</span>
<span style="color: #000000; font-weight: bold;">type</span> <span style="color: #228b22;">basic_token</span> <span style="color: #a52a2a;">=</span>
<span style="color: #a52a2a;">|</span> <span style="color: #000000; background-color: #ffffff;">Tstring</span> <span style="color: #a020f0;">of</span> lexicai_position_info_t <span style="color: #a52a2a;">*</span> string
<span style="color: #a52a2a;">|</span> <span style="color: #000000; background-color: #ffffff;">Tsemi</span> <span style="color: #a020f0;">of</span> lexical_position_info_t
etc
<span style="color: #a52a2a;">...</span>
</pre>
</div>

<p>
Is there some trick I'm missing, for how to use camlyacc/menhir in a manner that allows preserving this positional information during the parse?
</p>
</div>
</div>


<div id="outline-container-org612e2f4" class="outline-3">
<h3 id="org612e2f4">gasche replied</h3>
<div class="outline-text-3" id="text-org612e2f4">
<p>
To have location/position information in the AST: the standard approach I'm familiar with is not to embed position information in the tokens, but to query it from the lexer or parser at the place where you build your AST values in the parser actions. When using ocamlyacc, I use the <code>Lexing</code> module for this (<code>Lexing.lexeme_{start,end}_p</code>), when using Menhir I use its special symbols <code>${start,end}pos</code>, <code>${start,end}pos(n)</code>, <code>$loc</code>, <code>$loc(n)</code>.
</p>

<p>
To preserve comments, an approach we use in the OCaml compiler (where comments that are docstrings are kept in the AST) is to have a global table of comments, that is filled by the Lexer, and accessed from parsing actions (there is a function that says basically "collect all the comments from the last time you were called to &lt;this position&gt;").
</p>
</div>
</div>
</div>




<div id="outline-container-orgf8e2853" class="outline-2">
<h2 id="4">ppx_protocol_conv 5.0.0</h2>
<div class="outline-text-2" id="text-4">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-ppx-protocol-conv-5-0-0/3692/1">https://discuss.ocaml.org/t/ann-ppx-protocol-conv-5-0-0/3692/1</a>
</p>
</div>

<div id="outline-container-orgdb5854b" class="outline-3">
<h3 id="orgdb5854b">Anders Fugmann announced</h3>
<div class="outline-text-3" id="text-orgdb5854b">
<p>
It is my pleasure to announce the release of <a href="https://github.com/anders.fugmann/ppx_protocol_conv">Ppx_protocol_conv</a> version 5.0.0.
</p>

<p>
Ppx_protocol_conv is a syntax extension to generate functions to serialize and de-serialize ocaml types. The ppx itself does not contain any protocol specific code, but relies on user defined 'drivers' to define serialization and de-serialiazation of basic types and structures.
</p>

<p>
The library comes with multiple pre-defined drivers:
</p>
<ul class="org-ul">
<li>ppx_protocol_conv_json (Yojson.Safe.json)</li>
<li>ppx_protocol_conv_jsonm (Ezjson.value)</li>
<li>ppx_protocol_conv_msgpack (Msgpck.t)</li>
<li>ppx_protocol_conv_xml-light (Xml.xml)</li>
<li>ppx_protocol_conv_yaml (Yaml.value)</li>
</ul>

<p>
The library is based on ppxlib and is is compatible with base v0.12.
Release 5.0.0 is available through opam.
</p>

<p>
The project homepage is: <a href="https://github.com/andersfugmann/ppx_protocol_conv">https://github.com/andersfugmann/ppx_protocol_conv</a>
</p>

<p>
The project's <a href="https://github.com/andersfugmann/ppx_protocol_conv/wiki">wiki pages</a> contains some more information on how to use the library and existing drivers and on how to write you own drivers.
</p>

<p>
<b>Noteworthy Change</b>
This release includes a major rewrite of the core of the library to allow more control by user supplied drivers over the serialization and de-serialization of types. These changes breaks backward compatibility.
</p>

<p>
The json driver (<code>Ppx_protocol_conv_json</code>) has been updated to be compatible with the serialization format of ppx_deriving_yojson, supporting both <code>[@key]</code>, <code>[@name]</code> and <code>[@default]</code> attributes, and can be used as a replacement for <code>ppx_deriving_yojson</code> with few modifications.
</p>

<p>
Deserialization functions now returns a <code>result</code> type. Old support for exception type errors is available in functions with the <code>_exn</code> suffix.
For a complete list of changes, see the <a href="https://github.com/andersfugmann/ppx_protocol_conv/blob/master/Changelog">Changelog</a>.
</p>

<p>
As always, comments, suggestions and PRs are more than welcome.
</p>
</div>
</div>
</div>




<div id="outline-container-org0ced952" class="outline-2">
<h2 id="5">Orsetto: structured data interchange languages (preview release)</h2>
<div class="outline-text-2" id="text-5">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-orsetto-structured-data-interchange-languages-preview-release/3304/6">https://discuss.ocaml.org/t/ann-orsetto-structured-data-interchange-languages-preview-release/3304/6</a>
</p>
</div>

<div id="outline-container-orga468360" class="outline-3">
<h3 id="orga468360">james woodyatt announced</h3>
<div class="outline-text-3" id="text-orga468360">
<p>
I have now released <code>~preview4</code> which resolves Issue <a href="https://bitbucket.org/jhw/orsetto/issues/8/ocaml-407-the-new-stdlibseqt-is">#8</a> <i>OCaml 4.07: the new Stdlib.Seq.t is functionally equivalent to Cf_seq.t</i>. For OCaml 4.06, this introduces an external dependency on the <b>seq</b> compatibility package. I've also checked that documentary comments are available with <b>odig</b>, so this might be the last preview release before 1.0. (It depends on whether I decide to remove the support for the <b>ppx_let</b> syntax extension.)
</p>
</div>
</div>


<div id="outline-container-org32a062e" class="outline-3">
<h3 id="org32a062e">james woodyatt then added</h3>
<div class="outline-text-3" id="text-org32a062e">
<p>
&gt; It depends on whether I decide to remove the support for the  <b>ppx_let</b>  syntax extension.
</p>

<p>
I've thought about this, and I will not be removing support for the <b>ppx_let</b> syntax extension. I plan to <i>deprecate</i> it when OCaml 4.08 is released, but it will be retained while I continue supporting OCaml 4.06 and 4.07.
</p>
</div>
</div>
</div>




<div id="outline-container-org1885933" class="outline-2">
<h2 id="6">Searching for functions</h2>
<div class="outline-text-2" id="text-6">
<p>
Archive: <a href="https://discuss.ocaml.org/t/searching-for-functions/3698/1">https://discuss.ocaml.org/t/searching-for-functions/3698/1</a>
</p>
</div>

<div id="outline-container-orgebcd63a" class="outline-3">
<h3 id="orgebcd63a">Jordan Mackie announced</h3>
<div class="outline-text-3" id="text-orgebcd63a">
<p>
OCaml newbie here - coming from Haskell land out of curiosity.
</p>

<p>
I'm curious how you guys find your way around stdlib/packages etc?
</p>

<p>
Example: I'm writing a script and I want to lookup an environment variable. I know there's probably some function along the lines of  <code>get_env</code> somewhere, so I'd like to know where it is and what type it has. In Haskell I'd do a hoogle search along the lines of <a href="https://www.stackage.org/lts-13.18/hoogle?q=getenv">https://www.stackage.org/lts-13.18/hoogle?q=getenv</a> - what would be my process in OCaml?
</p>

<p>
I tried googling "get env var in Ocaml" - first hit is a link to stdlib, but I'm using base. It did at least give me the hint that <code>Sys</code> is a relevant namespace, so I go and look at the docs for <code>Base.Sys</code> (many clicks later - <a href="https://ocaml.janestreet.com/ocaml-core/latest/doc/base/Base/Sys/index.html">https://ocaml.janestreet.com/ocaml-core/latest/doc/base/Base/Sys/index.html</a>) but <code>getenv</code> isn't listed. But it is apparently there&#x2026;
</p>

<p>
There must be a better way?
</p>
</div>
</div>


<div id="outline-container-orgc0c4021" class="outline-3">
<h3 id="orgc0c4021">Yawar Amin</h3>
<div class="outline-text-3" id="text-orgc0c4021">
<p>
The Hoogle equivalent for OCaml is called odig: <a href="https://erratique.ch/software/odig">https://erratique.ch/software/odig</a> . You can install it locally and have it generate documentation for all installed packages. However, generated documentation is not globally searchable (see last point). Besides that, there are a few other strategies:
</p>

<ul class="org-ul">
<li>Familiarize yourself with the standard library that ships with every OCaml distribution: <a href="https://caml.inria.fr/pub/docs/manual-ocaml/libref/">https://caml.inria.fr/pub/docs/manual-ocaml/libref/</a> . This is the equivalent of Haskell's <code>base</code> package. The <code>Prelude</code> equivalent module is called <code>Pervasives</code>. You will find the <code>Sys</code> module here, and <code>getenv</code> in there.</li>
<li>Keep <a href="http://opam.ocaml.org/packages/">http://opam.ocaml.org/packages/</a> handy for when you're given a package name to look up. Package documentation is mostly not uploaded to a central location like Haddock. (But people have been talking about setting that up at docs.ocaml.org.) You'll probably need to open up and search through <code>.mli</code> files once in a while.</li>
<li>The old-style ocamldoc documentation pages (like the standard library I linked above) have very handy pages indexing types, values, and modules. However, the newer odoc documentation pages which are becoming the de facto standard do not, as of yet. There are a couple of issues tracking this.</li>
</ul>
</div>
</div>
</div>




<div id="outline-container-orgc273b1a" class="outline-2">
<h2 id="7">Other OCaml News</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-org0b30986" class="outline-3">
<h3 id="org0b30986">From the ocamlcore planet blog</h3>
<div class="outline-text-3" id="text-org0b30986">
<p>
Here are links from many OCaml blogs aggregated at <a href="http://ocaml.org/community/planet/">OCaml Planet</a>.
</p>

<ul class="org-ul">
<li><a href="https://functionaljobs.com/jobs/9165-ocaml-developer-at-ahrefs">OCaml Developer at Ahrefs (Full-time)</a></li>
<li><a href="https://blog.janestreet.com/learning-ml-depth-first/">Learning ML Depth-First</a></li>
</ul>
</div>
</div>
</div>




<div id="outline-container-orgdd8fca2" class="outline-2">
<h2 id="orgdd8fca2">Old CWN</h2>
<div class="outline-text-2" id="text-orgdd8fca2">
<p>
If you happen to miss a CWN, you can <a href="mailto:alan.schmitt@polytechnique.org">send me a message</a> and I'll mail it to you, or go take a look at <a href="http://alan.petitepomme.net/cwn/">the archive</a> or the <a href="http://alan.petitepomme.net/cwn/cwn.rss">RSS feed of the archives</a>.
</p>

<p>
If you also wish to receive it every week by mail, you may subscribe <a href="http://lists.idyll.org/listinfo/caml-news-weekly/">online</a>.
</p>

<div class="authorname">
<p>
<a href="http://alan.petitepomme.net/">Alan Schmitt</a>
</p>

</div>
</div>
</div>
</div>
</body>
</html>
