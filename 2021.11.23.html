<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-11-23 Tue 08:42 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OCaml Weekly News</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<style type="text/css">#table-of-contents h2 { display: none } .title { display: none } .authorname { text-align: right }</style>
<style type="text/css">.outline-2 {border-top: 1px solid black;}</style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">OCaml Weekly News</h1>
<p>
<a href="https://alan.petitepomme.net/cwn/2021.11.16.html">Previous Week</a> <a href="https://alan.petitepomme.net/cwn/index.html">Up</a> <a href="https://alan.petitepomme.net/cwn/2021.11.30.html">Next Week</a>
</p>

<p>
Hello
</p>

<p>
Here is the latest OCaml Weekly News, for the week of November 16 to 23, 2021.
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#1">Multicore OCaml: October 2021</a></li>
<li><a href="#2">Robur Reproducible Builds</a></li>
<li><a href="#3">OCaml compiler development newsletter, issue 4: October 2021</a></li>
<li><a href="#4">How do you read the lines of a text files…</a></li>
<li><a href="#5">WebAuthn - Web Authentication</a></li>
<li><a href="#6">Set up OCaml 2.0.0-beta9</a></li>
<li><a href="#7">Windows-friendly OCaml 4.12 distribution 2nd preview release (0.2.0)</a></li>
<li><a href="#8">opam build and opam test: the opam plugins that simplifies your dev setup</a></li>
<li><a href="#9">Twenty Years of OCaml Weekly News</a></li>
<li><a href="#orge4c4718">Old CWN</a></li>
</ul>
</div>
</div>


<div id="outline-container-1" class="outline-2">
<h2 id="1">Multicore OCaml: October 2021</h2>
<div class="outline-text-2" id="text-1">
<p>
Archive: <a href="https://discuss.ocaml.org/t/multicore-ocaml-october-2021/8822/1">https://discuss.ocaml.org/t/multicore-ocaml-october-2021/8822/1</a>
</p>
</div>

<div id="outline-container-orgdf2dfc0" class="outline-3">
<h3 id="orgdf2dfc0">Anil Madhavapeddy announced</h3>
<div class="outline-text-3" id="text-orgdf2dfc0">
<p>
Welcome to the October 2021 <a href="https://github.com/ocaml-multicore/ocaml-multicore">Multicore OCaml</a> monthly report! The
<a href="https://discuss.ocaml.org/tag/multicore-monthly">previous updates</a> along with
this update have been compiled by me, @ctk21, @kayceesrk and @shakthimaan.
</p>

<p>
As @octachron announced last month, the core team has <a href="https://discuss.ocaml.org/t/the-road-to-ocaml-5-0/8584">committed to an OCaml 5.0
release</a> next year with multicore and the effects runtime.
This month has seen tremendous activity in our multicore trees to prepare an upstream-friendly version, with a number
of changes made to make the code ready for <code>ocaml/ocaml</code> and reduce the size of the diff. Recall that we have been
feeding in multicore-related changes steadily since way <a href="https://discuss.ocaml.org/t/multicore-prerequisite-patches-appearing-in-released-ocaml-compilers-now/4408">back in OCaml
4.09</a>, and
so we are now down to the really big pieces.  Therefore the mainline OCaml trunk code is now being continuously being
merged into our 5.00 staging branch, and test coverage has increased accordingly.
</p>

<p>
In the standard library, we continue to work and improve on thread safety by default. Since effect handlers are
confirmed to go into 5.0 as well, they now have their own module in the stdlib as well. The multicore library
ecosystem is also evolving with the changes to support OCaml 5.00, and in particular, Domainslib has had significant
updates and improvements as more usecases build up. The integration of the Sandmark performance harness with
current-bench is also actively being worked upon.
</p>

<p>
We would like to acknowledge the following people for their contribution:
</p>
<ul class="org-ul">
<li>Török Edwin was able to reproduce the bug in <code>Task.pool</code> management <a href="https://github.com/ocaml-multicore/domainslib/issues/43">Domainslib#43</a>, and has also provided a PR to fix the same.</li>
<li>Sid Kshatriya has created <a href="https://github.com/ocaml-multicore/eio/pull/83">PR#83</a> for <code>Eio</code> to use the Effect Handlers module.</li>
</ul>

<p>
Our focus in November is going to continue to be on relentlessly making a 5.0 staging tree, and we are preparing for
a series of working groups with the core OCaml teams (taking up an entire week) to conduct preliminary code review on
the full patchset. Stay tuned for how that has gone by the start of December!
</p>

<p>
As always, the Multicore OCaml updates are listed first, which contain the upstream efforts, merges with trunk,
updates to test cases, bug fixes, and documentation improvements. This is followed by the ecosystem updates on
Domainslib, <code>Tezos</code>, and <code>Eio</code>. The Sandmark and current-bench tasks are finally listed for your reference.
</p>

<p>
<i>Editor’s note: the very long release notes can be found by following the archive link above.</i>
</p>
</div>
</div>
</div>




<div id="outline-container-2" class="outline-2">
<h2 id="2">Robur Reproducible Builds</h2>
<div class="outline-text-2" id="text-2">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-robur-reproducible-builds/8827/1">https://discuss.ocaml.org/t/ann-robur-reproducible-builds/8827/1</a>
</p>
</div>

<div id="outline-container-org32eda97" class="outline-3">
<h3 id="org32eda97">Reynir Björnsson announced</h3>
<div class="outline-text-3" id="text-org32eda97">
</div>
<div id="outline-container-org861dd8b" class="outline-4">
<h4 id="org861dd8b">Robur Reproducible Builds</h4>
<div class="outline-text-4" id="text-org861dd8b">
<p>
Over the past year we in <a href="https://robur.coop/">Robur</a> have been working towards easing deployment of reproducible
mirage applications. The work has been funded by the Eurepean Union under the <a href="https://pointer.ngi.eu/">Next Generation Internet (NGI Pointer)
initiative</a>. The result is <a href="https://builds.robur.coop">available as a website</a>.
</p>

<p>
The overall goal is to push MirageOS into production in a trustworthy way. We worked on reproducible builds for
MirageOS - with the infrastructure being reproducible itself. A handful of core packages are hosted there (described
below in this article), next to several ready-to-use MirageOS unikernels - ranging from <a href="https://builds.robur.coop/job/dns-primary-git/">authoritative DNS
servers</a> (<a href="https://builds.robur.coop/job/dns-secondary/">secondary</a>,
<a href="https://builds.robur.coop/job/dns-letsencrypt-secondary/">let's encrypt DNS solver</a>), <a href="https://builds.robur.coop/job/dnsvizor/">DNS-and-DHCP service (similar
to dnsmasq)</a>, <a href="https://builds.robur.coop/job/tlstunnel/">TLS reverse proxy</a>,
<a href="https://builds.robur.coop/job/unipi/">Unipi - a web server that delivers content from a git repository</a>, <a href="https://builds.robur.coop/job/dns-resolver/">DNS
resolver</a>, <a href="https://builds.robur.coop/job/caldav/">CalDAV server</a>, and
of course your own MirageOS unikernel.
</p>

<p>
Reproducible builds are crucial for supply chain security - everyone can reproduce the exact same binary (by using
the same sources and environment), without reproducible builds we would not publish binaries.
</p>

<p>
Reproducible builds are also great for fleet management: by inspecting the hash of the binary that is executed, we
can figure out which versions of which packages are in the unikernel - and suggest updates if newer builds are available or if a used packages has a security flaw in that version &#x2013; <code>albatross-client-local update my-unikernel</code>
is everything needed for an update.
</p>

<p>
In the following, we'll explain in more detail two scenarios: how to deploy MirageOS unikernels using the
infrastructure we provide, how to bootstrap and run the infrastructure for yourself. Afterwards we briefly describe
how to reproduce a package, and what are our core packages and their relationships.
</p>
</div>
</div>

<div id="outline-container-org273a58a" class="outline-4">
<h4 id="org273a58a">Brief robur and MirageOS introduction</h4>
<div class="outline-text-4" id="text-org273a58a">
<p>
MirageOS is an operating system, developed in OCaml, which produces unikernels. A unikernel serves a single purpose
and is a single process, i.e. only has the really needed dependencies. For example, an OpenVPN endpoint does neither
include persistent storage (block device, file system) nor user management. MirageOS unikernels are developed in
OCaml, a statically typed and type-safe programming language - which avoids common pitfalls from the grounds up
(spatial and temporal memory safety issues).
</p>

<p>
<a href="https://robur.coop">Robur</a> is a collective that develops MirageOS and OCaml software with open source license. It
was started in 2017, and is part of the non-profit company <a href="https://techcultivation.org">center for the cultivation of
technology</a>. We received funding from several projects (prototypefund, NGI pointer),
donations, and some commercial contracts.
</p>
</div>
</div>

<div id="outline-container-org88dbea2" class="outline-4">
<h4 id="org88dbea2">For someone who wants to run MirageOS unikernels</h4>
<div class="outline-text-4" id="text-org88dbea2">
<p>
To run a MirageOS unikernel on your laptop or computer with virtualization extensions (VT-x - KVM/BHyve), you can
first install solo5-hvt as a <a href="https://builds.robur.coop/job/solo5-hvt/">package</a> (take which fits your distribution),
and <a href="https://builds.robur.coop/job/albatross/">albatross</a>.
</p>

<p>
There is no configuration needed, you should start the <code>albatross_console</code> and the <code>albatross_daemon</code> service (via
<code>systemctl daemon-reload ; systemctl start albatross_daemon</code> on Linnux or <code>service albatross_daemon start</code> on
FreeBSD). Executing <code>albatross-client-local info ~ should return success (exit code 0) and no running unikernel. You
may need to be in the albatross group, or change the permissions of the Unix domain socket (~vmmd.sock</code> in
<code>/run/albatross/util/</code> on Linux, <code>/var/run/albatross/util/</code> on FreeBSD).
</p>
</div>

<div id="outline-container-org79f563f" class="outline-5">
<h5 id="org79f563f">Network setup</h5>
<div class="outline-text-5" id="text-org79f563f">
<p>
To setup networking, you need a bridge interface, usually named service, that albatross will use for unikernels. To
provide network connectivity to that bridge interface, you can either use NAT, forward public IP addresses there,
provide a gateway that tunnels via VPN, or add your network interface to the bridge. In the following, we describe
the setup in detail on Linux. Get in touch with us if you're interested in other platforms.
</p>

<p>
Bridge setup on Linux in <code>/etc/network/interfaces</code>:
</p>

<pre class="example" id="org7941d2d">
auto service
# Host-only bridge
iface service inet manual
    up ip link add service-master address 02:00:00:00:00:01 type dummy
    up ip link set dev service-master up
    up ip link add service type bridge
    up ip link set dev service-master master service
    up ip link set dev service up
    down ip link del service
    down ip link del service-master
</pre>
</div>

<div id="outline-container-orgde476b7" class="outline-6">
<h6 id="orgde476b7">Routing of a subnet</h6>
<div class="outline-text-6" id="text-orgde476b7">
<p>
If your host system acts as a router for a network, enable IPv4 forwarding (~ echo "1" &gt;
/proc/sys/net/ipv4/ip_forward~), and setup that IP address (<code>up ip addr add 192.168.0.1/24 dev service</code>)
</p>
</div>
</div>

<div id="outline-container-org37c2380" class="outline-6">
<h6 id="org37c2380">Physical network interface with IP address space</h6>
<div class="outline-text-6" id="text-org37c2380">
<p>
To put your unikernels on the same network as your host system, add that external network interface to the bridge:
<code>up ip link set dev enp0s20f0 master service</code>.
</p>
</div>
</div>

<div id="outline-container-orge2ecb18" class="outline-6">
<h6 id="orge2ecb18">NAT (no public IP address, e.g. for testing on your Laptop)</h6>
<div class="outline-text-6" id="text-orge2ecb18">
<p>
Setup a private network on the <code>service</code> bridge (<code>up ip addr add 192.168.0.1/24 dev service</code>), enable IPv4 forwarding
(<code>echo "1" &gt; /proc/sys/net/ipv4/ip_forward</code>), and a firewall rule (<code>iptables -t nat -A POSTROUTING -o enp0s20f0 -j
MASQUERADE</code>).
</p>
</div>
</div>
</div>

<div id="outline-container-orgc0d1963" class="outline-5">
<h5 id="orgc0d1963">Unikernel execution</h5>
<div class="outline-text-5" id="text-orgc0d1963">
<p>
Download the <a href="https://builds.robur.coop/job/traceroute/">traceroute</a> unikernel (<a href="https://builds.robur.coop/job/traceroute/build/latest/f/bin/traceroute.hvt">direct link to unikernel
image</a>), and run it via albatross: in one
shell, observe the console output: <code>albatross-client-local console traceroute</code>, in a second shell create the
unikernel: <code>albatross-client-local create --net=service traceroute traceroute.hvt --arg='--ipv4=192.168.0.2/24'
--arg='--ipv4-gateway=192.168.0.1'</code>
</p>

<p>
That's it. Albatross has more features, such as block devices, multiple bridges (for management, private networks,
&#x2026;), restart on certain exit codes, assignment to a specific CPU. It also has remote command execution and resource
limits (you can allow your friends to execute U unikernels with M MB memory and B MB block devices accessing your
bridges A and B). There is a daemon to collect metrics and report them to Telegraf (to push them into Influx and view
in nice Grafana dashboards). MirageOS unikernels also support IPv6, you're not limited to legacy IP.
</p>

<p>
You can also use <code>albatross-client-local update</code> to ensure you're running the latest unikernel - it checks
<a href="https://builds.robur.coop">https://builds.robur.coop</a> for the job and suggests to update if there is a newer binary available.
</p>
</div>
</div>
</div>

<div id="outline-container-orgff4095e" class="outline-4">
<h4 id="orgff4095e">For someone who wants to build and run MirageOS unikernels</h4>
<div class="outline-text-4" id="text-orgff4095e">
<p>
The fundamental tools for building in a reproducible way are orb and builder. On some distributions we provide binary
packages (<a href="https://builds.robur.coop/job/orb/">orb</a>, <a href="https://builds.robur.coop/job/builder/">builder</a>) that you can
use. On other distributions you'll need to bootstrap them from source:
</p>

<ul class="org-ul">
<li>To build in a reproducible way, we developed orb, which is written in OCaml. It is an opam package available at <a href="https://github.com/roburio/orb">https://github.com/roburio/orb</a> (installation via <code>opam pin add orb https://github.com/roburio/orb.git</code>) - once you have OCaml and <a href="https://opam.ocaml.org">opam</a> installed.</li>

<li>To build builder, <code>opam install builder</code> is all you need to do. <code>opam install builder-web</code> will install the latest version of builder-web.</li>
</ul>
</div>

<div id="outline-container-org2ed2f8b" class="outline-5">
<h5 id="org2ed2f8b">Setup builder</h5>
<div class="outline-text-5" id="text-org2ed2f8b">
<p>
On Linux:
</p>

<p>
Builder provides a systemd service (builder) that you should start. There is as well a builder-worker service that
executes the worker process in a docker container. Check the URLs and configuration in the systemd service files, if
necessary modify it using <code>systemctl edit --full builder-worker.service</code>, and start it. The provided
builder-worker.service script will build for Ubuntu 20.04 as of writing.
</p>

<p>
On FreeBSD:
</p>

<p>
For FreeBSD, rc scripts and an example jail.conf (and shell script to launch) are provided. Setting up a jail is
documented in the README (using poudriere).
</p>
</div>
</div>

<div id="outline-container-org010d147" class="outline-5">
<h5 id="org010d147">Setup builder-web</h5>
<div class="outline-text-5" id="text-org010d147">
<p>
Builder-web needs an initial database, an initial user, and also has a service script. Use the <code>builder-db migrate</code>
command to create an initial database, and <code>builder-db user-add --unrestricted my_user</code> to create a privileged user
<code>my_user</code>. Setup your builder to use reproducible packages from builder-web and upload results there (by setting the
<code>--upload https://my_user:my_password@builds.robur.coop/upload</code>).
</p>
</div>
</div>

<div id="outline-container-org44620ef" class="outline-5">
<h5 id="org44620ef">Schedule an orb job</h5>
<div class="outline-text-5" id="text-org44620ef">
<p>
The command <code>builder-client info</code> should output the schedule, queues, and running builds. To schedule a daily build,
run <code>builder-client orb-build traceroute traceroute-hvt</code>. This will create a new job named traceroute and pick up the
job template (<code>/etc/builder/orb-build.template.PLATFORM</code>) and schedule that job to your worker in order to build the
opam package traceroute-hvt.
</p>

<p>
We document the commands, you can always execute it with <code>--help</code> to see the man page.
</p>
</div>
</div>
</div>

<div id="outline-container-org4e4e571" class="outline-4">
<h4 id="org4e4e571">Reproducing builds</h4>
<div class="outline-text-4" id="text-org4e4e571">
<p>
From a build on <a href="https://builds.robur.coop">https://builds.robur.coop</a>, select an operating system and distribution that has been used for a
build. Go to the specific build, and download the "system-packages" file &#x2013; these are the exact versions of host
system packages that were used during the build. Make sure they're installed (version variance may lead to
non-reproducibility - orb and builder are not needed for a manual rebuild).
</p>

<p>
Download the build-environment file, which contains all environment variables that were set during the build. Set
these, and only these, in your shell.
</p>

<p>
Install opam (at least in version 2.1). Then, download the opam-switch file - which includes all opam files and
dependencies (including the OCaml compiler).  Execute <code>opam switch import opam-switch --switch reproduced-unikernel</code>
which will create a fresh opam switch where it will install the unikernel. This will be located in ~opam switch
prefix~/bin/unikernel.hvt.
</p>
</div>
</div>

<div id="outline-container-org0eea1ef" class="outline-4">
<h4 id="org0eea1ef">Core software components in more detail</h4>
<div class="outline-text-4" id="text-org0eea1ef">
</div>
<div id="outline-container-orga01258a" class="outline-5">
<h5 id="orga01258a"><a href="https://github.com/roburio/orb">orb</a></h5>
<div class="outline-text-5" id="text-orga01258a">
<p>
The Opam Reproducible Builder uses the opam libraries to conduct a build of an opam package using any opam
repositories. It collects system packages, environment variables, and a full and frozen opam switch export. These
artifacts contain the build information and can be used to reproduce the exact same binary.
</p>
</div>
</div>

<div id="outline-container-orgdf530be" class="outline-5">
<h5 id="orgdf530be"><a href="https://github.com/roburio/builder/">builder</a></h5>
<div class="outline-text-5" id="text-orgdf530be">
<p>
Builder is a suite of three executables: builder-server, builder-worker and builder-client. Together they
periodically run scheduled jobs which execute orb, collecting build artifacts and information used for reproducing
the build. The builder-worker is executed in a container or jailed environment, and communicates via TCP with the
builder-server. The result of the build can be uploaded to builder-web or stored in the file system.
</p>
</div>
</div>

<div id="outline-container-orge416426" class="outline-5">
<h5 id="orge416426"><a href="https://github.com/roburio/builder-web">builder-web</a></h5>
<div class="outline-text-5" id="text-orge416426">
<p>
Builder-web is a web interface for viewing and downloading builds and build artifacts created by builder jobs. The
binary checksums can be viewed and the build inputs (opam packages, environment variables, system packages) can be
compared across builds.
</p>

<p>
It uses <a href="https://github.com/aantron/dream">dream</a> with sqlite3 as backend database. The database schema evolved over
time, we developed migration and rollback tooling to update our live database.
</p>
</div>
</div>

<div id="outline-container-orgf603115" class="outline-5">
<h5 id="orgf603115"><a href="https://github.com/roburio/albatross">albatross</a></h5>
<div class="outline-text-5" id="text-orgf603115">
<p>
Albatross is an orchestration system for MirageOS unikernels. It manages system resources (tap interfaces, virtual
block devices) that can be passed to the unikernels. It reads the console output of a unikernel and provides it via a
TCP stream. It also has remote access via TLS, where apart from inspecting the running status also new unikernels can
be uploaded. Albatross integrates with builder-web to look up running unikernels by their hash and optionally
updating the unikernel binary.
</p>
</div>
</div>

<div id="outline-container-org7862fbb" class="outline-5">
<h5 id="org7862fbb"><a href="https://github.com/solo5/solo5">solo5</a></h5>
<div class="outline-text-5" id="text-org7862fbb">
<p>
Solo5 is the tender - the application that runs in the host system as a user process, consuming the system resources,
and delegating them to the unikernel. This is a pretty small binary with a tiny API between host and unikernel. <a href="https://archive.fosdem.org/2019/schedule/event/solo5_unikernels/">A
great solo5 overview talk (FOSDEM 2019)</a>.
</p>
</div>
</div>
</div>

<div id="outline-container-org55048e4" class="outline-4">
<h4 id="org55048e4">Future</h4>
<div class="outline-text-4" id="text-org55048e4">
<p>
We have enhancements and more features planned in the future. At the same time we are looking for feedback of the
reproducible build and unikernel deployment system (with a security perspective, with a devops perspective, etc.). We
are also keen to collaborate and would take new people on board.
</p>

<ul class="org-ul">
<li>Improving the web UI on <a href="https://builds.robur.coop/">https://builds.robur.coop/</a>. If you're interested, please get in touch, we have funding available.</li>
<li>Supporting more distributions: tell us your favourite distribution and how to build a package, then we can integrate that into our reproducible builds infrastructure.</li>
<li>Supporting spt - the sadboxed process tender - to run unikernels without a hypervisor.</li>
<li>Data analytics: which system packages updates or opam package releases result in variance of the binaries - did the release of an opam package increase or decrease the overall build times?</li>
<li>Functional and performance tests of the unikernels: for each different build, conduct basic functional testing, and performance test - to graph in the ouput. Also includes data analytics: did the release of an opam package increase or decrease the performance of unikernels?</li>
<li>Whole system performance analysis with memory profiling, and how to integrate this into a running unikernel.</li>
<li>MirageOS 4.0 support.</li>
<li>Metrics and logging collection and dynamic adjustment of metrics and log levels.</li>
<li>DNS resolver unikernel, still missing DNSSec support.</li>
</ul>

<p>
Interested? Get in touch with us via eMail to team at robur dot coop.
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-3" class="outline-2">
<h2 id="3">OCaml compiler development newsletter, issue 4: October 2021</h2>
<div class="outline-text-2" id="text-3">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ocaml-compiler-development-newsletter-issue-4-october-2021/8833/1">https://discuss.ocaml.org/t/ocaml-compiler-development-newsletter-issue-4-october-2021/8833/1</a>
</p>
</div>

<div id="outline-container-org947b3f3" class="outline-3">
<h3 id="org947b3f3">gasche announced</h3>
<div class="outline-text-3" id="text-org947b3f3">
<p>
I’m happy to publish the fourth issue of the “OCaml compiler development newsletter”. (This is by no means
exhaustive: many people didn’t end up having the time to write something, and it’s fine.)
</p>

<p>
Feel free of course to comment or ask questions!
</p>

<p>
If you have been working on the OCaml compiler and want to say something, please feel free to post in this thread! If
you would like me to get in touch next time I prepare a newsletter issue (some random point in the future), please
let me know by email at (gabriel.scherer at gmail).
</p>

<p>
Previous issues:
</p>
<ul class="org-ul">
<li><a href="https://discuss.ocaml.org/t/ocaml-compiler-development-newsletter-issue-3-june-september-2021/8598">OCaml compiler development newsletter, issue 3: June-September 2021</a></li>
<li><a href="https://discuss.ocaml.org/t/ocaml-compiler-development-newsletter-issue-2-may-2021/7965">OCaml compiler development newsletter, issue 2: May 2021</a></li>
<li><a href="https://discuss.ocaml.org/t/ocaml-compiler-development-newsletter-issue-1-before-may-2021/7831">OCaml compiler development newsletter, issue 1: before May 2021</a></li>
</ul>

<p>
October 2021 was a special month for some of us, as it was the last month before the <a href="https://discuss.ocaml.org/t/the-road-to-ocaml-5-0/8584#the-sequential-glaciation-3">Sequential
Glaciation</a> &#x2013; a multi-months
freeze on all features not related to Multicore, to facilitate Multicore integration.
</p>
</div>

<div id="outline-container-org9828a03" class="outline-4">
<h4 id="org9828a03">Xavier Leroy (@xavierleroy)</h4>
<div class="outline-text-4" id="text-org9828a03">
<p>
Knowing that winter is coming, I tied some loose ends in preparation for release 4.14, including more deprecation
warnings <a href="https://github.com/ocaml/ocaml/pull//10675">#10675</a>, proper termination of signal handling
<a href="https://github.com/ocaml/ocaml/pull/10726">#10726</a>, and increasing the native stack size limit when the operating
system allows <a href="https://github.com/ocaml/ocaml/pull/10736">#10736</a>. The latter should mitigate the problem of “Stack
Overflow” crashing non-tail-recursive code for large inputs that hit operating-system restrictions.
</p>

<p>
I also worked on reimplementing the <code>Random</code> standard library module using more modern pseudo-random number
generation (PRNG) algorithms.  In <a href="https://github.com/ocaml/RFCs/pull/28">RFC#28</a>, Gabriel Scherer proposed to change
the random-number generation algorithm of the standard library <code>Random</code> module to be "splittable", to offer better
behavior in a Multicore world. ("Splitting" a random-number generator state gives two separate states that supposedly
produce independent streams of random numbers; few RNG algorithms support splitting, and its theory is not
well-understood.)
</p>

<p>
My first proposal was based on the Xoshiro256++ PRNG, which is fast and statistically strong:
#<a href="https://github.com/ocaml/ocaml/pull/10701">10701</a>.  However, Xoshiro does not support full splitting, only a
limited form called "jumping", and the discussion showed that jumping was not enough.  Then a miracle happened: at
exactly the same time (OOPSLA conference in october 2021), Steele and Vigna proposed LXM, a family of PRNGs that have
all the nice properties of Xoshiro and support full splitting.  I promptly reimplemented the <code>Random</code> module using
LXM #<a href="https://github.com/ocaml/ocaml/pull/10742">10742</a>, and I find the result very nice.  I hope this implementation
will be selected to replace the existing <code>Random</code> module.
</p>
</div>
</div>

<div id="outline-container-org7aab8b5" class="outline-4">
<h4 id="org7aab8b5">Tail-recursion modulo constructors</h4>
<div class="outline-text-4" id="text-org7aab8b5">
<p>
Gabriel Scherer (@gasche) finished working on the TMC (Tail modulo constructor) PR
(#<a href="https://github.com/ocaml/ocaml/pull/9760">9760</a>) in time for the glaciation deadline, thanks to a well-placed
full-day meeting with Pierre Chambart (@chambart), who had done the last review of the work. They managed to get
something that we both liked, and the feature is now merged upstream.
</p>

<p>
Note that this is the continuation of the TRMC work started by Frédéric Bour (@let-def) in
#<a href="https://github.com/ocaml/ocaml/pull/181">181</a> in May 2015 (also with major contributions from Basile Clément
(@Elarnon)); this merge closed one of the longest-open development threads for the OCaml compiler.
</p>

<p>
One may now write:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span><span style="color: #483d8b;">[@tail_mod_cons]</span> <span style="color: #000000; font-weight: bold;">rec</span> <span style="color: #0000ff;">map</span> <span style="color: #a0522d;">f</span> = <span style="color: #a020f0;">function</span>
| <span style="color: #000000; background-color: #ffffff;">[]</span> -&gt; <span style="color: #000000; background-color: #ffffff;">[]</span>
| x<span style="color: #000000; background-color: #ffffff;">::</span>xs -&gt; f x <span style="color: #000000; background-color: #ffffff;">::</span> (map<span style="color: #483d8b;">[@tailcall]</span>) f xs
</pre>
</div>
<p>
and get an efficient tail-recursive definition of map.
</p>

<p>
A section of the manual is in progress to describe the feature: #<a href="https://github.com/ocaml/ocaml/pull/10740">10740</a>.
</p>

<p>
(On the other hand, there was no progress on the constructor-unboxing work, which will have to wait for 5.0.)
</p>
</div>
</div>

<div id="outline-container-org27af27b" class="outline-4">
<h4 id="org27af27b">Progress on native code emission and linking</h4>
<div class="outline-text-4" id="text-org27af27b">
<p>
As part of <a href="https://github.com/ocaml/RFCs/pull/15">RFC#15: Fast native toplevel using JIT</a>, there was a batch of
small changes on native-code emission and linking, and on the native toplevel proposed by @NathanRebours and David
@dra27: #<a href="https://github.com/ocaml/ocaml/pull/10690">10690</a>, #<a href="https://github.com/ocaml/ocaml/pull/10714">10714</a>,
#<a href="https://github.com/ocaml/ocaml/pull/10715">10715</a>.
</p>
</div>
</div>

<div id="outline-container-org76f2591" class="outline-4">
<h4 id="org76f2591">Module shapes for easier tooling</h4>
<div class="outline-text-4" id="text-org76f2591">
<p>
Ulysse Gérard, Thomas Refis and Leo White proposed a new program analysis within the OCaml compiler, designed to help
external tools understand the structure of implementation files (implementations of OCaml modules), in particular to
implement the "locate definition" function &#x2013; which is non-trivial in presence of <code>include</code>, <code>open</code>, etc.
</p>

<p>
The result of their analysis is a "shape" describing the items (values, types, etc.) of a module in an
easy-to-process yet richly-structured form.
</p>

<p>
Florian Angeletti (@Octachron) allowed to merge this PR thanks to his excellent review work, running against the
Glaciation deadline.
</p>

<p>
(The authors of the PR initially wanted to add new kinds of compilation artifacts for OCaml compilation units to
store shape information in <code>.cms</code> and <code>.cmsi</code> files, instead of the too-large <code>.cmt</code> files. People were grumpy about
it, so this part was left out for now.)
</p>
</div>
</div>

<div id="outline-container-org8ca0c85" class="outline-4">
<h4 id="org8ca0c85">UTF-X decoding and validation support in the Stdlib</h4>
<div class="outline-text-4" id="text-org8ca0c85">
<p>
In <a href="https://github.com/ocaml/ocaml/pull/10710">#10710</a> support for UTF-X decoding and validation was added by Daniel
Bünzli (@dbuenzli), a long-standing missing feature of the standard library. The API was carefully designed to avoid
allocations and exceptions while providing an easy-to-use decoding interface.
</p>
</div>
</div>

<div id="outline-container-org049f642" class="outline-4">
<h4 id="org049f642">Convenience functions for <code>Seq.t</code></h4>
<div class="outline-text-4" id="text-org049f642">
<p>
The type <code>Seq.t</code> of on-demand (but non-memoized) sequences of values was contributed by Simon Cruanes (@c-cube) in
2017, with only a minimal set of function, and increased slowly since. A large import of &gt;40 functions was completed
just in time before the glacation by François Potter (@fpottier) and Simon, thanks to reviews by @gasche, @dbuenzli
and many others. This is work that started in February 2020 thanks to issue
#<a href="https://github.com/ocaml/ocaml/issues/9312">9312</a> from Yawar Amin.
</p>

<p>
Behold:
</p>
<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">is_empty</span> : 'a t -&gt; bool
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">uncons</span> : 'a t -&gt; ('a * 'a t) option
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">length</span> : 'a t -&gt; int
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">iter</span> : ('a -&gt; unit) -&gt; 'a t -&gt; unit
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">fold_left</span> : ('a -&gt; 'b -&gt; 'a) -&gt; 'a -&gt; 'b t -&gt; 'a
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">iteri</span> : (int -&gt; 'a -&gt; unit) -&gt; 'a t -&gt; unit
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">fold_lefti</span> : (int -&gt; 'b -&gt; 'a -&gt; 'b) -&gt; 'b -&gt; 'a t -&gt; 'b
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">for_all</span> : ('a -&gt; bool) -&gt; 'a t -&gt; bool
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">exists</span> : ('a -&gt; bool) -&gt; 'a t -&gt; bool
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">find</span> : ('a -&gt; bool) -&gt; 'a t -&gt; 'a option
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">find_map</span> : ('a -&gt; 'b option) -&gt; 'a t -&gt; 'b option
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">iter2</span> : ('a -&gt; 'b -&gt; unit) -&gt; 'a t -&gt; 'b t -&gt; unit
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">fold_left2</span> : ('a -&gt; 'b -&gt; 'c -&gt; 'a) -&gt; 'a -&gt; 'b t -&gt; 'c t -&gt; 'a
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">for_all2</span> : ('a -&gt; 'b -&gt; bool) -&gt; 'a t -&gt; 'b t -&gt; bool
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">exists2</span> : ('a -&gt; 'b -&gt; bool) -&gt; 'a t -&gt; 'b t -&gt; bool
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">equal</span> : ('a -&gt; 'b -&gt; bool) -&gt; 'a t -&gt; 'b t -&gt; bool
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">compare</span> : ('a -&gt; 'b -&gt; int) -&gt; 'a t -&gt; 'b t -&gt; int
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">init</span> : int -&gt; (int -&gt; 'a) -&gt; 'a t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">unfold</span> : ('b -&gt; ('a * 'b) option) -&gt; 'b -&gt; 'a t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">repeat</span> : 'a -&gt; 'a t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">forever</span> : (unit -&gt; 'a) -&gt; 'a t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">cycle</span> : 'a t -&gt; 'a t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">iterate</span> : ('a -&gt; 'a) -&gt; 'a -&gt; 'a t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">mapi</span> : (int -&gt; 'a -&gt; 'b) -&gt; 'a t -&gt; 'b t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">scan</span> : ('b -&gt; 'a -&gt; 'b) -&gt; 'b -&gt; 'a t -&gt; 'b t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">take</span> : int -&gt; 'a t -&gt; 'a t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">drop</span> : int -&gt; 'a t -&gt; 'a t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">take_while</span> : ('a -&gt; bool) -&gt; 'a t -&gt; 'a t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">drop_while</span> : ('a -&gt; bool) -&gt; 'a t -&gt; 'a t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">group</span> : ('a -&gt; 'a -&gt; bool) -&gt; 'a t -&gt; 'a t t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">memoize</span> : 'a t -&gt; 'a t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">once</span> : 'a t -&gt; 'a t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">transpose</span> : 'a t t -&gt; 'a t t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">append</span> : 'a t -&gt; 'a t -&gt; 'a t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">zip</span> : 'a t -&gt; 'b t -&gt; ('a * 'b) t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">map2</span> : ('a -&gt; 'b -&gt; 'c) -&gt; 'a t -&gt; 'b t -&gt; 'c t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">interleave</span> : 'a t -&gt; 'a t -&gt; 'a t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">sorted_merge</span> : ('a -&gt; 'a -&gt; int) -&gt; 'a t -&gt; 'a t -&gt; 'a t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">product</span> : 'a t -&gt; 'b t -&gt; ('a * 'b) t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">map_product</span> : ('a -&gt; 'b -&gt; 'c) -&gt; 'a t -&gt; 'b t -&gt; 'c t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">unzip</span> : ('a * 'b) t -&gt; 'a t * 'b t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">split</span> : ('a * 'b) t -&gt; 'a t * 'b t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">partition_map</span> : ('a -&gt; ('b, 'c) <span style="color: #228b22;">Either.</span>t) -&gt; 'a t -&gt; 'b t * 'c t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">partition</span> : ('a -&gt; bool) -&gt; 'a t -&gt; 'a t * 'a t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">of_dispenser</span> : (unit -&gt; 'a option) -&gt; 'a t
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">to_dispenser</span> : 'a t -&gt; (unit -&gt; 'a option)
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">ints</span> : int -&gt; int t
</pre>
</div>
</div>
</div>

<div id="outline-container-org32f24b5" class="outline-4">
<h4 id="org32f24b5">A few of the nice contributions from new contributors we received</h4>
<div class="outline-text-4" id="text-org32f24b5">
<p>
Dong An (@kirisky) finished a left-open PR from Anukriti Kumar (#<a href="https://github.com/ocaml/ocaml/pull/9398">9398</a>,
#<a href="https://github.com/ocaml/ocaml/pull/10666">10666</a>) to complete the documentation of the OCAMLRUNPARAM variable.
</p>

<p>
Dong An also improved the README description of which C compiler should be available on MacOS or Windows to build the
compiler codebase: #<a href="https://github.com/ocaml/ocaml/pull/10685">10685</a>.
</p>

<p>
Thanks to Wiktor Kuchta, the ocaml toplevel now shows a tip at startup about the <code>#help</code> directive to get help:
#<a href="https://github.com/ocaml/ocaml/pull/10527">10527</a>. (Wiktor is not really a "new" contributor anymore, with many
<a href="https://github.com/ocaml/ocaml/commits?author=wiktorkuchta">nice contributions</a> over the last few months.)
</p>

<p>
While we are at it, a PR from @sonologico, proposed in May 2020, was merged just a few months ago
(#<a href="https://github.com/ocaml/ocaml/pull/9621">9621</a>). It changes the internal build system for the <code>ocamldebug</code>
debugger to avoid module-name clashes when linking user-defined printing code. Most of the delay came from
maintainers arguing over which of the twelve name-conflict-avoidance hacks^Wfeatures should be used.
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-4" class="outline-2">
<h2 id="4">How do you read the lines of a text files…</h2>
<div class="outline-text-2" id="text-4">
<p>
Archive: <a href="https://discuss.ocaml.org/t/how-do-you-read-the-lines-of-a-text-files/8834/1">https://discuss.ocaml.org/t/how-do-you-read-the-lines-of-a-text-files/8834/1</a>
</p>
</div>

<div id="outline-container-org740a3a6" class="outline-3">
<h3 id="org740a3a6">Kim Nguyễn said</h3>
<div class="outline-text-3" id="text-org740a3a6">
<p>
for years I have rewritten the same while loop that accumulates in a <code>string list ref</code> then catches
<code>End_of_file</code> and returns <code>List.rev</code> of my accumulator (or a variant with with a tail rec function with the
exception re-wraped as an option or more recently by matching on <code>End_of_file</code>).
</p>

<p>
For 4 years, I could simply have used <code>Arg.read_arg "file.txt"</code> most of the time and get the arrays of all the
lines in <code>file.txt</code> with the end of line character stripped.
</p>

<p>
I realized  yesterday morning this function existed (as well as <code>Arg.write_arg</code> and two variants that read
strings separated by <code>\000</code> instead of newline) while searching for something in the documentation of the
<code>Arg</code> module.
</p>

<p>
I hope this shaves a few bytes from everyone's programs next time someone quickly wants to grab the content of a file
(or save a list of strings as a file). And now I'm wondering what other gems I have missed…
</p>
</div>
</div>


<div id="outline-container-orgce72c4d" class="outline-3">
<h3 id="orgce72c4d">Daniel Bünzli then added</h3>
<div class="outline-text-3" id="text-orgce72c4d">
<p>
@K_N thanks to @nojb's
<a href="https://discuss.ocaml.org/t/ocaml-compiler-development-newsletter-issue-3-june-september-2021/8598#channels-in-the-standard-library-2">work</a>,
these mundane tasks finally get bearable with the upcoming <code>4.14</code> <code>Stdlib</code>.
</p>

<p>
For example:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">lines</span> <span style="color: #a0522d;">file</span> =
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">contents</span> = <span style="color: #228b22;">In_channel.</span>with_open_bin file <span style="color: #228b22;">In_channel.</span>input_all <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #228b22;">String.</span>split_on_char <span style="color: #8b2252;">'\n'</span> contents
</pre>
</div>

<p>
Or to support the widespread tool convention that filename <code>-</code> means stdin:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">lines</span> <span style="color: #a0522d;">file</span> =
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">contents</span> = <span style="color: #a020f0;">match</span> file <span style="color: #a020f0;">with</span>
  | <span style="color: #8b2252;">"-"</span> -&gt; <span style="color: #228b22;">In_channel.</span>input_all <span style="color: #228b22;">In_channel.</span>stdin
  | file -&gt; <span style="color: #228b22;">In_channel.</span>with_open_bin file <span style="color: #228b22;">In_channel.</span>input_all
  <span style="color: #000000; font-weight: bold;">in</span>
  <span style="color: #228b22;">String.</span>split_on_char <span style="color: #8b2252;">'\n'</span> contents
</pre>
</div>
</div>
</div>
</div>




<div id="outline-container-5" class="outline-2">
<h2 id="5">WebAuthn - Web Authentication</h2>
<div class="outline-text-2" id="text-5">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-webauthn-web-authentication/8845/1">https://discuss.ocaml.org/t/ann-webauthn-web-authentication/8845/1</a>
</p>
</div>

<div id="outline-container-orgba4a979" class="outline-3">
<h3 id="orgba4a979">Reynir Björnsson announced</h3>
<div class="outline-text-3" id="text-orgba4a979">
<p>
I am pleased to announce the release of webauthn on opam (PR pending), a server-side implentation of WebAuthn, a web
standard published by W3C of a similar vein as U2F for (second factor) authentication using various authenticators
such as FIDO U2F devices, android safetynet etc. Registering a new authenticator involves the client sending a public
key among other data to the server. Authentication is then done by sending a challenge which the client responds to
using the key.
</p>

<p>
The motivation for developing this WebAuthn implementation is Google's intention of deprecating U2F in Chrome
<a href="https://groups.google.com/a/chromium.org/g/blink-dev/c/xHC3AtU_65A">https://groups.google.com/a/chromium.org/g/blink-dev/c/xHC3AtU_65A</a>
</p>

<p>
Like our <a href="https://github.com/roburio/u2f">U2F implementation</a> the library does not use any IO, and only handles the
logic of generating challenges, verifying responses to registration challenges and authentication challenges. It is
up to the client of the library to handle IO, user management and more. Be sure to read <code>src/webauthn.mli</code> and the
demo in <code>bin/</code> <a href="https://github.com/roburio/webauthn/">https://github.com/roburio/webauthn/</a>. A live demo is available at: <a href="https://webauthn-demo.robur.coop/">https://webauthn-demo.robur.coop/</a>.
</p>
</div>

<div id="outline-container-org87d97c9" class="outline-4">
<h4 id="org87d97c9">Attestation types</h4>
<div class="outline-text-4" id="text-org87d97c9">
<p>
When registering a user an attestation certificate is optionally provided. The attestation certificate is a X509
certificate signing the public key sent during registration and contains information such as the maker and
model(family) of the authenticator. At the moment only <code>fido-u2f</code> and and <code>none</code> are supported.
</p>

<p>
The work was sponsored by skolem.tech
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-6" class="outline-2">
<h2 id="6">Set up OCaml 2.0.0-beta9</h2>
<div class="outline-text-2" id="text-6">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-set-up-ocaml-2-0-0-beta9/8861/1">https://discuss.ocaml.org/t/ann-set-up-ocaml-2-0-0-beta9/8861/1</a>
</p>
</div>

<div id="outline-container-orgae36035" class="outline-3">
<h3 id="orgae36035">Sora Morimoto announced</h3>
<div class="outline-text-3" id="text-orgae36035">
</div>
<div id="outline-container-org711d129" class="outline-4">
<h4 id="org711d129">Changed</h4>
<div class="outline-text-4" id="text-org711d129">
<ul class="org-ul">
<li>Increase the allowed artifact cache size from 5GB to 10GB.</li>
</ul>

<p>
<a href="https://github.com/ocaml/setup-ocaml/releases/tag/v2.0.0-beta9">https://github.com/ocaml/setup-ocaml/releases/tag/v2.0.0-beta9</a>
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-7" class="outline-2">
<h2 id="7">Windows-friendly OCaml 4.12 distribution 2nd preview release (0.2.0)</h2>
<div class="outline-text-2" id="text-7">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-windows-friendly-ocaml-4-12-distribution-2nd-preview-release-0-2-0/8488/6">https://discuss.ocaml.org/t/ann-windows-friendly-ocaml-4-12-distribution-2nd-preview-release-0-2-0/8488/6</a>
</p>
</div>

<div id="outline-container-orgf7ddaa2" class="outline-3">
<h3 id="orgf7ddaa2">jbeckford announced</h3>
<div class="outline-text-3" id="text-orgf7ddaa2">
<p>
0.2.6 of Diskuv OCaml is available.
</p>

<p>
Some of the more significant changes are:
</p>

<ul class="org-ul">
<li>OCaml has been upgraded from 4.12.0 to <a href="https://ocaml.org/releases/4.12.1.html">4.12.1</a>. Also: <a href="https://ocaml.org/releases/4.13.1.html">4.13.1</a> is bundled but is not yet supported</li>
<li>Introduce "Vanilla OCaml" zip archives for 32-bit and 64-bit at <a href="https://gitlab.com/diskuv/diskuv-ocaml/-/releases">https://gitlab.com/diskuv/diskuv-ocaml/-/releases</a>. Contains <code>ocaml.exe</code>, <code>ocamlc.opt.exe</code>, the other <code>ocaml*.exe</code> and <code>flexlink.exe</code>. Since the standard library directories are hardcoded by <code>ocamlc -config</code> as <code>C:/DiskuvOCaml/OcamlSys/32/lib/ocaml</code> and <code>C:/DiskuvOCaml/OcamlSys/64/lib/ocaml</code> the most useful scenario is continuous integration (GitHub Actions, etc.) where you can extract the archive to <code>C:\DiskuvOCaml\OcamlSys\{32|64}</code>. The archive contains reproducible source code which is Apache v2.0 licensed. And <code>ocamlc</code> must be run from a x64 or x86 Native Tools Command Prompt (Visual Studio). <b>A similar 32/64-bit archive for Opam was and still is available</b></li>
<li>Work to split DKML (Diskuv OCaml distribution) and DKSDK (Diskuv SDK) in the existing monorepo has started. DKSDK will support CMake, cross-compilation and building desktop/mobile/embedded applications, where DKML will be a full-featured OCaml distribution used with native (ie. Microsoft, Apple) compilers. DKML will primarily be Apache licensed, as it is today</li>
<li>Introduce vagrant to simplify testing Windows installations even on macOS and Linux machines. Assuming you have <a href="https://www.virtualbox.org/">VirtualBox</a> and <a href="https://www.vagrantup.com/">Vagrant</a> installed, just <code>git clone https://gitlab.com/diskuv/diskuv-ocaml</code> and do <code>cd vagrant/win32 ; vagrant up ; vagrant ssh</code> to open a Command Prompt terminal. Be prepared to wait 2 hours on a 2-CPU machine. From there you can do <code>with-dkml dune build</code>, <code>with-dkml ocamlc ...</code>, etc. to build and test your application. Or instead of <code>vagrant ssh</code> you can open Virtual Box, display the Windows desktop, and open the x64 Native Tools Command Prompt to hack away on your project without <code>with-dkml</code></li>
</ul>

<p>
Known issues:
</p>

<ul class="org-ul">
<li>Installing from mainline China frequently errors out. A short term fix is available at <a href="https://gitlab.com/diskuv/diskuv-ocaml/-/issues/6#note_726814601">https://gitlab.com/diskuv/diskuv-ocaml/-/issues/6#note_726814601</a></li>
</ul>

<p>
Links:
</p>
<ul class="org-ul">
<li><a href="https://diskuv.gitlab.io/diskuv-ocaml/index.html#two-step-installation-instructions">Installation instructions for the latest version</a></li>
<li><a href="https://gitlab.com/diskuv/diskuv-ocaml/-/releases">Release notes for all versions including upgrading instructions</a></li>
</ul>

<p>
And thanks to @dbuenzli for nudging me to include Vagrant a few months ago. Vagrant is now part of the <a href="https://github.com/diskuv/diskuv-ocaml-ghmirror/actions/workflows/vagrant-win32.yml">automated
GitHub Actions testing</a>; the
host virtual machine is macOS 10.15 which is the only free GitHub platform that supports nested virtualization into
Windows. But you can use it on your Linux/macOS desktop to do your own Windows development.
</p>
</div>

<div id="outline-container-orgf8d60a0" class="outline-4">
<h4 id="orgf8d60a0">What's next?</h4>
<div class="outline-text-4" id="text-orgf8d60a0">
<ul class="org-ul">
<li>The next version (0.3.0) includes at least one breaking change (upgrade of ocamlformat from 0.8.0 to 0.9.0)</li>
</ul>
</div>
</div>
</div>
</div>




<div id="outline-container-8" class="outline-2">
<h2 id="8">opam build and opam test: the opam plugins that simplifies your dev setup</h2>
<div class="outline-text-2" id="text-8">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-opam-build-opam-test-the-opam-plugins-that-simplifies-your-dev-setup/8867/1">https://discuss.ocaml.org/t/ann-opam-build-opam-test-the-opam-plugins-that-simplifies-your-dev-setup/8867/1</a>
</p>
</div>

<div id="outline-container-orge514a7d" class="outline-3">
<h3 id="orge514a7d">Kate announced</h3>
<div class="outline-text-3" id="text-orge514a7d">
<p>
I’m pleased to announce the first release of <code>opam-build</code> and <code>opam-test</code>.
Those two plugins are highly <b><b>experimental</b></b> for the moment but aims at a simpler workflow for developers to get
started building and testing their projects.
</p>
</div>

<div id="outline-container-org4063dfd" class="outline-4">
<h4 id="org4063dfd">opam-build</h4>
<div class="outline-text-4" id="text-org4063dfd">
<p>
builds any project easily with just one command:
</p>
<pre class="example" id="orged32b26">
opam build
</pre>
<p>
The command will setup a local switch and install all the required dependencies, then build the project (as described
in the opam files). So no matter your build system, calling <code>opam build</code> should be enough.
</p>
</div>
</div>

<div id="outline-container-orgd830fd0" class="outline-4">
<h4 id="orgd830fd0">opam-test</h4>
<div class="outline-text-4" id="text-orgd830fd0">
<p>
<code>opam-test</code> does the same thing as <code>opam-build</code> but runs the tests on top of it. Just call:
</p>
<pre class="example" id="orgf335438">
opam test
</pre>
<p>
to get started.
</p>

<p>
<code>opam-test</code> also circumvents issues with cyclic test dependencies in opam (where the tests require a package that
needs the library it is trying to test). Such cyclic dependency is present in packages such as odoc or base. See
<a href="https://github.com/ocaml/opam/issues/4594">https://github.com/ocaml/opam/issues/4594</a>
</p>

<p>
If your package is in such a case, <code>opam-test</code> allows you to use the <code>post</code> variable to make that work. For instance:
</p>

<p>
In project A:
</p>
<pre class="example" id="org192c41b">
run-test: ["dune" "build "-p" name "-j" jobs] {post}
depends: [
  "B" {with-test &amp; post}
]
</pre>
<p>
In project B:
</p>
<pre class="example" id="org21e42c7">
depends: [
  "A"
]
</pre>
<p>
Without the <code>{post}</code> variable, opam alone would not be able to run the tests as the tests are run before the
installation of the package and this would lead to a cyclic dependency. <code>opam-test</code> allows you to split the
installation from the tests and thus makes that work.
</p>
</div>
</div>

<div id="outline-container-org345edfa" class="outline-4">
<h4 id="org345edfa">Installation</h4>
<div class="outline-text-4" id="text-org345edfa">
<p>
To install, simply call
</p>
<pre class="example" id="orgb028c07">
opam update
opam install opam-build opam-test
</pre>
<p>
<i>If the package do not exist, they might not have been merged in opam-repository yet (watch for <a href="https://github.com/ocaml/opam-repository/pull/20085">https://github.com/ocaml/opam-repository/pull/20085</a>). In the meantime, instead you can install it directly from the source repository:</i>
</p>
<pre class="example" id="orgee1a60d">
opam pin add git+https://github.com/kit-ty-kate/opam-build
</pre>

<p>
Again, these plugins are highly experimental and are looking for use-cases. If you think this can be useful, feel
free to send some feedbacks here or on the bugtracker: <a href="https://github.com/kit-ty-kate/opam-build/issues">https://github.com/kit-ty-kate/opam-build/issues</a>
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-9" class="outline-2">
<h2 id="9">Twenty Years of OCaml Weekly News</h2>
<div class="outline-text-2" id="text-9">
<p>
Archive: <a href="https://discuss.ocaml.org/t/twenty-years-of-ocaml-weekly-news/8869/1">https://discuss.ocaml.org/t/twenty-years-of-ocaml-weekly-news/8869/1</a>
</p>
</div>

<div id="outline-container-orga299d8b" class="outline-3">
<h3 id="orga299d8b">Alan Schmitt announced</h3>
<div class="outline-text-3" id="text-orga299d8b">
<p>
On November 27th, 2001, I replaced David Mentré as maintainer of the OCaml Weekly News and I sent my first one. If you want a trip down memory lane, they are
all collected <a href="https://alan.petitepomme.net/cwn/index.html">here</a>.
</p>
</div>
</div>
</div>




<div id="outline-container-orge4c4718" class="outline-2">
<h2 id="orge4c4718">Old CWN</h2>
<div class="outline-text-2" id="text-orge4c4718">
<p>
If you happen to miss a CWN, you can <a href="mailto:alan.schmitt@polytechnique.org">send me a message</a> and I'll mail it to you, or go take a look at <a href="https://alan.petitepomme.net/cwn/">the archive</a> or the <a href="https://alan.petitepomme.net/cwn/cwn.rss">RSS feed of the archives</a>.
</p>

<p>
If you also wish to receive it every week by mail, you may subscribe <a href="http://lists.idyll.org/listinfo/caml-news-weekly/">online</a>.
</p>

<div class="authorname" id="orgfb0ccb5">
<p>
<a href="https://alan.petitepomme.net/">Alan Schmitt</a>
</p>

</div>
</div>
</div>
</div>
</body>
</html>
