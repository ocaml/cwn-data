<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2019-01-29 Tue 14:38 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OCaml Weekly News</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<style type="text/css">#table-of-contents h2 { display: none } .title { display: none } .authorname { text-align: right }</style>
<style type="text/css">.outline-2 {border-top: 1px solid black;}</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">OCaml Weekly News</h1>
<p>
<a href="http://alan.petitepomme.net/cwn/2019.01.22.html">Previous Week</a> <a href="http://alan.petitepomme.net/cwn/index.html">Up</a> <a href="http://alan.petitepomme.net/cwn/2019.02.05.html">Next Week</a>
</p>

<p>
Hello
</p>

<p>
Here is the latest OCaml Weekly News, for the week of January 22 to 29, 2019.
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#1">ocaml-gemini 0.1</a></li>
<li><a href="#2">Godbolt compiler explorer beta now has OCaml support</a></li>
<li><a href="#3">Debugging memory issues</a></li>
<li><a href="#4">First release of Mssql</a></li>
<li><a href="#5">IFDEF conditional compilation and ocamlbuild</a></li>
<li><a href="#orgb86eb8a">Old CWN</a></li>
</ul>
</div>
</div>


<div id="outline-container-org0c03713" class="outline-2">
<h2 id="1">ocaml-gemini 0.1</h2>
<div class="outline-text-2" id="text-1">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-ocaml-gemini-0-1/3221/1">https://discuss.ocaml.org/t/ann-ocaml-gemini-0-1/3221/1</a>
</p>
</div>

<div id="outline-container-org0f60330" class="outline-3">
<h3 id="org0f60330">Carmelo Piccione announced</h3>
<div class="outline-text-3" id="text-org0f60330">
<p>
Hello, I'd like to announce the initial release of <a href="https://github.com/struktured/ocaml-gemini">ocaml-gemini</a>, a pure OCaml library that fully implements the <a href="http://gemini.com">Gemini</a> <a href="https://docs.gemini.com/rest-api/">REST api</a> as well  as <a href="https://docs.gemini.com/websocket-api/#market-data">market data</a> and <a href="https://docs.gemini.com/websocket-api/#order-events">private order events</a> websocket apis.
</p>

<p>
For those unfamiliar, Gemini is a well established cryptocurrency exchange launched by the notorious Winklevoss Twins (unfortunately the exchange is written in Go, but I digress).
</p>

<p>
The implemention depends on <code>cohttp-async</code>, <code>websocket-async</code>, and <code>yojson</code> for serialization support.  <code>nocrypto</code> is used for the session authentication. If there is sufficient interest by the community I can extend the code to support a <code>lwt</code> version.
</p>

<p>
A console interface is also provided which accepts s-expressions as parameters. It is mostly used to test the api or do quick and dirty order management.
</p>

<p>
Finally, any feedback on the api or PRs are welcome, as usual.
</p>
</div>
</div>
</div>




<div id="outline-container-orgff08dda" class="outline-2">
<h2 id="2">Godbolt compiler explorer beta now has OCaml support</h2>
<div class="outline-text-2" id="text-2">
<p>
Archive: <a href="https://discuss.ocaml.org/t/godbolt-compiler-explorer-beta-now-has-ocaml-support/3225/1">https://discuss.ocaml.org/t/godbolt-compiler-explorer-beta-now-has-ocaml-support/3225/1</a>
</p>
</div>

<div id="outline-container-org22eaafe" class="outline-3">
<h3 id="org22eaafe">Freyr666 announced</h3>
<div class="outline-text-3" id="text-org22eaafe">
<p>
Feel free to test.
</p>

<p>
<a href="https://ocaml.godbolt.org/beta/">https://ocaml.godbolt.org/beta/</a>
</p>
</div>
</div>
</div>




<div id="outline-container-org1aab4c4" class="outline-2">
<h2 id="3">Debugging memory issues</h2>
<div class="outline-text-2" id="text-3">
<p>
Archive: <a href="https://discuss.ocaml.org/t/debugging-memory-issues/3223/1">https://discuss.ocaml.org/t/debugging-memory-issues/3223/1</a>
</p>
</div>

<div id="outline-container-orge5e78b6" class="outline-3">
<h3 id="orge5e78b6">Sean Talts asked</h3>
<div class="outline-text-3" id="text-orge5e78b6">
<p>
I'm working on a <a href="https://github.com/stan-dev/stanc3">new compiler/transpiler</a> written in OCaml and we've (unfortunately?) been using the Format library to emit the code that we're generating. Today I'm just starting to run it on some huge test programs and finding that it's taking up dozens of GB of memory pretty quickly and totally swamping the machine only a little ways into the program. I tried debugging with <code>ocamldebug</code> but I can't find any specific code that's repeating too much or anything like that - it just seems like something invisible is happening and my number one suspect is that it's the building up of these long Format strings (with nested "%a" compositional formatting). But I'd like to figure out for sure so I don't waste time switching away from the Format library or something if it's an unrelated issue.
</p>

<p>
Any help appreciated! Thanks :)
</p>
</div>
</div>


<div id="outline-container-orga50d7d0" class="outline-3">
<h3 id="orga50d7d0">Jack Feser replied</h3>
<div class="outline-text-3" id="text-orga50d7d0">
<p>
You could give spacetime (<a href="https://blog.janestreet.com/a-brief-trip-through-spacetime/">https://blog.janestreet.com/a-brief-trip-through-spacetime/</a>) a try. It's a new ocaml memory profiler. You'll need to install a spacetime-specific compiler switch though.
</p>
</div>
</div>


<div id="outline-container-org1fc1252" class="outline-3">
<h3 id="org1fc1252">Simon Cruanes then said</h3>
<div class="outline-text-3" id="text-org1fc1252">
<p>
In my experience, <code>Format</code> doesn't leak memory (if you use <code>fprintf</code> into some IO channel; if you print into a buffer then the buffer might grow, of course). It's pretty fast and very convenient. I second the idea of using some form of profiling such as spacetime to find where the leak comes from.
</p>
</div>
</div>


<div id="outline-container-org66634f3" class="outline-3">
<h3 id="org66634f3">Christian Lindig replied</h3>
<div class="outline-text-3" id="text-org66634f3">
<p>
I have not used it myself, but <code>Obj.reachable_words</code> reports the words reachable from a given value. If you suspect some value already to be responsible for the leak, you could observe it with this function.
</p>
</div>
</div>


<div id="outline-container-org95e1b8c" class="outline-3">
<h3 id="org95e1b8c">Pierre Chambart also replied</h3>
<div class="outline-text-3" id="text-org95e1b8c">
<p>
I have debugged quite a few things with <a href="https://github.com/jhjourdan/ocaml/tree/memprof">https://github.com/jhjourdan/ocaml/tree/memprof</a> . It is available in the opam repository as ocaml-variants.4.07.1+statistical-memprof you should use it with <a href="https://github.com/jhjourdan/statmemprof-emacs">https://github.com/jhjourdan/statmemprof-emacs</a>
</p>
</div>
</div>
</div>




<div id="outline-container-orgdc30d35" class="outline-2">
<h2 id="4">First release of Mssql</h2>
<div class="outline-text-2" id="text-4">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-first-release-of-mssql/3242/1">https://discuss.ocaml.org/t/ann-first-release-of-mssql/3242/1</a>
</p>
</div>

<div id="outline-container-org2604967" class="outline-3">
<h3 id="org2604967">Brendan Long announced</h3>
<div class="outline-text-3" id="text-org2604967">
<p>
I'm happy to announce the first <a href="https://opam.ocaml.org/packages/mssql/">opam release</a> of <a href="https://github.com/arenadotio/ocaml-mssql">Mssql</a>, our FreeTDS-based Async SQL Server client library.
</p>

<p>
We've gone to some trouble to make it safer to use than direct bindings to FreeTDS, with things like <a href="https://github.com/arenadotio/ocaml-mssql/blob/master/src/client.mli#L17">parameterized queries</a>, workarounds for <a href="http://pymssql.org/en/stable/freetds_and_dates.html">insane logic in FreeTDS</a>, and logic to throw exceptions instead of crashing when you try to do things like <a href="https://github.com/arenadotio/ocaml-mssql/blob/master/src/client.ml#L32">use a closed DB handle</a>.
</p>

<p>
We've also wrapped everything in background threads and <a href="https://github.com/arenadotio/ocaml-mssql/commit/d1a9ca2eaa818650368058501ad3d201f9854690">ensured that any FreeTDS calls that perform IO release the runtime lock</a>, so it's safe to use in an Async app without blocking everything when you do DB calls, and also ensured that if you attempt to use a connection concurrently, <a href="https://github.com/arenadotio/ocaml-mssql/blob/master/src/client.ml#L29">everything will just work</a> (although it won't be any faster).
</p>

<p>
There's also <a href="https://github.com/arenadotio/ocaml-mssql/blob/master/src/client.mli#L79">a built-in thread pool</a>, although it has some annoying limitations since FreeTDS doesn't give us low-enough-level control to properly reset connections.
</p>

<p>
(We made this using Async since that's what we use, but contact me if you want to add support for Lwt)
</p>
</div>
</div>
</div>




<div id="outline-container-orged3bfee" class="outline-2">
<h2 id="5">IFDEF conditional compilation and ocamlbuild</h2>
<div class="outline-text-2" id="text-5">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ifdef-conditional-compilation-and-ocamlbuild/3244/1">https://discuss.ocaml.org/t/ifdef-conditional-compilation-and-ocamlbuild/3244/1</a>
</p>
</div>

<div id="outline-container-orge27126f" class="outline-3">
<h3 id="orge27126f">Luc Bougé announced</h3>
<div class="outline-text-3" id="text-orge27126f">
<p>
I am developing a program in Ocaml for my Programming class.This idea is to provide the students with various versions of the program, using more and more complex techniques.
</p>

<p>
I would like to design a common master, and then derive the various versions automatically using some conditional compilation facility.
</p>

<p>
I considered <a href="http://caml.inria.fr/pub/docs/manual-camlp4/manual002.html">camlp4 IFDEF</a> but it applies to complete expressions, only. Instead, I would like to add or remove cases in long lists of <code>if ... then ... else if ...</code>.
</p>

<p>
Also, I am using <code>ocamlbuild</code> and I cannot find how to define <code>IFDEF</code> compilation tags in the compilation chain.
</p>

<p>
Is there any IFDEF-wizard in the community? :sunglasses:
</p>
</div>
</div>


<div id="outline-container-org1321959" class="outline-3">
<h3 id="org1321959">Anton Kochkov replied</h3>
<div class="outline-text-3" id="text-org1321959">
<p>
See <a href="https://github.com/ocaml-community/cppo">https://github.com/ocaml-community/cppo</a> + <a href="https://jbuilder.readthedocs.io/en/latest/quick-start.html#using-cppo">https://jbuilder.readthedocs.io/en/latest/quick-start.html#using-cppo</a> (for dune, since using plain ocamlbuild is "an old way of doing things").
</p>
</div>
</div>


<div id="outline-container-org806bc41" class="outline-3">
<h3 id="org806bc41">Anton Kochkov then added</h3>
<div class="outline-text-3" id="text-org806bc41">
<p>
Note there is also <a href="https://github.com/janestreet/ppx_optcomp">https://github.com/janestreet/ppx_optcomp</a> for using only extension points (PPX)
</p>
</div>
</div>
</div>




<div id="outline-container-orgb86eb8a" class="outline-2">
<h2 id="orgb86eb8a">Old CWN</h2>
<div class="outline-text-2" id="text-orgb86eb8a">
<p>
If you happen to miss a CWN, you can <a href="mailto:alan.schmitt@polytechnique.org">send me a message</a> and I'll mail it to you, or go take a look at <a href="http://alan.petitepomme.net/cwn/">the archive</a> or the <a href="http://alan.petitepomme.net/cwn/cwn.rss">RSS feed of the archives</a>.
</p>

<p>
If you also wish to receive it every week by mail, you may subscribe <a href="http://lists.idyll.org/listinfo/caml-news-weekly/">online</a>.
</p>

<div class="authorname">
<p>
<a href="http://alan.petitepomme.net/">Alan Schmitt</a>
</p>

</div>
</div>
</div>
</div>
</body>
</html>
