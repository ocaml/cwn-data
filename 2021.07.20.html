<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-07-20 Tue 14:57 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OCaml Weekly News</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<style type="text/css">#table-of-contents h2 { display: none } .title { display: none } .authorname { text-align: right }</style>
<style type="text/css">.outline-2 {border-top: 1px solid black;}</style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">OCaml Weekly News</h1>
<p>
<a href="https://alan.petitepomme.net/cwn/2021.07.13.html">Previous Week</a> <a href="https://alan.petitepomme.net/cwn/index.html">Up</a> <a href="https://alan.petitepomme.net/cwn/2021.07.27.html">Next Week</a>
</p>

<p>
Hello
</p>

<p>
Here is the latest OCaml Weekly News, for the week of July 13 to 20, 2021.
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#1">Writing a REST API with Dream</a></li>
<li><a href="#2">OTOML 0.9.0 — a compliant and flexible TOML parsing, manipulation, and pretty-printing library</a></li>
<li><a href="#3">soupault: a static website generator based on HTML rewriting</a></li>
<li><a href="#4">OCaml 4.13.0, second alpha release</a></li>
<li><a href="#5">OCamlFormat 0.19.0</a></li>
<li><a href="#6">OCaml Café: Wed, Aug 4 @ 7pm (U.S. Central)</a></li>
<li><a href="#orgb1dbfaf">Old CWN</a></li>
</ul>
</div>
</div>


<div id="outline-container-1" class="outline-2">
<h2 id="1">Writing a REST API with Dream</h2>
<div class="outline-text-2" id="text-1">
<p>
Archive: <a href="https://discuss.ocaml.org/t/writing-a-rest-api-with-dream/8150/1">https://discuss.ocaml.org/t/writing-a-rest-api-with-dream/8150/1</a>
</p>
</div>

<div id="outline-container-org6a8fb14" class="outline-3">
<h3 id="org6a8fb14">Joe Thomas announced</h3>
<div class="outline-text-3" id="text-org6a8fb14">
<p>
I've written a short <a href="https://jsthomas.github.io/ocaml-dream-api.html">blog post</a> about the positive experience I had
using Dream to build a REST API. The accompanying source code is available here:
</p>

<p>
<a href="https://github.com/jsthomas/sensors">https://github.com/jsthomas/sensors</a>
</p>

<p>
I'm interested in adding more examples and tutorials to the OCaml ecosystem and would be happy to get your feedback
on this writeup (here or via email/github).
</p>
</div>
</div>
</div>




<div id="outline-container-2" class="outline-2">
<h2 id="2">OTOML 0.9.0 — a compliant and flexible TOML parsing, manipulation, and pretty-printing library</h2>
<div class="outline-text-2" id="text-2">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-otoml-0-9-0-a-compliant-and-flexible-toml-parsing-manipulation-and-pretty-printing-library/8152/1">https://discuss.ocaml.org/t/ann-otoml-0-9-0-a-compliant-and-flexible-toml-parsing-manipulation-and-pretty-printing-library/8152/1</a>
</p>
</div>

<div id="outline-container-orge52b9fb" class="outline-3">
<h3 id="orge52b9fb">Daniil Baturin announced</h3>
<div class="outline-text-3" id="text-orge52b9fb">
<p>
I don't really like to base a release announcement on bashing another project, but this whole project is motivated by
my dissatisfaction with <a href="https://opam.ocaml.org/packages/toml/">To.ml</a>—the only TOML library for OCaml, so here we
go. OTOML is a TOML library that you (hopefully) can use without writing long rants afterwards. ;)
</p>

<p>
In short:
</p>

<ul class="org-ul">
<li><a href="https://toml.io/en/v1.0.0">TOML 1.0-compliant</a> (To.ml is not).</li>
<li>Good error reporting.</li>
<li>Makes it easy to look up nested values.</li>
<li>Bignum and calendar libraries are pluggable via functors.</li>
<li>Flexible pretty-printer with indentation.</li>
</ul>

<p>
OPAM: <a href="https://opam.ocaml.org/packages/otoml/">https://opam.ocaml.org/packages/otoml/</a>
GitHub: <a href="https://github.com/dmbaturin/otoml">https://github.com/dmbaturin/otoml</a>
</p>

<p>
Now let's get to details.
</p>

<p>
TOML is supposed to be human-friendly so that people can use it as a configuration file format. For that, both
developer and end-user experience must be great. To.ml provides neither. I've been using To.ml in my projects for a
long time, and
</p>
</div>

<div id="outline-container-orgbf00090" class="outline-4">
<h4 id="orgbf00090">Standard compliance</h4>
<div class="outline-text-4" id="text-orgbf00090">
<p>
TOML is neither minimal nor obvious really, it's much larger than the commonly used subset and the spec is not
consistent and not easy to read, but To.ml fails at rather well-known things, like dotted keys, arrays of tables and
heterogeneous arrays.
</p>

<p>
OTOML passes all tests in the <a href="https://github.com/BurntSushi/toml-test">test suite</a>, except the tests related to
bignum support. Those tests fail because the default implementation maps integers and floats to the native 31/63-bit
OCaml types. More on that later.
</p>
</div>
</div>

<div id="outline-container-org0a382a6" class="outline-4">
<h4 id="org0a382a6">Error reporting</h4>
<div class="outline-text-4" id="text-org0a382a6">
<p>
Let's look at error reporting. To.ml's response to any parse error is a generic error with just line and column
numbers.
</p>

<div class="org-src-container">
<pre class="src src-ocaml">utop # <span style="color: #228b22;">Toml.Parser.</span>from_string <span style="color: #8b2252;">"foo = ["</span> <span style="color: #ff4500;">;;</span>
- : <span style="color: #228b22;">Toml.Parser.</span>result =
<span style="color: #000000; background-color: #ffffff;">`Error</span>
  (<span style="color: #8b2252;">"Error in &lt;string&gt; at line 1 at column 7 (position 7)"</span>,
   {<span style="color: #228b22;">Toml.Parser.</span>source = <span style="color: #8b2252;">"&lt;string&gt;"</span>; line = 1; column = 7; position = 7})
</pre>
</div>

<p>
Menhir offers excellent tools for error reporting, so I took time to make descriptive messages for many error
conditions (there <span class="underline">are</span> generic "syntax error" messages still, but that's better than nothing at all).
</p>

<div class="org-src-container">
<pre class="src src-ocaml">utop # <span style="color: #228b22;">Otoml.Parser.</span>from_string_result <span style="color: #8b2252;">"foo = ["</span> <span style="color: #ff4500;">;;</span>
- : (<span style="color: #228b22;">Otoml.</span>t, string) result =
<span style="color: #000000; background-color: #ffffff;">Error</span>
 <span style="color: #8b2252;">"Syntax error on line 1, character 8: Malformed array (missing closing square bracket?)\n"</span>

utop # <span style="color: #228b22;">Otoml.Parser.</span>from_string_result <span style="color: #8b2252;">"foo = {bar "</span> <span style="color: #ff4500;">;;</span>
- : (<span style="color: #228b22;">Otoml.</span>t, string) result =
<span style="color: #000000; background-color: #ffffff;">Error</span>
 <span style="color: #8b2252;">"Syntax error on line 1, character 12: Key is followed by end of file or a malformed TOML construct.\n"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org76b13c8" class="outline-4">
<h4 id="org76b13c8">Looking up nested values</h4>
<div class="outline-text-4" id="text-org76b13c8">
<p>
Nested sections are common in configs and should be easy to work with. This is how you do it in OTOML:
</p>

<div class="org-src-container">
<pre class="src src-ocaml">utop # <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">t</span> = <span style="color: #228b22;">Otoml.Parser.</span>from_string <span style="color: #8b2252;">"[this.is.a.deeply.nested.table]</span>
<span style="color: #8b2252;">answer=42"</span><span style="color: #ff4500;">;;</span>
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">t</span> : <span style="color: #228b22;">Otoml.</span>t =
  <span style="color: #228b22;">Otoml.</span><span style="color: #000000; background-color: #ffffff;">TomlTable</span>
   [(<span style="color: #8b2252;">"this"</span>,
     <span style="color: #228b22;">Otoml.TomlTable.</span>..

utop # <span style="color: #228b22;">Otoml.</span>find t <span style="color: #228b22;">Otoml.</span>get_integer [<span style="color: #8b2252;">"this"</span>; <span style="color: #8b2252;">"is"</span>; <span style="color: #8b2252;">"a"</span>; <span style="color: #8b2252;">"deeply"</span>; <span style="color: #8b2252;">"nested"</span>; <span style="color: #8b2252;">"table"</span>; <span style="color: #8b2252;">"answer"</span>] <span style="color: #ff4500;">;;</span>
- : int = 42
</pre>
</div>

<p>
For comparison, this is how it was done in To.ml:
</p>

<div class="org-src-container">
<pre class="src src-ocaml">utop # <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">toml_data</span> = <span style="color: #228b22;">Toml.Parser.</span>(from_string <span style="color: #8b2252;">"</span>
<span style="color: #8b2252;">[this.is.a.deeply.nested.table]</span>
<span style="color: #8b2252;">answer=42"</span> <span style="color: #a52a2a;">|&gt;</span> unsafe)<span style="color: #ff4500;">;;</span>
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">toml_data</span> : <span style="color: #228b22;">Types.</span>table = &lt;abstr&gt;

utop # <span style="color: #228b22;">Toml.Lenses.</span>(get toml_data (
  key <span style="color: #8b2252;">"this"</span> <span style="color: #a52a2a;">|--</span> table
  <span style="color: #a52a2a;">|--</span> key <span style="color: #8b2252;">"is"</span> <span style="color: #a52a2a;">|--</span> table
  <span style="color: #a52a2a;">|--</span> key <span style="color: #8b2252;">"a"</span> <span style="color: #a52a2a;">|--</span> table
  <span style="color: #a52a2a;">|--</span> key <span style="color: #8b2252;">"deeply"</span> <span style="color: #a52a2a;">|--</span> table
  <span style="color: #a52a2a;">|--</span> key <span style="color: #8b2252;">"nested"</span> <span style="color: #a52a2a;">|--</span> table
  <span style="color: #a52a2a;">|--</span> key <span style="color: #8b2252;">"table"</span> <span style="color: #a52a2a;">|--</span> table
  <span style="color: #a52a2a;">|--</span> key <span style="color: #8b2252;">"answer"</span><span style="color: #a52a2a;">|--</span> int ))<span style="color: #ff4500;">;;</span>
- : int option = <span style="color: #000000; background-color: #ffffff;">Some</span> 42
</pre>
</div>
</div>
</div>

<div id="outline-container-org95001cc" class="outline-4">
<h4 id="org95001cc">Extra dependencies</h4>
<div class="outline-text-4" id="text-org95001cc">
<p>
The TOML spec includes first-class RFC3339 dates, for better or worse. The irony is that most uses of TOML (and,
indeed, most configuration files in the world) don't need that, so it's arguably a feature bloat—but if we set out to
support TOML as it's defined, that question is academic.
</p>

<p>
The practical implication is that if the standard library of a language doesn't include a datetime type, a TOML
library has to decide how to represent those values. To.ml makes ISO8601 a hard dependency, so if you don't use
dates, you end up with a useless dependency. And if you prefer another library (or need functionality no present in
ISO8601), you end up with two libraries: one you chose to use, and one more forced on you.
</p>

<p>
Same goes for the arbitrary precision arithmetic. Most configs won't need it, but the standard demands it, so
something needs to be done.
</p>

<p>
Luckily, in the OCaml land we have functors, so it's easy to make all these dependencies pluggable. So I made it a
functor that takes three modules.
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #000000; font-weight: bold;">module</span> <span style="color: #228b22;">Make</span> <span style="color: #a0522d;">(I : </span><span style="color: #228b22;">TomlInteger</span><span style="color: #a0522d;">) (F : </span><span style="color: #228b22;">TomlFloat</span><span style="color: #a0522d;">) (D : </span><span style="color: #228b22;">TomlDate</span><span style="color: #a0522d;">) </span>:
  <span style="color: #228b22;">TomlImplementation</span> <span style="color: #000000; font-weight: bold;">with type</span> <span style="color: #228b22;">toml_integer</span> = <span style="color: #228b22;">I.</span>t <span style="color: #000000; font-weight: bold;">and type</span> <span style="color: #228b22;">toml_float</span> = <span style="color: #228b22;">F.</span>t <span style="color: #000000; font-weight: bold;">and type</span> <span style="color: #228b22;">toml_date</span> = <span style="color: #228b22;">D.</span>t
</pre>
</div>

<p>
This is how to use Zarith for big integers and keep the rest unchanged:
</p>

<div class="org-src-container">
<pre class="src src-ocaml"><span style="color: #b22222;">(* </span><span style="color: #b22222;">No signature ascription:</span>
<span style="color: #b22222;">   `module BigInteger : Otoml.Base.TomlInteger` would make the type t abstract,</span>
<span style="color: #b22222;">   which is inconvenient.</span>
<span style="color: #b22222;"> </span><span style="color: #b22222;">*)</span>
<span style="color: #000000; font-weight: bold;">module</span> <span style="color: #228b22;">BigInteger</span> = <span style="color: #000000; font-weight: bold;">struct</span>
  <span style="color: #000000; font-weight: bold;">type</span> <span style="color: #228b22;">t</span> = <span style="color: #228b22;">Z.</span>t
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">of_string</span> = <span style="color: #228b22;">Z.</span>of_string
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">to_string</span> = <span style="color: #228b22;">Z.</span>to_string
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">of_boolean</span> <span style="color: #a0522d;">b</span> = <span style="color: #a020f0;">if</span> b <span style="color: #a020f0;">then</span> <span style="color: #228b22;">Z.</span>one <span style="color: #a020f0;">else</span> <span style="color: #228b22;">Z.</span>zero
  <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #0000ff;">to_boolean</span> <span style="color: #a0522d;">n</span> = (n &lt;&gt; <span style="color: #228b22;">Z.</span>zero)
<span style="color: #000000; font-weight: bold;">end</span>

<span style="color: #000000; font-weight: bold;">module</span> <span style="color: #228b22;">MyToml</span> = <span style="color: #228b22;">Otoml.Base.Make (BigInteger) (Otoml.Base.OCamlFloat) (Otoml.Base.StringDate)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1e4d191" class="outline-4">
<h4 id="org1e4d191">Printing</h4>
<div class="outline-text-4" id="text-org1e4d191">
<p>
To.ml's printer can print TOML at you, that's for certain. No indentation, nothing to help you navigate nested
values.
</p>

<div class="org-src-container">
<pre class="src src-ocaml">utop # <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">toml_data</span> = <span style="color: #228b22;">Toml.Parser.</span>(from_string <span style="color: #8b2252;">"[foo.bar]\nbaz=false\n [foo.quux]\n xyzzy = [1,2]"</span> <span style="color: #a52a2a;">|&gt;</span> unsafe) <span style="color: #a52a2a;">|&gt;</span>
<span style="color: #228b22;">Toml.Printer.</span>string_of_table <span style="color: #a52a2a;">|&gt;</span> print_endline<span style="color: #ff4500;">;;</span>
[foo.bar]
baz = <span style="color: #008b8b;">false</span>
[foo.quux]
xyzzy = [1, 2]
</pre>
</div>

<p>
We can do better:
</p>

<div class="org-src-container">
<pre class="src src-ocaml">utop # <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">t</span> = <span style="color: #228b22;">Otoml.Parser.</span>from_string <span style="color: #8b2252;">"[foo.bar]\nbaz=false\n [foo.quux]\n xyzzy = [1,2]"</span> <span style="color: #a52a2a;">|&gt;</span>
<span style="color: #228b22;">Otoml.Printer.</span>to_channel <span style="color: #008b8b;">~indent_width</span>:4 <span style="color: #008b8b;">~collapse_tables</span>:<span style="color: #008b8b;">false</span> stdout<span style="color: #ff4500;">;;</span>

[foo]

[foo.bar]
    baz = <span style="color: #008b8b;">false</span>

[foo.quux]
    xyzzy = [1, 2]
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">t</span> : unit = ()

utop # <span style="color: #000000; font-weight: bold;">let</span> <span style="color: #a0522d;">t</span> = <span style="color: #228b22;">Otoml.Parser.</span>from_string <span style="color: #8b2252;">"[foo.bar]\nbaz=false\n [foo.quux]\n xyzzy = [1,2]"</span> <span style="color: #a52a2a;">|&gt;</span>
<span style="color: #228b22;">Otoml.Printer.</span>to_channel <span style="color: #008b8b;">~indent_width</span>:4 <span style="color: #008b8b;">~collapse_tables</span>:<span style="color: #008b8b;">false</span> <span style="color: #008b8b;">~indent_subtables</span>:<span style="color: #008b8b;">true</span> stdout<span style="color: #ff4500;">;;</span>

[foo]

    [foo.bar]
        baz = <span style="color: #008b8b;">false</span>

    [foo.quux]
        xyzzy = [1, 2]
<span style="color: #000000; font-weight: bold;">val</span> <span style="color: #0000ff;">t</span> : unit = ()
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbd8c401" class="outline-4">
<h4 id="orgbd8c401">Maintenance practices</h4>
<div class="outline-text-4" id="text-orgbd8c401">
<p>
Last but not least, good maintenance practices are also important, not just good code. To.ml is at 7.0.0 now. It has
a <a href="https://github.com/ocaml-toml/To.ml/blob/master/CHANGES.md">CHANGES.md</a> file, but I'm still to see the maintainers
document what the breaking change is, who's affected, and what they should do to make their code compatible.
</p>

<p>
For example, in 6.0.0 the breaking change was a rename from <code>TomlLenses</code> to <code>Toml.Lenses</code>. In an earlier release, I
remember the opposite rename. Given the standard compatibility problems going unfixed for years, that's like
rearranging furniture when the roof is leaking.
</p>

<p>
I promise not to do that.
</p>
</div>
</div>

<div id="outline-container-org21071f4" class="outline-4">
<h4 id="org21071f4">Conclusion</h4>
<div class="outline-text-4" id="text-org21071f4">
<p>
I hope this library will help make TOML a viable configuration file format for OCaml programs.
</p>

<p>
It's just the first version of course, so there's still room for improvement. For example, the lexer is especially
ugly: due to TOML being highly context-sensitive, it involves massive amounts of lexer hacks for context tracking.
Maybe ocamllex is a wrong tool for the job abd it should be replaced with something else (since I'm using Menhir's
incremental API anyway, it's not tied to any lexer API).
</p>

<p>
The printer is also less tested than the parser, so there may be unhandled edge cases. It also has some cosmetic
issues like newlines between parent and child tables.
</p>

<p>
Any feedback and patches are welcome!
</p>
</div>
</div>
</div>
</div>




<div id="outline-container-3" class="outline-2">
<h2 id="3">soupault: a static website generator based on HTML rewriting</h2>
<div class="outline-text-2" id="text-3">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-soupault-a-static-website-generator-based-on-html-rewriting/4126/15">https://discuss.ocaml.org/t/ann-soupault-a-static-website-generator-based-on-html-rewriting/4126/15</a>
</p>
</div>

<div id="outline-container-org8c7dcb7" class="outline-3">
<h3 id="org8c7dcb7">Daniil Baturin announced</h3>
<div class="outline-text-3" id="text-org8c7dcb7">
<p>
<a href="https://soupault.app/blog/soupault-3.0.0-release/">soupault 3.0.0</a> is now available.
</p>

<p>
It now uses the new <a href="https://opam.ocaml.org/packages/otoml/">OTOML</a> library for loading the configs, which has some
positive side effects, e.g. keys in the output of <code>soupault --show-effective-config</code> (that shows your config plus
default values you didn't set explicitly) now come in the same order as in your config file.
</p>

<p>
It also provides TOML and YAML parsing functions to Lua plugins and has colored log headers (can be disabled with
NO_COLOR environment variables).
</p>
</div>
</div>
</div>




<div id="outline-container-4" class="outline-2">
<h2 id="4">OCaml 4.13.0, second alpha release</h2>
<div class="outline-text-2" id="text-4">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ocaml-4-13-0-second-alpha-release/8164/1">https://discuss.ocaml.org/t/ocaml-4-13-0-second-alpha-release/8164/1</a>
</p>
</div>

<div id="outline-container-org915cd56" class="outline-3">
<h3 id="org915cd56">octachron announced</h3>
<div class="outline-text-3" id="text-org915cd56">
<p>
The release of OCaml 4.13.0 is approaching. We have released a second alpha version to help fellow hackers join us
early in our bug hunting and opam ecosystem fixing fun (see below for the installation instructions). You can see the
progress on this front at <a href="https://github.com/ocaml/opam-repository/issues/18791">https://github.com/ocaml/opam-repository/issues/18791</a> .
</p>

<p>
Beyond the usual bug fixes (see the full list below), this second alpha integrates a new feature for native code:
poll points. Those poll points currently fixes some issues with signals in non-allocating loops
in native code. More importantly, they are prerequisite for the multicore runtime.
</p>

<p>
Another change is the removal of the removal of interbranch propagation of type information.
The feature, already postponed from 4.12, has been removed to focus for now on better error
message in the <code>-principal</code> mode.
</p>

<p>
If you find any bugs, please report them here:
</p>

<p>
<a href="https://github.com/ocaml/ocaml/issues">https://github.com/ocaml/ocaml/issues</a>
</p>

<p>
The first beta release may follow soon since the opam ecosystem is in quite good shape;
and we are on track for a full release in September.
</p>

<p>
Happy hacking,
Florian Angeletti for the OCaml team.
</p>
</div>

<div id="outline-container-org463bd72" class="outline-4">
<h4 id="org463bd72">Installation instructions</h4>
<div class="outline-text-4" id="text-org463bd72">
<p>
The base compiler can be installed as an opam switch with the following commands
</p>
<div class="org-src-container">
<pre class="src src-shell">opam update
opam switch create 4.13.0~alpha2 --repositories=default,<span style="color: #a0522d;">beta</span>=git+https://github.com/ocaml/ocaml-beta-repository.git
</pre>
</div>

<p>
If you want to tweak the configuration of the compiler, you can switch to the option variant with:
</p>

<div class="org-src-container">
<pre class="src src-shell">opam update
opam switch create &lt;switch_name&gt; --packages=ocaml-variants.4.13.0~alpha2+options,&lt;option_list&gt;
--repositories=default,<span style="color: #a0522d;">beta</span>=git+https://github.com/ocaml/ocaml-beta-repository.git
</pre>
</div>
<p>
where &lt;option_list&gt; is a comma separated list of ocaml-option-* packages. For instance, for a flambda and
no-flat-float-array switch:
</p>
<div class="org-src-container">
<pre class="src src-shell">opam switch create 4.13.0~alpha2+flambda+nffa
--packages=ocaml-variants.4.13.0~alpha2+options,ocaml-option-flambda,ocaml-option-no-flat-float-array
--repositories=default,<span style="color: #a0522d;">beta</span>=git+https://github.com/ocaml/ocaml-beta-repository.git
</pre>
</div>
<p>
All available options can be listed with "opam search ocaml-option".
</p>

<p>
If you want to test this version, it is advised to install the alpha opam repository
</p>

<p>
<a href="https://github.com/kit-ty-kate/opam-alpha-repository">https://github.com/kit-ty-kate/opam-alpha-repository</a>
</p>

<p>
with
</p>
<div class="org-src-container">
<pre class="src src-shell">opam repo add alpha git://github.com/kit-ty-kate/opam-alpha-repository.git
</pre>
</div>
<p>
This alpha repository contains various fixes in the process of being upstreamed.
</p>

<p>
The source code for the alpha is also available at these addresses:
</p>

<ul class="org-ul">
<li><a href="https://github.com/ocaml/ocaml/archive/4.13.0-alpha2.tar.gz">https://github.com/ocaml/ocaml/archive/4.13.0-alpha2.tar.gz</a></li>
<li><a href="https://caml.inria.fr/pub/distrib/ocaml-4.13/ocaml-4.13.0~alpha2.tar.gz">https://caml.inria.fr/pub/distrib/ocaml-4.13/ocaml-4.13.0~alpha2.tar.gz</a></li>
</ul>
</div>
</div>

<div id="outline-container-org4ad6cb6" class="outline-4">
<h4 id="org4ad6cb6">Changes since the first alpha release</h4>
<div class="outline-text-4" id="text-org4ad6cb6">
</div>
<div id="outline-container-org586a157" class="outline-5">
<h5 id="org586a157">New feature</h5>
<div class="outline-text-5" id="text-org586a157">
<ul class="org-ul">
<li><a href="https://github.com/ocaml/ocaml/issues/10039">10039</a>: Safepoints
Add poll points to native generated code. These are effectively
zero-sized allocations and fix some signal and remembered set
issues. Also multicore prerequisite.
(Sadiq Jaffer, Stephen Dolan, Damien Doligez, Xavier Leroy,
Anmol Sahoo, Mark Shinwell, review by Damien Doligez, Xavier Leroy,
and Mark Shinwell)</li>
</ul>
</div>
</div>

<div id="outline-container-org01ad38c" class="outline-5">
<h5 id="org01ad38c">New bug fixes</h5>
<div class="outline-text-5" id="text-org01ad38c">
<ul class="org-ul">
<li><a href="https://github.com/ocaml/ocaml/issues/10449">10449</a>: Fix major GC work accounting (the GC was running too fast). (Damien Doligez, report by Stephen Dolan, review by Nicolás Ojeda Bär and Sadiq Jaffer)</li>

<li><a href="https://github.com/ocaml/ocaml/issues/10454">10454</a>: Check row_more in nondep_type_rec.
(Leo White, review by Thomas Refis)</li>

<li><a href="https://github.com/ocaml/ocaml/issues/10468">10468</a>: Correctly pretty print local type substitution, e.g. type t := &#x2026;, with -dsource (Matt Else, review by Florian Angeletti)</li>

<li><a href="https://github.com/ocaml/ocaml/issues/10461">10461</a>, <a href="https://github.com/ocaml/ocaml/issues/10498">10498</a>: <code>caml_send*</code> helper functions take derived pointers as arguments.  Those must be declared with type Addr instead of Val. Moreover, poll point insertion must be disabled for <code>caml_send*</code>, otherwise the derived pointer is live across a poll point. (Vincent Laviron and Xavier Leroy, review by Xavier Leroy and Sadiq Jaffer)</li>

<li><a href="https://github.com/ocaml/ocaml/issues/10478">10478</a>: Fix segfault under Windows due to a mistaken initialization of thread ID when a thread starts. (David Allsopp, Nicolás Ojeda Bär, review by Xavier Leroy)</li>

<li><a href="https://github.com/ocaml/ocaml/issues/9525">9525</a>, <a href="https://github.com/ocaml/ocaml/issues/10402">10402</a>: ocamldoc only create paragraphq at the toplevel of documentation comments (Florian Angeletti, report by Hendrik Tews, review by Gabriel Scherer)</li>

<li><a href="https://github.com/ocaml/ocaml/issues/10206">10206</a>: Split labels and polymorphic variants tutorials
Splits the labels and polymorphic variants tutorial into two. Moves the GADTs
tutorial from the Language Extensions chapter to the tutorials.
(John Whitington, review by Florian Angeletti and Xavier Leroy)</li>
</ul>
</div>
</div>

<div id="outline-container-orgff657de" class="outline-5">
<h5 id="orgff657de">Removed feature</h5>
<div class="outline-text-5" id="text-orgff657de">
<ul class="org-ul">
<li>[ <b>breaking change</b> ] <a href="https://github.com/ocaml/ocaml/issues/9811">9811</a>: remove propagation from previous branches Type information inferred from previous branches was propagated in non-principal mode. Revert this for better compatibility with -principal mode. For the time being, infringing code should result in a principality warning. (Jacques Garrigue, review by Thomas Refis and Gabriel Scherer)</li>
</ul>

<p>
The up-to-date list of changes for OCaml 4.13 is available at <a href="https://github.com/ocaml/ocaml/blob/4.13/Changes">https://github.com/ocaml/ocaml/blob/4.13/Changes</a> .
</p>
</div>
</div>
</div>
</div>
</div>




<div id="outline-container-5" class="outline-2">
<h2 id="5">OCamlFormat 0.19.0</h2>
<div class="outline-text-2" id="text-5">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ann-ocamlformat-0-19-0/8167/1">https://discuss.ocaml.org/t/ann-ocamlformat-0-19-0/8167/1</a>
</p>
</div>

<div id="outline-container-org0cefdde" class="outline-3">
<h3 id="org0cefdde">Guillaume Petiot announced</h3>
<div class="outline-text-3" id="text-org0cefdde">
<p>
We are happy to announce the release of <a href="https://github.com/ocaml-ppx/ocamlformat">OCamlFormat 0.19.0</a>.
</p>

<p>
OCamlformat is an auto-formatter for OCaml code, writing the parse tree and comments in a consistent style, so that
you do not have to worry about formatting it by hand, and to speed up code review by focusing on the important parts.
</p>

<p>
OCamlFormat is beta software. We expect the program to change considerably before we reach version 1.0.0. In
particular, upgrading the `ocamlformat` package will cause your program to get reformatted. Sometimes it is
relatively pain-free, but sometimes it will make a diff in almost every file. We are working towards having a tool
that pleases most usecases in the OCaml community, please bear with us!
</p>

<p>
To make sure your project uses the last version of ocamlformat, please set
</p>

<pre class="example" id="org54c7115">
version=0.19.0
</pre>

<p>
in your <code>.ocamlformat</code> file.
</p>

<p>
Main changes in <code>ocamlformat.0.19.0</code> are:
</p>
<ul class="org-ul">
<li>OCaml 4.13 features are supported</li>
<li><code>ppxlib</code> dependency has been dropped</li>
<li>A new <code>line-endings={lf,crlf}</code> option has been added for windows compatibility</li>
</ul>

<p>
Here is the <a href="https://github.com/ocaml-ppx/ocamlformat/releases/tag/0.19.0">full list of changes</a>.
</p>

<p>
We encourage you to try ocamlformat, that can be installed from opam directly ( <code>opam install ocamlformat</code> ), but
please remember that it is still beta software. We have a <a href="https://github.com/ocaml-ppx/ocamlformat#faq-for-new-users">FAQ for new users
</a> that should help you decide if ocamlformat is the right
choice for you.
</p>
</div>
</div>


<div id="outline-container-org7d4e089" class="outline-3">
<h3 id="org7d4e089">Nicolás Ojeda Bär then added</h3>
<div class="outline-text-3" id="text-org7d4e089">
<blockquote>
<p>
A new <code>line-endings={lf,crlf}</code> option has been added for windows compatibility
</p>
</blockquote>

<p>
Just to expand a bit on this feature: previously, <code>ocamlformat</code> would use the system EOL convention (ie LF on
Unix-like OSs and CRLF on Windows). This meant that if you applied <code>ocamlformat</code> on systems with different EOL
conventions, you would get a diff on every line on every file purely due to the changed newlines. Furthermore, this
meant <code>ocamlformat</code> was hard to use if your project used LF on Windows (a common usage).
</p>

<p>
With the new option, <code>ocamlformat</code> enforces a given EOL convention. The system EOL convention is no longer used for
any purpose and the EOL convention used is the one specified in <code>ocamlformat</code>'s config (LF by default).
</p>
</div>
</div>
</div>




<div id="outline-container-6" class="outline-2">
<h2 id="6">OCaml Café: Wed, Aug 4 @ 7pm (U.S. Central)</h2>
<div class="outline-text-2" id="text-6">
<p>
Archive: <a href="https://discuss.ocaml.org/t/ocaml-cafe-wed-aug-4-7pm-u-s-central/8169/1">https://discuss.ocaml.org/t/ocaml-cafe-wed-aug-4-7pm-u-s-central/8169/1</a>
</p>
</div>

<div id="outline-container-org27538cc" class="outline-3">
<h3 id="org27538cc">Michael Bacarella announced</h3>
<div class="outline-text-3" id="text-org27538cc">
<p>
Please join us at the next OCaml Cafe, a friendly, low stakes opportunity to ask questions about the OCaml language
and ecosystem, work through programming problems that you’re stuck on, and get feedback on your code. Especially
geared toward new and intermediate users, experienced OCaml developers will be available to answer your questions.
Bring your code and we’ll be happy to review it, assist with debugging, and provide recommendations for improvement.
</p>

<p>
This month, OCaml Café will consist of two parts. First, Rudi Grinberg of <a href="https://ocamllabs.io/">OCaml Labs</a> will
present an informal introduction to <a href="https://dune.build/">Dune</a>, the OCaml build system. Learn about Dune from one
the people developing it. Following Rudi’s presentation, we will open the discussion to all things OCaml-related.
</p>

<p>
Full <a href="https://hfpug.org/event/ocaml-cafe-introduction-to-dune-and-open-forum/">Zoom meeting details here</a>.
</p>
<ul class="org-ul">
<li>Add to your <a href="https://www.google.com/calendar/event?action=TEMPLATE&amp;text=OCaml+Caf%C3%A9%3A+Introduction+to+Dune+and+Open+Forum&amp;dates=20210804T190000/20210804T210000&amp;details=OCaml+Caf%C3%A9+offers+a+friendly%2C+low+stakes+opportunity+to+ask+questions+about+the+OCaml+language+and+ecosystem%2C+work+through+programming+problems+that+you%E2%80%99re+stuck+on%2C+and+get+feedback+on+your+code.+Especially+geared+toward+new+and+intermediate+users%2C+experienced+OCaml+developers+will+be+available+to+answer+your+questions.%C2%A0+Bring+your+code+and+we%26%238217%3Bll+be+happy+to+review+it%2C+assist+with+debugging%2C+and+provide+recommendations+for+improvement.+%0AThis+month%2C+OCaml+Caf%C3%A9+will+consist+of+two+parts.%C2%A0+First%2C+Rudi+Grinberg+of+OCaml+Labs+will+present+an+informal+introduction+to+Dune%2C+the+OCaml+build+system.%C2%A0+Learn+about+Dune+from+one+the+people+developing+it.%C2%A0+Following+Rudi%26%238217%3Bs+presentation%2C+we+will+open+the+discussion+to+all+things+OCaml-related.+%0AWhether+you%E2%80%99re+still+trying+to+make+sense+of+currying+or+can+spot+non-tail-recursive+code+from+across+the+room%2C+we+hope+that+you%E2%80%99ll+join+us+with+your+questions+about+OCaml%2C+or+just+to+hang+out+with+the+OCaml+community.+%0A%0AClaude+Ru+%28View+Full+Event+Description+Here%3A+https%3A%2F%2Fhfpug.org%2Fevent%2Focaml-cafe-introduction-to-dune-and-open-forum%2F%29&amp;location=Zoom&amp;trp=false&amp;sprop=website:https://hfpug.org&amp;ctz=America%2FChicago">Google Calendar</a></li>
<li>Add to your <a href="https://hfpug.org/event/ocaml-cafe-introduction-to-dune-and-open-forum/?ical=1">iCal</a></li>
</ul>
</div>
</div>
</div>




<div id="outline-container-orgb1dbfaf" class="outline-2">
<h2 id="orgb1dbfaf">Old CWN</h2>
<div class="outline-text-2" id="text-orgb1dbfaf">
<p>
If you happen to miss a CWN, you can <a href="mailto:alan.schmitt@polytechnique.org">send me a message</a> and I'll mail it to you, or go take a look at <a href="https://alan.petitepomme.net/cwn/">the archive</a> or the <a href="https://alan.petitepomme.net/cwn/cwn.rss">RSS feed of the archives</a>.
</p>

<p>
If you also wish to receive it every week by mail, you may subscribe <a href="http://lists.idyll.org/listinfo/caml-news-weekly/">online</a>.
</p>

<div class="authorname" id="orgbd414d0">
<p>
<a href="https://alan.petitepomme.net/">Alan Schmitt</a>
</p>

</div>
</div>
</div>
</div>
</body>
</html>
